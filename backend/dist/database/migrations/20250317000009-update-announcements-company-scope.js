"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// src/database/migrations/20250123003-update-announcements-company-scope.ts
const sequelize_1 = require("sequelize");
exports.default = {
    up: async (queryInterface) => {
        // Adicionar campo targetCompanyId para permitir informativos específicos por empresa
        await queryInterface.addColumn('Announcements', 'targetCompanyId', {
            type: sequelize_1.DataTypes.INTEGER,
            allowNull: true,
            references: {
                model: 'Companies',
                key: 'id'
            },
            onUpdate: 'CASCADE',
            onDelete: 'SET NULL',
            comment: 'ID da empresa alvo. NULL = todas as empresas'
        });
        // Adicionar campo type para categorizar os informativos
        await queryInterface.addColumn('Announcements', 'type', {
            type: sequelize_1.DataTypes.ENUM('general', 'birthday', 'system'),
            allowNull: false,
            defaultValue: 'general',
            comment: 'Tipo do informativo'
        });
        // Adicionar campo isAutoGenerated para identificar informativos automáticos
        await queryInterface.addColumn('Announcements', 'isAutoGenerated', {
            type: sequelize_1.DataTypes.BOOLEAN,
            allowNull: false,
            defaultValue: false,
            comment: 'Informativo gerado automaticamente pelo sistema'
        });
        // Adicionar campo expiresAt para informativos temporários
        await queryInterface.addColumn('Announcements', 'expiresAt', {
            type: sequelize_1.DataTypes.DATE,
            allowNull: true,
            comment: 'Data de expiração do informativo'
        });
        // Adicionar índices
        await queryInterface.addIndex('Announcements', ['targetCompanyId'], {
            name: 'idx_announcements_target_company_id'
        });
        await queryInterface.addIndex('Announcements', ['type'], {
            name: 'idx_announcements_type'
        });
        await queryInterface.addIndex('Announcements', ['isAutoGenerated'], {
            name: 'idx_announcements_auto_generated'
        });
        await queryInterface.addIndex('Announcements', ['expiresAt'], {
            name: 'idx_announcements_expires_at'
        });
    },
    down: async (queryInterface) => {
        // Remover índices
        await queryInterface.removeIndex('Announcements', 'idx_announcements_target_company_id');
        await queryInterface.removeIndex('Announcements', 'idx_announcements_type');
        await queryInterface.removeIndex('Announcements', 'idx_announcements_auto_generated');
        await queryInterface.removeIndex('Announcements', 'idx_announcements_expires_at');
        // Remover colunas
        await queryInterface.removeColumn('Announcements', 'targetCompanyId');
        await queryInterface.removeColumn('Announcements', 'type');
        await queryInterface.removeColumn('Announcements', 'isAutoGenerated');
        await queryInterface.removeColumn('Announcements', 'expiresAt');
    }
};
