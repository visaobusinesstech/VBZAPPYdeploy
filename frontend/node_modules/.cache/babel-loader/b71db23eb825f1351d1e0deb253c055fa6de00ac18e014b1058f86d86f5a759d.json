{"ast":null,"code":"import io from\"socket.io-client\";import api from\"../services/api\";class SocketWorker{constructor(companyId,userId){const sessionToken=api.defaults.headers.Authorization;if(!SocketWorker.instance){this.companyId=companyId;this.userId=userId;this.token=sessionToken;this.socket=null;this.configureSocket();this.eventListeners={};// Armazena os ouvintes de eventos registrados\nSocketWorker.instance=this;}return SocketWorker.instance;}configureSocket(){this.socket=io(\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/\").concat(this===null||this===void 0?void 0:this.companyId),{autoConnect:true,reconnection:true,reconnectionDelay:1000,reconnectionAttempts:Infinity,// transports: [\"websocket\", \"polling\", \"flashsocket\"],\n// pingTimeout: 18000,\n// pingInterval: 18000,\nquery:{userId:this.userId,token:this.token}});this.socket.on(\"connect\",()=>{console.log(\"Conectado ao servidor Socket.IO\");});this.socket.on(\"disconnect\",()=>{console.log(\"Desconectado do servidor Socket.IO\");this.reconnectAfterDelay();});}// Adiciona um ouvinte de eventos\non(event,callback){this.connect();this.socket.on(event,callback);// Armazena o ouvinte no objeto de ouvintes\nif(!this.eventListeners[event]){this.eventListeners[event]=[];}this.eventListeners[event].push(callback);}// Emite um evento\nemit(event,data){this.connect();this.socket.emit(event,data);}// Desconecta um ou mais ouvintes de eventos\noff(event,callback){// console.log(event, callback)\nthis.connect();if(this.eventListeners[event]){// console.log(\"Desconectando do servidor Socket.IO:\", event, callback);\nif(callback){// Desconecta um ouvinte específico\nthis.socket.off(event,callback);this.eventListeners[event]=this.eventListeners[event].filter(cb=>cb!==callback);}else{// console.log(\"DELETOU EVENTOS DO SOCKET:\", this.eventListeners[event]);\n// Desconecta todos os ouvintes do evento\nthis.eventListeners[event].forEach(cb=>this.socket.off(event,cb));delete this.eventListeners[event];}// console.log(\"EVENTOS DO SOCKET:\", this.eventListeners);\n}}disconnect(){if(this.socket){this.socket.disconnect();this.socket=null;this.instance=null;console.log(\"Socket desconectado manualmente\");}}reconnectAfterDelay(){setTimeout(()=>{if(!this.socket||!this.socket.connected){console.log(\"Tentando reconectar após desconexão\");this.connect();}},1000);}// Garante que o socket esteja conectado\nconnect(){if(!this.socket){this.configureSocket();}}forceReconnect(){}}// const instance = (companyId, userId) => new SocketWorker(companyId,userId);\nconst instance=(companyId,userId)=>new SocketWorker(companyId,userId);export default instance;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}