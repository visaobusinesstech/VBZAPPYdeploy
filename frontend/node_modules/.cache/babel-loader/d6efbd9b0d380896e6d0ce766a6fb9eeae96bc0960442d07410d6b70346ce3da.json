{"ast":null,"code":"import _objectSpread from\"/home/deploy/codigologlow/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useContext,useState}from\"react\";import{Stepper,Step,StepLabel,Button,Typography,CircularProgress}from\"@material-ui/core\";import{Formik,Form}from\"formik\";import AddressForm from\"./Forms/AddressForm\";import PaymentForm from\"./Forms/PaymentForm\";import ReviewOrder from\"./ReviewOrder\";import CheckoutSuccess from\"./CheckoutSuccess\";import api from\"../../services/api\";import toastError from\"../../errors/toastError\";import{toast}from\"react-toastify\";import{AuthContext}from\"../../context/Auth/AuthContext\";import validationSchema from\"./FormModel/validationSchema\";import checkoutFormModel from\"./FormModel/checkoutFormModel\";import formInitialValues from\"./FormModel/formInitialValues\";import useStyles from\"./styles\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function CheckoutPage(props){const steps=[\"Dados\",\"Personalizar\",\"Revisar\"];const{formId,formField}=checkoutFormModel;const classes=useStyles();const[activeStep,setActiveStep]=useState(1);const[datePayment,setDatePayment]=useState(null);const[invoiceId,setinvoiceId]=useState(props.Invoice.id);const currentValidationSchema=validationSchema[activeStep];const isLastStep=activeStep===steps.length-1;const{user,socket}=useContext(AuthContext);function _renderStepContent(step,setFieldValue,setActiveStep,values){switch(step){case 0:return/*#__PURE__*/_jsx(AddressForm,{formField:formField,values:values,setFieldValue:setFieldValue});case 1:return/*#__PURE__*/_jsx(PaymentForm,{formField:formField,setFieldValue:setFieldValue,setActiveStep:setActiveStep,activeStep:step,invoiceId:invoiceId,values:values});case 2:return/*#__PURE__*/_jsx(ReviewOrder,{});default:return/*#__PURE__*/_jsx(\"div\",{children:\"Not Found\"});}}async function _submitForm(values,actions){try{const plan=JSON.parse(values.plan);const newValues={firstName:values.firstName,lastName:values.lastName,address2:values.address2,city:values.city,state:values.state,zipcode:values.zipcode,country:values.country,useAddressForPaymentDetails:values.useAddressForPaymentDetails,nameOnCard:values.nameOnCard,cardNumber:values.cardNumber,cvv:values.cvv,plan:values.plan,price:plan.price,users:plan.users,connections:plan.connections,invoiceId:invoiceId};const{data}=await api.post(\"/subscription\",newValues);console.log(data);setDatePayment(data);actions.setSubmitting(false);setActiveStep(activeStep+1);toast.success(\"Assinatura realizada com sucesso!, aguardando a realização do pagamento\");}catch(err){toastError(err);}}function _handleSubmit(values,actions){if(isLastStep){_submitForm(values,actions);}else{setActiveStep(activeStep+1);actions.setTouched({});actions.setSubmitting(false);}}function _handleBack(){setActiveStep(activeStep-1);}return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h4\",align:\"center\",children:\"Falta pouco!\"}),/*#__PURE__*/_jsx(Stepper,{activeStep:activeStep,className:classes.stepper,children:steps.map(label=>/*#__PURE__*/_jsx(Step,{children:/*#__PURE__*/_jsx(StepLabel,{children:label})},label))}),/*#__PURE__*/_jsx(React.Fragment,{children:activeStep===steps.length?/*#__PURE__*/_jsx(CheckoutSuccess,{pix:datePayment}):/*#__PURE__*/_jsx(Formik,{initialValues:_objectSpread(_objectSpread({},user),formInitialValues),validationSchema:currentValidationSchema,onSubmit:_handleSubmit,children:_ref=>{let{isSubmitting,setFieldValue,values}=_ref;return/*#__PURE__*/_jsxs(Form,{id:formId,children:[_renderStepContent(activeStep,setFieldValue,setActiveStep,values),/*#__PURE__*/_jsxs(\"div\",{className:classes.buttons,children:[activeStep!==1&&activeStep!==0&&/*#__PURE__*/_jsx(Button,{onClick:_handleBack,className:classes.button,children:\"VOLTAR\"}),/*#__PURE__*/_jsxs(\"div\",{className:classes.wrapper,children:[activeStep!==1&&/*#__PURE__*/_jsx(Button,{disabled:isSubmitting,type:\"submit\",variant:\"contained\",color:\"primary\",className:classes.button,children:isLastStep?\"PAGAR\":\"PRÓXIMO\"}),isSubmitting&&/*#__PURE__*/_jsx(CircularProgress,{size:24,className:classes.buttonProgress})]})]})]});}})})]});}","map":{"version":3,"names":["React","useContext","useState","Stepper","Step","StepLabel","Button","Typography","CircularProgress","Formik","Form","AddressForm","PaymentForm","ReviewOrder","CheckoutSuccess","api","toastError","toast","AuthContext","validationSchema","checkoutFormModel","formInitialValues","useStyles","jsx","_jsx","jsxs","_jsxs","CheckoutPage","props","steps","formId","formField","classes","activeStep","setActiveStep","datePayment","setDatePayment","invoiceId","setinvoiceId","Invoice","id","currentValidationSchema","isLastStep","length","user","socket","_renderStepContent","step","setFieldValue","values","children","_submitForm","actions","plan","JSON","parse","newValues","firstName","lastName","address2","city","state","zipcode","country","useAddressForPaymentDetails","nameOnCard","cardNumber","cvv","price","users","connections","data","post","console","log","setSubmitting","success","err","_handleSubmit","setTouched","_handleBack","Fragment","component","variant","align","className","stepper","map","label","pix","initialValues","_objectSpread","onSubmit","_ref","isSubmitting","buttons","onClick","button","wrapper","disabled","type","color","size","buttonProgress"],"sources":["/home/deploy/codigologlow/frontend/src/components/CheckoutPage/CheckoutPage.js"],"sourcesContent":["import React, { useContext, useState } from \"react\";\nimport {\n  Stepper,\n  Step,\n  StepLabel,\n  Button,\n  Typography,\n  CircularProgress,\n} from \"@material-ui/core\";\nimport { Formik, Form } from \"formik\";\n\nimport AddressForm from \"./Forms/AddressForm\";\nimport PaymentForm from \"./Forms/PaymentForm\";\nimport ReviewOrder from \"./ReviewOrder\";\nimport CheckoutSuccess from \"./CheckoutSuccess\";\n\nimport api from \"../../services/api\";\nimport toastError from \"../../errors/toastError\";\nimport { toast } from \"react-toastify\";\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\n\nimport validationSchema from \"./FormModel/validationSchema\";\nimport checkoutFormModel from \"./FormModel/checkoutFormModel\";\nimport formInitialValues from \"./FormModel/formInitialValues\";\n\nimport useStyles from \"./styles\";\n\nexport default function CheckoutPage(props) {\n  const steps = [\"Dados\", \"Personalizar\", \"Revisar\"];\n  const { formId, formField } = checkoutFormModel;\n\n  const classes = useStyles();\n  const [activeStep, setActiveStep] = useState(1);\n  const [datePayment, setDatePayment] = useState(null);\n  const [invoiceId, setinvoiceId] = useState(props.Invoice.id);\n  const currentValidationSchema = validationSchema[activeStep];\n  const isLastStep = activeStep === steps.length - 1;\n  const { user, socket } = useContext(AuthContext);\n\n  function _renderStepContent(step, setFieldValue, setActiveStep, values) {\n\n    switch (step) {\n      case 0:\n        return <AddressForm formField={formField} values={values} setFieldValue={setFieldValue} />;\n      case 1:\n        return <PaymentForm\n          formField={formField}\n          setFieldValue={setFieldValue}\n          setActiveStep={setActiveStep}\n          activeStep={step}\n          invoiceId={invoiceId}\n          values={values}\n        />;\n      case 2:\n        return <ReviewOrder />;\n      default:\n        return <div>Not Found</div>;\n    }\n  }\n\n  async function _submitForm(values, actions) {\n    try {\n      const plan = JSON.parse(values.plan);\n      const newValues = {\n        firstName: values.firstName,\n        lastName: values.lastName,\n        address2: values.address2,\n        city: values.city,\n        state: values.state,\n        zipcode: values.zipcode,\n        country: values.country,\n        useAddressForPaymentDetails: values.useAddressForPaymentDetails,\n        nameOnCard: values.nameOnCard,\n        cardNumber: values.cardNumber,\n        cvv: values.cvv,\n        plan: values.plan,\n        price: plan.price,\n        users: plan.users,\n        connections: plan.connections,\n        invoiceId: invoiceId\n      }\n\n      const { data } = await api.post(\"/subscription\", newValues);\n      console.log(data);\n      setDatePayment(data)\n      actions.setSubmitting(false);\n      setActiveStep(activeStep + 1);\n      toast.success(\"Assinatura realizada com sucesso!, aguardando a realização do pagamento\");\n    } catch (err) {\n      toastError(err);\n    }\n  }\n\n  function _handleSubmit(values, actions) {\n    if (isLastStep) {\n      _submitForm(values, actions);\n    } else {\n      setActiveStep(activeStep + 1);\n      actions.setTouched({});\n      actions.setSubmitting(false);\n    }\n  }\n\n  function _handleBack() {\n    setActiveStep(activeStep - 1);\n  }\n\n  return (\n    <React.Fragment>\n      <Typography component=\"h1\" variant=\"h4\" align=\"center\">\n        Falta pouco!\n      </Typography>\n      <Stepper activeStep={activeStep} className={classes.stepper}>\n        {steps.map((label) => (\n          <Step key={label}>\n            <StepLabel>{label}</StepLabel>\n          </Step>\n        ))}\n      </Stepper>\n      <React.Fragment>\n        {activeStep === steps.length ? (\n          <CheckoutSuccess pix={datePayment} />\n        ) : (\n          <Formik\n            initialValues={{\n              ...user,\n              ...formInitialValues\n            }}\n            validationSchema={currentValidationSchema}\n            onSubmit={_handleSubmit}\n          >\n            {({ isSubmitting, setFieldValue, values }) => (\n              <Form id={formId}>\n                {_renderStepContent(activeStep, setFieldValue, setActiveStep, values)}\n\n                <div className={classes.buttons}>\n                  {activeStep !== 1 && activeStep !== 0 && (\n                    <Button onClick={_handleBack} className={classes.button}>\n                      VOLTAR\n                    </Button>\n                  )}\n                  <div className={classes.wrapper}>\n                    {activeStep !== 1 && (\n                      <Button\n                        disabled={isSubmitting}\n                        type=\"submit\"\n                        variant=\"contained\"\n                        color=\"primary\"\n                        className={classes.button}\n                      >\n                        {isLastStep ? \"PAGAR\" : \"PRÓXIMO\"}\n                      </Button>\n                    )}\n                    {isSubmitting && (\n                      <CircularProgress\n                        size={24}\n                        className={classes.buttonProgress}\n                      />\n                    )}\n                  </div>\n                </div>\n              </Form>\n            )}\n          </Formik>\n        )}\n      </React.Fragment>\n    </React.Fragment>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}