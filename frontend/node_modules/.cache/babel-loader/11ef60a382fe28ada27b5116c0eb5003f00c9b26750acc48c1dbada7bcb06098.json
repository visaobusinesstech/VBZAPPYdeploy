{"ast":null,"code":"import React,{useEffect,useState,useContext}from'react';import{useHistory}from\"react-router-dom\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";import Avatar from\"@material-ui/core/Avatar\";import Typography from\"@material-ui/core/Typography\";import Grid from\"@material-ui/core/Grid\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{Button,Divider}from\"@material-ui/core\";import{isNil}from'lodash';import ShowTicketOpen from'../ShowTicketOpenModal';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const VcardPreview=_ref=>{let{contact,numbers,queueId,whatsappId,channel}=_ref;const history=useHistory();const{user}=useContext(AuthContext);const companyId=user.companyId;const[openAlert,setOpenAlert]=useState(false);const[userTicketOpen,setUserTicketOpen]=useState(\"\");const[queueTicketOpen,setQueueTicketOpen]=useState(\"\");const[selectedContact,setContact]=useState({id:0,name:\"\",number:0,profilePicUrl:\"\"});useEffect(()=>{const delayDebounceFn=setTimeout(()=>{const fetchContacts=async()=>{try{if(isNil(numbers)){return;}const number=numbers.replace(/\\D/g,\"\");const getData=await api.get(\"/contacts/profile/\".concat(number),{params:{channel:channel}});if(getData.data.contactId&&getData.data.contactId!==0){let obj={id:getData.data.contactId,name:contact,number:numbers,urlPicture:getData.data.urlPicture};setContact(obj);}else{let contactObj={name:contact,number:number,email:\"\",companyId:companyId};const{data}=await api.post(\"/contacts\",contactObj);setContact(data);}}catch(err){console.log(err);toastError(err);}};fetchContacts();},500);return()=>clearTimeout(delayDebounceFn);},[companyId,contact,numbers]);const handleCloseAlert=()=>{setOpenAlert(false);setOpenAlert(false);setUserTicketOpen(\"\");setQueueTicketOpen(\"\");};const handleNewChat=async()=>{try{const{data:ticket}=await api.post(\"/tickets\",{contactId:selectedContact.id,userId:user.id,status:\"open\",queueId,companyId:companyId,whatsappId});history.push(\"/tickets/\".concat(ticket.uuid));}catch(err){const ticket=JSON.parse(err.response.data.error);if(ticket.userId!==(user===null||user===void 0?void 0:user.id)){var _ticket$user,_ticket$queue;setOpenAlert(true);setUserTicketOpen(ticket===null||ticket===void 0?void 0:(_ticket$user=ticket.user)===null||_ticket$user===void 0?void 0:_ticket$user.name);setQueueTicketOpen(ticket===null||ticket===void 0?void 0:(_ticket$queue=ticket.queue)===null||_ticket$queue===void 0?void 0:_ticket$queue.name);}else{setOpenAlert(false);setUserTicketOpen(\"\");setQueueTicketOpen(\"\");history.push(\"/tickets/\".concat(ticket.uuid));}}};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{style:{minWidth:\"250px\"},children:[/*#__PURE__*/_jsx(ShowTicketOpen,{isOpen:openAlert,handleClose:handleCloseAlert,user:userTicketOpen,queue:queueTicketOpen}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:2,children:/*#__PURE__*/_jsx(Avatar,{src:\"\".concat(selectedContact===null||selectedContact===void 0?void 0:selectedContact.urlPicture)})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:9,children:/*#__PURE__*/_jsx(Typography,{style:{marginTop:\"12px\",marginLeft:\"10px\"},color:\"primary\",variant:\"subtitle1\",gutterBottom:true,children:selectedContact.name})}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Button,{fullWidth:true,color:\"primary\",onClick:handleNewChat,disabled:!selectedContact.number,children:\"Conversar\"})]})]})]})});};export default VcardPreview;","map":{"version":3,"names":["React","useEffect","useState","useContext","useHistory","toastError","api","Avatar","Typography","Grid","AuthContext","Button","Divider","isNil","ShowTicketOpen","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","VcardPreview","_ref","contact","numbers","queueId","whatsappId","channel","history","user","companyId","openAlert","setOpenAlert","userTicketOpen","setUserTicketOpen","queueTicketOpen","setQueueTicketOpen","selectedContact","setContact","id","name","number","profilePicUrl","delayDebounceFn","setTimeout","fetchContacts","replace","getData","get","concat","params","data","contactId","obj","urlPicture","contactObj","email","post","err","console","log","clearTimeout","handleCloseAlert","handleNewChat","ticket","userId","status","push","uuid","JSON","parse","response","error","_ticket$user","_ticket$queue","queue","children","style","minWidth","isOpen","handleClose","container","spacing","item","xs","src","marginTop","marginLeft","color","variant","gutterBottom","fullWidth","onClick","disabled"],"sources":["/home/deploy/codigologlow/frontend/src/components/VcardPreview/index.js"],"sourcesContent":["import React, { useEffect, useState, useContext } from 'react';\nimport { useHistory } from \"react-router-dom\";\nimport toastError from \"../../errors/toastError\";\nimport api from \"../../services/api\";\n\nimport Avatar from \"@material-ui/core/Avatar\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Grid from \"@material-ui/core/Grid\";\n\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\n\nimport { Button, Divider } from \"@material-ui/core\";\nimport { isNil } from 'lodash';\nimport ShowTicketOpen from '../ShowTicketOpenModal';\n\nconst VcardPreview = ({ contact, numbers, queueId, whatsappId, channel }) => {\n    const history = useHistory();\n    const { user } = useContext(AuthContext);\n\n    const companyId = user.companyId;\n\n    const [openAlert, setOpenAlert] = useState(false);\n    const [userTicketOpen, setUserTicketOpen] = useState(\"\");\n    const [queueTicketOpen, setQueueTicketOpen] = useState(\"\");\n\n    const [selectedContact, setContact] = useState({\n        id: 0,\n        name: \"\",\n        number: 0,\n        profilePicUrl: \"\"\n    });\n\n    useEffect(() => {\n        const delayDebounceFn = setTimeout(() => {\n            const fetchContacts = async () => {\n                try {\n                    if (isNil(numbers)) {\n                        return\n                    }\n                    const number = numbers.replace(/\\D/g, \"\");\n                    const getData = await api.get(`/contacts/profile/${number}`, { params: { channel: channel } });\n\n                    if (getData.data.contactId && getData.data.contactId !== 0) {\n                        let obj = {\n                            id: getData.data.contactId,\n                            name: contact,\n                            number: numbers,\n                            urlPicture: getData.data.urlPicture\n                        }\n\n                        setContact(obj)\n                    } else {\n                        let contactObj = {\n                            name: contact,\n                            number: number,\n                            email: \"\",\n                            companyId: companyId\n                        }\n\n                        const { data } = await api.post(\"/contacts\", contactObj);\n                        setContact(data)\n                    }\n\n                } catch (err) {\n                    console.log(err)\n                    toastError(err);\n                }\n            };\n            fetchContacts();\n        }, 500);\n        return () => clearTimeout(delayDebounceFn);\n    }, [companyId, contact, numbers]);\n\n    const handleCloseAlert = () => {\n        setOpenAlert(false);\n        setOpenAlert(false);\n        setUserTicketOpen(\"\");\n        setQueueTicketOpen(\"\");\n    };\n\n    const handleNewChat = async () => {\n        try {\n            const { data: ticket } = await api.post(\"/tickets\", {\n                contactId: selectedContact.id,\n                userId: user.id,\n                status: \"open\",\n                queueId,\n                companyId: companyId,\n                whatsappId\n            });\n\n            history.push(`/tickets/${ticket.uuid}`);\n        } catch (err) {\n            const ticket = JSON.parse(err.response.data.error);\n\n            if (ticket.userId !== user?.id) {\n                setOpenAlert(true);\n                setUserTicketOpen(ticket?.user?.name);\n                setQueueTicketOpen(ticket?.queue?.name);\n            } else {\n                setOpenAlert(false);\n                setUserTicketOpen(\"\");\n                setQueueTicketOpen(\"\");\n\n                history.push(`/tickets/${ticket.uuid}`);\n            }\n        }\n    }\n\n    return (\n        <>\n            <div style={{\n                minWidth: \"250px\",\n            }}>\n                <ShowTicketOpen\n                    isOpen={openAlert}\n                    handleClose={handleCloseAlert}\n                    user={userTicketOpen}\n                    queue={queueTicketOpen}\n                />\n                <Grid container spacing={1}>\n                    <Grid item xs={2}>\n                        <Avatar src={`${selectedContact?.urlPicture}`} />\n                    </Grid>\n                    <Grid item xs={9}>\n                        <Typography\n                            style={{ marginTop: \"12px\", marginLeft: \"10px\" }}\n                            color=\"primary\"\n                            variant=\"subtitle1\"\n                            gutterBottom\n                        >\n                            {selectedContact.name}\n                        </Typography>\n                    </Grid>\n                    <Grid item xs={12}>\n                        <Divider />\n                        <Button\n                            fullWidth\n                            color=\"primary\"\n                            onClick={handleNewChat}\n                            disabled={!selectedContact.number}\n                        >Conversar</Button>\n                    </Grid>\n                </Grid>\n            </div>\n        </>\n    );\n\n};\n\nexport default VcardPreview;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}