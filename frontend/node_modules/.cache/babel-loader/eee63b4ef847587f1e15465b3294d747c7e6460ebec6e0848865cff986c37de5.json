{"ast":null,"code":"import io from\"socket.io-client\";import api from\"../services/api\";class SocketWorker{constructor(companyId,userId){const sessionToken=api.defaults.headers.Authorization;if(!SocketWorker.instance){this.companyId=companyId;this.userId=userId;this.token=sessionToken;this.socket=null;this.configureSocket();this.eventListeners={};// Armazena os ouvintes de eventos registrados\nSocketWorker.instance=this;}return SocketWorker.instance;}configureSocket(){this.socket=io(\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/\").concat(this===null||this===void 0?void 0:this.companyId),{autoConnect:true,reconnection:true,reconnectionDelay:1000,reconnectionAttempts:Infinity,// transports: [\"websocket\", \"polling\", \"flashsocket\"],\n// pingTimeout: 18000,\n// pingInterval: 18000,\nquery:{userId:this.userId,token:this.token}});this.socket.on(\"connect\",()=>{console.log(\"Conectado ao servidor Socket.IO\");});this.socket.on(\"disconnect\",()=>{console.log(\"Desconectado do servidor Socket.IO\");this.reconnectAfterDelay();});}// Adiciona um ouvinte de eventos\non(event,callback){this.connect();this.socket.on(event,callback);// Armazena o ouvinte no objeto de ouvintes\nif(!this.eventListeners[event]){this.eventListeners[event]=[];}this.eventListeners[event].push(callback);}// Emite um evento\nemit(event,data){this.connect();this.socket.emit(event,data);}// Desconecta um ou mais ouvintes de eventos\noff(event,callback){// console.log(event, callback)\nthis.connect();if(this.eventListeners[event]){// console.log(\"Desconectando do servidor Socket.IO:\", event, callback);\nif(callback){// Desconecta um ouvinte específico\nthis.socket.off(event,callback);this.eventListeners[event]=this.eventListeners[event].filter(cb=>cb!==callback);}else{// console.log(\"DELETOU EVENTOS DO SOCKET:\", this.eventListeners[event]);\n// Desconecta todos os ouvintes do evento\nthis.eventListeners[event].forEach(cb=>this.socket.off(event,cb));delete this.eventListeners[event];}// console.log(\"EVENTOS DO SOCKET:\", this.eventListeners);\n}}disconnect(){if(this.socket){this.socket.disconnect();this.socket=null;this.instance=null;console.log(\"Socket desconectado manualmente\");}}reconnectAfterDelay(){setTimeout(()=>{if(!this.socket||!this.socket.connected){console.log(\"Tentando reconectar após desconexão\");this.connect();}},1000);}// Garante que o socket esteja conectado\nconnect(){if(!this.socket){this.configureSocket();}}forceReconnect(){}}// const instance = (companyId, userId) => new SocketWorker(companyId,userId);\nconst instance=(companyId,userId)=>new SocketWorker(companyId,userId);export default instance;","map":{"version":3,"names":["io","api","SocketWorker","constructor","companyId","userId","sessionToken","defaults","headers","Authorization","instance","token","socket","configureSocket","eventListeners","concat","process","env","REACT_APP_BACKEND_URL","autoConnect","reconnection","reconnectionDelay","reconnectionAttempts","Infinity","query","on","console","log","reconnectAfterDelay","event","callback","connect","push","emit","data","off","filter","cb","forEach","disconnect","setTimeout","connected","forceReconnect"],"sources":["/home/deploy/atendechatop/frontend/src/services/SocketWorker.js"],"sourcesContent":["import io from \"socket.io-client\";\nimport api from \"../services/api\";\n\n\nclass SocketWorker {\n  constructor(companyId , userId) {\n    const sessionToken = api.defaults.headers.Authorization\n\n    if (!SocketWorker.instance) {\n      this.companyId = companyId\n      this.userId = userId\n      this.token = sessionToken\n      this.socket = null;\n      this.configureSocket();\n      this.eventListeners = {}; // Armazena os ouvintes de eventos registrados\n      SocketWorker.instance = this;\n\n    } \n\n    return SocketWorker.instance;\n  }\n\n  configureSocket() {\n    this.socket = io(`${process.env.REACT_APP_BACKEND_URL}/${this?.companyId}` , {\n      autoConnect: true,\n      reconnection: true,\n      reconnectionDelay: 1000,\n      reconnectionAttempts: Infinity,\n      // transports: [\"websocket\", \"polling\", \"flashsocket\"],\n      // pingTimeout: 18000,\n      // pingInterval: 18000,\n      query: { userId: this.userId, token: this.token }\n    });\n\n    this.socket.on(\"connect\", () => {\n      console.log(\"Conectado ao servidor Socket.IO\");\n    });\n\n    this.socket.on(\"disconnect\", () => {\n      console.log(\"Desconectado do servidor Socket.IO\");\n      this.reconnectAfterDelay();\n    });\n  }\n\n  // Adiciona um ouvinte de eventos\n  on(event, callback) {\n\n    this.connect();\n    this.socket.on(event, callback);\n\n    // Armazena o ouvinte no objeto de ouvintes\n    if (!this.eventListeners[event]) {\n      this.eventListeners[event] = [];\n    }\n    this.eventListeners[event].push(callback);\n  }\n\n  // Emite um evento\n  emit(event, data) {\n    this.connect();\n    this.socket.emit(event, data);\n  }\n\n  // Desconecta um ou mais ouvintes de eventos\n  off(event, callback) {\n    // console.log(event, callback)\n    this.connect();\n    if (this.eventListeners[event]) {\n      // console.log(\"Desconectando do servidor Socket.IO:\", event, callback);\n      if (callback) {\n        // Desconecta um ouvinte específico\n        this.socket.off(event, callback);\n        this.eventListeners[event] = this.eventListeners[event].filter(cb => cb !== callback);\n      } else {\n        // console.log(\"DELETOU EVENTOS DO SOCKET:\", this.eventListeners[event]);\n\n        // Desconecta todos os ouvintes do evento\n        this.eventListeners[event].forEach(cb => this.socket.off(event, cb));\n        delete this.eventListeners[event];\n      }\n      // console.log(\"EVENTOS DO SOCKET:\", this.eventListeners);\n    }\n  }\n\n  disconnect() {\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null\n      this.instance = null\n      console.log(\"Socket desconectado manualmente\");\n    }\n  }\n\n  reconnectAfterDelay() {\n    setTimeout(() => {\n      if (!this.socket || !this.socket.connected) {\n        console.log(\"Tentando reconectar após desconexão\");\n        this.connect();\n      }\n    }, 1000);\n  }\n\n  // Garante que o socket esteja conectado\n  connect() {\n    if (!this.socket) {\n      this.configureSocket();\n    }\n  }\n\n  forceReconnect() {\n\n  }\n}\n\n// const instance = (companyId, userId) => new SocketWorker(companyId,userId);\nconst instance = (companyId, userId) => new SocketWorker(companyId, userId);\n\nexport default instance;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}