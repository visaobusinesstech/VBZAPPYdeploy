{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useContext,useState,useEffect,useRef,useCallback}from\"react\";import{useHistory}from\"react-router-dom\";import{Can}from\"../Can\";import{makeStyles}from\"@material-ui/core/styles\";import{IconButton,Menu,CircularProgress}from\"@material-ui/core\";import{DeviceHubOutlined,History,MoreVert,PictureAsPdf,SwapHorizOutlined,AccountBalanceWallet,FileCopy as FileCopyIcon,FlashOn,Add}from\"@material-ui/icons\";import{v4 as uuidv4}from\"uuid\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";// import TicketOptionsMenu from \"../TicketOptionsMenu\";\nimport ButtonWithSpinner from\"../ButtonWithSpinner\";import toastError from\"../../errors/toastError\";import usePlans from\"../../hooks/usePlans\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{TicketsContext}from\"../../context/Tickets/TicketsContext\";import Tooltip from\"@material-ui/core/Tooltip\";import ConfirmationModal from\"../ConfirmationModal\";import*as Yup from\"yup\";import{Formik,Form}from\"formik\";import Dialog from\"@material-ui/core/Dialog\";import DialogTitle from\"@material-ui/core/DialogTitle\";import DialogActions from\"@material-ui/core/DialogActions\";import Button from\"@material-ui/core/Button\";import TransferTicketModalCustom from\"../TransferTicketModalCustom\";import AcceptTicketWithouSelectQueue from\"../AcceptTicketWithoutQueueModal\";import NewTicketModal from\"../NewTicketModal\";//icones\nimport HighlightOffIcon from\"@material-ui/icons/HighlightOff\";import UndoIcon from\"@material-ui/icons/Undo\";import ScheduleModal from\"../ScheduleModal\";import MenuItem from\"@material-ui/core/MenuItem\";import{Switch}from\"@material-ui/core\";import ShowTicketOpen from\"../ShowTicketOpenModal\";import{toast}from\"react-toastify\";import useCompanySettings from\"../../hooks/useSettings/companySettings\";import ShowTicketLogModal from\"../../components/ShowTicketLogModal\";import TicketMessagesDialog from\"../TicketMessagesDialog\";import{useTheme}from\"@material-ui/styles\";import html2pdf from\"html2pdf.js\";import FinalizacaoVendaModal from\"../FinalizacaoVendaModal\";import QuickMessageModal from\"../QuickMessageModal\";import{Phone}from\"@material-ui/icons\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({actionButtons:{marginRight:6,maxWidth:\"100%\",flex:\"none\",alignSelf:\"center\",marginLeft:\"auto\",// flexBasis: \"50%\",\ndisplay:\"flex\",\"& > *\":{margin:theme.spacing(1)}},bottomButtonVisibilityIcon:{padding:1,color:theme.mode===\"light\"?theme.palette.primary.main:\"#FFF\"},botoes:{display:\"flex\",padding:\"15px\",justifyContent:\"flex-end\",maxWidth:\"100%\"// alignItems: \"center\"\n}}));const SessionSchema=Yup.object().shape({ratingId:Yup.string().required(\"AvaliaÃ§Ã£o obrigatÃ³ria\")});const TicketActionButtonsCustom=_ref=>{var _ticket$contact3;let{ticket,contact,onQuickMessageSelect// , showSelectMessageCheckbox,\n// selectedMessages,\n// forwardMessageModalOpen,\n// setForwardMessageModalOpen\n}=_ref;const classes=useStyles();const theme=useTheme();const history=useHistory();const isMounted=useRef(true);const[loading,setLoading]=useState(false);const{user}=useContext(AuthContext);const{setCurrentTicket,setTabOpen}=useContext(TicketsContext);const[open,setOpen]=React.useState(false);const formRef=React.useRef(null);const[confirmationOpen,setConfirmationOpen]=useState(false);const[transferTicketModalOpen,setTransferTicketModalOpen]=useState(false);const[newTicketModalOpen,setNewTicketModalOpen]=useState(false);const[scheduleModalOpen,setScheduleModalOpen]=useState(false);const[contactId,setContactId]=useState(null);const[acceptTicketWithouSelectQueueOpen,setAcceptTicketWithouSelectQueueOpen]=useState(false);const[showTicketLogOpen,setShowTicketLogOpen]=useState(false);const[openTicketMessageDialog,setOpenTicketMessageDialog]=useState(false);const[disableBot,setDisableBot]=useState(ticket.contact.disableBot);const[showSchedules,setShowSchedules]=useState(false);const[enableIntegration,setEnableIntegration]=useState(ticket.useIntegration);const[openAlert,setOpenAlert]=useState(false);const[userTicketOpen,setUserTicketOpen]=useState(\"\");const[queueTicketOpen,setQueueTicketOpen]=useState(\"\");const[logTicket,setLogTicket]=useState([]);const[showWavoipCall,setShowWavoipCall]=useState(false);const{get:getSetting}=useCompanySettings();const{getPlanCompany}=usePlans();const[anchorEl,setAnchorEl]=useState(null);const[menuOpen,setMenuOpen]=useState(false);const[showTestButton,setShowTestButton]=useState(false);const[exportedToPDF,setExportedToPDF]=useState(false);const[linkingWallet,setLinkingWallet]=useState(false);const[openFinalizacaoVenda,setOpenFinalizacaoVenda]=useState(false);const[ticketDataToFinalize,setTicketDataToFinalize]=useState(null);const[showFinalizacaoOptions,setShowFinalizacaoOptions]=useState(false);const[finalizacaoTipo,setFinalizacaoTipo]=useState(null);// 'semDespedida' ou 'comDespedida'\nconst[directTicketsToWallets,setDirectTicketsToWallets]=useState(false);// Estados para copiar telefone e respostas rÃ¡pidas\nconst[quickMessageModalOpen,setQuickMessageModalOpen]=useState(false);console.log(\"DEBUG user:\",user);console.log(\"DEBUG user.finalizacaoComValorVendaAtiva:\",user===null||user===void 0?void 0:user.finalizacaoComValorVendaAtiva);useEffect(()=>{fetchData();checkWhatsAppTriggerIntegration();fetchDirectTicketsToWalletsSetting();// Cleanup function to set isMounted to false when the component unmounts\nreturn()=>{isMounted.current=false;};},[]);useEffect(()=>{console.log(\"DEBUG openFinalizacaoVenda:\",openFinalizacaoVenda);},[openFinalizacaoVenda]);useEffect(()=>{console.log(\"DEBUG open (modal avaliaÃ§Ã£o):\",open);},[open]);const fetchData=async()=>{const companyId=user.companyId;const planConfigs=await getPlanCompany(undefined,companyId);console.log(\"DEBUG planConfigs:\",planConfigs);if(isMounted.current){setShowSchedules(planConfigs.plan.useSchedules);setShowWavoipCall(planConfigs.plan.wavoip);setOpenTicketMessageDialog(false);setDisableBot(ticket.contact.disableBot);setShowTicketLogOpen(false);}};const checkWhatsAppTriggerIntegration=async()=>{try{const{data}=await api.get(\"/whatsapp/\".concat(ticket.whatsappId));if(isMounted.current){setShowTestButton(data.triggerIntegrationOnClose===true);}}catch(err){console.error(err);if(isMounted.current){setShowTestButton(false);}}};const fetchDirectTicketsToWalletsSetting=async()=>{try{const setting=await getSetting({column:\"DirectTicketsToWallets\"});if(isMounted.current){setDirectTicketsToWallets(setting.DirectTicketsToWallets);}}catch(err){console.error(err);if(isMounted.current){setDirectTicketsToWallets(false);}}};// FunÃ§Ã£o para copiar telefone\nconst handleCopyPhone=async()=>{try{if(!(contact!==null&&contact!==void 0&&contact.number)){toast.error(i18n.t(\"ticketInfo.noPhone\"));return;}// Remove todos os caracteres nÃ£o numÃ©ricos e copia o nÃºmero puro\nconst phoneNumber=contact.number.replace(/\\D/g,'');// Verifica se tem pelo menos 8 dÃ­gitos (nÃºmero mÃ­nimo vÃ¡lido)\nif(phoneNumber.length>=8){await navigator.clipboard.writeText(phoneNumber);toast.success(i18n.t(\"ticketInfo.phonecopied\"));}else{toast.error(i18n.t(\"ticketInfo.invalidPhoneFormat\"));}}catch(err){console.error('Erro ao copiar telefone:',err);toast.error(i18n.t(\"ticketInfo.copyError\"));}};// FunÃ§Ãµes para respostas rÃ¡pidas\nconst handleOpenQuickMessageModal=()=>{setQuickMessageModalOpen(true);};const handleCloseQuickMessageModal=()=>{setQuickMessageModalOpen(false);};const handleQuickMessageSelect=useCallback(selectedMessage=>{console.log(\"ðŸŽ¯ Resposta rÃ¡pida selecionada:\",selectedMessage);handleCloseQuickMessageModal();if(selectedMessage.mediaPath){const event=new CustomEvent('insertQuickMessage',{detail:{quickMessage:{id:selectedMessage.id,message:selectedMessage.message||\"\",shortcode:selectedMessage.shortcode||\"\",mediaPath:selectedMessage.mediaPath,mediaType:selectedMessage.mediaType,value:selectedMessage.message||\"\"}},bubbles:false});window.dispatchEvent(event);}else{// Para texto, tambÃ©m usar evento\nconst event=new CustomEvent('insertQuickMessage',{detail:{quickMessage:{id:selectedMessage.id,message:selectedMessage.message||\"\",shortcode:selectedMessage.shortcode||\"\",mediaPath:null,mediaType:null,value:selectedMessage.message||\"\"}},bubbles:false});window.dispatchEvent(event);}},[]);const handleClickOpen=async e=>{const setting=await getSetting({column:\"requiredTag\"});if((setting===null||setting===void 0?void 0:setting.requiredTag)===\"enabled\"){//verificar se tem uma tag\ntry{const contactTags=await api.get(\"/contactTags/\".concat(ticket.contact.id));if(!contactTags.data.tags){toast.warning(i18n.t(\"messagesList.header.buttons.requiredTag\"));}else{setOpen(true);// handleUpdateTicketStatus(e, \"closed\", user?.id);\n}}catch(err){toastError(err);}}else{setOpen(true);// handleUpdateTicketStatus(e, \"closed\", user?.id);\n}};const handleClose=()=>{formRef.current.resetForm();setOpen(false);};const handleCloseAlert=()=>{setOpenAlert(false);setLoading(false);};const handleOpenAcceptTicketWithouSelectQueue=async()=>{setAcceptTicketWithouSelectQueueOpen(true);};const handleMenu=event=>{setAnchorEl(event.currentTarget);setMenuOpen(true);};const handleCloseMenu=()=>{setAnchorEl(null);setMenuOpen(false);};const handleOpenTransferModal=e=>{setTransferTicketModalOpen(true);if(typeof handleClose==\"function\")handleClose();};const handleOpenConfirmationModal=e=>{setConfirmationOpen(true);if(typeof handleClose==\"function\")handleClose();};const handleCloseTicketWithoutFarewellMsg=async()=>{setLoading(true);try{await api.put(\"/tickets/\".concat(ticket.id),{status:\"closed\",userId:(user===null||user===void 0?void 0:user.id)||null,sendFarewellMessage:false,amountUsedBotQueues:0});setLoading(false);history.push(\"/tickets\");}catch(err){setLoading(false);toastError(err);}};const handleExportPDF=async()=>{setOpenTicketMessageDialog(true);handleCloseMenu();};const handleEnableIntegration=async()=>{setLoading(true);try{await api.put(\"/tickets/\".concat(ticket.id),{useIntegration:!enableIntegration});setEnableIntegration(!enableIntegration);setLoading(false);}catch(err){setLoading(false);toastError(err);}};const handleShowLogTicket=async()=>{setShowTicketLogOpen(true);};const handleContactToggleDisableBot=async()=>{const{id}=ticket.contact;try{const{data}=await api.put(\"/contacts/toggleDisableBot/\".concat(id));ticket.contact.disableBot=data.disableBot;setDisableBot(data.disableBot);}catch(err){toastError(err);}};const handleCloseTransferTicketModal=()=>{setTransferTicketModalOpen(false);};const handleOpenNewTicketModal=()=>{setNewTicketModalOpen(true);};const handleCloseNewTicketModal=newTicket=>{setNewTicketModalOpen(false);if(newTicket){// Se um novo ticket foi criado, redirecionar para ele\nsetCurrentTicket({id:newTicket.id,uuid:newTicket.uuid,code:uuidv4()});history.push(\"/tickets/\".concat(newTicket.uuid));}};const handleDeleteTicket=async()=>{try{await api.delete(\"/tickets/\".concat(ticket.id));history.push(\"/tickets\");}catch(err){toastError(err);}};const handleSendMessage=async id=>{let setting;try{setting=await getSetting({column:\"greetingAcceptedMessage\"});}catch(err){toastError(err);}if(!setting.greetingAcceptedMessage){toast.warning(i18n.t(\"messagesList.header.buttons.greetingAcceptedMessage\"));return;}const msg=\"\".concat(setting.greetingAcceptedMessage);//`{{ms}} *{{name}}*, ${i18n.t(\"mainDrawer.appBar.user.myName\")} *${user?.name}* ${i18n.t(\"mainDrawer.appBar.user.continuity\")}.`;\nconst message={read:1,fromMe:true,mediaUrl:\"\",body:\"\".concat(msg.trim())};try{await api.post(\"/messages/\".concat(id),message);}catch(err){toastError(err);}};const handleUpdateTicketStatus=async(e,status,userId)=>{setLoading(true);try{var _setting,_ticket$whatsapp;await api.put(\"/tickets/\".concat(ticket.id),{status:status,userId:userId||null});let setting;try{setting=await getSetting({column:\"sendGreetingAccepted\"});}catch(err){toastError(err);}if(((_setting=setting)===null||_setting===void 0?void 0:_setting.sendGreetingAccepted)===\"enabled\"&&(!ticket.isGroup||((_ticket$whatsapp=ticket.whatsapp)===null||_ticket$whatsapp===void 0?void 0:_ticket$whatsapp.groupAsTicket)===\"enabled\")&&ticket.status===\"pending\"){handleSendMessage(ticket.id);}if(isMounted.current){setLoading(false);}if(status===\"open\"||status===\"group\"){setCurrentTicket(_objectSpread(_objectSpread({},ticket),{},{code:\"#\"+status}));setTimeout(()=>{history.push(\"/tickets\");},0);setTimeout(()=>{history.push(\"/tickets/\".concat(ticket.uuid));setTabOpen(status);},10);}else{setCurrentTicket({id:null,code:null});history.push(\"/tickets\");}}catch(err){if(isMounted.current){setLoading(false);}toastError(err);}};const handleAcepptTicket=async id=>{setLoading(true);try{const otherTicket=await api.put(\"/tickets/\".concat(id),{status:ticket.isGroup?\"group\":\"open\",userId:user===null||user===void 0?void 0:user.id});if(otherTicket.data.id!==ticket.id){if(otherTicket.data.userId!==(user===null||user===void 0?void 0:user.id)){if(isMounted.current){setOpenAlert(true);setUserTicketOpen(otherTicket.data.user.name);setQueueTicketOpen(otherTicket.data.queue.name);setTabOpen(otherTicket.isGroup?\"group\":\"open\");}}else{if(isMounted.current){setLoading(false);setTabOpen(otherTicket.isGroup?\"group\":\"open\");}history.push(\"/tickets/\".concat(otherTicket.data.uuid));}}else{if(isMounted.current){setLoading(false);}history.push(\"/tickets\");setTimeout(()=>{history.push(\"/tickets/\".concat(ticket.uuid));setTabOpen(ticket.isGroup?\"group\":\"open\");},1000);}}catch(err){if(isMounted.current){setLoading(false);}toastError(err);}};//Wavoip historic\nconst saveHistoricalLink=async payload=>{console.log('payload request historical',JSON.stringify(payload));const callHistorical=await api.post(\"/call/historical/wavoip\",payload);};//Wavoip conect\nconst handleOpenWavoipCall=async()=>{var _ticket$whatsapp2,_ticket$contact;if(!(ticket!==null&&ticket!==void 0&&(_ticket$whatsapp2=ticket.whatsapp)!==null&&_ticket$whatsapp2!==void 0&&_ticket$whatsapp2.wavoip)||!(ticket!==null&&ticket!==void 0&&(_ticket$contact=ticket.contact)!==null&&_ticket$contact!==void 0&&_ticket$contact.number)){toastError(\"Erro: Token ou nÃºmero de telefone nÃ£o disponÃ­vel.\");return;}const token=ticket.whatsapp.wavoip;const phone=ticket.contact.number.replace(/\\D/g,\"\");const name=ticket.contact.name;const url=\"https://app.wavoip.com/call?token=\".concat(token,\"&phone=\").concat(phone,\"&name=\").concat(name,\"&start_if_ready=true&close_after_call=true\");try{var _ticket$user,_ticket$whatsapp3,_ticket$contact2,_ticket$company;await saveHistoricalLink({\"user_id\":(ticket===null||ticket===void 0?void 0:(_ticket$user=ticket.user)===null||_ticket$user===void 0?void 0:_ticket$user.id)||null,\"token_wavoip\":token,\"whatsapp_id\":(ticket===null||ticket===void 0?void 0:(_ticket$whatsapp3=ticket.whatsapp)===null||_ticket$whatsapp3===void 0?void 0:_ticket$whatsapp3.id)||null,\"contact_id\":(ticket===null||ticket===void 0?void 0:(_ticket$contact2=ticket.contact)===null||_ticket$contact2===void 0?void 0:_ticket$contact2.id)||null,\"company_id\":(ticket===null||ticket===void 0?void 0:(_ticket$company=ticket.company)===null||_ticket$company===void 0?void 0:_ticket$company.id)||null,\"phone_to\":phone,\"name\":name,\"url\":url,\"createdAt\":new Date()});}catch(e){console.log('erro ao tentar salvar historico',e);}window.open(url,\"wavoip\",\"toolbar=no,scrollbars=no,resizable=no,top=500,left=500,width=500,height=700\");};const handleExportToPDF=()=>{const messagesListElement=document.getElementById(\"messagesList\");const headerElement=document.getElementById(\"TicketHeader\");const pdfOptions={margin:1,filename:\"\".concat(i18n.t(\"whatsappModalRel.form.reportFilename\")).concat(ticket.id,\".pdf\"),image:{type:\"jpeg\",quality:0.98},html2canvas:{scale:2},jsPDF:{unit:\"mm\",format:\"a4\",orientation:\"portrait\"}};if(messagesListElement&&headerElement){const headerClone=headerElement.cloneNode(true);const messagesListClone=messagesListElement.cloneNode(true);const containerElement=document.createElement(\"div\");containerElement.appendChild(headerClone);containerElement.appendChild(messagesListClone);return html2pdf().from(containerElement).set(pdfOptions).output(\"blob\");}else{toast.error(i18n.t(\"whatsappModalRel.form.elementNotFoundForExport\"));return null;}};const handleTestButton=async()=>{try{var _ticket$whatsapp4,_ticket$queue;if(ticket!==null&&ticket!==void 0&&(_ticket$whatsapp4=ticket.whatsapp)!==null&&_ticket$whatsapp4!==void 0&&_ticket$whatsapp4.integrationTypeId){const{data:integration}=await api.get(\"/queueIntegration/\".concat(ticket.whatsapp.integrationTypeId));if(integration){var _ticket$lastMessage;await api.post(\"/queueIntegration/testsession\",{integrationId:ticket.whatsapp.integrationTypeId,ticketId:ticket.id,contactId:ticket.contactId,body:((_ticket$lastMessage=ticket.lastMessage)===null||_ticket$lastMessage===void 0?void 0:_ticket$lastMessage.body)||\"\",status:\"closed\"});if(isMounted.current){toast.success(i18n.t(\"ticketList.success.integrationTriggered\"));}}}await handleUpdateTicketStatus(null,\"closed\",user===null||user===void 0?void 0:user.id,ticket===null||ticket===void 0?void 0:(_ticket$queue=ticket.queue)===null||_ticket$queue===void 0?void 0:_ticket$queue.id);if(isMounted.current){handleClose();}}catch(err){toastError(err);}};const handleLinkToWallet=async()=>{if(!ticket.contactId){toast.error(i18n.t(\"contactModal.saveFirst\"));return;}setLinkingWallet(true);try{if(!user.queues||user.queues.length===0){toast.error(i18n.t(\"contactModal.walletError\"));return;}// Usa a primeira fila do usuÃ¡rio\nconst userQueue=user.queues[0];await api.put(\"/contacts/wallet/\".concat(ticket.contactId),{wallets:{userId:user.id,queueId:ticket.queueId||userQueue.id}});toast.success(i18n.t(\"contactModal.walletLinked\"));}catch(err){toastError(err);}finally{setLinkingWallet(false);}};const handleFinalizarTicket=async tipo=>{if(user.finalizacaoComValorVendaAtiva===true||user.finalizacaoComValorVendaAtiva===\"true\"){setFinalizacaoTipo(tipo);setOpenFinalizacaoVenda(true);}else{if(tipo===\"semDespedida\"){handleCloseTicketWithoutFarewellMsg();}else{var _ticket$queue2;handleUpdateTicketStatus(null,\"closed\",user===null||user===void 0?void 0:user.id,ticket===null||ticket===void 0?void 0:(_ticket$queue2=ticket.queue)===null||_ticket$queue2===void 0?void 0:_ticket$queue2.id);}}};const handleClickResolver=()=>{console.log(\"DEBUG handleClickResolver chamado\");if(user.finalizacaoComValorVendaAtiva===true||user.finalizacaoComValorVendaAtiva===\"true\"){setFinalizacaoTipo(\"comDespedida\");setOpenFinalizacaoVenda(true);}else{setOpen(true);}};const handleUpdateTicketStatusWithData=async(ticketData,sendFarewellMessage,finalizacaoMessage)=>{try{await api.put(\"/tickets/\".concat(ticket.id),_objectSpread(_objectSpread({},ticketData),{},{sendFarewellMessage,finalizacaoMessage}));toast.success(\"Ticket finalizado com sucesso!\");// Atualize o estado conforme necessÃ¡rio\n}catch(err){toastError(err);}};// Tooltip dinÃ¢mico para copiar telefone\nconst getCopyPhoneTooltip=()=>{const usePrefixWhenCopy=localStorage.getItem('usePrefixWhenCopy')==='true';const prefix=localStorage.getItem('contactCopyPrefix')||'';let copyTooltip=i18n.t(\"ticketInfo.copyPhone\");if(usePrefixWhenCopy&&prefix){copyTooltip=\"Copiar telefone com prefixo (\".concat(prefix,\")\");}return copyTooltip;};return/*#__PURE__*/_jsxs(_Fragment,{children:[openAlert&&/*#__PURE__*/_jsx(ShowTicketOpen,{isOpen:openAlert,handleClose:handleCloseAlert,user:userTicketOpen,queue:queueTicketOpen}),acceptTicketWithouSelectQueueOpen&&/*#__PURE__*/_jsx(AcceptTicketWithouSelectQueue,{modalOpen:acceptTicketWithouSelectQueueOpen,onClose:e=>setAcceptTicketWithouSelectQueueOpen(false),ticketId:ticket.id,ticket:ticket}),showTicketLogOpen&&/*#__PURE__*/_jsx(ShowTicketLogModal,{isOpen:showTicketLogOpen,handleClose:e=>setShowTicketLogOpen(false),ticketId:ticket.id}),openTicketMessageDialog&&/*#__PURE__*/_jsx(TicketMessagesDialog,{open:openTicketMessageDialog,handleClose:()=>setOpenTicketMessageDialog(false),ticketId:ticket.id}),quickMessageModalOpen&&/*#__PURE__*/_jsx(QuickMessageModal,{open:quickMessageModalOpen,onClose:handleCloseQuickMessageModal,onSelect:handleQuickMessageSelect,companyId:user===null||user===void 0?void 0:user.companyId,userId:user===null||user===void 0?void 0:user.id}),newTicketModalOpen&&/*#__PURE__*/_jsx(NewTicketModal,{modalOpen:newTicketModalOpen,onClose:handleCloseNewTicketModal,initialContact:contact}),/*#__PURE__*/_jsxs(\"div\",{className:classes.actionButtons,children:[showWavoipCall&&/*#__PURE__*/_jsx(IconButton,{color:\"secondary\",onClick:handleOpenWavoipCall,children:/*#__PURE__*/_jsx(Phone,{})}),ticket.status===\"closed\"&&/*#__PURE__*/_jsx(ButtonWithSpinner,{loading:loading,startIcon:/*#__PURE__*/_jsx(Add,{}),size:\"small\",onClick:handleOpenNewTicketModal,children:\"Criar Novo Ticket\"}),(ticket.status===\"open\"||ticket.status===\"group\")&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IconButton,{className:classes.bottomButtonVisibilityIcon,onClick:handleCopyPhone,disabled:!(contact!==null&&contact!==void 0&&contact.number),children:/*#__PURE__*/_jsx(Tooltip,{title:getCopyPhoneTooltip(),children:/*#__PURE__*/_jsx(FileCopyIcon,{})})}),/*#__PURE__*/_jsx(IconButton,{className:classes.bottomButtonVisibilityIcon,onClick:handleOpenQuickMessageModal,children:/*#__PURE__*/_jsx(Tooltip,{title:i18n.t(\"ticketInfo.quickMessages\"),children:/*#__PURE__*/_jsx(FlashOn,{})})}),/*#__PURE__*/_jsx(IconButton,{className:classes.bottomButtonVisibilityIcon,children:/*#__PURE__*/_jsx(Tooltip,{title:i18n.t(\"messagesList.header.buttons.resolve\"),children:/*#__PURE__*/_jsx(HighlightOffIcon,{onClick:handleClickResolver})})}),/*#__PURE__*/_jsx(IconButton,{className:classes.bottomButtonVisibilityIcon,children:/*#__PURE__*/_jsx(Tooltip,{title:i18n.t(\"tickets.buttons.returnQueue\"),children:/*#__PURE__*/_jsx(UndoIcon// color=\"primary\"\n,{onClick:e=>handleUpdateTicketStatus(e,\"pending\",null)})})}),/*#__PURE__*/_jsx(IconButton,{className:classes.bottomButtonVisibilityIcon,children:/*#__PURE__*/_jsx(Tooltip,{title:\"Transferir Ticket\",children:/*#__PURE__*/_jsx(SwapHorizOutlined// color=\"primary\"\n,{onClick:handleOpenTransferModal})})}),directTicketsToWallets&&!((_ticket$contact3=ticket.contact)!==null&&_ticket$contact3!==void 0&&_ticket$contact3.contactWallets&&ticket.contact.contactWallets.length>0)&&/*#__PURE__*/_jsx(IconButton,{className:classes.bottomButtonVisibilityIcon,onClick:handleLinkToWallet,disabled:linkingWallet,children:/*#__PURE__*/_jsx(Tooltip,{title:\"Vincular \\xE0 minha carteira\",children:linkingWallet?/*#__PURE__*/_jsx(CircularProgress,{size:20}):/*#__PURE__*/_jsx(AccountBalanceWallet,{})})})]}),/*#__PURE__*/_jsx(MenuItem,{className:classes.bottomButtonVisibilityIcon,children:/*#__PURE__*/_jsx(Tooltip,{title:i18n.t(\"contactModal.form.chatBotContact\"),children:/*#__PURE__*/_jsx(Switch,{size:\"small\"// color=\"primary\"\n,checked:disableBot,onChange:()=>handleContactToggleDisableBot()})})}),confirmationOpen&&/*#__PURE__*/_jsx(ConfirmationModal,{title:\"\".concat(i18n.t(\"ticketOptionsMenu.confirmationModal.title\"),\" #\").concat(ticket.id,\"?\"),open:confirmationOpen,onClose:setConfirmationOpen,onConfirm:handleDeleteTicket,children:i18n.t(\"ticketOptionsMenu.confirmationModal.message\")}),transferTicketModalOpen&&/*#__PURE__*/_jsx(TransferTicketModalCustom,{modalOpen:transferTicketModalOpen,onClose:handleCloseTransferTicketModal,ticketid:ticket.id,ticket:ticket})]}),ticket.status===\"pending\"&&(ticket.queueId===null||ticket.queueId===undefined)&&/*#__PURE__*/_jsx(ButtonWithSpinner,{loading:loading,size:\"small\",variant:\"contained\",onClick:e=>handleOpenAcceptTicketWithouSelectQueue(),children:i18n.t(\"messagesList.header.buttons.accept\")}),ticket.status===\"pending\"&&ticket.queueId!==null&&/*#__PURE__*/_jsx(ButtonWithSpinner,{loading:loading,size:\"small\",variant:\"contained\"// color=\"primary\"\n,onClick:e=>handleUpdateTicketStatus(e,\"open\",user===null||user===void 0?void 0:user.id),children:i18n.t(\"messagesList.header.buttons.accept\")}),/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"account of current user\",\"aria-controls\":\"menu-appbar\",\"aria-haspopup\":\"true\",onClick:handleMenu,color:\"inherit\",style:{paddingHorizontal:3,paddingTop:10},children:/*#__PURE__*/_jsx(MoreVert,{style:{fontSize:16,padding:0}})}),/*#__PURE__*/_jsxs(Menu,{id:\"menu-appbar\",anchorEl:anchorEl,getContentAnchorEl:null,anchorOrigin:{vertical:\"bottom\",horizontal:\"right\"},keepMounted:true,transformOrigin:{vertical:\"top\",horizontal:\"right\"},open:menuOpen,onClose:handleCloseMenu,children:[/*#__PURE__*/_jsx(MenuItem,{onClick:handleOpenConfirmationModal,children:/*#__PURE__*/_jsx(Can,{role:user.profile,perform:\"ticket-options:deleteTicket\",yes:()=>i18n.t(\"tickets.buttons.deleteTicket\")})}),/*#__PURE__*/_jsx(MenuItem,{onClick:handleEnableIntegration,children:enableIntegration===true?i18n.t(\"messagesList.header.buttons.disableIntegration\"):i18n.t(\"messagesList.header.buttons.enableIntegration\")}),/*#__PURE__*/_jsx(MenuItem,{onClick:handleShowLogTicket,children:i18n.t(\"messagesList.header.buttons.logTicket\")}),/*#__PURE__*/_jsx(MenuItem,{onClick:handleExportPDF,children:i18n.t(\"ticketsList.buttons.exportAsPDF\")})]})]}),/*#__PURE__*/_jsx(_Fragment,{children:(!user.finalizacaoComValorVendaAtiva||user.finalizacaoComValorVendaAtiva===false||user.finalizacaoComValorVendaAtiva===\"false\")&&/*#__PURE__*/_jsx(Formik,{enableReinitialize:true,validationSchema:SessionSchema,innerRef:formRef,onSubmit:(values,actions)=>{setTimeout(()=>{actions.setSubmitting(false);actions.resetForm();},400);},children:_ref2=>{let{values,touched,errors,isSubmitting,setFieldValue,resetForm}=_ref2;return/*#__PURE__*/_jsx(Dialog,{open:open,onClose:handleClose,\"aria-labelledby\":\"alert-dialog-title\",\"aria-describedby\":\"alert-dialog-description\",children:/*#__PURE__*/_jsx(Form,{children:/*#__PURE__*/_jsxs(DialogActions,{className:classes.botoes,children:[/*#__PURE__*/_jsx(Button,{onClick:()=>handleFinalizarTicket(\"semDespedida\"),style:{background:theme.palette.primary.main,color:\"white\"},children:i18n.t(\"messagesList.header.dialogRatingWithoutFarewellMsg\")}),/*#__PURE__*/_jsx(Button,{onClick:()=>handleFinalizarTicket(\"comDespedida\"),style:{background:theme.palette.primary.main,color:\"white\"},children:i18n.t(\"messagesList.header.dialogRatingCancel\")}),showTestButton&&/*#__PURE__*/_jsx(Button,{onClick:handleTestButton,style:{background:theme.palette.primary.main,color:\"white\"},children:i18n.t(\"whatsappModalRel.form.resolveAndTriggerIntegration\")})]})})});}})}),openFinalizacaoVenda&&(console.log(\"DEBUG JSX: Renderizando FinalizacaoVendaModal\"),/*#__PURE__*/_jsx(FinalizacaoVendaModal,{open:openFinalizacaoVenda,onClose:()=>setOpenFinalizacaoVenda(false),ticket:ticket,onFinalizar:ticketData=>{setOpenFinalizacaoVenda(false);setTicketDataToFinalize(ticketData);setShowFinalizacaoOptions(true);}})),showFinalizacaoOptions&&/*#__PURE__*/_jsxs(Dialog,{open:showFinalizacaoOptions,onClose:()=>setShowFinalizacaoOptions(false),\"aria-labelledby\":\"finalizacao-options-title\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"finalizacao-options-title\",children:\"Como deseja finalizar?\"}),/*#__PURE__*/_jsxs(DialogActions,{className:classes.botoes,children:[/*#__PURE__*/_jsx(Button,{onClick:async()=>{setShowFinalizacaoOptions(false);await handleUpdateTicketStatusWithData(ticketDataToFinalize,false,null);},style:{background:theme.palette.primary.main,color:\"white\"},children:i18n.t(\"messagesList.header.dialogRatingWithoutFarewellMsg\")}),/*#__PURE__*/_jsx(Button,{onClick:async()=>{setShowFinalizacaoOptions(false);await handleUpdateTicketStatusWithData(ticketDataToFinalize,true,null);},style:{background:theme.palette.primary.main,color:\"white\"},children:i18n.t(\"messagesList.header.dialogRatingCancel\")})]})]})]});};export default TicketActionButtonsCustom;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}