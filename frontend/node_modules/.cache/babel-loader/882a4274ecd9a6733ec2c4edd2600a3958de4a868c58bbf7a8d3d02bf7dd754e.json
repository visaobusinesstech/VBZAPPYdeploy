{"ast":null,"code":"import _objectSpread from\"/home/deploy/codigologlow/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useContext}from\"react\";import{Grid,Paper,Typography,Button,TextField,Dialog,DialogTitle,DialogContent,DialogActions,IconButton,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,FormControlLabel,Checkbox,Box,Chip}from\"@material-ui/core\";import{Add as AddIcon,Edit as EditIcon,Delete as DeleteIcon}from\"@material-ui/icons\";import{makeStyles}from\"@material-ui/core/styles\";import{toast}from\"react-toastify\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{padding:theme.spacing(3)},paper:{padding:theme.spacing(2),marginBottom:theme.spacing(2)},title:{marginBottom:theme.spacing(2),color:theme.palette.primary.main},addButton:{marginBottom:theme.spacing(2)},table:{minWidth:650},actionCell:{width:120},chip:{margin:theme.spacing(0.5)}}));const FinalizacaoAtendimento=_ref=>{let{settings,onSettingsChange}=_ref;const classes=useStyles();const{user}=useContext(AuthContext);const[motivos,setMotivos]=useState([]);const[loading,setLoading]=useState(false);const[openModal,setOpenModal]=useState(false);const[editingMotivo,setEditingMotivo]=useState(null);const[formData,setFormData]=useState({name:\"\",description:\"\"});const[informarValorVenda,setInformarValorVenda]=useState(false);useEffect(()=>{if(settings){setInformarValorVenda(settings.informarValorVenda||false);}fetchMotivos();},[settings]);const fetchMotivos=async()=>{try{const{data}=await api.get(\"/ticketFinalizationReasons\");setMotivos(data);}catch(err){console.error(\"Erro ao buscar motivos:\",err);}};const handleOpenModal=function(){let motivo=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(motivo){setEditingMotivo(motivo);setFormData({name:motivo.name,description:motivo.description||\"\"});}else{setEditingMotivo(null);setFormData({name:\"\",description:\"\"});}setOpenModal(true);};const handleCloseModal=()=>{setOpenModal(false);setEditingMotivo(null);setFormData({name:\"\",description:\"\"});};const handleSubmit=async()=>{if(!formData.name.trim()){toast.error(\"Nome do motivo é obrigatório\");return;}setLoading(true);try{if(editingMotivo){await api.put(\"/ticketFinalizationReasons/\".concat(editingMotivo.id),formData);toast.success(\"Motivo atualizado com sucesso!\");}else{await api.post(\"/ticketFinalizationReasons\",formData);toast.success(\"Motivo criado com sucesso!\");}handleCloseModal();fetchMotivos();}catch(err){var _err$response,_err$response$data;toast.error(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||\"Erro ao salvar motivo\");}setLoading(false);};const handleDelete=async id=>{if(window.confirm(\"Tem certeza que deseja excluir este motivo?\")){try{await api.delete(\"/ticketFinalizationReasons/\".concat(id));toast.success(\"Motivo excluído com sucesso!\");fetchMotivos();}catch(err){var _err$response2,_err$response2$data;toast.error(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.error)||\"Erro ao excluir motivo\");}}};const handleInformarValorVendaChange=async event=>{const newValue=event.target.checked;setInformarValorVenda(newValue);try{await api.put(\"/companySettings\",{column:\"informarValorVenda\",data:newValue});if(onSettingsChange){onSettingsChange(_objectSpread(_objectSpread({},settings),{},{informarValorVenda:newValue}));}toast.success(\"Configuração atualizada com sucesso!\");}catch(err){toast.error(\"Erro ao atualizar configuração\");setInformarValorVenda(!newValue);// Revert on error\n}};return/*#__PURE__*/_jsxs(\"div\",{className:classes.root,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",className:classes.title,children:\"Finaliza\\xE7\\xE3o de Atendimento\"}),/*#__PURE__*/_jsxs(Paper,{className:classes.paper,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Configura\\xE7\\xF5es Gerais\"}),/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:informarValorVenda,onChange:handleInformarValorVendaChange,color:\"primary\"}),label:\"Informar valor da venda ao finalizar atendimento\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Quando habilitado, o campo de valor da venda aparecer\\xE1 no modal de finaliza\\xE7\\xE3o\"})]}),/*#__PURE__*/_jsxs(Paper,{className:classes.paper,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",mb:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Motivos de Finaliza\\xE7\\xE3o\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:()=>handleOpenModal(),className:classes.addButton,children:\"Adicionar Motivo\"})]}),/*#__PURE__*/_jsx(TableContainer,{children:/*#__PURE__*/_jsxs(Table,{className:classes.table,children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"Nome\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Descri\\xE7\\xE3o\"}),/*#__PURE__*/_jsx(TableCell,{className:classes.actionCell,children:\"A\\xE7\\xF5es\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:motivos.map(motivo=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:motivo.name})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:motivo.description||\"Sem descrição\"})}),/*#__PURE__*/_jsxs(TableCell,{className:classes.actionCell,children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleOpenModal(motivo),color:\"primary\",children:/*#__PURE__*/_jsx(EditIcon,{})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleDelete(motivo.id),color:\"secondary\",children:/*#__PURE__*/_jsx(DeleteIcon,{})})]})]},motivo.id))})]})}),motivos.length===0&&/*#__PURE__*/_jsx(Box,{textAlign:\"center\",py:3,children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Nenhum motivo cadastrado. Clique em \\\"Adicionar Motivo\\\" para come\\xE7ar.\"})})]}),/*#__PURE__*/_jsxs(Dialog,{open:openModal,onClose:handleCloseModal,maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:editingMotivo?\"Editar Motivo\":\"Adicionar Motivo\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Nome do Motivo\",value:formData.name,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{name:e.target.value})),variant:\"outlined\",margin:\"dense\",required:true})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Descri\\xE7\\xE3o (opcional)\",value:formData.description,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{description:e.target.value})),variant:\"outlined\",margin:\"dense\",multiline:true,rows:3})})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleCloseModal,disabled:loading,children:\"Cancelar\"}),/*#__PURE__*/_jsx(Button,{onClick:handleSubmit,color:\"primary\",variant:\"contained\",disabled:loading,children:loading?\"Salvando...\":editingMotivo?\"Atualizar\":\"Adicionar\"})]})]})]});};export default FinalizacaoAtendimento;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}