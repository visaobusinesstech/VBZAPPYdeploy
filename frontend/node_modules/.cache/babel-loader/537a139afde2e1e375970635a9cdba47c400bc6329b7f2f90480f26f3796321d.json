{"ast":null,"code":"import _objectSpread from\"/home/deploy/codigologlow/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useContext,useRef,useCallback}from\"react\";import\"emoji-mart/css/emoji-mart.css\";import{Picker}from\"emoji-mart\";import{useMediaQuery,useTheme}from\"@material-ui/core\";import{isNil}from\"lodash\";import{Fade}from\"@material-ui/core\";import{CircularProgress,ClickAwayListener,IconButton,InputBase,makeStyles,Paper,Hidden,Menu,MenuItem,Tooltip,Fab,Chip,Box}from\"@material-ui/core\";import{blue,green,pink,grey}from\"@material-ui/core/colors\";import{AttachFile,CheckCircleOutline,Clear,Comment,Create,Description,HighlightOff,Mic,Mood,MoreVert,Send,PermMedia,Person,Reply,Duo,Timer,WhatsApp,Info,AccountTree}from\"@material-ui/icons\";import{FormatBold as FormatBoldIcon,FormatItalic as FormatItalicIcon,FormatStrikethrough as FormatStrikethroughIcon,Code as CodeIcon,FormatListNumbered as FormatListNumberedIcon,FormatListBulleted as FormatListBulletedIcon,FormatQuote as FormatQuoteIcon,FormatClear as FormatClearIcon}from\"@material-ui/icons\";import AddIcon from\"@material-ui/icons/Add\";import{CameraAlt}from\"@material-ui/icons\";import MicRecorder from\"mic-recorder-to-mp3\";import clsx from\"clsx\";import{ReplyMessageContext}from\"../../context/ReplyingMessage/ReplyingMessageContext\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{i18n}from\"../../translate/i18n\";import toastError from\"../../errors/toastError\";import api,{openApi}from\"../../services/api\";import RecordingTimer from\"./RecordingTimer\";import useQuickMessages from\"../../hooks/useQuickMessages\";import{isString,isEmpty}from\"lodash\";import ContactSendModal from\"../ContactSendModal\";import CameraModal from\"../CameraModal\";import axios from\"axios\";import useCompanySettings from\"../../hooks/useSettings/companySettings\";import{ForwardMessageContext}from\"../../context/ForwarMessage/ForwardMessageContext\";import MessageUploadMedias from\"../MessageUploadMedias\";import{EditMessageContext}from\"../../context/EditingMessage/EditingMessageContext\";import ScheduleModal from\"../ScheduleModal\";import usePlans from\"../../hooks/usePlans\";import TemplateModal from\"../TemplateMetaModal\";import TriggerFlowModal from\"../TriggerFlowModal\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Mp3Recorder=new MicRecorder({bitRate:128,sampleRate:44100});const isMobileDevice=()=>{return /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);};const useStyles=makeStyles(theme=>({mainWrapper:{background:\"#eee\",display:\"flex\",flexDirection:\"column\",alignItems:\"center\",borderTop:\"1px solid rgba(0, 0, 0, 0.12)\",[theme.breakpoints.down(\"sm\")]:{position:\"fixed\",bottom:0,width:\"100%\"}},avatar:{width:\"50px\",height:\"50px\",borderRadius:\"25%\"},dropInfo:{background:\"#eee\",display:\"flex\",flexDirection:\"column\",alignItems:\"center\",width:\"100%\",padding:15,left:0,right:0},dropInfoOut:{display:\"none\"},gridFiles:{maxHeight:\"100%\",overflow:\"scroll\"},newMessageBox:{background:theme.palette.background.default,width:\"100%\",display:\"flex\",padding:\"7px\",alignItems:\"center\"},messageInputWrapper:{padding:6,marginRight:7,background:theme.palette.background.paper,display:\"flex\",borderRadius:20,flex:1,position:\"relative\",// âœ… Essencial para o position absolute funcionar\nzIndex:10// âœ… Z-index base\n},messageInputWrapperPrivate:{padding:6,marginRight:7,background:\"#F0E68C\",display:\"flex\",borderRadius:20,flex:1,position:\"relative\",// âœ… Essencial para o position absolute funcionar\nzIndex:10// âœ… Z-index base\n},messageInputWrapperPending:{padding:6,marginRight:7,background:\"#FFE0B2\",display:\"flex\",borderRadius:20,flex:1,position:\"relative\",// âœ… Essencial para o position absolute funcionar\nborder:\"2px solid #FF9800\",zIndex:10// âœ… Z-index base\n},messageInput:{paddingLeft:10,flex:1,border:\"none\"},messageInputPrivate:{paddingLeft:10,flex:1,border:\"none\",color:grey[800]},messageInputPending:{paddingLeft:10,flex:1,border:\"none\",color:\"#E65100\",fontWeight:500},sendMessageIcons:{color:grey[700]},ForwardMessageIcons:{color:grey[700],transform:\"scaleX(-1)\"},uploadInput:{display:\"none\"},viewMediaInputWrapper:{maxHeight:\"100%\",display:\"flex\",padding:\"10px 13px\",position:\"relative\",justifyContent:\"space-between\",alignItems:\"center\",backgroundColor:theme.mode===\"light\"?\"#ffffff\":\"#202c33\",borderTop:\"1px solid rgba(0, 0, 0, 0.12)\"},emojiBox:{position:\"absolute\",bottom:63,width:40,borderTop:\"1px solid #e8e8e8\"},circleLoading:{color:green[500],opacity:\"70%\",position:\"absolute\",top:\"20%\",left:\"50%\",marginLeft:-12},audioLoading:{color:green[500],opacity:\"70%\"},recorderWrapper:{display:\"flex\",alignItems:\"center\",alignContent:\"middle\"},cancelAudioIcon:{color:\"red\"},sendAudioIcon:{color:\"green\"},replyginMsgWrapper:{display:\"flex\",width:\"100%\",alignItems:\"center\",justifyContent:\"center\",paddingTop:8,paddingLeft:73,paddingRight:7,backgroundColor:theme.palette.optionsBackground},replyginMsgContainer:{flex:1,marginRight:5,overflowY:\"hidden\",backgroundColor:theme.mode===\"light\"?\"#f0f0f0\":\"#1d282f\",borderRadius:\"7.5px\",display:\"flex\",position:\"relative\"},replyginMsgBody:{padding:10,height:\"auto\",display:\"block\",whiteSpace:\"pre-wrap\",overflow:\"hidden\"},replyginContactMsgSideColor:{flex:\"none\",width:\"4px\",backgroundColor:\"#35cd96\"},replyginSelfMsgSideColor:{flex:\"none\",width:\"4px\",backgroundColor:\"#6bcbef\"},floatingFormatMenu:{position:'fixed',backgroundColor:theme.palette.background.paper,borderRadius:theme.shape.borderRadius,boxShadow:theme.shadows[8],zIndex:9999,display:'flex',flexDirection:'row',alignItems:'center',padding:'4px',border:\"1px solid \".concat(theme.palette.divider)},formatIconButton:{padding:'6px',borderRadius:'4px',minWidth:'32px',height:'32px'},messageContactName:{display:\"flex\",color:\"#6bcbef\",fontWeight:500},messageQuickAnswersWrapper:{margin:0,position:\"absolute\",bottom:\"100%\",// âœ… Posicionar acima do input\nbackground:theme.palette.background.default,padding:0,border:\"none\",left:0,right:0,// âœ… Usar right: 0 em vez de width: 100%\nmaxHeight:\"200px\",overflowY:\"auto\",overflowX:\"hidden\",boxShadow:\"0 -4px 16px rgba(0, 0, 0, 0.15)\",borderRadius:\"8px 8px 0 0\",zIndex:1000,// âœ… Z-index menor para evitar conflitos\n\"&::-webkit-scrollbar\":{width:\"6px\"},\"&::-webkit-scrollbar-track\":{background:\"transparent\"},\"&::-webkit-scrollbar-thumb\":{backgroundColor:theme.palette.action.disabled,borderRadius:\"3px\",\"&:hover\":{backgroundColor:theme.palette.action.hover}},\"& li\":{listStyle:\"none\",\"& a\":{display:\"block\",padding:\"8px\",textOverflow:\"ellipsis\",overflow:\"hidden\",maxHeight:\"auto\",\"&:hover\":{background:theme.palette.background.paper,cursor:\"pointer\"}}}},quickAnswerItem:{display:\"flex\",alignItems:\"center\",gap:theme.spacing(1),padding:theme.spacing(1.5),minHeight:\"48px\",cursor:\"pointer\",// âœ… Adicionar cursor pointer\nborderRadius:\"4px\",// âœ… Bordas arredondadas\nmargin:\"2px 4px\",// âœ… Pequena margem\n\"&:hover\":{backgroundColor:theme.palette.action.hover},transition:\"all 0.2s ease-in-out\"},// âœ… NOVO: Estilo para item selecionado via teclado\nquickAnswerItemSelected:{backgroundColor:theme.palette.primary.light+\"30\",// âœ… Cor semi-transparente\nborderLeft:\"4px solid \".concat(theme.palette.primary.main),fontWeight:500},// âœ… NOVO: Indicador de scroll\nquickAnswersScrollIndicator:{textAlign:\"center\",padding:theme.spacing(1),fontSize:\"0.75rem\",color:theme.palette.text.secondary,fontStyle:\"italic\",borderTop:\"1px solid \".concat(theme.palette.divider),backgroundColor:theme.palette.background.paper},quickAnswerText:{flex:1,textOverflow:\"ellipsis\",overflow:\"hidden\"},mediaTypeChip:{height:20,fontSize:\"0.7rem\"},invertedFabMenu:{border:\"none\",borderRadius:50,boxShadow:\"none\",padding:theme.spacing(1),backgroundColor:\"transparent\",color:\"grey\",\"&:hover\":{backgroundColor:\"transparent\"},\"&:disabled\":{backgroundColor:\"transparent !important\"}},invertedFabMenuMP:{border:\"none\",borderRadius:0,boxShadow:\"none\",width:theme.spacing(4),height:theme.spacing(4),backgroundColor:\"transparent\",color:blue[800],\"&:hover\":{backgroundColor:\"transparent\"}},invertedFabMenuCont:{border:\"none\",borderRadius:0,boxShadow:\"none\",minHeight:\"auto\",width:theme.spacing(4),height:theme.spacing(4),backgroundColor:\"transparent\",color:blue[500],\"&:hover\":{backgroundColor:\"transparent\"}},invertedFabMenuMeet:{border:\"none\",borderRadius:0,boxShadow:\"none\",minHeight:\"auto\",width:theme.spacing(4),height:theme.spacing(4),backgroundColor:\"transparent\",color:green[500],\"&:hover\":{backgroundColor:\"transparent\"}},invertedFabMenuDoc:{border:\"none\",borderRadius:0,boxShadow:\"none\",width:theme.spacing(4),height:theme.spacing(4),backgroundColor:\"transparent\",color:\"#7f66ff\",\"&:hover\":{backgroundColor:\"transparent\"}},invertedFabMenuCamera:{border:\"none\",borderRadius:0,boxShadow:\"none\",width:theme.spacing(4),height:theme.spacing(4),backgroundColor:\"transparent\",color:pink[500],\"&:hover\":{backgroundColor:\"transparent\"}},flexContainer:{display:\"flex\",flex:1,flexDirection:\"column\"},flexItem:{flex:1},pendingAlert:{marginBottom:theme.spacing(1),padding:theme.spacing(1,2),backgroundColor:\"#E3F2FD\",border:\"1px solid #2196F3\",borderRadius:4,display:\"flex\",alignItems:\"center\",gap:theme.spacing(1),color:\"#1976D2\",fontSize:\"0.875rem\"}}));const MessageInput=_ref=>{let{ticketId,ticketStatus,droppedFiles,contactId,ticketChannel,whatsappId}=_ref;const classes=useStyles();const theme=useTheme();const[mediasUpload,setMediasUpload]=useState([]);const isMounted=useRef(true);const[inputMessage,setInputMessage]=useState(\"\");const[showEmoji,setShowEmoji]=useState(false);const[templateModalOpen,setTemplateModalOpen]=useState(false);const[templates,setTemplates]=useState([]);const[loading,setLoading]=useState(false);const[recording,setRecording]=useState(false);const[quickAnswers,setQuickAnswer]=useState([]);const[typeBar,setTypeBar]=useState(false);const inputRef=useRef();const[onDragEnter,setOnDragEnter]=useState(false);const[anchorEl,setAnchorEl]=useState(null);const{setReplyingMessage,replyingMessage}=useContext(ReplyMessageContext);const{setEditingMessage,editingMessage}=useContext(EditMessageContext);const{user}=useContext(AuthContext);const[appointmentModalOpen,setAppointmentModalOpen]=useState(false);const{getPlanCompany}=usePlans();const[signMessagePar,setSignMessagePar]=useState(false);const{get:getSetting}=useCompanySettings();const[signMessage,setSignMessage]=useState(true);const[privateMessage,setPrivateMessage]=useState(false);const[privateMessageInputVisible,setPrivateMessageInputVisible]=useState(false);const[senVcardModalOpen,setSenVcardModalOpen]=useState(false);const[showModalMedias,setShowModalMedias]=useState(false);const[showSchedules,setShowSchedules]=useState(false);const[useWhatsappOfficial,setUseWhatsappOfficial]=useState(false);const{list:listQuickMessages}=useQuickMessages();const isMobile=useMediaQuery(\"(max-width: 767px)\");const[placeholderText,setPlaceHolderText]=useState(\"\");const[selectedQuickAnswerIndex,setSelectedQuickAnswerIndex]=useState(-1);const[isNavigatingQuickAnswers,setIsNavigatingQuickAnswers]=useState(false);const[triggerFlowModalOpen,setTriggerFlowModalOpen]=useState(false);const[flowProcessing,setFlowProcessing]=useState(false);const flowProcessingRef=useRef(false);const[formatMenuAnchorPosition,setFormatMenuAnchorPosition]=useState(null);const[selectedText,setSelectedText]=useState({text:'',start:0,end:0});const isTicketPending=()=>{return ticketStatus===\"pending\";};useEffect(()=>{if(isTicketPending()){setPrivateMessage(true);setPrivateMessageInputVisible(true);}},[ticketStatus]);useEffect(()=>{async function fetchTemplates(){const templates=await api.request({url:\"/quick-messages/list\",method:\"GET\",params:{isOficial:\"true\",userId:user.id,companyId:user.companyId,status:\"APPROVED\"// whatsappId,\n}});setTemplates(templates.data);}if(useWhatsappOfficial){fetchTemplates();}},[useWhatsappOfficial]);useEffect(()=>{async function fetchData(){const companyId=user.companyId;const planConfigs=await getPlanCompany(undefined,companyId);setShowSchedules(planConfigs.plan.useSchedules);setUseWhatsappOfficial(planConfigs.plan.useWhatsappOfficial);}fetchData();},[]);useEffect(()=>{if(ticketStatus===\"open\"||ticketStatus===\"group\"){setPlaceHolderText(i18n.t(\"messagesInput.placeholderOpen\"));}else if(ticketStatus===\"pending\"){setPlaceHolderText(\"Digite sua mensagem interna (ticket aguardando)...\");}else{setPlaceHolderText(i18n.t(\"messagesInput.placeholderClosed\"));}const maxLength=isMobile?20:Infinity;if(isMobile&&placeholderText.length>maxLength){setPlaceHolderText(placeholderText.substring(0,maxLength)+\"...\");}},[ticketStatus]);const{selectedMessages,setForwardMessageModalOpen,showSelectMessageCheckbox}=useContext(ForwardMessageContext);useEffect(()=>{if(droppedFiles&&droppedFiles.length>0){const selectedMedias=Array.from(droppedFiles);setMediasUpload(selectedMedias);setShowModalMedias(true);}},[droppedFiles]);useEffect(()=>{return()=>{isMounted.current=false;};},[]);useEffect(()=>{inputRef.current.focus();if(editingMessage){setInputMessage(editingMessage.body);}},[replyingMessage,editingMessage]);useEffect(()=>{inputRef.current.focus();return()=>{setInputMessage(\"\");setShowEmoji(false);setMediasUpload([]);setReplyingMessage(null);if(!isTicketPending()){setPrivateMessage(false);setPrivateMessageInputVisible(false);}setEditingMessage(null);};},[ticketId,setReplyingMessage,setEditingMessage]);useEffect(()=>{let isProcessing=false;// âœ… Flag para evitar processamento duplo\nconst handleInsertQuickMessage=event=>{// âœ… IMPORTANTE: Evitar processamento duplo\nif(isProcessing){console.log(\"âš ï¸ JÃ¡ processando evento, ignorando...\");return;}isProcessing=true;console.log(\"ðŸ“¥ Evento insertQuickMessage recebido:\",event.detail);const{quickMessage}=event.detail;if(!quickMessage){console.error(\"âŒ quickMessage nÃ£o encontrado no evento\");isProcessing=false;return;}console.log(\"ðŸ” Processando quickMessage:\",{hasMedia:!!quickMessage.mediaPath,mediaType:quickMessage.mediaType,message:quickMessage.message,ticketId:ticketId});if(quickMessage.mediaPath){console.log(\"ðŸŽµ Processando resposta rÃ¡pida com mÃ­dia\");handleQuickAnswersClick({value:quickMessage.message||\"\",mediaPath:quickMessage.mediaPath,mediaType:quickMessage.mediaType,shortcode:quickMessage.shortcode,label:\"/\".concat(quickMessage.shortcode,\" - \").concat(quickMessage.message)}).finally(()=>{isProcessing=false;// âœ… Liberar flag apÃ³s processamento\n});}else{console.log(\"ðŸ“ Processando resposta rÃ¡pida de texto\");const currentText=(inputMessage===null||inputMessage===void 0?void 0:inputMessage.trim())||\"\";const newText=currentText?\"\".concat(currentText,\"\\n\\n\").concat(quickMessage.message):quickMessage.message;setInputMessage(newText);setTimeout(()=>{if(inputRef.current){inputRef.current.focus();const length=newText.length;inputRef.current.setSelectionRange(length,length);}isProcessing=false;// âœ… Liberar flag\n},100);}};// âœ… IMPORTANTE: Escutar apenas no window\nwindow.addEventListener('insertQuickMessage',handleInsertQuickMessage);return()=>{window.removeEventListener('insertQuickMessage',handleInsertQuickMessage);isProcessing=false;// âœ… Reset da flag no cleanup\n};},[inputMessage,ticketId,privateMessage]);useEffect(()=>{setTimeout(()=>{if(isMounted.current)setOnDragEnter(false);},1000);},[onDragEnter===true]);useEffect(()=>{const fetchSettings=async()=>{const setting=await getSetting({column:\"sendSignMessage\"});if(isMounted.current){if(setting.sendSignMessage===\"enabled\"){setSignMessagePar(true);const signMessageStorage=JSON.parse(localStorage.getItem(\"persistentSignMessage\"));if(isNil(signMessageStorage)){setSignMessage(true);}else{setSignMessage(signMessageStorage);}}else if(setting.sendSignMessage===\"dontSend\"){localStorage.setItem(\"persistentSignMessage\",false);setSignMessage(false);setSignMessagePar(false);}else{setSignMessagePar(false);}}};fetchSettings();},[]);// CORREÃ‡ÃƒO DO ERRO charAt - FunÃ§Ã£o mais robusta\nconst safeCapitalizeFirstLetter=string=>{if(!string||typeof string!=='string')return\"\";return string.charAt(0).toUpperCase()+string.slice(1);};// FUNÃ‡Ã•ES PARA TRIGGER FLOW MODAL\nconst handleTriggerFlowClick=useCallback(()=>{console.log(\"ðŸŽ¯ Abrindo modal de fluxo\");// ðŸ›¡ï¸ RESET PREVENTIVO\nsetFlowProcessing(false);flowProcessingRef.current=false;setTriggerFlowModalOpen(true);},[]);const handleTriggerFlowClose=useCallback(()=>{console.log(\"ðŸšª Fechando modal\");setFlowProcessing(false);flowProcessingRef.current=false;setTriggerFlowModalOpen(false);},[]);const handleFlowProcessing=useCallback(isProcessing=>{console.log(\"ðŸ”„ Flow processing:\",isProcessing);setFlowProcessing(isProcessing);flowProcessingRef.current=isProcessing;// ðŸ”¥ TIMEOUT SIMPLES: 8 segundos e libera SEM PERGUNTAR\nif(isProcessing){setTimeout(()=>{console.log(\"â° TIMEOUT - Liberando campo FORÃ‡ADO\");setFlowProcessing(false);flowProcessingRef.current=false;},8000);}},[]);const handleFlowTriggered=useCallback(data=>{console.log(\"âœ… Fluxo concluÃ­do\");// ðŸ”¥ RESET IMEDIATO - SEM TIMEOUT\nsetFlowProcessing(false);flowProcessingRef.current=false;},[]);// NAVEGAÃ‡ÃƒO POR TECLADO CORRIGIDA\nconst handleKeyDown=useCallback(e=>{if(!typeBar||!Array.isArray(typeBar)||typeBar.length===0){setSelectedQuickAnswerIndex(-1);setIsNavigatingQuickAnswers(false);return;}switch(e.key){case'ArrowDown':e.preventDefault();setIsNavigatingQuickAnswers(true);setSelectedQuickAnswerIndex(prev=>{const nextIndex=prev<typeBar.length-1?prev+1:0;// SCROLL AUTOMÃTICO CORRIGIDO\nsetTimeout(()=>{const container=document.querySelector('.MuiBox-root ul');if(container){const selectedElement=container.children[nextIndex];if(selectedElement){selectedElement.scrollIntoView({behavior:'smooth',block:'nearest'});}}},0);return nextIndex;});break;case'ArrowUp':e.preventDefault();setIsNavigatingQuickAnswers(true);setSelectedQuickAnswerIndex(prev=>{const nextIndex=prev>0?prev-1:typeBar.length-1;// SCROLL AUTOMÃTICO CORRIGIDO\nsetTimeout(()=>{const container=document.querySelector('.MuiBox-root ul');if(container){const selectedElement=container.children[nextIndex];if(selectedElement){selectedElement.scrollIntoView({behavior:'smooth',block:'nearest'});}}},0);return nextIndex;});break;case'Enter':if(isNavigatingQuickAnswers&&selectedQuickAnswerIndex>=0){e.preventDefault();const selectedAnswer=typeBar[selectedQuickAnswerIndex];handleQuickAnswersClick(selectedAnswer);setSelectedQuickAnswerIndex(-1);setIsNavigatingQuickAnswers(false);}break;case'Escape':if(isNavigatingQuickAnswers){e.preventDefault();setSelectedQuickAnswerIndex(-1);setIsNavigatingQuickAnswers(false);setTypeBar(false);}break;case'Tab':if(isNavigatingQuickAnswers){e.preventDefault();setSelectedQuickAnswerIndex(prev=>{const nextIndex=prev<typeBar.length-1?prev+1:0;return nextIndex;});}break;default:if(isNavigatingQuickAnswers&&e.key.length===1){setSelectedQuickAnswerIndex(-1);setIsNavigatingQuickAnswers(false);}break;}},[typeBar,selectedQuickAnswerIndex,isNavigatingQuickAnswers]);useEffect(()=>{if(!typeBar||!Array.isArray(typeBar)||typeBar.length===0){setSelectedQuickAnswerIndex(-1);setIsNavigatingQuickAnswers(false);}},[typeBar]);const getQuickAnswerItemStyle=index=>({backgroundColor:selectedQuickAnswerIndex===index?theme.mode==='light'?'#e3f2fd':'#1e3a5f':'transparent',borderLeft:selectedQuickAnswerIndex===index?\"4px solid \".concat(theme.palette.primary.main):'4px solid transparent'});const handleSendLinkVideo=async()=>{const link=\"https://meet.jit.si/\".concat(ticketId);setInputMessage(link);};const handleSendTemplate=async()=>{setTemplateModalOpen(true);};const handleChangeInput=useCallback(e=>{setInputMessage(e.target.value);},[]);const handlePrivateMessage=e=>{if(isTicketPending()){return;}setPrivateMessage(!privateMessage);setPrivateMessageInputVisible(!privateMessageInputVisible);};const getMediaTypeIcon=mediaType=>{switch(mediaType){case'audio':return'ðŸŽµ';case'image':return'ðŸ–¼ï¸';case'video':return'ðŸŽ¥';case'document':return'ðŸ“Ž';default:return'ðŸ“Ž';}};const getMediaTypeColor=mediaType=>{switch(mediaType){case'audio':return'secondary';case'image':return'primary';case'video':return'default';case'document':return'default';default:return'default';}};const handleQuickAnswersClick=useCallback(async value=>{// âœ… IMPORTANTE: Evitar mÃºltiplas execuÃ§Ãµes simultÃ¢neas\nif(loading){console.log(\"âš ï¸ JÃ¡ processando, ignorando clique...\");return;}console.log(\"ðŸŽ¯ handleQuickAnswersClick chamado:\",value);console.log(\"ðŸ“‹ ticketId atual:\",ticketId);if(!ticketId){console.error(\"âŒ ticketId nÃ£o encontrado\");toastError(\"Erro: ID do ticket nÃ£o encontrado\");return;}if(value.mediaPath){try{setLoading(true);console.log(\"ðŸ“¥ Baixando mÃ­dia:\",value.mediaPath);const response=await api.get(value.mediaPath,{responseType:\"blob\"});console.log(\"âœ… MÃ­dia baixada com sucesso, tamanho:\",response.data.size);const messageBody=value.value&&value.value.trim()!==\"\"?value.value:\"\";await handleUploadQuickMessageMedia(response.data,messageBody,value.mediaType);console.log(\"âœ… MÃ­dia enviada com sucesso\");setInputMessage(\"\");setTypeBar(false);return;}catch(err){console.error(\"âŒ Erro ao processar mÃ­dia:\",err);toastError(err);}finally{setLoading(false);}}else{// Para mensagens de texto\nsetInputMessage(value.value||\"\");setTypeBar(false);}},[loading,ticketId,privateMessage]);const handleUploadQuickMessageMedia=useCallback(async function(blob,message){let mediaType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;console.log(\"ðŸ“¤ Iniciando upload de mÃ­dia:\",{blobSize:blob.size,message,mediaType,ticketId});if(!ticketId){throw new Error(\"ID do ticket nÃ£o encontrado\");}// âœ… IMPORTANTE: Verificar se jÃ¡ estÃ¡ enviando\nif(loading){console.log(\"âš ï¸ Upload jÃ¡ em andamento, ignorando...\");return;}try{let extension='bin';if(blob.type){const mimeType=blob.type.split(\"/\")[1];extension=mimeType;if(blob.type.includes('webm')||blob.type.includes('audio')){extension=blob.type.includes('webm')?'webm':'mp3';}}else if(mediaType){const typeExtensionMap={'audio':'webm','image':'jpg','video':'mp4','document':'pdf'};extension=typeExtensionMap[mediaType]||'bin';}const formData=new FormData();const filename=\"\".concat(new Date().getTime(),\".\").concat(extension);formData.append(\"medias\",blob,filename);formData.append(\"typeArch\",\"quickMessage\");const body=message&&message.trim()!==\"\"?privateMessage||isTicketPending()?\"\\u200D\".concat(message):message:privateMessage||isTicketPending()?\"\\u200D\":\"\";formData.append(\"body\",body);formData.append(\"fromMe\",true);formData.append(\"isPrivate\",privateMessage||isTicketPending()?\"true\":\"false\");console.log(\"ðŸ“¤ Enviando para:\",\"/messages/\".concat(ticketId));if(isMounted.current){const response=await api.post(\"/messages/\".concat(ticketId),formData);console.log(\"âœ… Upload realizado com sucesso:\",response.status);}}catch(err){console.error(\"âŒ Erro no upload:\",err);toastError(err);throw err;}},[ticketId,privateMessage,loading]);const handleAddEmoji=e=>{let emoji=e.native;setInputMessage(prevState=>prevState+emoji);};const[modalCameraOpen,setModalCameraOpen]=useState(false);const handleCapture=imageData=>{if(imageData){handleUploadCamera(imageData);}};const handleChangeMedias=e=>{if(!e.target.files){return;}const selectedMedias=Array.from(e.target.files);setMediasUpload(selectedMedias);setShowModalMedias(true);};const handleChangeSign=e=>{getStatusSingMessageLocalstogare();};const handleOpenModalForward=()=>{if(selectedMessages.length===0){setForwardMessageModalOpen(false);toastError(i18n.t(\"messagesList.header.notMessage\"));return;}setForwardMessageModalOpen(true);};const getStatusSingMessageLocalstogare=()=>{const signMessageStorage=JSON.parse(localStorage.getItem(\"persistentSignMessage\"));if(signMessageStorage!==null){if(signMessageStorage){localStorage.setItem(\"persistentSignMessage\",false);setSignMessage(false);}else{localStorage.setItem(\"persistentSignMessage\",true);setSignMessage(true);}}else{localStorage.setItem(\"persistentSignMessage\",false);setSignMessage(false);}};const handleInputPaste=e=>{if(e.clipboardData.files[0]){const selectedMedias=Array.from(e.clipboardData.files);setMediasUpload(selectedMedias);setShowModalMedias(true);}};const handleInputDrop=e=>{e.preventDefault();if(e.dataTransfer.files[0]){const selectedMedias=Array.from(e.dataTransfer.files);setMediasUpload(selectedMedias);setShowModalMedias(true);}};const handleUploadMedia=async mediasUpload=>{setLoading(true);if(!mediasUpload.length){console.log(\"Nenhuma mÃ­dia selecionada.\");setLoading(false);return;}const formData=new FormData();formData.append(\"fromMe\",true);formData.append(\"isPrivate\",privateMessage||isTicketPending()?\"true\":\"false\");mediasUpload.forEach(media=>{formData.append(\"body\",media.caption);formData.append(\"medias\",media.file);});try{await api.post(\"/messages/\".concat(ticketId),formData);}catch(err){toastError(err);}setLoading(false);setMediasUpload([]);setShowModalMedias(false);if(!isTicketPending()){setPrivateMessage(false);setPrivateMessageInputVisible(false);}};const handleSendContatcMessage=async vcard=>{setSenVcardModalOpen(false);setLoading(true);if(isNil(vcard)){setLoading(false);return;}const message={read:1,fromMe:true,mediaUrl:\"\",body:null,quotedMsg:replyingMessage,isPrivate:privateMessage||isTicketPending()?\"true\":\"false\",vCard:vcard};try{await api.post(\"/messages/\".concat(ticketId),message);}catch(err){toastError(err);}setInputMessage(\"\");setShowEmoji(false);setLoading(false);setReplyingMessage(null);setEditingMessage(null);if(!isTicketPending()){setPrivateMessage(false);setPrivateMessageInputVisible(false);}};const handleSendMessage=async()=>{if(!inputMessage||inputMessage.trim()===\"\")return;setLoading(true);const userName=privateMessage||isTicketPending()?\"\".concat(user.name,\" - Mensagem Interna\"):user.name;const sendMessage=inputMessage.trim();const message={read:1,fromMe:true,mediaUrl:\"\",body:(signMessage&&!isTicketPending()||privateMessage||isTicketPending())&&!editingMessage?\"*\".concat(userName,\":*\\n\").concat(sendMessage):sendMessage,quotedMsg:replyingMessage,isPrivate:privateMessage||isTicketPending()?\"true\":\"false\"};try{if(editingMessage!==null){await api.post(\"/messages/edit/\".concat(editingMessage.id),message);}else{console.log(\"ENVIOU PARA TIKCET\",ticketId);await api.post(\"/messages/\".concat(ticketId),message);}}catch(err){toastError(err);}setInputMessage(\"\");setShowEmoji(false);setLoading(false);setReplyingMessage(null);if(!isTicketPending()){setPrivateMessage(false);}setEditingMessage(null);if(!isTicketPending()){setPrivateMessageInputVisible(false);}handleMenuItemClick();};const handleSendMessageTemplate=async e=>{if(e.id===\"\")return;setLoading(true);const message={templateId:e.id,variables:e.variables,bodyToSave:e.bodyToSave,mediaUrl:\"\",quotedMsg:replyingMessage};try{await api.post(\"/messages-template/\".concat(ticketId),message);setLoading(false);}catch(err){toastError(err);setLoading(false);}setTemplateModalOpen(false);setInputMessage(\"\");setShowEmoji(false);setReplyingMessage(null);if(!isTicketPending()){setPrivateMessage(false);}setEditingMessage(null);if(!isTicketPending()){setPrivateMessageInputVisible(false);}handleMenuItemClick();};const handleStartRecording=async()=>{setLoading(true);try{await navigator.mediaDevices.getUserMedia({audio:true});await Mp3Recorder.start();setRecording(true);setLoading(false);}catch(err){toastError(err);setLoading(false);}};useEffect(()=>{async function fetchData(){const companyId=user.companyId;const messages=await listQuickMessages({companyId,userId:user.id,isOficial:ticketChannel===\"whatsapp_oficial\"?\"true\":\"false\"});const options=messages.map(m=>{let truncatedMessage=m.message;if(isString(truncatedMessage)&&truncatedMessage.length>90){truncatedMessage=m.message.substring(0,90)+\"...\";}return{value:m.message,label:\"/\".concat(m.shortcode,\" - \").concat(truncatedMessage),mediaPath:m.mediaPath,mediaType:m.mediaType,shortcode:m.shortcode};});if(isMounted.current){setQuickAnswer(options);}}fetchData();},[]);useEffect(()=>{if(isString(inputMessage)&&!isEmpty(inputMessage)&&inputMessage.length>=1){const firstWord=inputMessage.charAt(0);if(firstWord===\"/\"){setTypeBar(firstWord.indexOf(\"/\")>-1);const filteredOptions=quickAnswers.filter(m=>m.label.toLowerCase().indexOf(inputMessage.toLowerCase())>-1);setTypeBar(filteredOptions);}else{setTypeBar(false);}}else{setTypeBar(false);}},[inputMessage]);useEffect(()=>{console.log(\"ðŸ” Modal state:\",triggerFlowModalOpen,\"Flow processing:\",flowProcessing);// ðŸ”¥ RESET SIMPLES: Se modal fecha, libera campo\nif(!triggerFlowModalOpen&&flowProcessing){console.log(\"ðŸ”“ FORÃ‡ANDO liberaÃ§Ã£o do campo\");setFlowProcessing(false);flowProcessingRef.current=false;}},[triggerFlowModalOpen,flowProcessing]);const disableOption=useCallback(()=>{const isFlowProcessing=flowProcessingRef.current||flowProcessing;return loading||recording||isFlowProcessing||// ðŸ›¡ï¸ Usar tanto ref quanto estado\n!isTicketPending()&&ticketStatus!==\"open\"&&ticketStatus!==\"group\";},[loading,recording,flowProcessing,ticketStatus]);const disableOptionForPending=useCallback(()=>{const isFlowProcessing=flowProcessingRef.current||flowProcessing;return loading||recording||isFlowProcessing||// ðŸ›¡ï¸ Usar tanto ref quanto estado\nticketStatus===\"closed\";},[loading,recording,flowProcessing,ticketStatus]);const handleUploadCamera=async blob=>{setLoading(true);try{const formData=new FormData();const filename=\"\".concat(new Date().getTime(),\".png\");formData.append(\"medias\",blob,filename);formData.append(\"body\",privateMessage||isTicketPending()?\"\\u200D\":\"\");formData.append(\"fromMe\",true);await api.post(\"/messages/\".concat(ticketId),formData);}catch(err){toastError(err);setLoading(false);}setLoading(false);};// âœ… CORREÃ‡ÃƒO KISS: Apenas otimizar nome do arquivo para mobile\nconst handleUploadAudio=async()=>{setLoading(true);try{const[,blob]=await Mp3Recorder.stop().getMp3();if(blob.size<10000){setLoading(false);setRecording(false);return;}const formData=new FormData();// âœ… CORREÃ‡ÃƒO: Nome do arquivo otimizado para mobile\nlet filename;if([\"whatsapp\",\"whatsapp_oficial\"].includes(ticketChannel)){// Para WhatsApp, usar formato mais compatÃ­vel com mobile\nfilename=isMobileDevice()?\"audio_\".concat(new Date().getTime(),\".ogg\")// OGG para mobile\n:\"audio_\".concat(new Date().getTime(),\".mp3\");// MP3 para desktop\n}else{filename=\"\".concat(new Date().getTime(),\".m4a\");}formData.append(\"medias\",blob,filename);formData.append(\"body\",\"ðŸŽµ Mensagem de voz\");// âœ… Body mais claro\nformData.append(\"fromMe\",true);formData.append(\"isPrivate\",privateMessage||isTicketPending()?\"true\":\"false\");console.log(\"\\uD83D\\uDCE4 Enviando \\xE1udio: \".concat(filename,\" (\").concat(blob.size,\" bytes)\"));if(isMounted.current){await api.post(\"/messages/\".concat(ticketId),formData);}}catch(err){toastError(err);}finally{if(isMounted.current){setLoading(false);setRecording(false);}}};const handleCloseModalMedias=()=>{setShowModalMedias(false);};const handleCancelAudio=async()=>{try{await Mp3Recorder.stop().getMp3();setRecording(false);}catch(err){toastError(err);}};const handleOpenMenuClick=event=>{setAnchorEl(event.currentTarget);};const handleMenuItemClick=event=>{setAnchorEl(null);};const handleSendContactModalOpen=async()=>{handleMenuItemClick();setSenVcardModalOpen(true);};const handleCameraModalOpen=async()=>{handleMenuItemClick();setModalCameraOpen(true);};const handleCancelSelection=()=>{setMediasUpload([]);setShowModalMedias(false);};const checkForSelectedText=useCallback(()=>{if(inputRef.current){const start=inputRef.current.selectionStart;const end=inputRef.current.selectionEnd;if(start!==end&&start!==null&&end!==null){const selectedText=inputMessage.substring(start,end);if(selectedText.trim()!==''){// Para InputBase, calcular posiÃ§Ã£o baseada no elemento\nconst inputRect=inputRef.current.getBoundingClientRect();const scrollTop=window.pageYOffset||document.documentElement.scrollTop;setSelectedText({text:selectedText,start:start,end:end});setFormatMenuAnchorPosition({x:inputRect.left+inputRect.width/2,y:inputRect.top+scrollTop-10// Posicionar acima do input\n});return true;}}}setFormatMenuAnchorPosition(null);return false;},[inputMessage]);const handleCloseFormatMenu=useCallback(()=>{setFormatMenuAnchorPosition(null);},[]);// Aplica a formataÃ§Ã£o ao texto selecionado\nconst handleFormatText=useCallback(formatType=>{const{text,start,end}=selectedText;let formattedText='';switch(formatType){case'bold':formattedText=\"*\".concat(text,\"*\");break;case'italic':formattedText=\"_\".concat(text,\"_\");break;case'strikethrough':formattedText=\"~\".concat(text,\"~\");break;case'code':formattedText=\"`\".concat(text,\"`\");break;case'numberedList':formattedText=text.split('\\n').map((line,index)=>\"\".concat(index+1,\". \").concat(line)).join('\\n');break;case'bulletList':formattedText=text.split('\\n').map(line=>\"\\u2022 \".concat(line)).join('\\n');break;case'quote':formattedText=text.split('\\n').map(line=>\"> \".concat(line)).join('\\n');break;case'clear':formattedText=text.replace(/\\*([^*]+)\\*/g,'$1')// remove negrito\n.replace(/_([^_]+)_/g,'$1')// remove itÃ¡lico\n.replace(/~([^~]+)~/g,'$1')// remove tachado\n.replace(/`([^`]+)`/g,'$1')// remove cÃ³digo\n.replace(/^\\d+\\.\\s/gm,'')// remove numeraÃ§Ã£o de lista\n.replace(/^â€¢\\s/gm,'')// remove marcadores de lista\n.replace(/^>\\s/gm,'');// remove citaÃ§Ã£o\nbreak;default:formattedText=text;}// Substitui o texto selecionado pelo texto formatado\nconst newInputMessage=inputMessage.substring(0,start)+formattedText+inputMessage.substring(end);setInputMessage(newInputMessage);// Fecha o menu apÃ³s a formataÃ§Ã£o\nhandleCloseFormatMenu();// Define o foco e a posiÃ§Ã£o do cursor apÃ³s a operaÃ§Ã£o\nsetTimeout(()=>{if(inputRef.current){inputRef.current.focus();const newCursorPosition=start+formattedText.length;inputRef.current.selectionStart=newCursorPosition;inputRef.current.selectionEnd=newCursorPosition;}},100);},[selectedText,inputMessage,handleCloseFormatMenu]);// Handlers para detectar seleÃ§Ã£o de texto\nconst handleSelectText=useCallback(()=>{checkForSelectedText();},[checkForSelectedText]);const handleMouseUp=useCallback(()=>{checkForSelectedText();},[checkForSelectedText]);const handleKeyUp=useCallback(e=>{// Teclas que podem alterar a seleÃ§Ã£o\nif(e.key==='ArrowLeft'||e.key==='ArrowRight'||e.key==='Shift'){checkForSelectedText();}},[checkForSelectedText]);const renderReplyingMessage=message=>{var _message$contact;return/*#__PURE__*/_jsxs(\"div\",{className:classes.replyginMsgWrapper,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.replyginMsgContainer,children:[/*#__PURE__*/_jsx(\"span\",{className:clsx(classes.replyginContactMsgSideColor,{[classes.replyginSelfMsgSideColor]:!message.fromMe})}),replyingMessage&&/*#__PURE__*/_jsxs(\"div\",{className:classes.replyginMsgBody,children:[!message.fromMe&&/*#__PURE__*/_jsx(\"span\",{className:classes.messageContactName,children:(_message$contact=message.contact)===null||_message$contact===void 0?void 0:_message$contact.name}),message.body]})]}),/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"showRecorder\",component:\"span\",disabled:disableOptionForPending(),onClick:()=>{setReplyingMessage(null);setEditingMessage(null);setInputMessage(\"\");},children:/*#__PURE__*/_jsx(Clear,{className:classes.sendMessageIcons})})]});};const renderFlowProcessingAlert=()=>{if(!flowProcessing)return null;return/*#__PURE__*/_jsxs(Box,{className:classes.pendingAlert,style:{backgroundColor:\"#E8F5E8\",borderColor:\"#4CAF50\"},children:[/*#__PURE__*/_jsx(CircularProgress,{size:16,style:{marginRight:8}}),/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Fluxo em Execu\\xE7\\xE3o:\"}),\" Campo de mensagem temporariamente desabilitado.\"]})]});};const TextFormatMenu=()=>{const isMenuOpen=Boolean(formatMenuAnchorPosition);const isMobile=useMediaQuery(theme.breakpoints.down('sm'));if(!isMenuOpen)return null;return/*#__PURE__*/_jsx(ClickAwayListener,{onClickAway:handleCloseFormatMenu,children:/*#__PURE__*/_jsx(Fade,{in:isMenuOpen,children:/*#__PURE__*/_jsxs(\"div\",{className:classes.floatingFormatMenu,style:{top:formatMenuAnchorPosition?formatMenuAnchorPosition.y-50:0,left:formatMenuAnchorPosition?formatMenuAnchorPosition.x:0},children:[/*#__PURE__*/_jsx(Tooltip,{title:\"Negrito\",children:/*#__PURE__*/_jsx(IconButton,{className:classes.formatIconButton,disabled:disableOptionForPending(),onClick:()=>handleFormatText('bold'),size:\"small\",children:/*#__PURE__*/_jsx(FormatBoldIcon,{fontSize:isMobile?\"small\":\"medium\"})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"It\\xE1lico\",children:/*#__PURE__*/_jsx(IconButton,{className:classes.formatIconButton,disabled:disableOptionForPending(),onClick:()=>handleFormatText('italic'),size:\"small\",children:/*#__PURE__*/_jsx(FormatItalicIcon,{fontSize:isMobile?\"small\":\"medium\"})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Tachado\",children:/*#__PURE__*/_jsx(IconButton,{className:classes.formatIconButton,disabled:disableOptionForPending(),onClick:()=>handleFormatText('strikethrough'),size:\"small\",children:/*#__PURE__*/_jsx(FormatStrikethroughIcon,{fontSize:isMobile?\"small\":\"medium\"})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"C\\xF3digo\",children:/*#__PURE__*/_jsx(IconButton,{className:classes.formatIconButton,disabled:disableOptionForPending(),onClick:()=>handleFormatText('code'),size:\"small\",children:/*#__PURE__*/_jsx(CodeIcon,{fontSize:isMobile?\"small\":\"medium\"})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Lista Numerada\",children:/*#__PURE__*/_jsx(IconButton,{className:classes.formatIconButton,disabled:disableOptionForPending(),onClick:()=>handleFormatText('numberedList'),size:\"small\",children:/*#__PURE__*/_jsx(FormatListNumberedIcon,{fontSize:isMobile?\"small\":\"medium\"})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Lista com Marcadores\",children:/*#__PURE__*/_jsx(IconButton,{className:classes.formatIconButton,disabled:disableOptionForPending(),onClick:()=>handleFormatText('bulletList'),size:\"small\",children:/*#__PURE__*/_jsx(FormatListBulletedIcon,{fontSize:isMobile?\"small\":\"medium\"})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Cita\\xE7\\xE3o\",children:/*#__PURE__*/_jsx(IconButton,{className:classes.formatIconButton,disabled:disableOptionForPending(),onClick:()=>handleFormatText('quote'),size:\"small\",children:/*#__PURE__*/_jsx(FormatQuoteIcon,{fontSize:isMobile?\"small\":\"medium\"})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Limpar Formata\\xE7\\xE3o\",children:/*#__PURE__*/_jsx(IconButton,{className:classes.formatIconButton,disabled:disableOptionForPending(),onClick:()=>handleFormatText('clear'),size:\"small\",children:/*#__PURE__*/_jsx(FormatClearIcon,{fontSize:isMobile?\"small\":\"medium\"})})})]})})});};const renderPendingAlert=()=>{if(!isTicketPending())return null;return/*#__PURE__*/_jsxs(Box,{className:classes.pendingAlert,children:[/*#__PURE__*/_jsx(Info,{style:{fontSize:20}}),/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Ticket Aguardando:\"}),\" Apenas mensagens internas s\\xE3o permitidas neste momento.\"]})]});};if(mediasUpload.length>0){return/*#__PURE__*/_jsx(Paper,{elevation:0,square:true,className:classes.viewMediaInputWrapper,onDragEnter:()=>setOnDragEnter(true),onDrop:e=>handleInputDrop(e),children:showModalMedias&&/*#__PURE__*/_jsx(MessageUploadMedias,{isOpen:showModalMedias,files:mediasUpload,onClose:handleCloseModalMedias,onSend:handleUploadMedia,onCancelSelection:handleCancelSelection})});}else{return/*#__PURE__*/_jsxs(_Fragment,{children:[templateModalOpen&&/*#__PURE__*/_jsx(TemplateModal,{open:templateModalOpen,handleClose:()=>setTemplateModalOpen(false),onSelectTemplate:e=>handleSendMessageTemplate(e),templates:templates}),modalCameraOpen&&/*#__PURE__*/_jsx(CameraModal,{isOpen:modalCameraOpen,onRequestClose:()=>setModalCameraOpen(false),onCapture:handleCapture}),senVcardModalOpen&&/*#__PURE__*/_jsx(ContactSendModal,{modalOpen:senVcardModalOpen,onClose:c=>{handleSendContatcMessage(c);}}),triggerFlowModalOpen&&/*#__PURE__*/_jsx(TriggerFlowModal,{open:triggerFlowModalOpen,onClose:handleTriggerFlowClose,ticketId:ticketId,ticketStatus:ticketStatus,onFlowTriggered:handleFlowTriggered,onFlowProcessing:handleFlowProcessing}),/*#__PURE__*/_jsxs(Paper,{square:true,elevation:0,className:classes.mainWrapper,onDragEnter:()=>setOnDragEnter(true),onDrop:e=>handleInputDrop(e),children:[renderPendingAlert(),renderFlowProcessingAlert(),replyingMessage&&renderReplyingMessage(replyingMessage)||editingMessage&&renderReplyingMessage(editingMessage),/*#__PURE__*/_jsxs(\"div\",{className:classes.newMessageBox,children:[!isTicketPending()&&/*#__PURE__*/_jsxs(Hidden,{only:[\"sm\",\"xs\"],children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"emojiPicker\",component:\"span\",disabled:disableOption(),onClick:e=>setShowEmoji(prevState=>!prevState),children:/*#__PURE__*/_jsx(Mood,{className:classes.sendMessageIcons})}),showEmoji?/*#__PURE__*/_jsx(\"div\",{className:classes.emojiBox,children:/*#__PURE__*/_jsx(ClickAwayListener,{onClickAway:e=>setShowEmoji(true),children:/*#__PURE__*/_jsx(Picker,{perLine:16,theme:\"dark\",i18n:i18n,showPreview:true,showSkinTones:false,onSelect:handleAddEmoji})})}):null,/*#__PURE__*/_jsx(Fab,{disabled:disableOption(),\"aria-label\":\"uploadMedias\",component:\"span\",className:classes.invertedFabMenu,onClick:handleOpenMenuClick,children:/*#__PURE__*/_jsx(AddIcon,{})}),/*#__PURE__*/_jsxs(Menu,{anchorEl:anchorEl,keepMounted:true,open:Boolean(anchorEl),onClose:handleMenuItemClick,id:\"simple-menu\",children:[/*#__PURE__*/_jsxs(MenuItem,{onClick:handleMenuItemClick,children:[/*#__PURE__*/_jsx(\"input\",{multiple:true,type:\"file\",id:\"upload-img-button\",accept:\"image/*, video/*, audio/* \",className:classes.uploadInput,onChange:handleChangeMedias}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"upload-img-button\",children:[/*#__PURE__*/_jsx(Fab,{\"aria-label\":\"upload-img\",component:\"span\",className:classes.invertedFabMenuMP,children:/*#__PURE__*/_jsx(PermMedia,{})}),i18n.t(\"messageInput.type.imageVideo\")]})]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleCameraModalOpen,children:[/*#__PURE__*/_jsx(Fab,{className:classes.invertedFabMenuCamera,children:/*#__PURE__*/_jsx(CameraAlt,{})}),i18n.t(\"messageInput.type.cam\")]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleMenuItemClick,children:[/*#__PURE__*/_jsx(\"input\",{multiple:true,type:\"file\",id:\"upload-doc-button\",accept:\"application/*, text/*, .odt, .ods, .odp, .odg, .xml, .ofx, .zip, .rar, .7z, .tar, .gz, .bz2, .msg, .key, .numbers, .pages\",className:classes.uploadInput,onChange:handleChangeMedias}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"upload-doc-button\",children:[/*#__PURE__*/_jsx(Fab,{\"aria-label\":\"upload-img\",component:\"span\",className:classes.invertedFabMenuDoc,children:/*#__PURE__*/_jsx(Description,{})}),\"Documento\"]})]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleSendContactModalOpen,children:[/*#__PURE__*/_jsx(Fab,{className:classes.invertedFabMenuCont,children:/*#__PURE__*/_jsx(Person,{})}),i18n.t(\"messageInput.type.contact\")]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleSendLinkVideo,children:[/*#__PURE__*/_jsx(Fab,{className:classes.invertedFabMenuMeet,children:/*#__PURE__*/_jsx(Duo,{})}),i18n.t(\"messageInput.type.meet\")]}),useWhatsappOfficial&&ticketChannel===\"whatsapp_oficial\"&&/*#__PURE__*/_jsxs(MenuItem,{onClick:handleSendTemplate,children:[/*#__PURE__*/_jsx(Fab,{className:classes.invertedFabMenuMeet,children:/*#__PURE__*/_jsx(WhatsApp,{})}),i18n.t(\"messageInput.type.template\")]})]}),signMessagePar&&/*#__PURE__*/_jsx(Tooltip,{title:i18n.t(\"messageInput.tooltip.signature\"),children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"send-upload\",component:\"span\",onClick:handleChangeSign,children:signMessage===true?/*#__PURE__*/_jsx(Create,{style:{color:theme.mode===\"light\"?theme.palette.primary.main:\"#EEE\"}}):/*#__PURE__*/_jsx(Create,{style:{color:\"grey\"}})})}),ticketStatus===\"open\"&&/*#__PURE__*/_jsx(Tooltip,{title:\"Disparar Fluxo\",children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"trigger-flow\",component:\"span\",onClick:handleTriggerFlowClick,disabled:disableOption(),children:/*#__PURE__*/_jsx(AccountTree,{style:{color:theme.mode===\"light\"?theme.palette.secondary.main:\"#EEE\"}})})}),!isTicketPending()&&/*#__PURE__*/_jsx(Tooltip,{title:i18n.t(\"messageInput.tooltip.privateMessage\"),children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"send-upload\",component:\"span\",onClick:handlePrivateMessage,children:privateMessage===true?/*#__PURE__*/_jsx(Comment,{style:{color:theme.mode===\"light\"?theme.palette.primary.main:\"#EEE\"}}):/*#__PURE__*/_jsx(Comment,{style:{color:\"grey\"}})})})]}),isTicketPending()&&/*#__PURE__*/_jsxs(Hidden,{only:[\"md\",\"lg\",\"xl\"],children:[/*#__PURE__*/_jsx(IconButton,{\"aria-controls\":\"simple-menu\",\"aria-haspopup\":\"true\",onClick:handleOpenMenuClick,children:/*#__PURE__*/_jsx(MoreVert,{})}),/*#__PURE__*/_jsx(Menu,{id:\"simple-menu\",keepMounted:true,anchorEl:anchorEl,open:Boolean(anchorEl),onClose:handleMenuItemClick,children:/*#__PURE__*/_jsxs(MenuItem,{onClick:handleMenuItemClick,children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"emojiPicker\",component:\"span\",disabled:disableOptionForPending(),onClick:e=>setShowEmoji(prevState=>!prevState),children:/*#__PURE__*/_jsx(Mood,{className:classes.sendMessageIcons})}),\"Emoji\"]})})]}),!isTicketPending()&&/*#__PURE__*/_jsxs(Hidden,{only:[\"md\",\"lg\",\"xl\"],children:[/*#__PURE__*/_jsx(IconButton,{\"aria-controls\":\"simple-menu\",\"aria-haspopup\":\"true\",onClick:handleOpenMenuClick,children:/*#__PURE__*/_jsx(MoreVert,{})}),/*#__PURE__*/_jsxs(Menu,{id:\"simple-menu\",keepMounted:true,anchorEl:anchorEl,open:Boolean(anchorEl),onClose:handleMenuItemClick,children:[/*#__PURE__*/_jsxs(MenuItem,{onClick:handleMenuItemClick,children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"emojiPicker\",component:\"span\",disabled:disableOption(),onClick:e=>setShowEmoji(prevState=>!prevState),children:/*#__PURE__*/_jsx(Mood,{className:classes.sendMessageIcons})}),\"Emoji\"]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleMenuItemClick,children:[/*#__PURE__*/_jsx(\"input\",{multiple:true,type:\"file\",id:\"upload-img-button-mobile\",accept:\"image/*, video/*, audio/* \",disabled:disableOption(),className:classes.uploadInput,onChange:handleChangeMedias}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"upload-img-button-mobile\",children:/*#__PURE__*/_jsx(Fab,{\"aria-label\":\"upload-img\",component:\"span\",className:classes.invertedFabMenuMP,disabled:disableOption(),children:/*#__PURE__*/_jsx(PermMedia,{})})}),i18n.t(\"messageInput.type.imageVideo\")]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleCameraModalOpen,children:[/*#__PURE__*/_jsx(Fab,{className:classes.invertedFabMenuCamera,disabled:disableOption(),children:/*#__PURE__*/_jsx(CameraAlt,{})}),i18n.t(\"messageInput.type.cam\")]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleMenuItemClick,children:[/*#__PURE__*/_jsx(\"input\",{multiple:true,type:\"file\",id:\"upload-doc-button-mobile\",accept:\"application/*, text/*, .odt, .ods, .odp, .odg, .xml, .ofx, .zip, .rar, .7z, .tar, .gz, .bz2, .msg, .key, .numbers, .pages\",disabled:disableOption(),className:classes.uploadInput,onChange:handleChangeMedias}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"upload-doc-button-mobile\",children:/*#__PURE__*/_jsx(Fab,{\"aria-label\":\"upload-img\",component:\"span\",className:classes.invertedFabMenuDoc,disabled:disableOption(),children:/*#__PURE__*/_jsx(Description,{})})}),\"Documento\"]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleSendContactModalOpen,children:[/*#__PURE__*/_jsx(Fab,{className:classes.invertedFabMenuCont,disabled:disableOption(),children:/*#__PURE__*/_jsx(Person,{})}),i18n.t(\"messageInput.type.contact\")]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleSendLinkVideo,children:[/*#__PURE__*/_jsx(Fab,{className:classes.invertedFabMenuMeet,disabled:disableOption(),children:/*#__PURE__*/_jsx(Duo,{})}),i18n.t(\"messageInput.type.meet\")]}),useWhatsappOfficial&&ticketChannel===\"whatsapp_oficial\"&&/*#__PURE__*/_jsxs(MenuItem,{onClick:handleSendTemplate,children:[/*#__PURE__*/_jsx(Fab,{className:classes.invertedFabMenuMeet,disabled:disableOption(),children:/*#__PURE__*/_jsx(WhatsApp,{})}),i18n.t(\"messageInput.type.template\")]}),signMessagePar&&/*#__PURE__*/_jsxs(MenuItem,{onClick:handleChangeSign,children:[/*#__PURE__*/_jsx(Tooltip,{title:\"Habilitar/Desabilitar Assinatura\",children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"send-upload\",component:\"span\",children:signMessage===true?/*#__PURE__*/_jsx(Create,{style:{color:theme.mode===\"light\"?theme.palette.primary.main:\"#EEE\"}}):/*#__PURE__*/_jsx(Create,{style:{color:\"grey\"}})})}),\"Assinatura\"]}),ticketStatus===\"open\"&&/*#__PURE__*/_jsxs(MenuItem,{onClick:()=>{handleMenuItemClick();handleTriggerFlowClick();},children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"trigger-flow\",component:\"span\",children:/*#__PURE__*/_jsx(AccountTree,{style:{color:theme.mode===\"light\"?theme.palette.secondary.main:\"#EEE\"}})}),\"Disparar Fluxo\"]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handlePrivateMessage,children:[/*#__PURE__*/_jsx(Tooltip,{title:\"Habilitar/Desabilitar Coment\\xE1rios\",children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"send-upload\",component:\"span\",children:privateMessage===true?/*#__PURE__*/_jsx(Comment,{style:{color:theme.mode===\"light\"?theme.palette.primary.main:\"#EEE\"}}):/*#__PURE__*/_jsx(Comment,{style:{color:\"grey\"}})})}),\"Coment\\xE1rios\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.flexContainer,children:[(privateMessageInputVisible||isTicketPending())&&/*#__PURE__*/_jsx(\"div\",{className:classes.flexItem,children:/*#__PURE__*/_jsxs(\"div\",{className:isTicketPending()?classes.messageInputWrapperPending:classes.messageInputWrapperPrivate,children:[/*#__PURE__*/_jsx(InputBase,{inputRef:input=>{input&&input.focus();input&&(inputRef.current=input);},className:isTicketPending()?classes.messageInputPending:classes.messageInputPrivate,placeholder:isTicketPending()?\"Mensagem interna (ticket aguardando aceite)...\":ticketStatus===\"open\"||ticketStatus===\"group\"?i18n.t(\"messagesInput.placeholderPrivateMessage\"):i18n.t(\"messagesInput.placeholderClosed\"),multiline:true,maxRows:5,value:safeCapitalizeFirstLetter(inputMessage),onChange:handleChangeInput,disabled:disableOptionForPending(),onPaste:e=>{(ticketStatus===\"open\"||ticketStatus===\"group\"||isTicketPending())&&handleInputPaste(e);},onKeyDown:handleKeyDown,onKeyUp:handleKeyUp,onMouseUp:handleMouseUp,onSelect:handleSelectText,onKeyPress:e=>{if(loading||e.shiftKey)return;else if(e.key===\"Enter\"&&!isNavigatingQuickAnswers){handleSendMessage();}},spellCheck:true}),typeBar?/*#__PURE__*/_jsxs(Box,{component:\"ul\",className:classes.messageQuickAnswersWrapper,style:{marginBottom:\"8px\"// âœ… Pequeno espaÃ§o entre input e lista\n},children:[typeBar.map((value,index)=>{const isSelected=selectedQuickAnswerIndex===index;return/*#__PURE__*/_jsx(\"li\",{className:classes.messageQuickAnswersWrapperItem,style:{listStyle:\"none\"},children:/*#__PURE__*/_jsxs(\"div\",{className:clsx(classes.quickAnswerItem,isSelected&&classes.quickAnswerItemSelected),style:_objectSpread(_objectSpread({},getQuickAnswerItemStyle(index)),isSelected&&{backgroundColor:theme.palette.primary.light+\"20\",borderLeft:\"4px solid \".concat(theme.palette.primary.main),transform:\"translateX(2px)\"// âœ… Leve deslocamento visual\n}),onClick:()=>handleQuickAnswersClick(value),children:[/*#__PURE__*/_jsx(Box,{className:classes.quickAnswerText,children:value.label}),value.mediaType&&/*#__PURE__*/_jsx(Chip,{size:\"small\",label:\"\".concat(getMediaTypeIcon(value.mediaType),\" \").concat(value.mediaType),color:getMediaTypeColor(value.mediaType),className:classes.mediaTypeChip})]})},index);}),typeBar.length>4&&/*#__PURE__*/_jsx(\"li\",{style:{listStyle:\"none\"},children:/*#__PURE__*/_jsxs(\"div\",{className:classes.quickAnswersScrollIndicator,children:[\"\\uD83D\\uDCCB \",typeBar.length,\" respostas \\u2022 use \\u2191\\u2193 para navegar\"]})})]}):null]})}),!privateMessageInputVisible&&!isTicketPending()&&/*#__PURE__*/_jsx(\"div\",{className:classes.flexItem,children:/*#__PURE__*/_jsxs(\"div\",{className:classes.messageInputWrapper,children:[/*#__PURE__*/_jsx(InputBase,{inputRef:input=>{input&&input.focus();input&&(inputRef.current=input);},className:classes.messageInput,placeholder:placeholderText,multiline:true,maxRows:5,value:safeCapitalizeFirstLetter(inputMessage),onChange:handleChangeInput,disabled:disableOption(),onPaste:e=>{(ticketStatus===\"open\"||ticketStatus===\"group\")&&handleInputPaste(e);},onKeyDown:handleKeyDown,onKeyUp:handleKeyUp,onMouseUp:handleMouseUp,onSelect:handleSelectText,onKeyPress:e=>{if(loading||e.shiftKey)return;else if(e.key===\"Enter\"&&!isNavigatingQuickAnswers){handleSendMessage();}},spellCheck:true}),typeBar?/*#__PURE__*/_jsxs(\"ul\",{className:classes.messageQuickAnswersWrapper,children:[typeBar.map((value,index)=>{const isSelected=selectedQuickAnswerIndex===index;return/*#__PURE__*/_jsx(\"li\",{className:classes.messageQuickAnswersWrapperItem,children:/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(classes.quickAnswerItem,\" \").concat(isSelected?'selected':''),style:getQuickAnswerItemStyle(index),onClick:()=>handleQuickAnswersClick(value),children:[/*#__PURE__*/_jsx(Box,{className:classes.quickAnswerText,children:value.label}),value.mediaType&&/*#__PURE__*/_jsx(Chip,{size:\"small\",label:\"\".concat(getMediaTypeIcon(value.mediaType),\" \").concat(value.mediaType),color:getMediaTypeColor(value.mediaType),className:classes.mediaTypeChip})]})},index);}),typeBar.length>5&&/*#__PURE__*/_jsxs(\"div\",{className:classes.quickAnswersScrollIndicator,children:[typeBar.length,\" respostas \\u2022 role para ver mais\"]})]}):/*#__PURE__*/_jsx(\"div\",{})]})})]}),(!privateMessageInputVisible||isTicketPending())&&/*#__PURE__*/_jsxs(_Fragment,{children:[showSchedules&&!isTicketPending()&&/*#__PURE__*/_jsx(Tooltip,{title:i18n.t(\"tickets.buttons.scredule\"),children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"scheduleMessage\",component:\"span\",onClick:()=>setAppointmentModalOpen(true),disabled:loading,children:/*#__PURE__*/_jsx(Timer,{className:classes.sendMessageIcons})})}),inputMessage||showSelectMessageCheckbox?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"sendMessage\",component:\"span\",onClick:showSelectMessageCheckbox?handleOpenModalForward:handleSendMessage,disabled:loading,children:showSelectMessageCheckbox?/*#__PURE__*/_jsx(Reply,{className:classes.ForwardMessageIcons}):/*#__PURE__*/_jsx(Send,{className:classes.sendMessageIcons})})}):recording?/*#__PURE__*/_jsxs(\"div\",{className:classes.recorderWrapper,children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"cancelRecording\",component:\"span\",fontSize:\"large\",disabled:loading,onClick:handleCancelAudio,children:/*#__PURE__*/_jsx(HighlightOff,{className:classes.cancelAudioIcon})}),loading?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(CircularProgress,{className:classes.audioLoading})}):/*#__PURE__*/_jsx(RecordingTimer,{}),/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"sendRecordedAudio\",component:\"span\",onClick:handleUploadAudio,disabled:loading,children:/*#__PURE__*/_jsx(CheckCircleOutline,{className:classes.sendAudioIcon})})]}):/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"showRecorder\",component:\"span\",disabled:disableOptionForPending(),onClick:handleStartRecording,children:/*#__PURE__*/_jsx(Mic,{className:classes.sendMessageIcons})})]}),privateMessageInputVisible&&!isTicketPending()&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"sendMessage\",component:\"span\",onClick:showSelectMessageCheckbox?handleOpenModalForward:handleSendMessage,disabled:loading,children:showSelectMessageCheckbox?/*#__PURE__*/_jsx(Reply,{className:classes.ForwardMessageIcons}):/*#__PURE__*/_jsx(Send,{className:classes.sendMessageIcons})})}),appointmentModalOpen&&/*#__PURE__*/_jsx(ScheduleModal,{open:appointmentModalOpen,onClose:()=>setAppointmentModalOpen(false),message:inputMessage,contactId:contactId,fromMessageInput:true,user:user}),/*#__PURE__*/_jsx(TextFormatMenu,{})]})]})]});}};export default MessageInput;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}