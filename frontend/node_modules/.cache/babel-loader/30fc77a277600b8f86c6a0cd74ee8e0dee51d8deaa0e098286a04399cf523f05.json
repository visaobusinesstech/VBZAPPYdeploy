{"ast":null,"code":"import React,{useEffect,useState,useContext}from\"react\";import QRCode from\"qrcode.react\";import toastError from\"../../errors/toastError\";import{makeStyles}from\"@material-ui/core/styles\";import{Dialog,DialogContent,Paper,Typography}from\"@material-ui/core\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{display:\"flex\",flexWrap:\"wrap\",justifyContent:\"center\",padding:theme.spacing(2)},dialogPaper:{minWidth:320,maxWidth:400,width:\"100%\",padding:theme.spacing(2),margin:0,[theme.breakpoints.down(\"xs\")]:{minWidth:\"90vw\"}},content:{display:\"flex\",flexDirection:\"column\",alignItems:\"center\",justifyContent:\"center\",textAlign:\"center\",padding:theme.spacing(3)},qrCodeContainer:{padding:theme.spacing(3),backgroundColor:\"white\",borderRadius:theme.shape.borderRadius,marginTop:theme.spacing(2)},loadingText:{marginTop:theme.spacing(2),color:theme.palette.text.secondary}}));const QrcodeModal=_ref=>{let{open,onClose,whatsAppId}=_ref;const classes=useStyles();const[qrCode,setQrCode]=useState(\"\");const{user,socket}=useContext(AuthContext);useEffect(()=>{const fetchSession=async()=>{if(!whatsAppId)return;try{const{data}=await api.get(\"/whatsapp/\".concat(whatsAppId));setQrCode(data.qrcode);}catch(err){toastError(err);}};fetchSession();},[whatsAppId]);useEffect(()=>{if(!whatsAppId)return;const companyId=user.companyId;const onWhatsappData=data=>{if(data.action===\"update\"&&data.session.id===whatsAppId){setQrCode(data.session.qrcode);}if(data.action===\"update\"&&data.session.qrcode===\"\"){onClose();}};socket.on(\"company-\".concat(companyId,\"-whatsappSession\"),onWhatsappData);return()=>{socket.off(\"company-\".concat(companyId,\"-whatsappSession\"),onWhatsappData);};},[whatsAppId,onClose,user.companyId]);return/*#__PURE__*/_jsx(Dialog,{open:open,onClose:onClose,classes:{paper:classes.dialogPaper},\"aria-labelledby\":\"qr-code-dialog\",children:/*#__PURE__*/_jsx(DialogContent,{className:classes.content,children:/*#__PURE__*/_jsxs(Paper,{elevation:0,className:classes.dialogPaper,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"primary\",gutterBottom:true,children:i18n.t(\"qrCode.message\")}),/*#__PURE__*/_jsx(\"div\",{className:classes.root,children:qrCode?/*#__PURE__*/_jsx(\"div\",{className:classes.qrCodeContainer,children:/*#__PURE__*/_jsx(QRCode,{value:qrCode,size:280,style:{maxWidth:\"100%\",height:\"auto\"}})}):/*#__PURE__*/_jsx(Typography,{variant:\"body1\",className:classes.loadingText,children:i18n.t(\"qrCode.waiting\")})})]})})});};export default/*#__PURE__*/React.memo(QrcodeModal);","map":{"version":3,"names":["React","useEffect","useState","useContext","QRCode","toastError","makeStyles","Dialog","DialogContent","Paper","Typography","i18n","api","AuthContext","jsx","_jsx","jsxs","_jsxs","useStyles","theme","root","display","flexWrap","justifyContent","padding","spacing","dialogPaper","minWidth","maxWidth","width","margin","breakpoints","down","content","flexDirection","alignItems","textAlign","qrCodeContainer","backgroundColor","borderRadius","shape","marginTop","loadingText","color","palette","text","secondary","QrcodeModal","_ref","open","onClose","whatsAppId","classes","qrCode","setQrCode","user","socket","fetchSession","data","get","concat","qrcode","err","companyId","onWhatsappData","action","session","id","on","off","paper","children","className","elevation","variant","gutterBottom","t","value","size","style","height","memo"],"sources":["/home/deploy/atendechatop/frontend/src/components/QrcodeModal/index.js"],"sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\nimport QRCode from \"qrcode.react\";\nimport toastError from \"../../errors/toastError\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Dialog, DialogContent, Paper, Typography } from \"@material-ui/core\";\nimport { i18n } from \"../../translate/i18n\";\nimport api from \"../../services/api\";\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    justifyContent: \"center\",\n    padding: theme.spacing(2),\n  },\n  dialogPaper: {\n    minWidth: 320,\n    maxWidth: 400,\n    width: \"100%\",\n    padding: theme.spacing(2),\n    margin: 0,\n    [theme.breakpoints.down(\"xs\")]: {\n      minWidth: \"90vw\",\n    },\n  },\n  content: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    textAlign: \"center\",\n    padding: theme.spacing(3),\n  },\n  qrCodeContainer: {\n    padding: theme.spacing(3),\n    backgroundColor: \"white\",\n    borderRadius: theme.shape.borderRadius,\n    marginTop: theme.spacing(2),\n  },\n  loadingText: {\n    marginTop: theme.spacing(2),\n    color: theme.palette.text.secondary,\n  },\n}));\n\nconst QrcodeModal = ({ open, onClose, whatsAppId }) => {\n  const classes = useStyles();\n  const [qrCode, setQrCode] = useState(\"\");\n  const { user, socket } = useContext(AuthContext);\n\n  useEffect(() => {\n    const fetchSession = async () => {\n      if (!whatsAppId) return;\n\n      try {\n        const { data } = await api.get(`/whatsapp/${whatsAppId}`);\n        setQrCode(data.qrcode);\n      } catch (err) {\n        toastError(err);\n      }\n    };\n    fetchSession();\n  }, [whatsAppId]);\n\n  useEffect(() => {\n    if (!whatsAppId) return;\n    const companyId = user.companyId;\n\n    const onWhatsappData = (data) => {\n      if (data.action === \"update\" && data.session.id === whatsAppId) {\n        setQrCode(data.session.qrcode);\n      }\n\n      if (data.action === \"update\" && data.session.qrcode === \"\") {\n        onClose();\n      }\n    };\n    socket.on(`company-${companyId}-whatsappSession`, onWhatsappData);\n\n    return () => {\n      socket.off(`company-${companyId}-whatsappSession`, onWhatsappData);\n    };\n  }, [whatsAppId, onClose, user.companyId]);\n\n  return (\n    <Dialog\n      open={open}\n      onClose={onClose}\n      classes={{ paper: classes.dialogPaper }}\n      aria-labelledby=\"qr-code-dialog\"\n    >\n      <DialogContent className={classes.content}>\n        <Paper elevation={0} className={classes.dialogPaper}>\n          <Typography variant=\"h6\" color=\"primary\" gutterBottom>\n            {i18n.t(\"qrCode.message\")}\n          </Typography>\n          <div className={classes.root}>\n            {qrCode ? (\n              <div className={classes.qrCodeContainer}>\n                <QRCode \n                  value={qrCode} \n                  size={280} \n                  style={{ maxWidth: \"100%\", height: \"auto\" }}\n                />\n              </div>\n            ) : (\n              <Typography variant=\"body1\" className={classes.loadingText}>\n                {i18n.t(\"qrCode.waiting\")}\n              </Typography>\n            )}\n          </div>\n        </Paper>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default React.memo(QrcodeModal);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}