{"ast":null,"code":"import React,{createContext,useState,useEffect,useContext}from\"react\";import api from\"../../services/api\";import useWhatsApps from\"../../hooks/useWhatsApps\";import WavoipPhoneWidget from\"../../components/WavoipCall\";import{AuthContext}from\"../Auth/AuthContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const WhatsAppsContext=/*#__PURE__*/createContext();const WhatsAppsProvider=_ref=>{var _user$company;let{children}=_ref;// Add fallback values to prevent destructuring errors\nconst whatsAppData=useWhatsApps();const{loading=false,whatsApps=[]}=whatsAppData||{};const{user}=useContext(AuthContext);const[wavoipToken,setWavoipToken]=useState(null);const[loadingSession,setLoadingSession]=useState(true);const[error,setError]=useState(null);useEffect(()=>{const fetchSession=async()=>{try{var _data$whatsapp;const{data}=await api.get(\"/call/historical/user/whatsapp\");// let wavoipToken  = \"\";\n// for(const d of data){\n//   if(d?.wavoip){\n//     wavoipToken = d.wavoip;\n//     break;\n//   }\n// }\nconsole.log('whavoip token',data);setWavoipToken((data===null||data===void 0?void 0:(_data$whatsapp=data.whatsapp)===null||_data$whatsapp===void 0?void 0:_data$whatsapp.wavoip)||null);}catch(err){console.error(\"Erro fetchSession:\",err);setWavoipToken(null);}finally{setLoadingSession(false);}};fetchSession();},[]);// Log error state for debugging\nif(error){console.warn(\"WhatsAppsProvider error:\",error);}return/*#__PURE__*/_jsxs(WhatsAppsContext.Provider,{value:{whatsApps,loading,error},children:[children,wavoipToken&&/*#__PURE__*/_jsx(WavoipPhoneWidget,{token:wavoipToken,position:\"bottom-right\",name:(user===null||user===void 0?void 0:(_user$company=user.company)===null||_user$company===void 0?void 0:_user$company.name)||\"waVoip\",country:\"BR\",autoConnect:true,onCallStarted:data=>console.log(\"Chamada iniciada:\",data),onCallEnded:data=>console.log(\"Chamada finalizada:\",data),onConnectionStatus:status=>console.log(\"Status:\",status),onError:error=>console.error(\"Erro:\",error)})]});};export{WhatsAppsContext,WhatsAppsProvider};","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","api","useWhatsApps","WavoipPhoneWidget","AuthContext","jsx","_jsx","jsxs","_jsxs","WhatsAppsContext","WhatsAppsProvider","_ref","_user$company","children","whatsAppData","loading","whatsApps","user","wavoipToken","setWavoipToken","loadingSession","setLoadingSession","error","setError","fetchSession","_data$whatsapp","data","get","console","log","whatsapp","wavoip","err","warn","Provider","value","token","position","name","company","country","autoConnect","onCallStarted","onCallEnded","onConnectionStatus","status","onError"],"sources":["/home/deploy/atendechatop/frontend/src/context/WhatsApp/WhatsAppsContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext } from \"react\";\nimport api from \"../../services/api\";\nimport useWhatsApps from \"../../hooks/useWhatsApps\";\nimport WavoipPhoneWidget from \"../../components/WavoipCall\";\nimport { AuthContext } from \"../Auth/AuthContext\";\n\nconst WhatsAppsContext = createContext();\n\nconst WhatsAppsProvider = ({ children }) => {\n  // Add fallback values to prevent destructuring errors\n  const whatsAppData = useWhatsApps();\n  const { loading = false, whatsApps = [] } = whatsAppData || {};\n  const { user } = useContext(AuthContext);\n  \n  const [wavoipToken, setWavoipToken] = useState(null);\n  const [loadingSession, setLoadingSession] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const fetchSession = async () => {\n      try {\n        const { data } = await api.get(\"/call/historical/user/whatsapp\");\n\n        // let wavoipToken  = \"\";\n        // for(const d of data){\n        //   if(d?.wavoip){\n        //     wavoipToken = d.wavoip;\n        //     break;\n        //   }\n        // }\n        console.log('whavoip token', data)\n        setWavoipToken(data?.whatsapp?.wavoip || null);\n      } catch (err) {\n        console.error(\"Erro fetchSession:\", err);\n        setWavoipToken(null);\n      } finally {\n        setLoadingSession(false);\n      }\n    };\n    fetchSession();\n  }, []);\n\n\n  // Log error state for debugging\n  if (error) {\n    console.warn(\"WhatsAppsProvider error:\", error);\n  }\n\n  return (\n    <WhatsAppsContext.Provider value={{ whatsApps, loading, error }}>\n      {children}\n      {wavoipToken && (\n        <WavoipPhoneWidget\n          token={wavoipToken}\n          position=\"bottom-right\"\n          name={user?.company?.name || \"waVoip\"}\n          country=\"BR\"\n          autoConnect={true}\n          onCallStarted={(data) => console.log(\"Chamada iniciada:\", data)}\n          onCallEnded={(data) => console.log(\"Chamada finalizada:\", data)}\n          onConnectionStatus={(status) => console.log(\"Status:\", status)}\n          onError={(error) => console.error(\"Erro:\", error)}\n        />\n      )}\n    </WhatsAppsContext.Provider>\n  );\n};\n\nexport { WhatsAppsContext, WhatsAppsProvider };"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}