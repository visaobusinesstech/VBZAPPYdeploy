{"ast":null,"code":"import React,{memo,useEffect,useState,useCallback}from\"react\";import{Box,Typography,IconButton,Chip,Paper,Tooltip}from\"@mui/material\";import{QuestionAnswer,Code as VariablesIcon,ContentCopy as ContentCopyIcon,DeleteOutline as DeleteOutlineIcon,Save as SaveIcon}from\"@mui/icons-material\";import{Handle}from\"react-flow-renderer\";import{useNodeStorage}from\"../../../stores/useNodeStorage\";import{processVariablesInText}from\"../../../utils/variableUtils\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default/*#__PURE__*/memo(_ref=>{let{data,isConnectable,id}=_ref;const storageItems=useNodeStorage();const[processedQuestion,setProcessedQuestion]=useState(data.question||\"\");const[variableValue,setVariableValue]=useState(\"\");const[isExecutionMode,setIsExecutionMode]=useState(false);const extractVariables=text=>{if(!text)return[];const regex=/\\$\\{([^}]+)\\}/g;const matches=[];let match;while((match=regex.exec(text))!==null){matches.push(match[1]);}return[...new Set(matches)];};const updateProcessedQuestion=useCallback(()=>{const originalText=data.question||\"\";const newText=processVariablesInText(originalText);setProcessedQuestion(newText);},[data.question]);useEffect(()=>{const isExecutionPath=!window.location.pathname.includes('/flowbuilder-config');setIsExecutionMode(isExecutionPath);if(isExecutionPath&&data.variableName){const checkVariableValue=()=>{if(window.flowVariables&&window.flowVariables[data.variableName]){setVariableValue(window.flowVariables[data.variableName]);}};checkVariableValue();const intervalId=setInterval(checkVariableValue,1000);return()=>clearInterval(intervalId);}},[data.variableName]);useEffect(()=>{updateProcessedQuestion();const handleVariableUpdate=()=>{console.log('[inputNode] Detectada atualização de variáveis');updateProcessedQuestion();};window.addEventListener('flowVariableUpdate',handleVariableUpdate);const intervalId=setInterval(()=>{updateProcessedQuestion();},500);return()=>{window.removeEventListener('flowVariableUpdate',handleVariableUpdate);clearInterval(intervalId);};},[data.question,updateProcessedQuestion]);return/*#__PURE__*/_jsxs(Box,{sx:{backgroundColor:\"#fff\",borderRadius:2,boxShadow:2,p:2,width:280,display:\"flex\",flexDirection:\"column\",gap:1,position:\"relative\",border:\"1px solid rgba(156, 39, 176, 0.2)\"},children:[/*#__PURE__*/_jsx(Handle,{type:\"target\",position:\"left\",style:{left:-8,top:\"50%\",transform:\"translateY(-50%)\",background:\"#9c27b0\",width:12,height:12,cursor:'pointer'},onConnect:params=>console.log(\"handle onConnect\",params),isConnectable:isConnectable}),/*#__PURE__*/_jsxs(Box,{sx:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\"},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:\"flex\",alignItems:\"center\",gap:1},children:[/*#__PURE__*/_jsx(QuestionAnswer,{fontSize:\"small\",sx:{color:'#9c27b0'}}),/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",fontWeight:\"bold\",children:\"Input\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:\"flex\",gap:1},children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>{storageItems.setNodesStorage(id);storageItems.setAct(\"duplicate\");},children:/*#__PURE__*/_jsx(ContentCopyIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>{storageItems.setNodesStorage(id);storageItems.setAct(\"delete\");},children:/*#__PURE__*/_jsx(DeleteOutlineIcon,{fontSize:\"small\"})})]})]}),/*#__PURE__*/_jsxs(Paper,{elevation:0,sx:{bgcolor:'#f9f4fb',p:1.5,borderRadius:1,minHeight:'60px',overflow:'auto',maxHeight:'150px',wordBreak:'break-word',border:'1px solid rgba(156, 39, 176, 0.1)'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",sx:{display:'block',mb:0.5},children:\"Pergunta:\"}),data.question?/*#__PURE__*/_jsx(Box,{children:!isExecutionMode?data.question.split(/\\$\\{([^}]+)\\}/).map((part,index)=>{if(index%2===0){return/*#__PURE__*/_jsx(Typography,{variant:\"body2\",component:\"span\",children:part},index);}else{return/*#__PURE__*/_jsx(Chip,{label:part,size:\"small\",sx:{height:20,fontSize:'0.75rem',bgcolor:'rgba(156, 39, 176, 0.1)',color:'#9c27b0',border:'1px solid rgba(156, 39, 176, 0.2)',my:0.25,mx:0.5,'& .MuiChip-label':{px:1}}},index);}}):/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:processedQuestion})}):/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",sx:{fontStyle:'italic'},children:\"Pergunta n\\xE3o definida\"})]}),/*#__PURE__*/_jsxs(Paper,{elevation:0,sx:{bgcolor:'#f9f4fb',p:1.5,borderRadius:1,minHeight:'40px',overflow:'auto',wordBreak:'break-word',border:'1px solid rgba(156, 39, 176, 0.1)'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",sx:{display:'block',mb:0.5},children:\"Vari\\xE1vel para armazenar resposta:\"}),data.variableName?/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Chip,{label:data.variableName,size:\"small\",sx:{height:24,fontSize:'0.85rem',bgcolor:'rgba(156, 39, 176, 0.1)',color:'#9c27b0',border:'1px solid rgba(156, 39, 176, 0.2)','& .MuiChip-label':{px:1.5}}}),isExecutionMode&&variableValue&&/*#__PURE__*/_jsx(Tooltip,{title:\"Valor: \".concat(variableValue),children:/*#__PURE__*/_jsxs(Box,{sx:{ml:1.5,p:0.75,borderRadius:1,bgcolor:'rgba(25, 118, 210, 0.1)',border:'1px solid rgba(25, 118, 210, 0.2)',display:'flex',alignItems:'center',gap:0.5},children:[/*#__PURE__*/_jsx(SaveIcon,{fontSize:\"small\",sx:{color:'#1976d2',width:16,height:16}}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"primary\",children:variableValue.length>15?\"\".concat(variableValue.substring(0,15),\"...\"):variableValue})]})})]}):/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",sx:{fontStyle:'italic'},children:\"Vari\\xE1vel n\\xE3o definida\"})]}),data.question&&data.question.includes(\"${\")&&/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1,mt:0.5,bgcolor:'rgba(156, 39, 176, 0.05)',p:0.75,borderRadius:1},children:[/*#__PURE__*/_jsx(VariablesIcon,{fontSize:\"small\",sx:{color:'#9c27b0',width:16,height:16}}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",sx:{color:'#9c27b0'},children:[\"Usando vari\\xE1veis: \",extractVariables(data.question).join(', ')]})]}),/*#__PURE__*/_jsx(Handle,{type:\"source\",position:\"right\",id:\"a\",style:{right:-8,top:\"50%\",transform:\"translateY(-50%)\",background:\"#9c27b0\",width:12,height:12,cursor:'pointer'},isConnectable:isConnectable})]});});","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}