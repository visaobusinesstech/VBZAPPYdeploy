{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import{makeStyles}from'@material-ui/core/styles';import{Avatar,Button,Tooltip,Typography,Divider,Dialog,DialogTitle,DialogContent,DialogActions,TextField,IconButton}from'@material-ui/core';import CloseIcon from'@material-ui/icons/Close';import{format,parseISO,isSameDay}from'date-fns';import{useHistory}from'react-router-dom';import{Draggable}from'react-beautiful-dnd';import api from'../../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({card:{padding:theme.spacing(0.8),background:'#fff',borderRadius:8,boxShadow:'0px 10px 17px -10px rgba(0, 0, 0, 0.59)',marginBottom:theme.spacing(1),cursor:'grab',display:'flex',flexDirection:'column',position:'relative',marginRight:theme.spacing(0.5)},header:{display:'flex',alignItems:'center',marginBottom:theme.spacing(0.5),justifyContent:'space-between'},leftHeader:{display:'flex',alignItems:'center'},avatar:{marginRight:theme.spacing(1),width:theme.spacing(3),height:theme.spacing(3)},cardTitle:{fontSize:'1rem',fontWeight:'bold',color:theme.mode===\"light\"?theme.palette.text.primary:\"#000\"},ticketNumber:{fontSize:'0.9rem',fontWeight:'bold',color:\"#757575\"},divider:{background:\"#e6e6e6\"},lastMessageTime:{fontSize:'0.8rem',color:\"#757575\"},lastMessageTimeUnread:{fontSize:'0.8rem',color:theme.palette.success.main,fontWeight:'bold'},cardDescription:{fontSize:'0.9rem',color:\"#757575\",flexGrow:1,marginRight:theme.spacing(1)},valueRow:{display:'flex',justifyContent:'space-between',alignItems:'center',marginTop:theme.spacing(1)},descriptionRow:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:theme.spacing(1)},footer:{display:'flex',alignItems:'center',marginTop:'auto'},cardButton:{fontSize:'0.5rem',padding:'2px 6px',color:'#fff',backgroundColor:theme.palette.primary.main,borderRadius:'10px','&:hover':{backgroundColor:theme.palette.primary.dark}},connectionTag:{background:\"#000\",color:'#FFF',padding:'2px 6px',fontWeight:'bold',borderRadius:'10px',fontSize:'0.5rem',marginLeft:'auto'},opportunityValue:{fontSize:'0.9rem',color:theme.palette.primary.main,fontWeight:'bold',cursor:'pointer'},removeValueButton:{padding:0,marginLeft:theme.spacing(1),color:theme.palette.error.main},textField:{'& .MuiOutlinedInput-root':{borderRadius:'10px'}},dialogPaper:{borderRadius:'10px'},dialogButton:{borderRadius:'10px'}}));const KanbanCard=_ref=>{let{ticket,index,updateTicket}=_ref;const classes=useStyles();const history=useHistory();const[open,setOpen]=useState(false);const[newValue,setNewValue]=useState('');const handleCardClick=()=>{history.push(\"/tickets/\".concat(ticket.uuid));};const lastMessageTimeClass=Number(ticket.unreadMessages)>0?classes.lastMessageTimeUnread:classes.lastMessageTime;const customFields=ticket.contact.extraInfo||[];const valueFieldIndex=customFields.findIndex(field=>field.name==='valor');const valueField=valueFieldIndex!==-1?customFields[valueFieldIndex]:null;const opportunityValue=valueField?parseFloat(valueField.value):null;const handleOpenModal=()=>{setNewValue(valueField?valueField.value.toString():'');setOpen(true);};const handleCloseModal=()=>{setOpen(false);};const updateContactValue=async(contactId,value)=>{try{await api.put(\"/contacts/\".concat(contactId),{extraInfo:[{name:'valor',value:value.toString()}]});}catch(error){console.error('Erro ao atualizar o valor:',error);}};const removeContactValue=async()=>{try{await api.put(\"/contacts/\".concat(ticket.contact.id),{extraInfo:[]});if(valueFieldIndex!==-1){customFields.splice(valueFieldIndex,1);}updateTicket(_objectSpread({},ticket));}catch(error){console.error('Erro ao remover o valor:',error);}};const handleSaveValue=async()=>{await updateContactValue(ticket.contact.id,newValue);if(valueField){valueField.value=newValue;}else{if(!ticket.contact.extraInfo){ticket.contact.extraInfo=[];}ticket.contact.extraInfo.push({name:'valor',value:newValue});}updateTicket(_objectSpread({},ticket));setOpen(false);};return/*#__PURE__*/_jsx(Draggable,{draggableId:ticket.id.toString(),index:index,children:(provided,snapshot)=>{var _ticket$contact$name,_ticket$lastMessage;return/*#__PURE__*/_jsxs(\"div\",_objectSpread(_objectSpread(_objectSpread({className:classes.card,ref:provided.innerRef},provided.draggableProps),provided.dragHandleProps),{},{children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.header,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.leftHeader,children:[/*#__PURE__*/_jsx(Avatar,{src:ticket.contact.urlPicture,className:classes.avatar}),/*#__PURE__*/_jsx(Tooltip,{title:ticket.contact.name,children:/*#__PURE__*/_jsx(Typography,{className:classes.cardTitle,children:((_ticket$contact$name=ticket.contact.name)===null||_ticket$contact$name===void 0?void 0:_ticket$contact$name.substring(0,10))||' '})})]}),/*#__PURE__*/_jsxs(Typography,{className:classes.ticketNumber,children:[\"Ticket n\\xBA \",ticket.id]})]}),/*#__PURE__*/_jsx(Divider,{className:classes.divider}),/*#__PURE__*/_jsx(\"div\",{className:classes.valueRow,children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Typography,{className:classes.opportunityValue,onClick:handleOpenModal,children:opportunityValue!==null?\"Valor: R$ \".concat(opportunityValue.toFixed(2)):'Atribuir Valor'}),opportunityValue!==null&&/*#__PURE__*/_jsx(Tooltip,{title:\"Remover\",children:/*#__PURE__*/_jsx(IconButton,{className:classes.removeValueButton,onClick:removeContactValue,size:\"small\",children:/*#__PURE__*/_jsx(CloseIcon,{fontSize:\"small\"})})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:classes.descriptionRow,children:[/*#__PURE__*/_jsx(Tooltip,{title:ticket.lastMessage||' ',children:/*#__PURE__*/_jsx(Typography,{className:classes.cardDescription,children:((_ticket$lastMessage=ticket.lastMessage)===null||_ticket$lastMessage===void 0?void 0:_ticket$lastMessage.substring(0,20))||' '})}),/*#__PURE__*/_jsx(Typography,{className:lastMessageTimeClass,children:isSameDay(parseISO(ticket.updatedAt),new Date())?format(parseISO(ticket.updatedAt),'HH:mm'):format(parseISO(ticket.updatedAt),'dd/MM/yyyy')})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.footer,children:[/*#__PURE__*/_jsx(Button,{size:\"small\",className:classes.cardButton,onClick:handleCardClick,children:\"Ver Ticket\"}),ticket.user&&/*#__PURE__*/_jsx(Typography,{className:classes.connectionTag,children:ticket.user.name.toUpperCase()})]}),/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleCloseModal,classes:{paper:classes.dialogPaper},children:[/*#__PURE__*/_jsxs(DialogTitle,{children:[valueField?'Editar':'Atribuir',\" Valor da Oportunidade\"]}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(TextField,{label:\"Valor\",type:\"number\",fullWidth:true,value:newValue,onChange:e=>setNewValue(e.target.value),variant:\"outlined\",size:\"small\",className:classes.textField,personalizados:true})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleCloseModal,color:\"secondary\",variant:\"outlined\",className:classes.dialogButton,children:\"Cancelar\"}),/*#__PURE__*/_jsx(Button,{onClick:handleSaveValue,color:\"primary\",variant:\"outlined\",className:classes.dialogButton,children:\"Salvar\"})]})]})]}));}});};export default KanbanCard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}