{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect,useContext}from\"react\";import{AuthContext}from\"../context/Auth/AuthContext\";const useOnlineUsers=()=>{const[onlineUsers,setOnlineUsers]=useState([]);const{socket}=useContext(AuthContext);useEffect(()=>{if(!socket)return;socket.on(\"users:online\",users=>{setOnlineUsers(users);});socket.on(\"user:online\",_ref=>{let{userId,lastSeen}=_ref;setOnlineUsers(prev=>{const userIndex=prev.findIndex(u=>u.id===userId);if(userIndex===-1)return prev;const updatedUsers=[...prev];updatedUsers[userIndex]=_objectSpread(_objectSpread({},updatedUsers[userIndex]),{},{online:true,lastSeen});return updatedUsers;});});socket.on(\"user:offline\",_ref2=>{let{userId,lastSeen}=_ref2;setOnlineUsers(prev=>{const userIndex=prev.findIndex(u=>u.id===userId);if(userIndex===-1)return prev;const updatedUsers=[...prev];updatedUsers[userIndex]=_objectSpread(_objectSpread({},updatedUsers[userIndex]),{},{online:false,lastSeen});return updatedUsers;});});socket.on(\"user:new\",_ref3=>{let{user}=_ref3;setOnlineUsers(prev=>{if(prev.some(u=>u.id===user.id))return prev;return[...prev,_objectSpread(_objectSpread({},user),{},{online:true})];});});const heartbeatInterval=setInterval(()=>{socket.emit(\"heartbeat\");},15000);return()=>{socket.off(\"users:online\");socket.off(\"user:online\");socket.off(\"user:offline\");socket.off(\"user:new\");clearInterval(heartbeatInterval);};},[socket]);return onlineUsers;};export default useOnlineUsers;","map":{"version":3,"names":["useState","useEffect","useContext","AuthContext","useOnlineUsers","onlineUsers","setOnlineUsers","socket","on","users","_ref","userId","lastSeen","prev","userIndex","findIndex","u","id","updatedUsers","_objectSpread","online","_ref2","_ref3","user","some","heartbeatInterval","setInterval","emit","off","clearInterval"],"sources":["/home/deploy/atendechatop/frontend/src/hooks/useOnlineUsers.js"],"sourcesContent":["import { useState, useEffect, useContext } from \"react\";\nimport { AuthContext } from \"../context/Auth/AuthContext\";\n\nconst useOnlineUsers = () => {\n  const [onlineUsers, setOnlineUsers] = useState([]);\n  const { socket } = useContext(AuthContext);\n\n  useEffect(() => {\n    if (!socket) return;\n\n    socket.on(\"users:online\", (users) => {\n      setOnlineUsers(users);\n    });\n\n    socket.on(\"user:online\", ({ userId, lastSeen }) => {\n      setOnlineUsers((prev) => {\n        const userIndex = prev.findIndex((u) => u.id === userId);\n        if (userIndex === -1) return prev;\n\n        const updatedUsers = [...prev];\n        updatedUsers[userIndex] = {\n          ...updatedUsers[userIndex],\n          online: true,\n          lastSeen,\n        };\n        return updatedUsers;\n      });\n    });\n\n    socket.on(\"user:offline\", ({ userId, lastSeen }) => {\n      setOnlineUsers((prev) => {\n        const userIndex = prev.findIndex((u) => u.id === userId);\n        if (userIndex === -1) return prev;\n\n        const updatedUsers = [...prev];\n        updatedUsers[userIndex] = {\n          ...updatedUsers[userIndex],\n          online: false,\n          lastSeen,\n        };\n        return updatedUsers;\n      });\n    });\n\n    socket.on(\"user:new\", ({ user }) => {\n      setOnlineUsers((prev) => {\n        if (prev.some((u) => u.id === user.id)) return prev;\n        return [...prev, { ...user, online: true }];\n      });\n    });\n\n    const heartbeatInterval = setInterval(() => {\n      socket.emit(\"heartbeat\");\n    }, 15000);\n\n    return () => {\n      socket.off(\"users:online\");\n      socket.off(\"user:online\");\n      socket.off(\"user:offline\");\n      socket.off(\"user:new\");\n      clearInterval(heartbeatInterval);\n    };\n  }, [socket]);\n\n  return onlineUsers;\n};\n\nexport default useOnlineUsers;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}