{"ast":null,"code":"import React,{useState,useEffect,useRef,useContext}from\"react\";import{useHistory,useParams}from\"react-router-dom\";import{parseISO,format,isSameDay}from\"date-fns\";import clsx from\"clsx\";import emojiRegex from\"emoji-regex\";import{v4 as uuidv4}from\"uuid\";import{makeStyles,withStyles}from\"@material-ui/core/styles\";import{green}from\"@material-ui/core/colors\";import ListItem from\"@material-ui/core/ListItem\";import ListItemText from\"@material-ui/core/ListItemText\";import ListItemAvatar from\"@material-ui/core/ListItemAvatar\";import Typography from\"@material-ui/core/Typography\";import Avatar from\"@material-ui/core/Avatar\";import Divider from\"@material-ui/core/Divider\";import Badge from\"@material-ui/core/Badge\";import IconButton from\"@material-ui/core/IconButton\";import{i18n}from\"../../translate/i18n\";import VisibilityIcon from\"@material-ui/icons/Visibility\";import CheckIcon from\"@material-ui/icons/CheckCircle\";import ReplayIcon from\"@material-ui/icons/Replay\";import ClearOutlinedIcon from\"@material-ui/icons/ClearOutlined\";import api from\"../../services/api\";import{Dialog,DialogContent}from\"@material-ui/core\";import MarkdownWrapper from\"../MarkdownWrapper\";import{Tooltip}from\"@material-ui/core\";import{AuthContext}from\"../../context/Auth/AuthContext\";import toastError from\"../../errors/toastError\";import facebookIcon from\"../../assets/facebook.png\";import insatagramIcon from\"../../assets/instagram.png\";import whatsappIcon from\"../../assets/whatsapp.png\";import{TicketsContext}from\"../../context/Tickets/TicketsContext\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({ticket:{position:\"relative\"},pendingTicket:{cursor:\"unset\"},noTicketsDiv:{display:\"flex\",height:\"100px\",margin:40,flexDirection:\"column\",alignItems:\"center\",justifyContent:\"center\"},noTicketsText:{textAlign:\"center\",color:\"rgb(104, 121, 146)\",fontSize:\"14px\",lineHeight:\"1.4\"},noTicketsTitle:{textAlign:\"center\",fontSize:\"16px\",fontWeight:\"600\",margin:\"0px\"},contactNameWrapper:{display:\"flex\",justifyContent:\"space-between\"},lastMessageTime:{position:\"absolute\",marginRight:5,right:20,bottom:30},closedBadge:{alignSelf:\"center\",justifySelf:\"flex-end\",marginRight:32,marginLeft:\"auto\"},contactLastMessage:{paddingRight:20},newMessagesCount:{alignSelf:\"center\",marginRight:8,marginLeft:\"auto\"},bottomButton:{top:\"12px\"},badgeStyle:{color:\"white\",backgroundColor:green[500]},acceptButton:{position:\"absolute\",left:\"50%\"},ticketQueueColor:{flex:\"none\",width:\"8px\",height:\"100%\",position:\"absolute\",top:\"0%\",left:\"0%\"},userTag:{position:\"absolute\",marginRight:110,right:20,bottom:30,backgroundColor:theme.palette.background.default,color:theme.palette.primary.main,border:\"1px solid #CCC\",padding:1,paddingLeft:5,paddingRight:5,borderRadius:10,fontSize:\"0.9em\"},divTags:{position:\"absolute\",marginRight:0,left:0,bottom:0,flexWrap:\"wrap\",display:\"flex\",flexDirection:\"row\",justifyContent:\"flex-start\",alignItems:\"center\"},tags:{color:\"#FFF\",border:\"1px solid #CCC\",padding:0,paddingLeft:5,paddingRight:5,borderRadius:0,fontSize:\"0.6em\",textAlign:\"center\"},divUser:{position:\"absolute\",marginRight:0,left:0,top:0,flexWrap:\"wrap\",display:\"flex\",flexDirection:\"row\",justifyContent:\"flex-start\",alignItems:\"center\"},user:{color:\"#eee\",border:\"1px solid #CCC\",padding:0,paddingLeft:5,paddingRight:5,borderRadius:0,fontSize:\"0.6em\",textAlign:\"center\"},tagsWrapper:{zIndex:500},badge:{backgroundColor:\"#44b700\",color:\"#44b700\",boxShadow:\"0 0 0 2px \".concat(theme.palette.background.paper),\"&::after\":{position:\"absolute\",top:0,left:0,width:\"100%\",height:\"100%\",borderRadius:\"50%\",animation:\"$ripple 1.2s infinite ease-in-out\",border:\"1px solid currentColor\",content:'\"\"'}},\"@keyframes ripple\":{\"0%\":{transform:\"scale(.8)\",opacity:1},\"100%\":{transform:\"scale(2.4)\",opacity:0}},// Estilos para o modal da imagem\nimageModal:{display:\"flex\",alignItems:\"center\",justifyContent:\"center\"},imageModalContent:{outline:\"none\",maxWidth:\"90vw\",maxHeight:\"90vh\"},expandedImage:{width:\"100%\",height:\"auto\",maxWidth:\"500px\",borderRadius:theme.spacing(1)},clickableAvatar:{cursor:\"pointer\",\"&:hover\":{opacity:0.8}}}));const SmallAvatar=withStyles(theme=>({root:{width:22,height:22,border:\"2px solid \".concat(theme.palette.background.paper)}}))(Avatar);const getAvatarChannel=channel=>{if(channel===\"facebook\"){return facebookIcon;}if(channel===\"whatsapp\"){return whatsappIcon;}if(channel===\"whatsappapi\"){return whatsappIcon;}if(channel===\"instagram\"){return insatagramIcon;}};const TicketListItem=_ref=>{var _ticket$queue,_ticket$queue2,_ticket$contact2,_ticket$contact3,_ticket$whatsapp,_ticket$userRating,_ticket$user,_ticket$tags,_ticket$contact4,_ticket$contact5;let{ticket}=_ref;const classes=useStyles();const history=useHistory();const[loading,setLoading]=useState(false);const{ticketId}=useParams();const isMounted=useRef(true);const{user}=useContext(AuthContext);const{setCurrentTicket,setTabOpen}=useContext(TicketsContext);const[imageModalOpen,setImageModalOpen]=useState(false);// Estado para o modal da imagem\nuseEffect(()=>{return()=>{isMounted.current=false;};},[]);// FunÃ§Ã£o para abrir modal da imagem\nconst handleImageClick=e=>{var _ticket$contact;e.stopPropagation();// Prevenir que o clique no avatar selecione o ticket\nif(ticket!==null&&ticket!==void 0&&(_ticket$contact=ticket.contact)!==null&&_ticket$contact!==void 0&&_ticket$contact.urlPicture){setImageModalOpen(true);}};// FunÃ§Ã£o para fechar modal da imagem\nconst handleImageModalClose=()=>{setImageModalOpen(false);};function getRatingIcon(rate){let icon=\"\";if(rate===1){icon=\"ðŸ˜¡\";}else if(rate===2){icon=\"ðŸ˜ \";}else if(rate===3){icon=\"ðŸ˜\";}else if(rate===4){icon=\"ðŸ˜ƒ\";}else if(rate===5){icon=\"ðŸ˜\";}return icon;}const handleAcepptTicket=async ticket=>{setLoading(true);try{await api.put(\"/tickets/\".concat(ticket.id),{status:\"open\",userId:user===null||user===void 0?void 0:user.id});}catch(err){setLoading(false);toastError(err);}if(isMounted.current){setLoading(false);}history.push(\"/tickets/\".concat(ticket.uuid));};const handleAcepptTicketBot=async ticket=>{// alert(\"Bot\");\nsetLoading(true);try{await api.put(\"/tickets/\".concat(ticket.id),{status:\"open\",userId:user===null||user===void 0?void 0:user.id});}catch(err){setLoading(false);toastError(err);}if(isMounted.current){setLoading(false);}history.push(\"/tickets/\".concat(ticket.uuid));};const handleReopenTicket=async ticket=>{setLoading(true);try{await api.put(\"/tickets/\".concat(ticket.id),{status:\"open\",userId:user===null||user===void 0?void 0:user.id});}catch(err){setLoading(false);toastError(err);}if(isMounted.current){setLoading(false);}history.push(\"/tickets/\".concat(ticket.uuid));};const handleViewTicket=async ticket=>{setLoading(true);try{await api.put(\"/tickets/\".concat(ticket.id),{status:\"pending\"});}catch(err){setLoading(false);toastError(err);}if(isMounted.current){setLoading(false);}history.push(\"/tickets/\".concat(ticket.uuid));};const handleSelectTicket=ticket=>{const code=uuidv4();const{id,uuid}=ticket;setTabOpen(ticket.status);setCurrentTicket({id,uuid,code});};const handleClosedTicket=async ticket=>{setLoading(true);try{await api.put(\"/tickets/\".concat(ticket.id),{status:\"closed\"});}catch(err){setLoading(false);toastError(err);}if(isMounted.current){setLoading(false);}};const renderUserName=name=>{let str=name.replace(emojiRegex(),\"\").trim();const firstName=str.split(\" \")[0];return firstName;};return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(ListItem,{dense:true,button:true,onClick:e=>{handleSelectTicket(ticket);},selected:ticketId&&+ticketId===ticket.id,className:clsx(classes.ticket,{[classes.pendingTicket]:ticket.status===\"pending\"}),children:[/*#__PURE__*/_jsx(Tooltip,{arrow:true,placement:\"right\",title:((_ticket$queue=ticket.queue)===null||_ticket$queue===void 0?void 0:_ticket$queue.name)||\"Sem departamento\",children:/*#__PURE__*/_jsx(\"span\",{style:{backgroundColor:((_ticket$queue2=ticket.queue)===null||_ticket$queue2===void 0?void 0:_ticket$queue2.color)||\"#7C7C7C\"},className:classes.ticketQueueColor})}),/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Badge,{overlap:\"circular\",anchorOrigin:{vertical:\"bottom\",horizontal:\"right\"},badgeContent:/*#__PURE__*/_jsx(SmallAvatar,{alt:ticket===null||ticket===void 0?void 0:ticket.channel,src:getAvatarChannel(ticket===null||ticket===void 0?void 0:ticket.channel)}),children:/*#__PURE__*/_jsx(Avatar,{alt:ticket===null||ticket===void 0?void 0:(_ticket$contact2=ticket.contact)===null||_ticket$contact2===void 0?void 0:_ticket$contact2.name,src:ticket===null||ticket===void 0?void 0:(_ticket$contact3=ticket.contact)===null||_ticket$contact3===void 0?void 0:_ticket$contact3.urlPicture,className:classes.clickableAvatar,onClick:handleImageClick})})}),/*#__PURE__*/_jsx(ListItemText,{disableTypography:true,primary:/*#__PURE__*/_jsxs(\"span\",{className:classes.contactNameWrapper,children:[/*#__PURE__*/_jsx(Typography,{noWrap:true,component:\"span\",variant:\"body2\",color:\"textPrimary\",children:ticket.contact.name}),/*#__PURE__*/_jsx(Typography,{className:classes.lastMessageTime,component:\"span\",variant:\"body2\",color:\"textSecondary\",children:isSameDay(parseISO(ticket.updatedAt),new Date())?/*#__PURE__*/_jsx(_Fragment,{children:format(parseISO(ticket.updatedAt),\"HH:mm\")}):/*#__PURE__*/_jsx(_Fragment,{children:format(parseISO(ticket.updatedAt),\"dd/MM/yyyy\")})}),ticket.whatsappId&&/*#__PURE__*/_jsx(\"div\",{className:classes.userTag,title:i18n.t(\"ticketsList.connectionTitle\"),children:(_ticket$whatsapp=ticket.whatsapp)===null||_ticket$whatsapp===void 0?void 0:_ticket$whatsapp.name})]}),secondary:/*#__PURE__*/_jsxs(\"span\",{className:classes.contactNameWrapper,children:[ticket.status===\"closed\"?ticket!==null&&ticket!==void 0&&ticket.userRating?getRatingIcon(ticket===null||ticket===void 0?void 0:(_ticket$userRating=ticket.userRating)===null||_ticket$userRating===void 0?void 0:_ticket$userRating.rate):null:null,/*#__PURE__*/_jsx(Typography,{className:classes.contactLastMessage,noWrap:true,component:\"span\",variant:\"body2\",color:\"textSecondary\",children:ticket.lastMessage?/*#__PURE__*/_jsx(MarkdownWrapper,{children:ticket.lastMessage}):/*#__PURE__*/_jsx(\"br\",{})}),/*#__PURE__*/_jsx(Badge,{overlap:\"rectangular\",className:classes.newMessagesCount,badgeContent:ticket.unreadMessages,classes:{badge:classes.badgeStyle}})]})}),ticket.status===\"pending\"&&/*#__PURE__*/_jsx(IconButton,{className:classes.bottomButton,color:\"primary\",loading:loading.toString(),onClick:e=>ticket.isBot?handleAcepptTicketBot(ticket):handleAcepptTicket(ticket),children:/*#__PURE__*/_jsx(CheckIcon,{})}),/*#__PURE__*/_jsxs(\"div\",{className:classes.divTags,children:[ticket.isGroup&&/*#__PURE__*/_jsx(\"div\",{className:classes.tagsWrapper,children:/*#__PURE__*/_jsx(\"div\",{className:classes.tags// title={ticket.isGroup}\n,style:{backgroundColor:\"#7C7C7C\"},children:\"Grupo\"},ticket.id)}),((_ticket$user=ticket.user)===null||_ticket$user===void 0?void 0:_ticket$user.id)&&user.profile.toUpperCase()===\"ADMIN\"&&/*#__PURE__*/_jsx(\"div\",{className:classes.tagsWrapper,children:/*#__PURE__*/_jsx(\"div\",{className:classes.tags,title:renderUserName(ticket.user.name),style:{backgroundColor:ticket.user.color===\"\"||!ticket.user.color?\"#7C7C7C\":ticket.user.color},children:renderUserName(ticket.user.name)},ticket.user.id)}),((_ticket$tags=ticket.tags)===null||_ticket$tags===void 0?void 0:_ticket$tags.length)>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:classes.tagsWrapper,children:/*#__PURE__*/_jsx(\"div\",{className:classes.tags,title:ticket.tags[0].name,style:{backgroundColor:ticket.tags[0].color},children:ticket.tags[0].name},ticket.tags[0].id)}),ticket.tags.length>1&&/*#__PURE__*/_jsxs(\"div\",{className:classes.tags,title:ticket.tags[1].name,style:{backgroundColor:ticket.tags[1].color},children:[\"+\",ticket.tags.length-1]},ticket.tags[1].id)]})]}),ticket.status===\"pending\"&&(user.showDashboard===\"enabled\"||user.profile===\"admin\")&&/*#__PURE__*/_jsx(IconButton,{className:classes.bottomButton,color:\"primary\",onClick:e=>handleClosedTicket(ticket),children:/*#__PURE__*/_jsx(ClearOutlinedIcon,{})}),ticket.status===\"open\"&&/*#__PURE__*/_jsx(IconButton,{className:classes.bottomButton,color:\"primary\",onClick:e=>handleViewTicket(ticket),children:/*#__PURE__*/_jsx(ReplayIcon,{})}),ticket.status===\"open\"&&/*#__PURE__*/_jsx(IconButton,{className:classes.bottomButton,color:\"primary\",onClick:e=>handleClosedTicket(ticket),children:/*#__PURE__*/_jsx(ClearOutlinedIcon,{})}),ticket.status===\"closed\"&&/*#__PURE__*/_jsx(IconButton,{className:classes.bottomButton,color:\"primary\",onClick:e=>handleReopenTicket(ticket),children:/*#__PURE__*/_jsx(ReplayIcon,{})}),ticket.status===\"closed\"&&/*#__PURE__*/_jsx(IconButton,{className:classes.bottomButton,color:\"primary\"})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsx(Dialog,{open:imageModalOpen,onClose:handleImageModalClose,className:classes.imageModal,maxWidth:\"md\",fullWidth:true,children:/*#__PURE__*/_jsx(DialogContent,{className:classes.imageModalContent,children:/*#__PURE__*/_jsx(\"img\",{src:ticket===null||ticket===void 0?void 0:(_ticket$contact4=ticket.contact)===null||_ticket$contact4===void 0?void 0:_ticket$contact4.urlPicture,alt:(ticket===null||ticket===void 0?void 0:(_ticket$contact5=ticket.contact)===null||_ticket$contact5===void 0?void 0:_ticket$contact5.name)||\"Foto do contato\",className:classes.expandedImage})})})]},ticket.id);};export default TicketListItem;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}