{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useContext}from\"react\";import{Field}from\"formik\";import{useHistory}from\"react-router-dom\";import{makeStyles}from\"@material-ui/core/styles\";import Paper from\"@material-ui/core/Paper\";import{toast}from\"react-toastify\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import Title from\"../../components/Title\";import DeleteOutlineIcon from\"@material-ui/icons/DeleteOutline\";import api from\"../../services/api\";import usePlans from\"../../hooks/usePlans\";import toastError from\"../../errors/toastError\";import{i18n}from\"../../translate/i18n\";import{Box,Button,FormControl,Grid,InputLabel,MenuItem,Select,Typography}from\"@material-ui/core\";import ConfirmationModal from\"../../components/ConfirmationModal\";import ForbiddenPage from\"../../components/ForbiddenPage\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({mainPaper:_objectSpread({flex:1,padding:theme.spacing(1),// padding: theme.padding,\noverflowY:\"scroll\"},theme.scrollbarStyles),textRight:{textAlign:\"right\"},tabPanelsContainer:{// padding: theme.spacing(2),\npadding:theme.padding},paper:{padding:theme.spacing(2),display:\"flex\",alignItems:\"center\",marginBottom:12}}));const initialSettings={messageInterval:20,longerIntervalAfter:20,greaterInterval:60,variables:[],sabado:\"false\",domingo:\"false\",startHour:\"09:00\",endHour:\"18:00\"};const CampaignsConfig=()=>{const classes=useStyles();const history=useHistory();const[settings,setSettings]=useState(initialSettings);const[showVariablesForm,setShowVariablesForm]=useState(false);const[confirmationOpen,setConfirmationOpen]=useState(false);const[selectedKey,setSelectedKey]=useState(null);const[variable,setVariable]=useState({key:\"\",value:\"\"});const{user,socket}=useContext(AuthContext);const[sabado,setSabado]=React.useState(false);const[domingo,setDomingo]=React.useState(false);const[startHour,setStartHour]=useState(\"08:00\");const[endHour,setEndHour]=useState(\"19:00\");const{getPlanCompany}=usePlans();useEffect(()=>{async function fetchData(){const companyId=user.companyId;const planConfigs=await getPlanCompany(undefined,companyId);if(!planConfigs.plan.useCampaigns){toast.error(\"Esta empresa não possui permissão para acessar essa página! Estamos lhe redirecionando.\");setTimeout(()=>{history.push(\"/\");},1000);}}fetchData();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(()=>{api.get(\"/campaign-settings\").then(_ref=>{let{data}=_ref;const settingsList=[];console.log(data);if(Array.isArray(data)&&data.length>0){data.forEach(item=>{settingsList.push([item.key,item.value]);if(item.key===\"sabado\")setSabado((item===null||item===void 0?void 0:item.value)===\"true\");if(item.key===\"domingo\")setDomingo((item===null||item===void 0?void 0:item.value)===\"true\");if(item.key===\"startHour\")setStartHour(item===null||item===void 0?void 0:item.value);if(item.key===\"endHour\")setEndHour(item===null||item===void 0?void 0:item.value);});setSettings(Object.fromEntries(settingsList));}});},[]);const handleOnChangeVariable=e=>{if(e.target.value!==null){const changedProp={};changedProp[e.target.name]=e.target.value;setVariable(prev=>_objectSpread(_objectSpread({},prev),changedProp));}};const handleOnChangeSettings=e=>{const changedProp={};changedProp[e.target.name]=e.target.value;setSettings(prev=>_objectSpread(_objectSpread({},prev),changedProp));};const addVariable=()=>{setSettings(prev=>{if(!Array.isArray(prev.variables)){// Lidar com o caso em que prev.variables não é um array\nreturn _objectSpread(_objectSpread({},prev),{},{variables:[Object.assign({},variable)]});}const variablesExists=settings.variables.filter(v=>v.key===variable.key);const variables=prev.variables;if(variablesExists.length===0){variables.push(Object.assign({},variable));setVariable({key:\"\",value:\"\"});}return _objectSpread(_objectSpread({},prev),{},{variables});});};const removeVariable=()=>{const newList=settings.variables.filter(v=>v.key!==selectedKey);setSettings(prev=>_objectSpread(_objectSpread({},prev),{},{variables:newList}));setSelectedKey(null);};const saveSettings=async()=>{await api.post(\"/campaign-settings\",{settings});toast.success(\"Configurações salvas\");};const handleChange=event=>{if(event.target.name===\"sabado\"){setSabado(event.target.checked);}if(event.target.name===\"domingo\"){setDomingo(event.target.checked);}};const handleSaveTimeMass=async()=>{let settings={sabado:sabado,domingo:domingo,startHour:startHour,endHour:endHour};try{await api.post(\"/campaign-settings/\",{settings});toast.success(i18n.t(\"settings.success\"));}catch(err){toastError(err);}};return/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsx(ConfirmationModal,{title:i18n.t(\"campaigns.confirmationModal.deleteTitle\"),open:confirmationOpen,onClose:()=>setConfirmationOpen(false),onConfirm:removeVariable,children:i18n.t(\"campaigns.confirmationModal.deleteMessage\")}),user.profile===\"user\"&&(user===null||user===void 0?void 0:user.showCampaign)===\"disabled\"?/*#__PURE__*/_jsx(ForbiddenPage,{}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(MainHeader,{children:/*#__PURE__*/_jsx(Grid,{style:{width:\"99.6%\"},container:true,children:/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsx(Title,{children:i18n.t(\"campaignsConfig.title\")})})})}),/*#__PURE__*/_jsx(Paper,{className:classes.mainPaper,variant:\"outlined\",children:/*#__PURE__*/_jsx(Box,{className:classes.tabPanelsContainer,children:/*#__PURE__*/_jsxs(Grid,{spacing:1,container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsx(Typography,{component:\"h1\",children:\"Intervalos \\xA0\"})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:3,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",className:classes.formControl,fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"messageInterval-label\",children:i18n.t(\"campaigns.settings.randomInterval\")}),/*#__PURE__*/_jsxs(Select,{name:\"messageInterval\",id:\"messageInterval\",labelId:\"messageInterval-label\",label:i18n.t(\"campaigns.settings.randomInterval\"),value:settings.messageInterval,onChange:e=>handleOnChangeSettings(e),children:[/*#__PURE__*/_jsx(MenuItem,{value:0,children:i18n.t(\"campaigns.settings.noBreak\")}),/*#__PURE__*/_jsx(MenuItem,{value:5,children:\"5 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:10,children:\"10 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:15,children:\"15 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:20,children:\"20 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:30,children:\"30 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:60,children:\"40 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:70,children:\"60 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:80,children:\"80 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:100,children:\"100 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:120,children:\"120 segundos\"}),\"                                                `` ``\"]})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:3,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",className:classes.formControl,fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"longerIntervalAfter-label\",children:i18n.t(\"campaigns.settings.intervalGapAfter\")}),/*#__PURE__*/_jsxs(Select,{name:\"longerIntervalAfter\",id:\"longerIntervalAfter\",labelId:\"longerIntervalAfter-label\",label:i18n.t(\"campaigns.settings.intervalGapAfter\"),value:settings.longerIntervalAfter,onChange:e=>handleOnChangeSettings(e),children:[/*#__PURE__*/_jsx(MenuItem,{value:0,children:i18n.t(\"campaigns.settings.undefined\")}),/*#__PURE__*/_jsxs(MenuItem,{value:5,children:[\"5 \",i18n.t(\"campaigns.settings.messages\")]}),/*#__PURE__*/_jsxs(MenuItem,{value:10,children:[\"10 \",i18n.t(\"campaigns.settings.messages\")]}),/*#__PURE__*/_jsxs(MenuItem,{value:15,children:[\"15 \",i18n.t(\"campaigns.settings.messages\")]}),/*#__PURE__*/_jsxs(MenuItem,{value:20,children:[\"20 \",i18n.t(\"campaigns.settings.messages\")]}),/*#__PURE__*/_jsxs(MenuItem,{value:30,children:[\"30 \",i18n.t(\"campaigns.settings.messages\")]}),/*#__PURE__*/_jsxs(MenuItem,{value:40,children:[\"40 \",i18n.t(\"campaigns.settings.messages\")]}),/*#__PURE__*/_jsxs(MenuItem,{value:50,children:[\"50 \",i18n.t(\"campaigns.settings.messages\")]}),/*#__PURE__*/_jsxs(MenuItem,{value:60,children:[\"60 \",i18n.t(\"campaigns.settings.messages\")]})]})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:3,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",className:classes.formControl,fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"greaterInterval-label\",children:i18n.t(\"campaigns.settings.laggerTriggerRange\")}),/*#__PURE__*/_jsxs(Select,{name:\"greaterInterval\",id:\"greaterInterval\",labelId:\"greaterInterval-label\",label:i18n.t(\"campaigns.settings.laggerTriggerRange\"),value:settings.greaterInterval,onChange:e=>handleOnChangeSettings(e),children:[/*#__PURE__*/_jsx(MenuItem,{value:0,children:i18n.t(\"campaigns.settings.noBreak\")}),/*#__PURE__*/_jsx(MenuItem,{value:20,children:\"20 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:30,children:\"30 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:40,children:\"40 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:50,children:\"50 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:60,children:\"60 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:70,children:\"70 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:80,children:\"80 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:90,children:\"90 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:100,children:\"100 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:110,children:\"110 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:120,children:\"120 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:130,children:\"130 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:140,children:\"140 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:150,children:\"150 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:160,children:\"160 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:170,children:\"170 segundos\"}),/*#__PURE__*/_jsx(MenuItem,{value:180,children:\"180 segundos\"})]})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,className:classes.textRight,item:true,children:/*#__PURE__*/_jsx(Button,{onClick:saveSettings,color:\"primary\",variant:\"contained\",children:i18n.t(\"campaigns.settings.save\")})})]})})})]})]});};export default CampaignsConfig;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}