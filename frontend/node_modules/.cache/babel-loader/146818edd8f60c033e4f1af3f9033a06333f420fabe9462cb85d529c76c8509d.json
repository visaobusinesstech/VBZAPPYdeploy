{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useContext,useEffect,useReducer,useState}from\"react\";import openSocket from\"socket.io-client\";import{Button,IconButton,Paper,Table,TableBody,TableCell,TableHead,TableRow}from\"@material-ui/core\";import{makeStyles}from\"@material-ui/core/styles\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import MainHeaderButtonsWrapper from\"../../components/MainHeaderButtonsWrapper\";import TableRowSkeleton from\"../../components/TableRowSkeleton\";import Title from\"../../components/Title\";import{i18n}from\"../../translate/i18n\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";import{DeleteOutline,Edit}from\"@material-ui/icons\";import PromptModal from\"../../components/PromptModal\";import{toast}from\"react-toastify\";import ConfirmationModal from\"../../components/ConfirmationModal\";import{AuthContext}from\"../../context/Auth/AuthContext\";import usePlans from\"../../hooks/usePlans\";import{useHistory}from\"react-router-dom/cjs/react-router-dom.min\";import ForbiddenPage from\"../../components/ForbiddenPage\";// import { SocketContext } from \"../../context/Socket/SocketContext\";\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({mainPaper:_objectSpread({flex:1,padding:theme.spacing(1),overflowY:\"scroll\"},theme.scrollbarStyles),customTableCell:{display:\"flex\",alignItems:\"center\",justifyContent:\"center\"}}));const reducer=(state,action)=>{if(action.type===\"LOAD_PROMPTS\"){const prompts=action.payload;const newPrompts=[];prompts.forEach(prompt=>{const promptIndex=state.findIndex(p=>p.id===prompt.id);if(promptIndex!==-1){state[promptIndex]=prompt;}else{newPrompts.push(prompt);}});return[...state,...newPrompts];}if(action.type===\"UPDATE_PROMPTS\"){const prompt=action.payload;const promptIndex=state.findIndex(p=>p.id===prompt.id);if(promptIndex!==-1){state[promptIndex]=prompt;return[...state];}else{return[prompt,...state];}}if(action.type===\"DELETE_PROMPT\"){const promptId=action.payload;const promptIndex=state.findIndex(p=>p.id===promptId);if(promptIndex!==-1){state.splice(promptIndex,1);}return[...state];}if(action.type===\"RESET\"){return[];}};const Prompts=()=>{const classes=useStyles();const[prompts,dispatch]=useReducer(reducer,[]);const[loading,setLoading]=useState(false);const[promptModalOpen,setPromptModalOpen]=useState(false);const[selectedPrompt,setSelectedPrompt]=useState(null);const[confirmModalOpen,setConfirmModalOpen]=useState(false);//   const socketManager = useContext(SocketContext);\nconst{user,socket}=useContext(AuthContext);const{getPlanCompany}=usePlans();const history=useHistory();const companyId=user.companyId;useEffect(()=>{async function fetchData(){const planConfigs=await getPlanCompany(undefined,companyId);if(!planConfigs.plan.useOpenAi){toast.error(\"Esta empresa não possui permissão para acessar essa página! Estamos lhe redirecionando.\");setTimeout(()=>{history.push(\"/\");},1000);}}fetchData();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(()=>{(async()=>{setLoading(true);try{const{data}=await api.get(\"/prompt\");dispatch({type:\"LOAD_PROMPTS\",payload:data.prompts});setLoading(false);}catch(err){toastError(err);setLoading(false);}})();},[]);useEffect(()=>{// const socket = socketManager.GetSocket();\nconst onPromptEvent=data=>{if(data.action===\"update\"||data.action===\"create\"){dispatch({type:\"UPDATE_PROMPTS\",payload:data.prompt});}if(data.action===\"delete\"){dispatch({type:\"DELETE_PROMPT\",payload:data.promptId});}};socket.on(\"company-\".concat(companyId,\"-prompt\"),onPromptEvent);return()=>{socket.off(\"company-\".concat(companyId,\"-prompt\"),onPromptEvent);};},[socket]);const handleOpenPromptModal=()=>{setPromptModalOpen(true);setSelectedPrompt(null);};const handleClosePromptModal=()=>{setPromptModalOpen(false);setSelectedPrompt(null);};const handleEditPrompt=prompt=>{setSelectedPrompt(prompt);setPromptModalOpen(true);};const handleCloseConfirmationModal=()=>{setConfirmModalOpen(false);setSelectedPrompt(null);};const handleDeletePrompt=async promptId=>{try{const{data}=await api.delete(\"/prompt/\".concat(promptId));toast.info(i18n.t(data.message));}catch(err){toastError(err);}setSelectedPrompt(null);};return/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsx(ConfirmationModal,{title:selectedPrompt&&\"\".concat(i18n.t(\"prompts.confirmationModal.deleteTitle\"),\" \").concat(selectedPrompt.name,\"?\"),open:confirmModalOpen,onClose:handleCloseConfirmationModal,onConfirm:()=>handleDeletePrompt(selectedPrompt.id),children:i18n.t(\"prompts.confirmationModal.deleteMessage\")}),/*#__PURE__*/_jsx(PromptModal,{open:promptModalOpen,onClose:handleClosePromptModal,promptId:selectedPrompt===null||selectedPrompt===void 0?void 0:selectedPrompt.id}),user.profile===\"user\"?/*#__PURE__*/_jsx(ForbiddenPage,{}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(MainHeader,{children:[/*#__PURE__*/_jsx(Title,{children:i18n.t(\"prompts.title\")}),/*#__PURE__*/_jsx(MainHeaderButtonsWrapper,{children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:handleOpenPromptModal,children:i18n.t(\"prompts.buttons.add\")})})]}),/*#__PURE__*/_jsx(Paper,{className:classes.mainPaper,variant:\"outlined\",children:/*#__PURE__*/_jsxs(Table,{size:\"small\",children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"left\",children:i18n.t(\"prompts.table.name\")}),/*#__PURE__*/_jsx(TableCell,{align:\"left\",children:i18n.t(\"prompts.table.queue\")}),/*#__PURE__*/_jsx(TableCell,{align:\"left\",children:i18n.t(\"prompts.table.max_tokens\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"prompts.table.actions\")})]})}),/*#__PURE__*/_jsx(TableBody,{children:/*#__PURE__*/_jsxs(_Fragment,{children:[prompts.map(prompt=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"left\",children:prompt.name}),/*#__PURE__*/_jsx(TableCell,{align:\"left\",children:prompt.queue.name}),/*#__PURE__*/_jsx(TableCell,{align:\"left\",children:prompt.maxTokens}),/*#__PURE__*/_jsxs(TableCell,{align:\"center\",children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleEditPrompt(prompt),children:/*#__PURE__*/_jsx(Edit,{})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>{setSelectedPrompt(prompt);setConfirmModalOpen(true);},children:/*#__PURE__*/_jsx(DeleteOutline,{})})]})]},prompt.id)),loading&&/*#__PURE__*/_jsx(TableRowSkeleton,{columns:4})]})})]})})]})]});};export default Prompts;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}