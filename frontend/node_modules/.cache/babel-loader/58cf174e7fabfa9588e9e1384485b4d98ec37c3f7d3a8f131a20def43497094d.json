{"ast":null,"code":"import _objectSpread from\"/home/deploy/codigologlow/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from\"react\";import*as Yup from\"yup\";import{Formik,Form,Field}from\"formik\";import{toast}from\"react-toastify\";import{makeStyles}from\"@material-ui/core/styles\";import{green}from\"@material-ui/core/colors\";import Button from\"@material-ui/core/Button\";import TextField from\"@material-ui/core/TextField\";import Dialog from\"@material-ui/core/Dialog\";import DialogActions from\"@material-ui/core/DialogActions\";import DialogContent from\"@material-ui/core/DialogContent\";import DialogTitle from\"@material-ui/core/DialogTitle\";import CircularProgress from\"@material-ui/core/CircularProgress\";import AttachFileIcon from\"@material-ui/icons/AttachFile\";import DeleteOutlineIcon from\"@material-ui/icons/DeleteOutline\";import IconButton from\"@material-ui/core/IconButton\";import{i18n}from\"../../translate/i18n\";import{head}from\"lodash\";import api from\"../../services/api\";import toastError from\"../../errors/toastError\";import{FormControl,Grid,InputLabel,MenuItem,Select}from\"@material-ui/core\";import ConfirmationModal from\"../ConfirmationModal\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{display:\"flex\",flexWrap:\"wrap\"},multFieldLine:{display:\"flex\",\"& > *:not(:last-child)\":{marginRight:theme.spacing(1)}},btnWrapper:{position:\"relative\"},buttonProgress:{color:green[500],position:\"absolute\",top:\"50%\",left:\"50%\",marginTop:-12,marginLeft:-12},formControl:{margin:theme.spacing(1),minWidth:120},colorAdorment:{width:20,height:20}}));const AnnouncementSchema=Yup.object().shape({title:Yup.string().required(\"Obrigatório\"),text:Yup.string().required(\"Obrigatório\")});const AnnouncementModal=_ref=>{let{open,onClose,announcementId,reload}=_ref;const classes=useStyles();const initialState={title:\"\",text:\"\",priority:3,status:true};const[confirmationOpen,setConfirmationOpen]=useState(false);const[announcement,setAnnouncement]=useState(initialState);const[attachment,setAttachment]=useState(null);const attachmentFile=useRef(null);useEffect(()=>{try{(async()=>{if(!announcementId)return;const{data}=await api.get(\"/announcements/\".concat(announcementId));setAnnouncement(prevState=>{return _objectSpread(_objectSpread({},prevState),data);});})();}catch(err){toastError(err);}},[announcementId,open]);const handleClose=()=>{setAnnouncement(initialState);setAttachment(null);onClose();};const handleAttachmentFile=e=>{const file=head(e.target.files);if(file){setAttachment(file);}};const handleSaveAnnouncement=async values=>{const announcementData=_objectSpread({},values);try{if(announcementId){await api.put(\"/announcements/\".concat(announcementId),announcementData);if(attachment!=null){const formData=new FormData();formData.append(\"typeArch\",\"announcements\");formData.append(\"file\",attachment);await api.post(\"/announcements/\".concat(announcementId,\"/media-upload\"),formData);}}else{const{data}=await api.post(\"/announcements\",announcementData);if(attachment!=null){const formData=new FormData();formData.append(\"typeArch\",\"announcements\");formData.append(\"file\",attachment);await api.post(\"/announcements/\".concat(data.id,\"/media-upload\"),formData);}}toast.success(i18n.t(\"announcements.toasts.success\"));if(typeof reload==\"function\"){reload();}}catch(err){toastError(err);}handleClose();};const deleteMedia=async()=>{if(attachment){setAttachment(null);attachmentFile.current.value=null;}if(announcement.mediaPath){await api.delete(\"/announcements/\".concat(announcement.id,\"/media-upload\"));setAnnouncement(prev=>_objectSpread(_objectSpread({},prev),{},{mediaPath:null}));toast.success(i18n.t(\"announcements.toasts.deleted\"));if(typeof reload==\"function\"){reload();}}};return/*#__PURE__*/_jsxs(\"div\",{className:classes.root,children:[/*#__PURE__*/_jsx(ConfirmationModal,{title:i18n.t(\"announcements.confirmationModal.deleteTitle\"),open:confirmationOpen,onClose:()=>setConfirmationOpen(false),onConfirm:deleteMedia,children:i18n.t(\"announcements.confirmationModal.deleteMessage\")}),/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleClose,maxWidth:\"xs\",fullWidth:true,scroll:\"paper\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"form-dialog-title\",children:announcementId?\"\".concat(i18n.t(\"announcements.dialog.edit\")):\"\".concat(i18n.t(\"announcements.dialog.add\"))}),/*#__PURE__*/_jsx(\"div\",{style:{display:\"none\"},children:/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".png,.jpg,.jpeg\",ref:attachmentFile,onChange:e=>handleAttachmentFile(e)})}),/*#__PURE__*/_jsx(Formik,{initialValues:announcement,enableReinitialize:true,validationSchema:AnnouncementSchema,onSubmit:(values,actions)=>{setTimeout(()=>{handleSaveAnnouncement(values);actions.setSubmitting(false);},400);},children:_ref2=>{let{touched,errors,isSubmitting,values}=_ref2;return/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsx(DialogContent,{dividers:true,children:/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"announcements.dialog.form.title\"),name:\"title\",error:touched.title&&Boolean(errors.title),helperText:touched.title&&errors.title,variant:\"outlined\",margin:\"dense\",fullWidth:true})}),/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"announcements.dialog.form.text\"),name:\"text\",error:touched.text&&Boolean(errors.text),helperText:touched.text&&errors.text,variant:\"outlined\",margin:\"dense\",multiline:true,rows:7,fullWidth:true})}),/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",margin:\"dense\",fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"status-selection-label\",children:i18n.t(\"announcements.dialog.form.status\")}),/*#__PURE__*/_jsxs(Field,{as:Select,label:i18n.t(\"announcements.dialog.form.status\"),placeholder:i18n.t(\"announcements.dialog.form.status\"),labelId:\"status-selection-label\",id:\"status\",name:\"status\",error:touched.status&&Boolean(errors.status),children:[/*#__PURE__*/_jsx(MenuItem,{value:true,children:i18n.t(\"announcements.dialog.form.active\")}),/*#__PURE__*/_jsx(MenuItem,{value:false,children:i18n.t(\"announcements.dialog.form.inactive\")})]})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",margin:\"dense\",fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"priority-selection-label\",children:i18n.t(\"announcements.dialog.form.priority\")}),/*#__PURE__*/_jsxs(Field,{as:Select,label:i18n.t(\"announcements.dialog.form.priority\"),placeholder:i18n.t(\"announcements.dialog.form.priority\"),labelId:\"priority-selection-label\",id:\"priority\",name:\"priority\",error:touched.priority&&Boolean(errors.priority),children:[/*#__PURE__*/_jsx(MenuItem,{value:1,children:i18n.t(\"announcements.dialog.form.high\")}),/*#__PURE__*/_jsx(MenuItem,{value:2,children:i18n.t(\"announcements.dialog.form.medium\")}),/*#__PURE__*/_jsx(MenuItem,{value:3,children:i18n.t(\"announcements.dialog.form.low\")})]})]})}),(announcement.mediaPath||attachment)&&/*#__PURE__*/_jsxs(Grid,{xs:12,item:true,children:[/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(AttachFileIcon,{}),children:attachment?attachment.name:announcement.mediaName}),/*#__PURE__*/_jsx(IconButton,{onClick:()=>setConfirmationOpen(true),color:\"secondary\",children:/*#__PURE__*/_jsx(DeleteOutlineIcon,{})})]})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[!attachment&&!announcement.mediaPath&&/*#__PURE__*/_jsx(Button,{color:\"primary\",onClick:()=>attachmentFile.current.click(),disabled:isSubmitting,variant:\"outlined\",children:i18n.t(\"announcements.dialog.buttons.attach\")}),/*#__PURE__*/_jsx(Button,{onClick:handleClose,color:\"secondary\",disabled:isSubmitting,variant:\"outlined\",children:i18n.t(\"announcements.dialog.buttons.cancel\")}),/*#__PURE__*/_jsxs(Button,{type:\"submit\",color:\"primary\",disabled:isSubmitting,variant:\"contained\",className:classes.btnWrapper,children:[announcementId?\"\".concat(i18n.t(\"announcements.dialog.buttons.edit\")):\"\".concat(i18n.t(\"announcements.dialog.buttons.add\")),isSubmitting&&/*#__PURE__*/_jsx(CircularProgress,{size:24,className:classes.buttonProgress})]})]})]});}})]})]});};export default AnnouncementModal;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}