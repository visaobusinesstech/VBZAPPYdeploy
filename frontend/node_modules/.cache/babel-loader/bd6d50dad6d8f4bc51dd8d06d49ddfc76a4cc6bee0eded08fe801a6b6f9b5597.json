{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef,useContext}from\"react\";import*as Yup from\"yup\";import{Formik,Form,Field}from\"formik\";import{toast}from\"react-toastify\";import{head}from\"lodash\";import{makeStyles}from\"@material-ui/core/styles\";import{green}from\"@material-ui/core/colors\";import Button from\"@material-ui/core/Button\";import IconButton from\"@material-ui/core/IconButton\";import TextField from\"@material-ui/core/TextField\";import Dialog from\"@material-ui/core/Dialog\";import DialogActions from\"@material-ui/core/DialogActions\";import DialogContent from\"@material-ui/core/DialogContent\";import DialogTitle from\"@material-ui/core/DialogTitle\";import CircularProgress from\"@material-ui/core/CircularProgress\";import AttachFileIcon from\"@material-ui/icons/AttachFile\";import DeleteOutlineIcon from\"@material-ui/icons/DeleteOutline\";import Chip from'@material-ui/core/Chip';import RepeatIcon from'@material-ui/icons/Repeat';import VisibilityIcon from'@material-ui/icons/Visibility';import{isNil}from\"lodash\";import{i18n}from\"../../translate/i18n\";import moment from\"moment\";import api from\"../../services/api\";import toastError from\"../../errors/toastError\";import{Box,FormControl,Grid,InputLabel,MenuItem,Select,Tab,Tabs,FormControlLabel,Switch,Typography,Collapse,List,ListItem,ListItemText,FormHelperText,Card,CardContent,Checkbox,FormGroup}from\"@material-ui/core\";import{AuthContext}from\"../../context/Auth/AuthContext\";import ConfirmationModal from\"../ConfirmationModal\";import UserStatusIcon from\"../UserModal/statusIcon\";import Autocomplete,{createFilterOptions}from\"@material-ui/lab/Autocomplete\";import useQueues from\"../../hooks/useQueues\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{display:\"flex\",flexWrap:\"wrap\"},textField:{marginRight:theme.spacing(1),flex:1},extraAttr:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\"},btnWrapper:{position:\"relative\"},buttonProgress:{color:green[500],position:\"absolute\",top:\"50%\",left:\"50%\",marginTop:-12,marginLeft:-12},recurrenceCard:{marginTop:theme.spacing(2),padding:theme.spacing(2),backgroundColor:theme.palette.grey[50]},previewCard:{marginTop:theme.spacing(1),maxHeight:200,overflow:'auto'},recurrenceIcon:{marginRight:theme.spacing(1),color:theme.palette.primary.main}}));// No CampaignModal.js - Atualizar o schema de validação\nconst CampaignSchema=Yup.object().shape({name:Yup.string().min(2,\"Too Short!\").max(50,\"Too Long!\").required(\"Required\"),isRecurring:Yup.boolean().default(false),recurrenceType:Yup.string().when('isRecurring',{is:true,then:Yup.string().oneOf(['minutely','hourly','daily','weekly','biweekly','monthly','yearly']).required('Tipo de recorrência é obrigatório'),otherwise:Yup.string().nullable()}),recurrenceInterval:Yup.number().when('isRecurring',{is:true,then:Yup.number().min(1,'Intervalo deve ser maior que 0').required('Intervalo é obrigatório'),otherwise:Yup.number().nullable()}),// CORREÇÃO: Validar como array mas permitir vazio\nrecurrenceDaysOfWeek:Yup.array().when(['isRecurring','recurrenceType'],{is:(isRecurring,recurrenceType)=>isRecurring&&recurrenceType==='weekly',then:Yup.array().min(1,'Selecione pelo menos um dia da semana').required(),otherwise:Yup.array().nullable()}),recurrenceDayOfMonth:Yup.number().when(['isRecurring','recurrenceType'],{is:(isRecurring,recurrenceType)=>isRecurring&&recurrenceType==='monthly',then:Yup.number().min(1,'Dia deve ser entre 1 e 31').max(31,'Dia deve ser entre 1 e 31').required('Dia do mês é obrigatório'),otherwise:Yup.number().nullable()}),recurrenceEndDate:Yup.date().when('isRecurring',{is:true,then:Yup.date().min(new Date(),'Data final deve ser futura').nullable(),otherwise:Yup.date().nullable()}),maxExecutions:Yup.number().when('isRecurring',{is:true,then:Yup.number().min(1,'Número máximo deve ser maior que 0').nullable(),otherwise:Yup.number().nullable()})});const CampaignModal=_ref=>{let{open,onClose,campaignId,initialValues,onSave,resetPagination}=_ref;const classes=useStyles();const isMounted=useRef(true);const{user,socket}=useContext(AuthContext);const{companyId}=user;const initialState={name:\"\",message1:\"\",message2:\"\",message3:\"\",message4:\"\",message5:\"\",confirmationMessage1:\"\",confirmationMessage2:\"\",confirmationMessage3:\"\",confirmationMessage4:\"\",confirmationMessage5:\"\",status:\"INATIVA\",confirmation:false,scheduledAt:\"\",contactListId:\"\",tagListId:\"Nenhuma\",companyId,statusTicket:\"closed\",openTicket:\"disabled\",// Novos campos de recorrência\nisRecurring:false,recurrenceType:\"\",recurrenceInterval:1,recurrenceDaysOfWeek:[],recurrenceDayOfMonth:1,recurrenceEndDate:\"\",maxExecutions:null};const[campaign,setCampaign]=useState(initialState);const[whatsapps,setWhatsapps]=useState([]);const[selectedWhatsapps,setSelectedWhatsapps]=useState([]);const[whatsappId,setWhatsappId]=useState(null);const[contactLists,setContactLists]=useState([]);const[tagLists,setTagLists]=useState([]);const[messageTab,setMessageTab]=useState(0);const[attachment,setAttachment]=useState(null);const[confirmationOpen,setConfirmationOpen]=useState(false);const[campaignEditable,setCampaignEditable]=useState(true);const[previewExecutions,setPreviewExecutions]=useState([]);const[showPreview,setShowPreview]=useState(false);const attachmentFile=useRef(null);const[options,setOptions]=useState([]);const[queues,setQueues]=useState([]);const[allQueues,setAllQueues]=useState([]);const[loading,setLoading]=useState(false);const[searchParam,setSearchParam]=useState(\"\");const[selectedUser,setSelectedUser]=useState(null);const[selectedQueue,setSelectedQueue]=useState(null);const{findAll:findAllQueues}=useQueues();// Opções para dias da semana\nconst daysOfWeekOptions=[{value:0,label:'Domingo'},{value:1,label:'Segunda-feira'},{value:2,label:'Terça-feira'},{value:3,label:'Quarta-feira'},{value:4,label:'Quinta-feira'},{value:5,label:'Sexta-feira'},{value:6,label:'Sábado'}];// Função para preview das execuções\nconst handlePreviewRecurrence=async values=>{if(!values.isRecurring||!values.recurrenceType||!values.scheduledAt){setPreviewExecutions([]);return;}try{const params={recurrenceType:values.recurrenceType,recurrenceInterval:values.recurrenceInterval,recurrenceDaysOfWeek:JSON.stringify(values.recurrenceDaysOfWeek),recurrenceDayOfMonth:values.recurrenceDayOfMonth};if(campaignId){const{data}=await api.get(\"/campaigns/\".concat(campaignId,\"/recurrence-preview\"),{params});setPreviewExecutions(data.executions);}else{// Para campanhas novas, calcular localmente ou usar endpoint genérico\nconst mockExecutions=calculateMockExecutions(values);setPreviewExecutions(mockExecutions);}}catch(err){console.error('Erro ao buscar preview:',err);}};// Função auxiliar para calcular execuções mock\nconst calculateMockExecutions=values=>{const executions=[];let currentDate=moment(values.scheduledAt);for(let i=0;i<5;i++){executions.push(currentDate.format('DD/MM/YYYY HH:mm'));switch(values.recurrenceType){case'minutely':currentDate=currentDate.clone().add(values.recurrenceInterval,'minutes');break;case'hourly':currentDate=currentDate.clone().add(values.recurrenceInterval,'hours');break;case'daily':currentDate=currentDate.clone().add(values.recurrenceInterval,'days');break;case'weekly':currentDate=currentDate.clone().add(values.recurrenceInterval,'weeks');break;case'biweekly':currentDate=currentDate.clone().add(values.recurrenceInterval*2,'weeks');break;case'monthly':currentDate=currentDate.clone().add(values.recurrenceInterval,'months');if(values.recurrenceDayOfMonth){currentDate=currentDate.date(values.recurrenceDayOfMonth);}break;case'yearly':currentDate=currentDate.clone().add(values.recurrenceInterval,'years');break;}}return executions;};useEffect(()=>{return()=>{isMounted.current=false;};},[]);useEffect(()=>{if(isMounted.current){const loadQueues=async()=>{const list=await findAllQueues();setAllQueues(list);setQueues(list);};loadQueues();}},[]);useEffect(()=>{if(searchParam.length<3){setLoading(false);setSelectedQueue(\"\");return;}const delayDebounceFn=setTimeout(()=>{setLoading(true);const fetchUsers=async()=>{try{const{data}=await api.get(\"/users/\");setOptions(data.users);setLoading(false);}catch(err){setLoading(false);toastError(err);}};fetchUsers();},500);return()=>clearTimeout(delayDebounceFn);},[searchParam]);useEffect(()=>{if(isMounted.current){if(initialValues){setCampaign(prevState=>{return _objectSpread(_objectSpread({},prevState),initialValues);});}api.get(\"/contact-lists/list\",{params:{companyId}}).then(_ref2=>{let{data}=_ref2;return setContactLists(data);});api.get(\"/whatsapp\",{params:{companyId,session:0}}).then(_ref3=>{let{data}=_ref3;const mappedWhatsapps=data.map(whatsapp=>_objectSpread(_objectSpread({},whatsapp),{},{selected:false}));setWhatsapps(mappedWhatsapps);});api.get(\"/tags/list\",{params:{companyId,kanban:0}}).then(_ref4=>{let{data}=_ref4;const fetchedTags=data;const formattedTagLists=fetchedTags.filter(tag=>tag.contacts.length>0).map(tag=>({id:tag.id,name:\"\".concat(tag.name,\" (\").concat(tag.contacts.length,\")\")}));setTagLists(formattedTagLists);}).catch(error=>{console.error(\"Error retrieving tags:\",error);});if(!campaignId)return;api.get(\"/campaigns/\".concat(campaignId)).then(_ref5=>{let{data}=_ref5;if(data!==null&&data!==void 0&&data.user)setSelectedUser(data.user);if(data!==null&&data!==void 0&&data.queue)setSelectedQueue(data.queue.id);if(data!==null&&data!==void 0&&data.whatsappId){setWhatsappId(parseInt(data.whatsappId));// Converter para número\n}else{setWhatsappId(null);}setCampaign(prev=>{let prevCampaignData=Object.assign({},prev);Object.entries(data).forEach(_ref6=>{let[key,value]=_ref6;if(key===\"scheduledAt\"&&value!==\"\"&&value!==null){prevCampaignData[key]=moment(value).format(\"YYYY-MM-DDTHH:mm\");}else if(key===\"recurrenceEndDate\"&&value!==\"\"&&value!==null){prevCampaignData[key]=moment(value).format(\"YYYY-MM-DD\");}else if(key===\"recurrenceDaysOfWeek\"&&value){prevCampaignData[key]=JSON.parse(value);}else{prevCampaignData[key]=value===null?\"\":value;}});return prevCampaignData;});});}},[campaignId,open,initialValues,companyId]);useEffect(()=>{const now=moment();const scheduledAt=moment(campaign.scheduledAt);const moreThenAnHour=!Number.isNaN(scheduledAt.diff(now))&&scheduledAt.diff(now,\"hour\")>1;const isEditable=campaign.status===\"INATIVA\"||campaign.status===\"PROGRAMADA\"&&moreThenAnHour;setCampaignEditable(isEditable);},[campaign.status,campaign.scheduledAt]);const handleClose=()=>{onClose();setCampaign(initialState);setPreviewExecutions([]);setShowPreview(false);};const handleAttachmentFile=e=>{const file=head(e.target.files);if(file){setAttachment(file);}};const handleSaveCampaign=async values=>{try{const dataValues=_objectSpread(_objectSpread({},values),{},{whatsappId:whatsappId,userId:(selectedUser===null||selectedUser===void 0?void 0:selectedUser.id)||null,queueId:selectedQueue||null,// CORREÇÃO: Garantir conversão correta do array\nrecurrenceDaysOfWeek:values.isRecurring&&values.recurrenceDaysOfWeek&&values.recurrenceDaysOfWeek.length>0?values.recurrenceDaysOfWeek// Enviar array, o backend irá converter para JSON\n:null// Enviar null se não for recorrente ou array vazio\n});// Processar datas\nObject.entries(values).forEach(_ref7=>{let[key,value]=_ref7;if(key===\"scheduledAt\"&&value!==\"\"&&value!==null){dataValues[key]=moment(value).format(\"YYYY-MM-DD HH:mm:ss\");}else if(key===\"recurrenceEndDate\"&&value!==\"\"&&value!==null){dataValues[key]=moment(value).format(\"YYYY-MM-DD HH:mm:ss\");}else if(key!==\"recurrenceDaysOfWeek\"){// Não processar recurrenceDaysOfWeek aqui\ndataValues[key]=value===\"\"?null:value;}});// Garantir que campos não recorrentes sejam null quando isRecurring é false\nif(!values.isRecurring){dataValues.recurrenceType=null;dataValues.recurrenceInterval=null;dataValues.recurrenceDaysOfWeek=null;dataValues.recurrenceDayOfMonth=null;dataValues.recurrenceEndDate=null;dataValues.maxExecutions=null;}if(campaignId){await api.put(\"/campaigns/\".concat(campaignId),dataValues);if(attachment!=null){const formData=new FormData();formData.append(\"file\",attachment);await api.post(\"/campaigns/\".concat(campaignId,\"/media-upload\"),formData);}handleClose();}else{const{data}=await api.post(\"/campaigns\",dataValues);if(attachment!=null){const formData=new FormData();formData.append(\"file\",attachment);await api.post(\"/campaigns/\".concat(data.id,\"/media-upload\"),formData);}if(onSave){onSave(data);}handleClose();}toast.success(i18n.t(\"campaigns.toasts.success\"));}catch(err){console.log(err);toastError(err);}};const deleteMedia=async()=>{if(attachment){setAttachment(null);attachmentFile.current.value=null;}if(campaign.mediaPath){await api.delete(\"/campaigns/\".concat(campaign.id,\"/media-upload\"));setCampaign(prev=>_objectSpread(_objectSpread({},prev),{},{mediaPath:null,mediaName:null}));toast.success(i18n.t(\"campaigns.toasts.deleted\"));}};const renderMessageField=identifier=>{return/*#__PURE__*/_jsx(Field,{as:TextField,id:identifier,name:identifier,fullWidth:true,rows:5,label:i18n.t(\"campaigns.dialog.form.\".concat(identifier)),placeholder:i18n.t(\"campaigns.dialog.form.messagePlaceholder\"),multiline:true,variant:\"outlined\",helperText:\"Utilize vari\\xE1veis como {nome}, {numero}, {email} ou defina vari\\xE1veis personalizadas.\",disabled:!campaignEditable&&campaign.status!==\"CANCELADA\"});};const renderConfirmationMessageField=identifier=>{return/*#__PURE__*/_jsx(Field,{as:TextField,id:identifier,name:identifier,fullWidth:true,rows:5,label:i18n.t(\"campaigns.dialog.form.\".concat(identifier)),placeholder:i18n.t(\"campaigns.dialog.form.messagePlaceholder\"),multiline:true,variant:\"outlined\",disabled:!campaignEditable&&campaign.status!==\"CANCELADA\"});};const cancelCampaign=async()=>{try{await api.post(\"/campaigns/\".concat(campaign.id,\"/cancel\"));toast.success(i18n.t(\"campaigns.toasts.cancel\"));setCampaign(prev=>_objectSpread(_objectSpread({},prev),{},{status:\"CANCELADA\"}));resetPagination();}catch(err){toast.error(err.message);}};const restartCampaign=async()=>{try{await api.post(\"/campaigns/\".concat(campaign.id,\"/restart\"));toast.success(i18n.t(\"campaigns.toasts.restart\"));setCampaign(prev=>_objectSpread(_objectSpread({},prev),{},{status:\"EM_ANDAMENTO\"}));resetPagination();}catch(err){toast.error(err.message);}};const filterOptions=createFilterOptions({trim:true});return/*#__PURE__*/_jsxs(\"div\",{className:classes.root,children:[/*#__PURE__*/_jsx(ConfirmationModal,{title:i18n.t(\"campaigns.confirmationModal.deleteTitle\"),open:confirmationOpen,onClose:()=>setConfirmationOpen(false),onConfirm:deleteMedia,children:i18n.t(\"campaigns.confirmationModal.deleteMessage\")}),/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleClose,fullWidth:true,maxWidth:\"lg\",scroll:\"paper\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"form-dialog-title\",children:campaignEditable?/*#__PURE__*/_jsx(_Fragment,{children:campaignId?\"\".concat(i18n.t(\"campaigns.dialog.update\")):\"\".concat(i18n.t(\"campaigns.dialog.new\"))}):/*#__PURE__*/_jsx(_Fragment,{children:\"\".concat(i18n.t(\"campaigns.dialog.readonly\"))})}),/*#__PURE__*/_jsx(\"div\",{style:{display:\"none\"},children:/*#__PURE__*/_jsx(\"input\",{type:\"file\",ref:attachmentFile,onChange:e=>handleAttachmentFile(e)})}),/*#__PURE__*/_jsx(Formik,{initialValues:campaign,enableReinitialize:true,validationSchema:CampaignSchema,onSubmit:(values,actions)=>{setTimeout(()=>{handleSaveCampaign(values);actions.setSubmitting(false);},400);},children:_ref8=>{let{values,errors,touched,isSubmitting,setFieldValue}=_ref8;return/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsx(DialogContent,{dividers:true,children:/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"campaigns.dialog.form.name\"),name:\"name\",error:touched.name&&Boolean(errors.name),helperText:touched.name&&errors.name,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField,disabled:!campaignEditable})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.formControl,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"confirmation-selection-label\",children:i18n.t(\"campaigns.dialog.form.confirmation\")}),/*#__PURE__*/_jsxs(Field,{as:Select,label:i18n.t(\"campaigns.dialog.form.confirmation\"),placeholder:i18n.t(\"campaigns.dialog.form.confirmation\"),labelId:\"confirmation-selection-label\",id:\"confirmation\",name:\"confirmation\",error:touched.confirmation&&Boolean(errors.confirmation),disabled:!campaignEditable,children:[/*#__PURE__*/_jsx(MenuItem,{value:false,children:\"Desabilitada\"}),/*#__PURE__*/_jsx(MenuItem,{value:true,children:\"Habilitada\"})]})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.formControl,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"contactList-selection-label\",children:i18n.t(\"campaigns.dialog.form.contactList\")}),/*#__PURE__*/_jsxs(Field,{as:Select,label:i18n.t(\"campaigns.dialog.form.contactList\"),placeholder:i18n.t(\"campaigns.dialog.form.contactList\"),labelId:\"contactList-selection-label\",id:\"contactListId\",name:\"contactListId\",error:touched.contactListId&&Boolean(errors.contactListId),disabled:!campaignEditable,children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"Nenhuma\"}),contactLists&&contactLists.map(contactList=>/*#__PURE__*/_jsx(MenuItem,{value:contactList.id,children:contactList.name},contactList.id))]})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.formControl,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"tagList-selection-label\",children:i18n.t(\"campaigns.dialog.form.tagList\")}),/*#__PURE__*/_jsx(Field,{as:Select,label:i18n.t(\"campaigns.dialog.form.tagList\"),placeholder:i18n.t(\"campaigns.dialog.form.tagList\"),labelId:\"tagList-selection-label\",id:\"tagListId\",name:\"tagListId\",error:touched.tagListId&&Boolean(errors.tagListId),disabled:!campaignEditable,children:Array.isArray(tagLists)&&tagLists.map(tagList=>/*#__PURE__*/_jsx(MenuItem,{value:tagList.id,children:tagList.name},tagList.id))})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.formControl,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"whatsapp-selection-label\",children:i18n.t(\"campaigns.dialog.form.whatsapp\")}),/*#__PURE__*/_jsx(Field,{as:Select,label:i18n.t(\"campaigns.dialog.form.whatsapp\"),placeholder:i18n.t(\"campaigns.dialog.form.whatsapp\"),labelId:\"whatsapp-selection-label\",id:\"whatsappIds\",name:\"whatsappIds\",required:true,error:touched.whatsappId&&Boolean(errors.whatsappId),disabled:!campaignEditable,value:whatsappId,onChange:event=>{setWhatsappId(event.target.value);},children:whatsapps&&whatsapps.map(whatsapp=>/*#__PURE__*/_jsx(MenuItem,{value:whatsapp.id,children:whatsapp.name},whatsapp.id))})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"campaigns.dialog.form.scheduledAt\"),name:\"scheduledAt\",error:touched.scheduledAt&&Boolean(errors.scheduledAt),helperText:touched.scheduledAt&&errors.scheduledAt,variant:\"outlined\",margin:\"dense\",type:\"datetime-local\",InputLabelProps:{shrink:true},fullWidth:true,className:classes.textField,disabled:!campaignEditable})}),/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsx(Card,{className:classes.recurrenceCard,children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",mb:2,children:[/*#__PURE__*/_jsx(RepeatIcon,{className:classes.recurrenceIcon}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Configura\\xE7\\xE3o de Recorr\\xEAncia\"})]}),/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Field,{as:Switch,name:\"isRecurring\",checked:values.isRecurring,onChange:e=>{setFieldValue('isRecurring',e.target.checked);if(!e.target.checked){setPreviewExecutions([]);setShowPreview(false);}},disabled:!campaignEditable}),label:\"Habilitar recorr\\xEAncia\"})}),/*#__PURE__*/_jsx(Collapse,{in:values.isRecurring,children:/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:12,md:3,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",margin:\"dense\",fullWidth:true,error:touched.recurrenceType&&Boolean(errors.recurrenceType),children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Tipo de Recorr\\xEAncia\"}),/*#__PURE__*/_jsxs(Field,{as:Select,name:\"recurrenceType\",label:\"Tipo de Recorr\\xEAncia\",disabled:!campaignEditable,onChange:e=>{setFieldValue('recurrenceType',e.target.value);// Reset outros campos quando mudar tipo\nsetFieldValue('recurrenceDaysOfWeek',[]);setFieldValue('recurrenceDayOfMonth',1);},children:[/*#__PURE__*/_jsx(MenuItem,{value:\"minutely\",children:\"Por Minuto\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"hourly\",children:\"Por Hora\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"daily\",children:\"Di\\xE1rio\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"weekly\",children:\"Semanal\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"biweekly\",children:\"Quinzenal\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"monthly\",children:\"Mensal\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"yearly\",children:\"Anual\"})]}),touched.recurrenceType&&errors.recurrenceType&&/*#__PURE__*/_jsx(FormHelperText,{error:true,children:errors.recurrenceType})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:3,item:true,children:/*#__PURE__*/_jsx(Field,{as:TextField,name:\"recurrenceInterval\",label:\"Intervalo\",type:\"number\",variant:\"outlined\",margin:\"dense\",fullWidth:true,inputProps:{min:1},error:touched.recurrenceInterval&&Boolean(errors.recurrenceInterval),helperText:touched.recurrenceInterval&&errors.recurrenceInterval||\"A cada \".concat(values.recurrenceInterval||1,\" \").concat(values.recurrenceType==='minutely'?'minuto(s)':values.recurrenceType==='hourly'?'hora(s)':values.recurrenceType==='daily'?'dia(s)':values.recurrenceType==='weekly'?'semana(s)':values.recurrenceType==='biweekly'?'quinzena(s)':values.recurrenceType==='monthly'?'mês(es)':values.recurrenceType==='yearly'?'ano(s)':''),disabled:!campaignEditable})}),values.recurrenceType==='weekly'&&/*#__PURE__*/_jsxs(Grid,{xs:12,md:6,item:true,children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",gutterBottom:true,children:\"Dias da Semana\"}),/*#__PURE__*/_jsx(FormGroup,{row:true,children:daysOfWeekOptions.map(day=>/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:values.recurrenceDaysOfWeek.includes(day.value),onChange:e=>{const currentDays=values.recurrenceDaysOfWeek||[];if(e.target.checked){setFieldValue('recurrenceDaysOfWeek',[...currentDays,day.value]);}else{setFieldValue('recurrenceDaysOfWeek',currentDays.filter(d=>d!==day.value));}},disabled:!campaignEditable}),label:day.label.substring(0,3)},day.value))}),touched.recurrenceDaysOfWeek&&errors.recurrenceDaysOfWeek&&/*#__PURE__*/_jsx(FormHelperText,{error:true,children:errors.recurrenceDaysOfWeek})]}),values.recurrenceType==='monthly'&&/*#__PURE__*/_jsx(Grid,{xs:12,md:3,item:true,children:/*#__PURE__*/_jsx(Field,{as:TextField,name:\"recurrenceDayOfMonth\",label:\"Dia do M\\xEAs\",type:\"number\",variant:\"outlined\",margin:\"dense\",fullWidth:true,inputProps:{min:1,max:31},error:touched.recurrenceDayOfMonth&&Boolean(errors.recurrenceDayOfMonth),helperText:touched.recurrenceDayOfMonth&&errors.recurrenceDayOfMonth||\"Dia específico do mês (1-31)\",disabled:!campaignEditable})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsx(Field,{as:TextField,name:\"recurrenceEndDate\",label:\"Data Final (opcional)\",type:\"date\",variant:\"outlined\",margin:\"dense\",fullWidth:true,InputLabelProps:{shrink:true},error:touched.recurrenceEndDate&&Boolean(errors.recurrenceEndDate),helperText:touched.recurrenceEndDate&&errors.recurrenceEndDate||\"Deixe vazio para recorrência infinita\",disabled:!campaignEditable})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsx(Field,{as:TextField,name:\"maxExecutions\",label:\"M\\xE1ximo de Execu\\xE7\\xF5es (opcional)\",type:\"number\",variant:\"outlined\",margin:\"dense\",fullWidth:true,inputProps:{min:1},error:touched.maxExecutions&&Boolean(errors.maxExecutions),helperText:touched.maxExecutions&&errors.maxExecutions||\"Deixe vazio para recorrência infinita\",disabled:!campaignEditable})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsxs(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(VisibilityIcon,{}),onClick:()=>{handlePreviewRecurrence(values);setShowPreview(!showPreview);},disabled:!values.recurrenceType||!values.scheduledAt,fullWidth:true,style:{marginTop:8},children:[showPreview?'Ocultar':'Visualizar',\" Pr\\xF3ximas Execu\\xE7\\xF5es\"]})}),/*#__PURE__*/_jsx(Collapse,{in:showPreview&&previewExecutions.length>0,children:/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsx(Card,{className:classes.previewCard,children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",gutterBottom:true,children:\"Pr\\xF3ximas 5 Execu\\xE7\\xF5es:\"}),/*#__PURE__*/_jsx(List,{dense:true,children:previewExecutions.slice(0,5).map((execution,index)=>/*#__PURE__*/_jsx(ListItem,{divider:true,children:/*#__PURE__*/_jsx(ListItemText,{primary:\"\".concat(index+1,\"\\xAA Execu\\xE7\\xE3o\"),secondary:typeof execution==='string'?execution:moment(execution).format('DD/MM/YYYY HH:mm')})},index))})]})})})})]})})]})]})})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.formControl,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"openTicket-selection-label\",children:i18n.t(\"campaigns.dialog.form.openTicket\")}),/*#__PURE__*/_jsxs(Field,{as:Select,label:i18n.t(\"campaigns.dialog.form.openTicket\"),placeholder:i18n.t(\"campaigns.dialog.form.openTicket\"),labelId:\"openTicket-selection-label\",id:\"openTicket\",name:\"openTicket\",error:touched.openTicket&&Boolean(errors.openTicket),disabled:!campaignEditable,children:[/*#__PURE__*/_jsx(MenuItem,{value:\"enabled\",children:i18n.t(\"campaigns.dialog.form.enabledOpenTicket\")}),/*#__PURE__*/_jsx(MenuItem,{value:\"disabled\",children:i18n.t(\"campaigns.dialog.form.disabledOpenTicket\")})]})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsx(Autocomplete,{style:{marginTop:'8px'},variant:\"outlined\",margin:\"dense\",className:classes.formControl,getOptionLabel:option=>\"\".concat(option.name),value:selectedUser,size:\"small\",onChange:(e,newValue)=>{setSelectedUser(newValue);if(newValue!=null&&Array.isArray(newValue.queues)){if(newValue.queues.length===1){setSelectedQueue(newValue.queues[0].id);}setQueues(newValue.queues);}else{setQueues(allQueues);setSelectedQueue(\"\");}},options:options,filterOptions:filterOptions,freeSolo:true,fullWidth:true,autoHighlight:true,disabled:!campaignEditable||values.openTicket==='disabled',noOptionsText:i18n.t(\"transferTicketModal.noOptions\"),loading:loading,renderOption:option=>/*#__PURE__*/_jsxs(\"span\",{children:[\" \",/*#__PURE__*/_jsx(UserStatusIcon,{user:option}),\" \",option.name]}),renderInput:params=>/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({},params),{},{label:i18n.t(\"transferTicketModal.fieldLabel\"),variant:\"outlined\",onChange:e=>setSearchParam(e.target.value),InputProps:_objectSpread(_objectSpread({},params.InputProps),{},{endAdornment:/*#__PURE__*/_jsxs(React.Fragment,{children:[loading?/*#__PURE__*/_jsx(CircularProgress,{color:\"inherit\",size:20}):null,params.InputProps.endAdornment]})})}))})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.formControl,children:[/*#__PURE__*/_jsx(InputLabel,{children:i18n.t(\"transferTicketModal.fieldQueueLabel\")}),/*#__PURE__*/_jsx(Select,{value:selectedQueue,onChange:e=>setSelectedQueue(e.target.value),label:i18n.t(\"transferTicketModal.fieldQueuePlaceholder\"),required:!isNil(selectedUser),disabled:!campaignEditable||values.openTicket==='disabled',children:queues.map(queue=>/*#__PURE__*/_jsx(MenuItem,{value:queue.id,children:queue.name},queue.id))})]})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.formControl,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"statusTicket-selection-label\",children:i18n.t(\"campaigns.dialog.form.statusTicket\")}),/*#__PURE__*/_jsxs(Field,{as:Select,label:i18n.t(\"campaigns.dialog.form.statusTicket\"),placeholder:i18n.t(\"campaigns.dialog.form.statusTicket\"),labelId:\"statusTicket-selection-label\",id:\"statusTicket\",name:\"statusTicket\",error:touched.statusTicket&&Boolean(errors.statusTicket),disabled:!campaignEditable||values.openTicket==='disabled',children:[/*#__PURE__*/_jsx(MenuItem,{value:\"closed\",children:i18n.t(\"campaigns.dialog.form.closedTicketStatus\")}),/*#__PURE__*/_jsx(MenuItem,{value:\"pending\",children:i18n.t(\"campaigns.dialog.form.pendingTicketStatus\")}),/*#__PURE__*/_jsx(MenuItem,{value:\"open\",children:i18n.t(\"campaigns.dialog.form.openTicketStatus\")})]})]})}),/*#__PURE__*/_jsxs(Grid,{xs:12,item:true,children:[/*#__PURE__*/_jsxs(Tabs,{value:messageTab,indicatorColor:\"primary\",textColor:\"primary\",onChange:(e,v)=>setMessageTab(v),variant:\"fullWidth\",centered:true,style:{background:\"#f2f2f2\",border:\"1px solid #e6e6e6\",borderRadius:2},children:[/*#__PURE__*/_jsx(Tab,{label:\"Msg. 1\",index:0}),/*#__PURE__*/_jsx(Tab,{label:\"Msg. 2\",index:1}),/*#__PURE__*/_jsx(Tab,{label:\"Msg. 3\",index:2}),/*#__PURE__*/_jsx(Tab,{label:\"Msg. 4\",index:3}),/*#__PURE__*/_jsx(Tab,{label:\"Msg. 5\",index:4})]}),/*#__PURE__*/_jsxs(Box,{style:{paddingTop:20,border:\"none\"},children:[messageTab===0&&/*#__PURE__*/_jsx(_Fragment,{children:values.confirmation?/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:12,md:8,item:true,children:/*#__PURE__*/_jsx(_Fragment,{children:renderMessageField(\"message1\")})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsx(_Fragment,{children:renderConfirmationMessageField(\"confirmationMessage1\")})})]}):/*#__PURE__*/_jsx(_Fragment,{children:renderMessageField(\"message1\")})}),messageTab===1&&/*#__PURE__*/_jsx(_Fragment,{children:values.confirmation?/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:12,md:8,item:true,children:/*#__PURE__*/_jsx(_Fragment,{children:renderMessageField(\"message2\")})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsx(_Fragment,{children:renderConfirmationMessageField(\"confirmationMessage2\")})})]}):/*#__PURE__*/_jsx(_Fragment,{children:renderMessageField(\"message2\")})}),messageTab===2&&/*#__PURE__*/_jsx(_Fragment,{children:values.confirmation?/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:12,md:8,item:true,children:/*#__PURE__*/_jsx(_Fragment,{children:renderMessageField(\"message3\")})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsx(_Fragment,{children:renderConfirmationMessageField(\"confirmationMessage3\")})})]}):/*#__PURE__*/_jsx(_Fragment,{children:renderMessageField(\"message3\")})}),messageTab===3&&/*#__PURE__*/_jsx(_Fragment,{children:values.confirmation?/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:12,md:8,item:true,children:/*#__PURE__*/_jsx(_Fragment,{children:renderMessageField(\"message4\")})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsx(_Fragment,{children:renderConfirmationMessageField(\"confirmationMessage4\")})})]}):/*#__PURE__*/_jsx(_Fragment,{children:renderMessageField(\"message4\")})}),messageTab===4&&/*#__PURE__*/_jsx(_Fragment,{children:values.confirmation?/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:12,md:8,item:true,children:/*#__PURE__*/_jsx(_Fragment,{children:renderMessageField(\"message5\")})}),/*#__PURE__*/_jsx(Grid,{xs:12,md:4,item:true,children:/*#__PURE__*/_jsx(_Fragment,{children:renderConfirmationMessageField(\"confirmationMessage5\")})})]}):/*#__PURE__*/_jsx(_Fragment,{children:renderMessageField(\"message5\")})})]})]}),(campaign.mediaPath||attachment)&&/*#__PURE__*/_jsxs(Grid,{xs:12,item:true,children:[/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(AttachFileIcon,{}),children:attachment!=null?attachment.name:campaign.mediaName}),campaignEditable&&/*#__PURE__*/_jsx(IconButton,{onClick:()=>setConfirmationOpen(true),color:\"primary\",children:/*#__PURE__*/_jsx(DeleteOutlineIcon,{color:\"secondary\"})})]})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[campaign.status===\"CANCELADA\"&&/*#__PURE__*/_jsx(Button,{color:\"primary\",onClick:()=>restartCampaign(),variant:\"outlined\",children:i18n.t(\"campaigns.dialog.buttons.restart\")}),campaign.status===\"EM_ANDAMENTO\"&&/*#__PURE__*/_jsx(Button,{color:\"primary\",onClick:()=>cancelCampaign(),variant:\"outlined\",children:i18n.t(\"campaigns.dialog.buttons.cancel\")}),!attachment&&!campaign.mediaPath&&campaignEditable&&/*#__PURE__*/_jsx(Button,{color:\"primary\",onClick:()=>attachmentFile.current.click(),disabled:isSubmitting,variant:\"outlined\",children:i18n.t(\"campaigns.dialog.buttons.attach\")}),/*#__PURE__*/_jsx(Button,{onClick:handleClose,color:\"primary\",disabled:isSubmitting,variant:\"outlined\",children:i18n.t(\"campaigns.dialog.buttons.close\")}),(campaignEditable||campaign.status===\"CANCELADA\")&&/*#__PURE__*/_jsxs(Button,{type:\"submit\",color:\"primary\",disabled:isSubmitting,variant:\"contained\",className:classes.btnWrapper,children:[campaignId?\"\".concat(i18n.t(\"campaigns.dialog.buttons.edit\")):\"\".concat(i18n.t(\"campaigns.dialog.buttons.add\")),isSubmitting&&/*#__PURE__*/_jsx(CircularProgress,{size:24,className:classes.buttonProgress})]})]})]});}})]})]});};export default CampaignModal;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}