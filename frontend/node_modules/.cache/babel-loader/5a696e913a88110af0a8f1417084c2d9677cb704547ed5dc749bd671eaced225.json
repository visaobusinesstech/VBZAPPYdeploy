{"ast":null,"code":"import _objectSpread from\"/home/deploy/codigologlow/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useCallback,useContext,useEffect}from\"react\";import{toast}from\"react-toastify\";import{add,format,parseISO}from\"date-fns\";import Menu from\"@material-ui/core/Menu\";import MenuItem from\"@material-ui/core/MenuItem\";import PopupState,{bindTrigger,bindMenu}from\"material-ui-popup-state\";// import { SocketContext } from \"../../context/Socket/SocketContext\";\nimport{makeStyles}from\"@material-ui/core/styles\";import{green}from\"@material-ui/core/colors\";import{Button,TableBody,TableRow,TableCell,IconButton,Table,TableHead,Paper,Tooltip,Typography,CircularProgress,Box,Card,CardContent,Dialog,DialogTitle,DialogContent,DialogActions,Select,MenuItem as MuiMenuItem,FormControl,InputLabel}from\"@material-ui/core\";import{Edit,CheckCircle,SignalCellularConnectedNoInternet2Bar,SignalCellularConnectedNoInternet0Bar,SignalCellular4Bar,CropFree,DeleteOutline,Facebook,Instagram,WhatsApp,Sync}from\"@material-ui/icons\";import WebhookIcon from'@mui/icons-material/Webhook';import FacebookLogin from\"react-facebook-login/dist/facebook-login-render-props\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import MainHeaderButtonsWrapper from\"../../components/MainHeaderButtonsWrapper\";import Title from\"../../components/Title\";import TableRowSkeleton from\"../../components/TableRowSkeleton\";import api from\"../../services/api\";import WhatsAppModal from\"../../components/WhatsAppModal\";import ConfirmationModal from\"../../components/ConfirmationModal\";import QrcodeModal from\"../../components/QrcodeModal\";import{i18n}from\"../../translate/i18n\";import{WhatsAppsContext}from\"../../context/WhatsApp/WhatsAppsContext\";import toastError from\"../../errors/toastError\";import formatSerializedId from'../../utils/formatSerializedId';import{AuthContext}from\"../../context/Auth/AuthContext\";import usePlans from\"../../hooks/usePlans\";import{useHistory}from\"react-router-dom/cjs/react-router-dom.min\";import ForbiddenPage from\"../../components/ForbiddenPage\";import{Can}from\"../../components/Can\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({mainPaper:_objectSpread({flex:1,// padding: theme.spacing(1),\npadding:theme.padding,overflowY:\"scroll\"},theme.scrollbarStyles),customTableCell:{display:\"flex\",alignItems:\"center\",justifyContent:\"center\"},tooltip:{backgroundColor:\"#f5f5f9\",color:\"rgba(0, 0, 0, 0.87)\",fontSize:theme.typography.pxToRem(14),border:\"1px solid #dadde9\",maxWidth:450},tooltipPopper:{textAlign:\"center\"},buttonProgress:{color:green[500]}}));function CircularProgressWithLabel(props){return/*#__PURE__*/_jsxs(Box,{position:\"relative\",display:\"inline-flex\",children:[/*#__PURE__*/_jsx(CircularProgress,_objectSpread({variant:\"determinate\"},props)),/*#__PURE__*/_jsx(Box,{top:0,left:0,bottom:0,right:0,position:\"absolute\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",children:/*#__PURE__*/_jsx(Typography,{variant:\"caption\",component:\"div\",color:\"textSecondary\",children:\"\".concat(Math.round(props.value),\"%\")})})]});}const CustomToolTip=_ref=>{let{title,content,children}=_ref;const classes=useStyles();return/*#__PURE__*/_jsx(Tooltip,{arrow:true,classes:{tooltip:classes.tooltip,popper:classes.tooltipPopper},title:/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Typography,{gutterBottom:true,color:\"inherit\",children:title}),content&&/*#__PURE__*/_jsx(Typography,{children:content})]}),children:children});};const IconChannel=channel=>{switch(channel){case\"facebook\":return/*#__PURE__*/_jsx(Facebook,{style:{color:\"#3b5998\"}});case\"instagram\":return/*#__PURE__*/_jsx(Instagram,{style:{color:\"#e1306c\"}});case\"whatsapp\":return/*#__PURE__*/_jsx(WhatsApp,{style:{color:\"#25d366\"}});case\"whatsapp_oficial\":return/*#__PURE__*/_jsx(WhatsApp,{style:{color:\"#25d366\"}});default:return\"error\";}};const Connections=()=>{const classes=useStyles();const{whatsApps,loading}=useContext(WhatsAppsContext);const[whatsAppModalOpen,setWhatsAppModalOpen]=useState(false);const[statusImport,setStatusImport]=useState([]);const[qrModalOpen,setQrModalOpen]=useState(false);const[selectedWhatsApp,setSelectedWhatsApp]=useState(null);const[channel,setChannel]=useState(\"whatsapp\");const[confirmModalOpen,setConfirmModalOpen]=useState(false);const history=useHistory();const confirmationModalInitialState={action:\"\",title:\"\",message:\"\",whatsAppId:\"\",open:false};const[confirmModalInfo,setConfirmModalInfo]=useState(confirmationModalInitialState);const[planConfig,setPlanConfig]=useState(false);const[transferModalOpen,setTransferModalOpen]=useState(false);const[sourceConnection,setSourceConnection]=useState(\"\");const[targetConnection,setTargetConnection]=useState(\"\");const[preDeleteModalOpen,setPreDeleteModalOpen]=useState(false);const[whatsAppToDelete,setWhatsAppToDelete]=useState(null);const[transferProgressModalOpen,setTransferProgressModalOpen]=useState(false);const[transferProgress,setTransferProgress]=useState({current:0,total:0,percentage:0});//   const socketManager = useContext(SocketContext);\nconst{user,socket}=useContext(AuthContext);const companyId=user.companyId;const{getPlanCompany}=usePlans();useEffect(()=>{async function fetchData(){const planConfigs=await getPlanCompany(undefined,companyId);setPlanConfig(planConfigs);}fetchData();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);const responseFacebook=response=>{if(response.status!==\"unknown\"){const{accessToken,id}=response;api.post(\"/facebook\",{facebookUserId:id,facebookUserToken:accessToken}).then(response=>{toast.success(i18n.t(\"connections.facebook.success\"));}).catch(error=>{toastError(error);});}};const responseInstagram=response=>{if(response.status!==\"unknown\"){const{accessToken,id}=response;api.post(\"/facebook\",{addInstagram:true,facebookUserId:id,facebookUserToken:accessToken}).then(response=>{toast.success(i18n.t(\"connections.facebook.success\"));}).catch(error=>{toastError(error);});}};useEffect(()=>{// const socket = socketManager.GetSocket();\nsocket.on(\"importMessages-\".concat(user.companyId),data=>{if(data.action===\"refresh\"){setStatusImport([]);history.go(0);}if(data.action===\"update\"){setStatusImport(data.status);}});socket.on(\"transferTickets-\".concat(user.companyId),data=>{if(data.action===\"progress\"){setTransferProgress({current:data.current,total:data.total,percentage:Math.round(data.current/data.total*100)});}if(data.action===\"completed\"){setTransferProgressModalOpen(false);setTransferProgress({current:0,total:0,percentage:0});toast.success(\"Transfer\\xEAncia conclu\\xEDda! \".concat(data.transferred,\" tickets transferidos com sucesso.\"));handleCloseTransferModal();}if(data.action===\"error\"){setTransferProgressModalOpen(false);setTransferProgress({current:0,total:0,percentage:0});toast.error(\"Erro na transferência de tickets.\");}});/* return () => {\n      socket.disconnect();\n    }; */},[whatsApps]);const handleStartWhatsAppSession=async whatsAppId=>{try{await api.post(\"/whatsappsession/\".concat(whatsAppId));}catch(err){toastError(err);}};const handleRequestNewQrCode=async whatsAppId=>{try{await api.put(\"/whatsappsession/\".concat(whatsAppId));}catch(err){toastError(err);}};const handleOpenWhatsAppModal=channel=>{setChannel(channel);setSelectedWhatsApp(null);setWhatsAppModalOpen(true);};const handleCloseWhatsAppModal=useCallback(()=>{setWhatsAppModalOpen(false);setSelectedWhatsApp(null);},[setSelectedWhatsApp,setWhatsAppModalOpen]);const handleOpenQrModal=whatsApp=>{setSelectedWhatsApp(whatsApp);setQrModalOpen(true);};const handleCloseQrModal=useCallback(()=>{setSelectedWhatsApp(null);setQrModalOpen(false);},[setQrModalOpen,setSelectedWhatsApp]);const handleEditWhatsApp=whatsApp=>{setChannel(whatsApp.channel);setSelectedWhatsApp(whatsApp);setWhatsAppModalOpen(true);};const handleSyncTemplates=async whatsAppId=>{await api.get(\"/whatsapp/sync-templates/\".concat(whatsAppId));};const handleCopyWebhook=url=>{navigator.clipboard.writeText(url);// Copia o token para a área de transferência    \n};const openInNewTab=url=>{window.open(url,'_blank','noopener,noreferrer');};const handleOpenConfirmationModal=(action,whatsAppId)=>{if(action===\"disconnect\"){setConfirmModalInfo({action:action,title:i18n.t(\"connections.confirmationModal.disconnectTitle\"),message:i18n.t(\"connections.confirmationModal.disconnectMessage\"),whatsAppId:whatsAppId});}if(action===\"delete\"){setConfirmModalInfo({action:action,title:i18n.t(\"connections.confirmationModal.deleteTitle\"),message:i18n.t(\"connections.confirmationModal.deleteMessage\"),whatsAppId:whatsAppId});}if(action===\"closedImported\"){setConfirmModalInfo({action:action,title:i18n.t(\"connections.confirmationModal.closedImportedTitle\"),message:i18n.t(\"connections.confirmationModal.closedImportedMessage\"),whatsAppId:whatsAppId});}setConfirmModalOpen(true);};const handleSubmitConfirmationModal=async()=>{if(confirmModalInfo.action===\"disconnect\"){try{await api.delete(\"/whatsappsession/\".concat(confirmModalInfo.whatsAppId));}catch(err){toastError(err);}}if(confirmModalInfo.action===\"delete\"){try{await api.delete(\"/whatsapp/\".concat(confirmModalInfo.whatsAppId));toast.success(i18n.t(\"connections.toasts.deleted\"));}catch(err){toastError(err);}}if(confirmModalInfo.action===\"closedImported\"){try{await api.post(\"/closedimported/\".concat(confirmModalInfo.whatsAppId));toast.success(i18n.t(\"connections.toasts.closedimported\"));}catch(err){toastError(err);}}setConfirmModalInfo(confirmationModalInitialState);};const renderImportButton=whatsApp=>{if((whatsApp===null||whatsApp===void 0?void 0:whatsApp.statusImportMessages)===\"renderButtonCloseTickets\"){return/*#__PURE__*/_jsx(Button,{style:{marginLeft:12},size:\"small\",variant:\"outlined\",color:\"primary\",onClick:()=>{handleOpenConfirmationModal(\"closedImported\",whatsApp.id);},children:i18n.t(\"connections.buttons.closedImported\")});}if(whatsApp!==null&&whatsApp!==void 0&&whatsApp.importOldMessages){let isTimeStamp=!isNaN(new Date(Math.floor(whatsApp===null||whatsApp===void 0?void 0:whatsApp.statusImportMessages)).getTime());if(isTimeStamp){const ultimoStatus=new Date(Math.floor(whatsApp===null||whatsApp===void 0?void 0:whatsApp.statusImportMessages)).getTime();const dataLimite=+add(ultimoStatus,{seconds:+35}).getTime();if(dataLimite>new Date().getTime()){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Button,{disabled:true,style:{marginLeft:12},size:\"small\",endIcon:/*#__PURE__*/_jsx(CircularProgress,{size:12,className:classes.buttonProgress}),variant:\"outlined\",color:\"primary\",children:i18n.t(\"connections.buttons.preparing\")})});}}}};const renderActionButtons=whatsApp=>{return/*#__PURE__*/_jsxs(_Fragment,{children:[whatsApp.channel===\"whatsapp\"&&whatsApp.status===\"qrcode\"&&/*#__PURE__*/_jsx(Can,{role:user.profile===\"user\"&&user.allowConnections===\"enabled\"?\"admin\":user.profile,perform:\"connections-page:addConnection\",yes:()=>/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"contained\",color:\"primary\",onClick:()=>handleOpenQrModal(whatsApp),children:i18n.t(\"connections.buttons.qrcode\")})}),whatsApp.channel===\"whatsapp\"&&whatsApp.status===\"DISCONNECTED\"&&/*#__PURE__*/_jsx(Can,{role:user.profile===\"user\"&&user.allowConnections===\"enabled\"?\"admin\":user.profile,perform:\"connections-page:addConnection\",yes:()=>/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"outlined\",color:\"primary\",onClick:()=>handleStartWhatsAppSession(whatsApp.id),children:i18n.t(\"connections.buttons.tryAgain\")}),\" \",/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"outlined\",color:\"secondary\",onClick:()=>handleRequestNewQrCode(whatsApp.id),children:i18n.t(\"connections.buttons.newQr\")})]})}),whatsApp.channel===\"whatsapp\"&&(whatsApp.status===\"CONNECTED\"||whatsApp.status===\"PAIRING\"||whatsApp.status===\"TIMEOUT\")&&/*#__PURE__*/_jsx(Can,{role:user.profile,perform:\"connections-page:addConnection\",yes:()=>/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"outlined\",color:\"secondary\",onClick:()=>{handleOpenConfirmationModal(\"disconnect\",whatsApp.id);},children:i18n.t(\"connections.buttons.disconnect\")}),renderImportButton(whatsApp)]})}),whatsApp.channel===\"whatsapp\"&&whatsApp.status===\"OPENING\"&&/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"outlined\",disabled:true,color:\"default\",children:i18n.t(\"connections.buttons.connecting\")})]});};const renderStatusToolTips=whatsApp=>{return/*#__PURE__*/_jsxs(\"div\",{className:classes.customTableCell,children:[whatsApp.status===\"DISCONNECTED\"&&/*#__PURE__*/_jsx(CustomToolTip,{title:i18n.t(\"connections.toolTips.disconnected.title\"),content:i18n.t(\"connections.toolTips.disconnected.content\"),children:/*#__PURE__*/_jsx(SignalCellularConnectedNoInternet0Bar,{color:\"secondary\"})}),whatsApp.status===\"OPENING\"&&/*#__PURE__*/_jsx(CircularProgress,{size:24,className:classes.buttonProgress}),whatsApp.status===\"qrcode\"&&/*#__PURE__*/_jsx(CustomToolTip,{title:i18n.t(\"connections.toolTips.qrcode.title\"),content:i18n.t(\"connections.toolTips.qrcode.content\"),children:/*#__PURE__*/_jsx(CropFree,{})}),whatsApp.status===\"CONNECTED\"&&/*#__PURE__*/_jsx(CustomToolTip,{title:i18n.t(\"connections.toolTips.connected.title\"),children:/*#__PURE__*/_jsx(SignalCellular4Bar,{style:{color:green[500]}})}),(whatsApp.status===\"TIMEOUT\"||whatsApp.status===\"PAIRING\")&&/*#__PURE__*/_jsx(CustomToolTip,{title:i18n.t(\"connections.toolTips.timeout.title\"),content:i18n.t(\"connections.toolTips.timeout.content\"),children:/*#__PURE__*/_jsx(SignalCellularConnectedNoInternet2Bar,{color:\"secondary\"})})]});};const restartWhatsapps=async()=>{try{await api.post(\"/whatsapp-restart/\");toast.success(i18n.t(\"connections.waitConnection\"));}catch(err){toastError(err);}};const handleOpenTransferModal=()=>{setTransferModalOpen(true);};const handleCloseTransferModal=()=>{setTransferModalOpen(false);setSourceConnection(\"\");setTargetConnection(\"\");};const handleCloseTransferProgressModal=()=>{setTransferProgressModalOpen(false);setTransferProgress({current:0,total:0,percentage:0});};const handleTransferTickets=async()=>{if(!sourceConnection||!targetConnection){toast.error(\"Selecione as conexões de origem e destino\");return;}if(sourceConnection===targetConnection){toast.error(\"As conexões de origem e destino devem ser diferentes\");return;}try{const response=await api.post(\"/transfer-tickets\",{sourceConnectionId:sourceConnection,targetConnectionId:targetConnection});if(response.data.requiresProgress){setTransferModalOpen(false);setTransferProgressModalOpen(true);setTransferProgress({current:0,total:response.data.totalTickets,percentage:0});}else{toast.success(\"Tickets transferidos com sucesso! \".concat(response.data.transferred||0,\" tickets transferidos.\"));handleCloseTransferModal();}}catch(err){toastError(err);}};const handleOpenPreDeleteModal=whatsAppId=>{setWhatsAppToDelete(whatsAppId);setPreDeleteModalOpen(true);};const handleClosePreDeleteModal=()=>{setPreDeleteModalOpen(false);setWhatsAppToDelete(null);};const handleConfirmTransferDone=()=>{setPreDeleteModalOpen(false);handleOpenConfirmationModal(\"delete\",whatsAppToDelete);setWhatsAppToDelete(null);};return/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsx(ConfirmationModal,{title:confirmModalInfo.title,open:confirmModalOpen,onClose:setConfirmModalOpen,onConfirm:handleSubmitConfirmationModal,children:confirmModalInfo.message}),qrModalOpen&&/*#__PURE__*/_jsx(QrcodeModal,{open:qrModalOpen,onClose:handleCloseQrModal,whatsAppId:!whatsAppModalOpen&&(selectedWhatsApp===null||selectedWhatsApp===void 0?void 0:selectedWhatsApp.id)}),/*#__PURE__*/_jsx(WhatsAppModal,{open:whatsAppModalOpen,onClose:handleCloseWhatsAppModal,whatsAppId:!qrModalOpen&&(selectedWhatsApp===null||selectedWhatsApp===void 0?void 0:selectedWhatsApp.id),channel:channel}),/*#__PURE__*/_jsxs(Dialog,{open:transferModalOpen,onClose:handleCloseTransferModal,maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Transfer\\xEAncia de Tickets\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",style:{marginBottom:24,lineHeight:1.6},children:[\"Para transferir os tickets, selecione a conex\\xE3o de \",/*#__PURE__*/_jsx(\"strong\",{children:\"origem\"}),\" (de onde os tickets ser\\xE3o movidos) e a conex\\xE3o de \",/*#__PURE__*/_jsx(\"strong\",{children:\"destino\"}),\" (para onde os tickets ser\\xE3o transferidos). Todos os atendimentos ativos da conex\\xE3o de origem ser\\xE3o movidos para a conex\\xE3o de destino.\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:24,marginBottom:24},children:[/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Origem\"}),/*#__PURE__*/_jsx(Select,{value:sourceConnection,onChange:e=>setSourceConnection(e.target.value),label:\"Origem\",children:whatsApps.map(whatsApp=>/*#__PURE__*/_jsx(MuiMenuItem,{value:whatsApp.id,children:whatsApp.name},whatsApp.id))})]}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:24,color:'#4caf50',fontWeight:'bold'},children:\"\\u2192\"}),/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Destino\"}),/*#__PURE__*/_jsx(Select,{value:targetConnection,onChange:e=>setTargetConnection(e.target.value),label:\"Destino\",children:whatsApps.map(whatsApp=>/*#__PURE__*/_jsx(MuiMenuItem,{value:whatsApp.id,children:whatsApp.name},whatsApp.id))})]})]})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleCloseTransferModal,color:\"default\",children:\"CANCELAR\"}),/*#__PURE__*/_jsx(Button,{onClick:handleTransferTickets,color:\"primary\",variant:\"contained\",children:\"TRANSFERIR\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:transferProgressModalOpen,onClose:handleCloseTransferProgressModal,maxWidth:\"sm\",fullWidth:true,disableBackdropClick:true,disableEscapeKeyDown:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Transferindo Tickets\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',padding:'20px 0'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",style:{marginBottom:16},children:\"Progresso da Transfer\\xEAncia\"}),/*#__PURE__*/_jsxs(Box,{position:\"relative\",display:\"inline-flex\",marginBottom:2,children:[/*#__PURE__*/_jsx(CircularProgress,{variant:\"determinate\",value:transferProgress.percentage,size:80,thickness:4}),/*#__PURE__*/_jsx(Box,{top:0,left:0,bottom:0,right:0,position:\"absolute\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",children:/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",component:\"div\",color:\"textSecondary\",style:{fontSize:'14px',fontWeight:'bold'},children:[transferProgress.percentage,\"%\"]})})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",style:{marginTop:16},children:[transferProgress.current,\" de \",transferProgress.total,\" tickets transferidos\"]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",style:{marginTop:8},children:\"Por favor, aguarde enquanto os tickets s\\xE3o transferidos...\"})]})})]}),/*#__PURE__*/_jsxs(Dialog,{open:preDeleteModalOpen,onClose:handleClosePreDeleteModal,maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Transfer\\xEAncia de Tickets\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body1\",style:{marginBottom:16},children:\"Antes de excluir esta conex\\xE3o, voc\\xEA j\\xE1 fez a transfer\\xEAncia dos tickets para outra conex\\xE3o?\"})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleClosePreDeleteModal,color:\"default\",children:\"N\\xC3O\"}),/*#__PURE__*/_jsx(Button,{onClick:handleConfirmTransferDone,color:\"primary\",variant:\"contained\",children:\"SIM\"})]})]}),user.profile===\"user\"&&user.allowConnections===\"disabled\"?/*#__PURE__*/_jsx(ForbiddenPage,{}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(MainHeader,{children:[/*#__PURE__*/_jsxs(Title,{children:[i18n.t(\"connections.title\"),\" (\",whatsApps.length,\")\"]}),/*#__PURE__*/_jsxs(MainHeaderButtonsWrapper,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:handleOpenTransferModal,children:\"Transferir Tickets\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:restartWhatsapps,children:i18n.t(\"connections.restartConnections\")}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:()=>openInNewTab(\"https://wa.me/\".concat(process.env.REACT_APP_NUMBER_SUPPORT)),children:i18n.t(\"connections.callSupport\")}),/*#__PURE__*/_jsx(PopupState,{variant:\"popover\",popupId:\"demo-popup-menu\",children:popupState=>/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(Can,{role:user.profile,perform:\"connections-page:addConnection\",yes:()=>{var _planConfig$plan,_planConfig$plan2,_process$env$REACT_AP,_process$env$REACT_AP2;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,_objectSpread(_objectSpread({variant:\"contained\",color:\"primary\"},bindTrigger(popupState)),{},{children:i18n.t(\"connections.newConnection\")})),/*#__PURE__*/_jsxs(Menu,_objectSpread(_objectSpread({},bindMenu(popupState)),{},{children:[/*#__PURE__*/_jsxs(MenuItem,{disabled:planConfig!==null&&planConfig!==void 0&&(_planConfig$plan=planConfig.plan)!==null&&_planConfig$plan!==void 0&&_planConfig$plan.useWhatsapp?false:true,onClick:()=>{handleOpenWhatsAppModal();popupState.close();},children:[/*#__PURE__*/_jsx(WhatsApp,{fontSize:\"small\",style:{marginRight:\"10px\",color:\"#25D366\"}}),\"WhatsApp\"]}),/*#__PURE__*/_jsxs(MenuItem,{disabled:planConfig!==null&&planConfig!==void 0&&(_planConfig$plan2=planConfig.plan)!==null&&_planConfig$plan2!==void 0&&_planConfig$plan2.useWhatsappOfficial?false:true,onClick:()=>{handleOpenWhatsAppModal(\"whatsapp_oficial\");popupState.close();},children:[/*#__PURE__*/_jsx(WhatsApp,{fontSize:\"small\",style:{marginRight:\"10px\",color:\"#25D366\"}}),\"WhatsApp Oficial\"]}),/*#__PURE__*/_jsx(FacebookLogin,{appId:process.env.REACT_APP_FACEBOOK_APP_ID,autoLoad:false,fields:\"name,email,picture\",version:\"9.0\",scope:((_process$env$REACT_AP=process.env.REACT_APP_REQUIRE_BUSINESS_MANAGEMENT)===null||_process$env$REACT_AP===void 0?void 0:_process$env$REACT_AP.toUpperCase())===\"TRUE\"?\"public_profile,pages_messaging,pages_show_list,pages_manage_metadata,pages_read_engagement,business_management\":\"public_profile,pages_messaging,pages_show_list,pages_manage_metadata,pages_read_engagement\",callback:responseFacebook,render:renderProps=>{var _planConfig$plan3;return/*#__PURE__*/_jsxs(MenuItem,{disabled:planConfig!==null&&planConfig!==void 0&&(_planConfig$plan3=planConfig.plan)!==null&&_planConfig$plan3!==void 0&&_planConfig$plan3.useFacebook?false:true,onClick:renderProps.onClick,children:[/*#__PURE__*/_jsx(Facebook,{fontSize:\"small\",style:{marginRight:\"10px\",color:\"#3b5998\"}}),\"Facebook\"]});}}),/*#__PURE__*/_jsx(FacebookLogin,{appId:process.env.REACT_APP_FACEBOOK_APP_ID,autoLoad:false,fields:\"name,email,picture\",version:\"9.0\",scope:((_process$env$REACT_AP2=process.env.REACT_APP_REQUIRE_BUSINESS_MANAGEMENT)===null||_process$env$REACT_AP2===void 0?void 0:_process$env$REACT_AP2.toUpperCase())===\"TRUE\"?\"public_profile,instagram_basic,instagram_manage_messages,pages_messaging,pages_show_list,pages_manage_metadata,pages_read_engagement,business_management\":\"public_profile,instagram_basic,instagram_manage_messages,pages_messaging,pages_show_list,pages_manage_metadata,pages_read_engagement\",callback:responseInstagram,render:renderProps=>{var _planConfig$plan4;return/*#__PURE__*/_jsxs(MenuItem,{disabled:planConfig!==null&&planConfig!==void 0&&(_planConfig$plan4=planConfig.plan)!==null&&_planConfig$plan4!==void 0&&_planConfig$plan4.useInstagram?false:true,onClick:renderProps.onClick,children:[/*#__PURE__*/_jsx(Instagram,{fontSize:\"small\",style:{marginRight:\"10px\",color:\"#e1306c\"}}),\"Instagram\"]});}})]}))]});}})})})]})]}),statusImport!==null&&statusImport!==void 0&&statusImport.all?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{style:{margin:\"auto\",marginBottom:12},children:/*#__PURE__*/_jsx(Card,{className:classes.root,children:/*#__PURE__*/_jsxs(CardContent,{className:classes.content,children:[/*#__PURE__*/_jsx(Typography,{component:\"h5\",variant:\"h5\",children:(statusImport===null||statusImport===void 0?void 0:statusImport.this)===-1?i18n.t(\"connections.buttons.preparing\"):i18n.t(\"connections.buttons.importing\")}),(statusImport===null||statusImport===void 0?void 0:statusImport.this)===-1?/*#__PURE__*/_jsx(Typography,{component:\"h6\",variant:\"h6\",align:\"center\",children:/*#__PURE__*/_jsx(CircularProgress,{size:24})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{component:\"h6\",variant:\"h6\",align:\"center\",children:\"\".concat(i18n.t(\"connections.typography.processed\"),\" \").concat(statusImport===null||statusImport===void 0?void 0:statusImport.this,\" \").concat(i18n.t(\"connections.typography.in\"),\" \").concat(statusImport===null||statusImport===void 0?void 0:statusImport.all,\"  \").concat(i18n.t(\"connections.typography.date\"),\": \").concat(statusImport===null||statusImport===void 0?void 0:statusImport.date,\" \")}),/*#__PURE__*/_jsx(Typography,{align:\"center\",children:/*#__PURE__*/_jsx(CircularProgressWithLabel,{style:{margin:\"auto\"},value:(statusImport===null||statusImport===void 0?void 0:statusImport.this)/(statusImport===null||statusImport===void 0?void 0:statusImport.all)*100})})]})]})})})}):null,/*#__PURE__*/_jsx(Paper,{className:classes.mainPaper,variant:\"outlined\",children:/*#__PURE__*/_jsxs(Table,{size:\"small\",children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"Channel\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"connections.table.color\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"connections.table.name\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"connections.table.number\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"connections.table.status\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"connections.table.session\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"connections.table.lastUpdate\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"connections.table.default\")}),/*#__PURE__*/_jsx(Can,{role:user.profile===\"user\"&&user.allowConnections===\"enabled\"?\"admin\":user.profile,perform:\"connections-page:addConnection\",yes:()=>/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"connections.table.actions\")})})]})}),/*#__PURE__*/_jsx(TableBody,{children:loading?/*#__PURE__*/_jsx(TableRowSkeleton,{}):/*#__PURE__*/_jsx(_Fragment,{children:(whatsApps===null||whatsApps===void 0?void 0:whatsApps.length)>0&&whatsApps.map(whatsApp=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:IconChannel(whatsApp.channel)}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsx(\"div\",{className:classes.customTableCell,children:/*#__PURE__*/_jsx(\"span\",{style:{backgroundColor:whatsApp.color,width:60,height:20,alignSelf:\"center\"}})})}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:whatsApp.name}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:whatsApp.channel==='whatsapp'&&whatsApp.number?/*#__PURE__*/_jsx(_Fragment,{children:formatSerializedId(whatsApp.number)}):whatsApp.channel==='whatsapp_oficial'&&whatsApp.phone_number?/*#__PURE__*/_jsx(_Fragment,{children:formatSerializedId(whatsApp.phone_number)}):\"-\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:renderStatusToolTips(whatsApp)}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:renderActionButtons(whatsApp)}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:format(parseISO(whatsApp.updatedAt),\"dd/MM/yy HH:mm\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:whatsApp.isDefault&&/*#__PURE__*/_jsx(\"div\",{className:classes.customTableCell,children:/*#__PURE__*/_jsx(CheckCircle,{style:{color:green[500]}})})}),/*#__PURE__*/_jsx(Can,{role:user.profile,perform:\"connections-page:addConnection\",yes:()=>/*#__PURE__*/_jsxs(TableCell,{align:\"center\",children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleEditWhatsApp(whatsApp),children:/*#__PURE__*/_jsx(Edit,{})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:e=>{handleOpenPreDeleteModal(whatsApp.id);},children:/*#__PURE__*/_jsx(DeleteOutline,{})}),whatsApp.channel===\"whatsapp_oficial\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Tooltip,{title:\"Sincronizar templates\",children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",\"aria-label\":\"sync-templates\",onClick:e=>{handleSyncTemplates(whatsApp.id);},children:/*#__PURE__*/_jsx(Sync,{})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Copiar webhook para Meta\",children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",\"aria-label\":\"copy-webhook\",onClick:e=>{handleCopyWebhook(whatsApp.waba_webhook);},children:/*#__PURE__*/_jsx(WebhookIcon,{})})})]})]})})]},whatsApp.id))})})]})})]})]});};export default Connections;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}