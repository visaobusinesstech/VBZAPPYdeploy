{"ast":null,"code":"import{useState,useEffect,useRef}from\"react\";import{useHistory}from\"react-router-dom\";import{has,isArray}from\"lodash\";import{toast}from\"react-toastify\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";import toastError from\"../../errors/toastError\";import{socketConnection}from\"../../services/socket\";import moment from\"moment\";const useAuth=()=>{const history=useHistory();const[isAuth,setIsAuth]=useState(false);const[loading,setLoading]=useState(true);const[user,setUser]=useState({});const[socket,setSocket]=useState(null);// Ref para manter referência dos listeners ativos\nconst listenersRef=useRef(new Set());// Interceptors do API (mantém como estava)\napi.interceptors.request.use(config=>{const token=localStorage.getItem(\"token\");if(token){config.headers[\"Authorization\"]=\"Bearer \".concat(JSON.parse(token));setIsAuth(true);}return config;},error=>{Promise.reject(error);});api.interceptors.response.use(response=>{return response;},async error=>{var _error$response,_error$response2;const originalRequest=error.config;if((error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===403&&!originalRequest._retry){originalRequest._retry=true;const{data}=await api.post(\"/auth/refresh_token\");if(data){localStorage.setItem(\"token\",JSON.stringify(data.token));api.defaults.headers.Authorization=\"Bearer \".concat(data.token);}return api(originalRequest);}if((error===null||error===void 0?void 0:(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status)===401){localStorage.removeItem(\"token\");api.defaults.headers.Authorization=undefined;setIsAuth(false);}return Promise.reject(error);});// Effect para inicialização do token\nuseEffect(()=>{const token=localStorage.getItem(\"token\");(async()=>{if(token){try{const{data}=await api.post(\"/auth/refresh_token\");api.defaults.headers.Authorization=\"Bearer \".concat(data.token);setIsAuth(true);setUser(data.user||data);}catch(err){toastError(err);}}setLoading(false);})();},[]);// Effect para configuração do socket\nuseEffect(()=>{if(Object.keys(user).length&&user.id>0){console.log(\"Configurando socket para user\",user.id,\"company\",user.companyId);// Limpar listeners anteriores\nif(socket){listenersRef.current.forEach(eventName=>{if(socket.off){socket.off(eventName);}});listenersRef.current.clear();}// Criar nova conexão socket\nconst socketInstance=socketConnection({user:{companyId:user.companyId,id:user.id}});if(socketInstance){setSocket(socketInstance);// Aguardar um pouco para garantir que o socket está configurado\nsetTimeout(()=>{const eventName=\"company-\".concat(user.companyId,\"-user\");const handleUserUpdate=data=>{if(data.action===\"update\"&&data.user.id===user.id){setUser(data.user);}};// Verificar se o socket tem o método 'on'\nif(socketInstance&&typeof socketInstance.on==='function'){socketInstance.on(eventName,handleUserUpdate);listenersRef.current.add(eventName);console.log(\"Listener adicionado para: \".concat(eventName));}else{console.error(\"Socket instance não tem método 'on'\",socketInstance);}},100);}}// Cleanup function\nreturn()=>{if(socket&&listenersRef.current.size>0){console.log(\"Limpando listeners do socket para user\",user.id);listenersRef.current.forEach(eventName=>{if(socket.off){socket.off(eventName);}});listenersRef.current.clear();}};},[user.id,user.companyId]);// Dependências específicas\n// Effect para buscar dados do usuário atual\nuseEffect(()=>{const fetchCurrentUser=async()=>{try{const{data}=await api.get(\"/auth/me\");setUser(data.user||data);}catch(err){console.log(\"Erro ao buscar usuário atual:\",err);}};if(isAuth){fetchCurrentUser();}},[isAuth]);const handleLogin=async userData=>{setLoading(true);try{const{data}=await api.post(\"/auth/login\",userData);const{user:{company}}=data;// Lógica de configurações da empresa (mantém como estava)\nif(has(company,\"companieSettings\")&&isArray(company.companieSettings[0])){const setting=company.companieSettings[0].find(s=>s.key===\"campaignsEnabled\");if(setting&&setting.value===\"true\"){localStorage.setItem(\"cshow\",null);}}if(has(company,\"companieSettings\")&&isArray(company.companieSettings[0])){const setting=company.companieSettings[0].find(s=>s.key===\"sendSignMessage\");const signEnable=setting.value===\"enable\";if(setting&&setting.value===\"enabled\"){localStorage.setItem(\"sendSignMessage\",signEnable);}}localStorage.setItem(\"profileImage\",data.user.profileImage);moment.locale(\"pt-br\");let dueDate;if(data.user.company.id===1){dueDate=\"2999-12-31T00:00:00.000Z\";}else{dueDate=data.user.company.dueDate;}const hoje=moment(moment()).format(\"DD/MM/yyyy\");const vencimento=moment(dueDate).format(\"DD/MM/yyyy\");// Comparar apenas as datas (sem horas) para permitir acesso até 23h59 do dia do vencimento\nconst hojeInicio=moment().startOf('day');const vencimentoInicio=moment(dueDate).startOf('day');var diff=vencimentoInicio.diff(hojeInicio,'days');var before=hojeInicio.isSameOrBefore(vencimentoInicio,'day');var dias=diff;if(before===true){localStorage.setItem(\"token\",JSON.stringify(data.token));localStorage.setItem(\"companyDueDate\",vencimento);api.defaults.headers.Authorization=\"Bearer \".concat(data.token);setUser(data.user||data);setIsAuth(true);toast.success(i18n.t(\"auth.toasts.success\"));if(Math.round(dias)<5){toast.warn(\"Sua assinatura vence em \".concat(Math.round(dias),\" \").concat(Math.round(dias)===1?\"dia\":\"dias\",\" \"));}history.push(\"/tickets\");setLoading(false);}else{api.defaults.headers.Authorization=\"Bearer \".concat(data.token);setIsAuth(true);toastError(\"Opss! Sua assinatura venceu \".concat(vencimento,\".\\nEntre em contato com o Suporte para mais informa\\xE7\\xF5es! \"));history.push(\"/financeiro-aberto\");setLoading(false);}}catch(err){toastError(err);setLoading(false);}};const handleLogout=async()=>{setLoading(true);try{// Limpar socket antes do logout\nif(socket){listenersRef.current.forEach(eventName=>{if(socket.off){socket.off(eventName);}});listenersRef.current.clear();if(typeof socket.disconnect==='function'){socket.disconnect();}}await api.delete(\"/auth/logout\");setIsAuth(false);setUser({});setSocket(null);localStorage.removeItem(\"token\");localStorage.removeItem(\"cshow\");api.defaults.headers.Authorization=undefined;setLoading(false);history.push(\"/login\");}catch(err){toastError(err);setLoading(false);}};const getCurrentUserInfo=async()=>{try{const{data}=await api.get(\"/auth/me\");console.log(data);return data;}catch(_){return null;}};return{isAuth,user,loading,handleLogin,handleLogout,getCurrentUserInfo,socket};};export default useAuth;","map":{"version":3,"names":["useState","useEffect","useRef","useHistory","has","isArray","toast","i18n","api","toastError","socketConnection","moment","useAuth","history","isAuth","setIsAuth","loading","setLoading","user","setUser","socket","setSocket","listenersRef","Set","interceptors","request","use","config","token","localStorage","getItem","headers","concat","JSON","parse","error","Promise","reject","response","_error$response","_error$response2","originalRequest","status","_retry","data","post","setItem","stringify","defaults","Authorization","removeItem","undefined","err","Object","keys","length","id","console","log","companyId","current","forEach","eventName","off","clear","socketInstance","setTimeout","handleUserUpdate","action","on","add","size","fetchCurrentUser","get","handleLogin","userData","company","companieSettings","setting","find","s","key","value","signEnable","profileImage","locale","dueDate","hoje","format","vencimento","hojeInicio","startOf","vencimentoInicio","diff","before","isSameOrBefore","dias","success","t","Math","round","warn","push","handleLogout","disconnect","delete","getCurrentUserInfo","_"],"sources":["/home/deploy/atendechatop/frontend/src/hooks/useAuth.js/index.js"],"sourcesContent":["import { useState, useEffect, useRef } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { has, isArray } from \"lodash\";\n\nimport { toast } from \"react-toastify\";\n\nimport { i18n } from \"../../translate/i18n\";\nimport api from \"../../services/api\";\nimport toastError from \"../../errors/toastError\";\nimport { socketConnection } from \"../../services/socket\";\nimport moment from \"moment\";\n\nconst useAuth = () => {\n  const history = useHistory();\n  const [isAuth, setIsAuth] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [user, setUser] = useState({});\n  const [socket, setSocket] = useState(null);\n  \n  // Ref para manter referência dos listeners ativos\n  const listenersRef = useRef(new Set());\n\n  // Interceptors do API (mantém como estava)\n  api.interceptors.request.use(\n    (config) => {\n      const token = localStorage.getItem(\"token\");\n      if (token) {\n        config.headers[\"Authorization\"] = `Bearer ${JSON.parse(token)}`;\n        setIsAuth(true);\n      }\n      return config;\n    },\n    (error) => {\n      Promise.reject(error);\n    }\n  );\n\n  api.interceptors.response.use(\n    (response) => {\n      return response;\n    },\n    async (error) => {\n      const originalRequest = error.config;\n      if (error?.response?.status === 403 && !originalRequest._retry) {\n        originalRequest._retry = true;\n\n        const { data } = await api.post(\"/auth/refresh_token\");\n        if (data) {\n          localStorage.setItem(\"token\", JSON.stringify(data.token));\n          api.defaults.headers.Authorization = `Bearer ${data.token}`;\n        }\n        return api(originalRequest);\n      }\n      if (error?.response?.status === 401) {\n        localStorage.removeItem(\"token\");\n        api.defaults.headers.Authorization = undefined;\n        setIsAuth(false);\n      }\n      return Promise.reject(error);\n    }\n  );\n\n  // Effect para inicialização do token\n  useEffect(() => {\n    const token = localStorage.getItem(\"token\");\n    (async () => {\n      if (token) {\n        try {\n          const { data } = await api.post(\"/auth/refresh_token\");\n          api.defaults.headers.Authorization = `Bearer ${data.token}`;\n          setIsAuth(true);\n          setUser(data.user || data);\n        } catch (err) {\n          toastError(err);\n        }\n      }\n      setLoading(false);\n    })();\n  }, []);\n\n  // Effect para configuração do socket\n  useEffect(() => {\n    if (Object.keys(user).length && user.id > 0) {\n      console.log(\"Configurando socket para user\", user.id, \"company\", user.companyId);\n      \n      // Limpar listeners anteriores\n      if (socket) {\n        listenersRef.current.forEach(eventName => {\n          if (socket.off) {\n            socket.off(eventName);\n          }\n        });\n        listenersRef.current.clear();\n      }\n\n      // Criar nova conexão socket\n      const socketInstance = socketConnection({ user: {\n        companyId: user.companyId,\n        id: user.id }\n      });\n      \n      if (socketInstance) {\n        setSocket(socketInstance);\n\n        // Aguardar um pouco para garantir que o socket está configurado\n        setTimeout(() => {\n          const eventName = `company-${user.companyId}-user`;\n          \n          const handleUserUpdate = (data) => {\n            if (data.action === \"update\" && data.user.id === user.id) {\n              setUser(data.user);\n            }\n          };\n\n          // Verificar se o socket tem o método 'on'\n          if (socketInstance && typeof socketInstance.on === 'function') {\n            socketInstance.on(eventName, handleUserUpdate);\n            listenersRef.current.add(eventName);\n            console.log(`Listener adicionado para: ${eventName}`);\n          } else {\n            console.error(\"Socket instance não tem método 'on'\", socketInstance);\n          }\n        }, 100);\n      }\n    }\n\n    // Cleanup function\n    return () => {\n      if (socket && listenersRef.current.size > 0) {\n        console.log(\"Limpando listeners do socket para user\", user.id);\n        listenersRef.current.forEach(eventName => {\n          if (socket.off) {\n            socket.off(eventName);\n          }\n        });\n        listenersRef.current.clear();\n      }\n    };\n  }, [user.id, user.companyId]); // Dependências específicas\n\n  // Effect para buscar dados do usuário atual\n  useEffect(() => {\n    const fetchCurrentUser = async () => {\n      try {\n        const { data } = await api.get(\"/auth/me\");\n        setUser(data.user || data);\n      } catch (err) {\n        console.log(\"Erro ao buscar usuário atual:\", err);\n      }\n    };\n    \n    if (isAuth) {\n      fetchCurrentUser();\n    }\n  }, [isAuth]);\n\n  const handleLogin = async (userData) => {\n    setLoading(true);\n\n    try {\n      const { data } = await api.post(\"/auth/login\", userData);\n      const {\n        user: { company },\n      } = data;\n\n      // Lógica de configurações da empresa (mantém como estava)\n      if (\n        has(company, \"companieSettings\") &&\n        isArray(company.companieSettings[0])\n      ) {\n        const setting = company.companieSettings[0].find(\n          (s) => s.key === \"campaignsEnabled\"\n        );\n        if (setting && setting.value === \"true\") {\n          localStorage.setItem(\"cshow\", null);\n        }\n      }\n\n      if (\n        has(company, \"companieSettings\") &&\n        isArray(company.companieSettings[0])\n      ) {\n        const setting = company.companieSettings[0].find(\n          (s) => s.key === \"sendSignMessage\"\n        );\n\n        const signEnable = setting.value === \"enable\";\n\n        if (setting && setting.value === \"enabled\") {\n          localStorage.setItem(\"sendSignMessage\", signEnable);\n        }\n      }\n      \n      localStorage.setItem(\"profileImage\", data.user.profileImage);\n\n      moment.locale(\"pt-br\");\n      let dueDate;\n      if (data.user.company.id === 1) {\n        dueDate = \"2999-12-31T00:00:00.000Z\";\n      } else {\n        dueDate = data.user.company.dueDate;\n      }\n      \n      const hoje = moment(moment()).format(\"DD/MM/yyyy\");\n      const vencimento = moment(dueDate).format(\"DD/MM/yyyy\");\n\n      // Comparar apenas as datas (sem horas) para permitir acesso até 23h59 do dia do vencimento\n      const hojeInicio = moment().startOf('day');\n      const vencimentoInicio = moment(dueDate).startOf('day');\n      \n      var diff = vencimentoInicio.diff(hojeInicio, 'days');\n      var before = hojeInicio.isSameOrBefore(vencimentoInicio, 'day');\n      var dias = diff;\n\n      if (before === true) {\n        localStorage.setItem(\"token\", JSON.stringify(data.token));\n        localStorage.setItem(\"companyDueDate\", vencimento);\n        api.defaults.headers.Authorization = `Bearer ${data.token}`;\n        setUser(data.user || data);\n        setIsAuth(true);\n        toast.success(i18n.t(\"auth.toasts.success\"));\n        \n        if (Math.round(dias) < 5) {\n          toast.warn(\n            `Sua assinatura vence em ${Math.round(dias)} ${\n              Math.round(dias) === 1 ? \"dia\" : \"dias\"\n            } `\n          );\n        }\n\n        history.push(\"/tickets\");\n        setLoading(false);\n      } else {\n        api.defaults.headers.Authorization = `Bearer ${data.token}`;\n        setIsAuth(true);\n        toastError(`Opss! Sua assinatura venceu ${vencimento}.\nEntre em contato com o Suporte para mais informações! `);\n        history.push(\"/financeiro-aberto\");\n        setLoading(false);\n      }\n    } catch (err) {\n      toastError(err);\n      setLoading(false);\n    }\n  };\n\n  const handleLogout = async () => {\n    setLoading(true);\n\n    try {\n      // Limpar socket antes do logout\n      if (socket) {\n        listenersRef.current.forEach(eventName => {\n          if (socket.off) {\n            socket.off(eventName);\n          }\n        });\n        listenersRef.current.clear();\n        \n        if (typeof socket.disconnect === 'function') {\n          socket.disconnect();\n        }\n      }\n\n      await api.delete(\"/auth/logout\");\n      setIsAuth(false);\n      setUser({});\n      setSocket(null);\n      localStorage.removeItem(\"token\");\n      localStorage.removeItem(\"cshow\");\n      api.defaults.headers.Authorization = undefined;\n      setLoading(false);\n      history.push(\"/login\");\n    } catch (err) {\n      toastError(err);\n      setLoading(false);\n    }\n  };\n\n  const getCurrentUserInfo = async () => {\n    try {\n      const { data } = await api.get(\"/auth/me\");\n      console.log(data);\n      return data;\n    } catch (_) {\n      return null;\n    }\n  };\n\n  return {\n    isAuth,\n    user,\n    loading,\n    handleLogin,\n    handleLogout,\n    getCurrentUserInfo,\n    socket,\n  };\n};\n\nexport default useAuth;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}