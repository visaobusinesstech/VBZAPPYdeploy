{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef,useContext}from\"react\";import*as Yup from\"yup\";import{Formik,FieldArray,Form,Field}from\"formik\";import{toast}from\"react-toastify\";import{makeStyles}from\"@material-ui/core/styles\";import{green}from\"@material-ui/core/colors\";import Button from\"@material-ui/core/Button\";import TextField from\"@material-ui/core/TextField\";import Dialog from\"@material-ui/core/Dialog\";import DialogActions from\"@material-ui/core/DialogActions\";import DialogContent from\"@material-ui/core/DialogContent\";import DialogTitle from\"@material-ui/core/DialogTitle\";import IconButton from\"@material-ui/core/IconButton\";import DeleteOutlineIcon from\"@material-ui/icons/DeleteOutline\";import CircularProgress from\"@material-ui/core/CircularProgress\";import Compressor from\"compressorjs\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";import toastError from\"../../errors/toastError\";import{Checkbox,FormControl,InputLabel,MenuItem,Select,Stack,Typography}from\"@mui/material\";import{AccessTime,AddCircle,Delete,Image,KeyboardArrowDown,KeyboardArrowUp,Message,MicNone,Videocam,InsertDriveFile}from\"@mui/icons-material\";import{capitalize}from\"../../utils/capitalize\";import{Box}from\"@material-ui/core\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{display:\"flex\",flexWrap:\"wrap\"},textField:{marginRight:theme.spacing(1),flex:1},extraAttr:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\"},btnWrapper:{position:\"relative\"},buttonProgress:{color:green[500],position:\"absolute\",top:\"50%\",left:\"50%\",marginTop:-12,marginLeft:-12}}));const FlowBuilderSingleBlockModal=_ref=>{let{open,onSave,onUpdate,data,close}=_ref;const classes=useStyles();const isMounted=useRef(true);const[activeModal,setActiveModal]=useState(false);const[rule,setRule]=useState();const[medias,setMedias]=useState([]);const[textDig,setTextDig]=useState();const[elements,setElements]=useState([]);const[elementsSeq,setElementsSeq]=useState([]);const[elementsSeqEdit,setElementsSeqEdit]=useState([]);const[elementsEdit,setElementsEdit]=useState([]);const[numberMessages,setNumberMessages]=useState(0);const[numberMessagesLast,setNumberMessagesLast]=useState(0);const[numberInterval,setNumberInterval]=useState(0);const[numberIntervalLast,setNumberIntervalLast]=useState(0);const[numberAudio,setNumberAudio]=useState(0);const[numberAudioLast,setNumberAudioLast]=useState(0);const[numberVideo,setNumberVideo]=useState(0);const[numberVideoLast,setNumberVideoLast]=useState(0);const[numberImg,setNumberImg]=useState(0);const[numberImgLast,setNumberImgLast]=useState(0);const[loading,setLoading]=useState(false);const[previewImg,setPreviewImg]=useState([]);const[previewAudios,setPreviewAudios]=useState([]);const[previewVideos,setPreviewVideos]=useState([]);const[arrayOption,setArrayOption]=useState([]);const[variables,setVariables]=useState([]);const[previewDocs,setPreviewDocs]=useState([]);const[numberDocLast,setNumberDocLast]=useState(0);const[numberDocs,setNumberDocs]=useState(0);const[labels,setLabels]=useState({title:\"Adicionar conteúdo ao fluxo\",btn:\"Adicionar\"});const{user}=useContext(AuthContext);const companyId=user.companyId;const handleElements=newNameFiles=>{let elementsSequence=[];const newArrMessage=elementsSeq.filter(item=>item.includes(\"message\"));const newArrInterval=elementsSeq.filter(item=>item.includes(\"interval\"));const newArrImg=elementsSeq.filter(item=>item.includes(\"img\"));const newArrAudio=elementsSeq.filter(item=>item.includes(\"audio\"));const newArrVideo=elementsSeq.filter(item=>item.includes(\"video\"));//Todas as mensagens\nfor(let i=0;i<numberMessages;i++){const value=document.querySelector(\".\".concat(newArrMessage[i])).querySelector(\".MuiInputBase-input\").value;if(!value){toast.error(\"Campos de mensagem vazio!\");setLoading(false);throw\"\";}elementsSequence.push({type:\"message\",value:value,number:newArrMessage[i]});console.log(\"text\");}//Todos os intervalos\nfor(let i=0;i<numberInterval;i++){const value=document.querySelector(\".\".concat(newArrInterval[i])).querySelector(\".MuiInputBase-input\").value;if(parseInt(value)===0||parseInt(value)>120){toast.error(\"Intervalo não pode ser 0 ou maior que 120!\");setLoading(false);throw\"\";}elementsSequence.push({type:\"interval\",value:value,number:newArrInterval[i]});}//Todas as imagens\nfor(let i=0;i<numberImg;i++){const onlyImg=newNameFiles!==null&&newNameFiles.filter(file=>file.includes(\"png\")||file.includes(\"jpg\")||file.includes(\"jpeg\"));const onlyImgNameOriginal=medias.filter(file=>file.name.includes(\"png\")||file.name.includes(\"jpg\")||file.name.includes(\"jpeg\"));if(elementsSeqEdit.includes(newArrImg[i])){const itemSelectedEdit=elementsEdit.filter(item=>item.number===newArrImg[i])[0];elementsSequence.push({type:\"img\",value:itemSelectedEdit.value,original:itemSelectedEdit.original,number:itemSelectedEdit.number,teste:\"image\"});}else{let indexElem=0;if(elementsSeqEdit.filter(item=>item.includes(\"img\")).length>0){indexElem=elementsSeqEdit.filter(item=>item.includes(\"img\")).length-i;}else{indexElem=i;}// console.log(\"IMAGE\", indexElem, '-->>', onlyImgNameOriginal[indexElem]);\nelementsSequence.push({type:\"img\",value:onlyImg[indexElem],original:onlyImgNameOriginal[indexElem].name,number:newArrImg[i],teste:\"image\"});}}//Todos os audios\nfor(let i=0;i<numberAudio;i++){const onlyAudio=newNameFiles!==null&&newNameFiles.filter(file=>file.includes(\"mp3\")||file.includes(\"ogg\")||file.includes(\"mpeg\")||file.includes(\"opus\"));const onlyAudioNameOriginal=medias.filter(file=>file.name.includes(\"mp3\")||file.name.includes(\"ogg\")||file.name.includes(\"mpeg\")||file.name.includes(\"opus\"));if(elementsSeqEdit.includes(newArrAudio[i])){const itemSelectedEdit=elementsEdit.filter(item=>item.number===newArrAudio[i])[0];elementsSequence.push({type:\"audio\",value:itemSelectedEdit.value,original:itemSelectedEdit.original,number:itemSelectedEdit.number,record:document.querySelector(\".check\".concat(newArrAudio[i])).querySelector(\".PrivateSwitchBase-input\").checked});}else{let indexElem=0;if(elementsSeqEdit.filter(item=>item.includes(\"audio\")).length>0){indexElem=elementsSeqEdit.filter(item=>item.includes(\"audio\")).length-i;}else{indexElem=i;}elementsSequence.push({type:\"audio\",value:onlyAudio[indexElem],original:onlyAudioNameOriginal[indexElem].name,number:newArrAudio[i],record:document.querySelector(\".check\".concat(newArrAudio[i])).querySelector(\".PrivateSwitchBase-input\").checked});}}//Todos os videos\nfor(let i=0;i<numberVideo;i++){const onlyVideo=newNameFiles!==null&&newNameFiles.filter(file=>file.includes(\"mp4\")||file.includes(\"avi\"));const onlyVideoNameOriginal=medias.filter(file=>file.name.includes(\"mp4\")||file.name.includes(\"avi\"));if(elementsSeqEdit.includes(newArrVideo[i])){const itemSelectedEdit=elementsEdit.filter(item=>item.number===newArrVideo[i])[0];elementsSequence.push({type:\"video\",value:itemSelectedEdit.value,original:itemSelectedEdit.original,number:itemSelectedEdit.number});}else{let indexElem=0;if(elementsSeqEdit.filter(item=>item.includes(\"video\")).length>0){indexElem=elementsSeqEdit.filter(item=>item.includes(\"video\")).length-i;}else{indexElem=i;}elementsSequence.push({type:\"video\",value:onlyVideo[indexElem],original:onlyVideoNameOriginal[indexElem].name,number:newArrVideo[i]});}}// Todos os documentos\nfor(let i=0;i<numberDocs;i++){const onlyDocs=newNameFiles!==null&&newNameFiles.filter(file=>file.includes(\"pdf\"));const onlyDocNameOriginal=medias.filter(file=>file.name.includes(\"pdf\"));// console.log(\"### elementsSeqEdit\", elementsSeqEdit);\nif(elementsSeqEdit.includes(\"document\".concat(i))){const itemSelectedEdit=elementsEdit.filter(item=>item.number===\"document\".concat(i))[0];elementsSequence.push({type:\"document\",value:itemSelectedEdit===null||itemSelectedEdit===void 0?void 0:itemSelectedEdit.value,original:itemSelectedEdit===null||itemSelectedEdit===void 0?void 0:itemSelectedEdit.original,number:itemSelectedEdit===null||itemSelectedEdit===void 0?void 0:itemSelectedEdit.number});}else{let indexElem=0;if(elementsSeqEdit.filter(item=>item.includes(\"document\")).length>0){indexElem=elementsSeqEdit.filter(item=>item.includes(\"document\")).length-i;}else{indexElem=i;}// console.log(\"onlyDocs\", onlyDocs);\n// console.log(\"onlyDocNameOriginal\", onlyDocNameOriginal);\n// console.log(\"DOCUMENT\", indexElem, '-->>', onlyDocNameOriginal[indexElem]);\nelementsSequence.push({type:\"document\",value:onlyDocs[indexElem],original:onlyDocNameOriginal[indexElem].name,number:\"document\".concat(i)});}}console.log(\"elementsSequence\",elementsSequence);return elementsSequence;};const deleteElementsTypeOne=(id,type)=>{if(type===\"message\"){setNumberMessages(old=>old-1);setElementsSeq(old=>old.filter(item=>item!==\"message\".concat(id)));setElementsSeqEdit(old=>old.filter(item=>item!==\"message\".concat(id)));document.querySelector(\".stackMessage\".concat(id)).remove();}if(type===\"interval\"){setNumberInterval(old=>old-1);setElementsSeq(old=>old.filter(item=>item!==\"interval\".concat(id)));setElementsSeqEdit(old=>old.filter(item=>item!==\"interval\".concat(id)));document.querySelector(\".stackInterval\".concat(id)).remove();}if(type===\"img\"){setNumberImg(old=>old-1);setPreviewImg(old=>{setMedias(oldMedia=>{try{return oldMedia.filter(mediaItem=>mediaItem.name!==old.filter(item=>item.number===id)[0].name);}catch(e){return oldMedia;}});return old.filter(item=>item.number!==id);});setElementsSeq(old=>old.filter(item=>item!==\"img\".concat(id)));setElementsSeqEdit(old=>old.filter(item=>item!==\"img\".concat(id)));document.querySelector(\".stackImg\".concat(id)).remove();}if(type===\"audio\"){setNumberAudio(old=>old-1);setPreviewAudios(old=>{setMedias(oldMedia=>{try{return oldMedia.filter(mediaItem=>mediaItem.name!==old.filter(item=>item.number===id)[0].name);}catch(e){return oldMedia;}});return old.filter(item=>item.number!==id);});setElementsSeq(old=>old.filter(item=>item!==\"audio\".concat(id)));setElementsSeqEdit(old=>old.filter(item=>item!==\"audio\".concat(id)));document.querySelector(\".stackAudio\".concat(id)).remove();}if(type===\"video\"){setNumberVideo(old=>old-1);setPreviewVideos(old=>{setMedias(oldMedia=>{try{return oldMedia.filter(mediaItem=>mediaItem.name!==old.filter(item=>item.number===id)[0].name);}catch(e){return oldMedia;}});return old.filter(item=>item.number!==id);});setElementsSeq(old=>old.filter(item=>item!==\"video\".concat(id)));setElementsSeqEdit(old=>old.filter(item=>item!==\"video\".concat(id)));document.querySelector(\".stackVideo\".concat(id)).remove();}if(type===\"document\"){setNumberDocs(old=>old-1);setPreviewDocs(old=>{setMedias(oldMedia=>{try{return oldMedia.filter(mediaItem=>mediaItem.name!==old.filter(item=>item.number===id)[0].name);}catch(e){return oldMedia;}});return old.filter(item=>item.number!==id);});setElementsSeq(old=>old.filter(item=>item!==\"document\".concat(id)));setElementsSeqEdit(old=>old.filter(item=>item!==\"document\".concat(id)));document.querySelector(\".stackDocument\".concat(id)).remove();}};const moveElementDown=id=>{setElementsSeq(old=>{const array=old;const index=array.indexOf(id);moveItemParaFrente(index);console.log(\"id\",id);if(index!==-1&&index<array.length-1){// Verifica se o elemento foi encontrado no array e não está na última posição\nconst novoArray=[...array];// Cria uma cópia do array original\nconst elementoMovido=novoArray.splice(index,1)[0];novoArray.splice(index+1,0,elementoMovido);return novoArray;}return array;});};const moveElementUp=id=>{setElementsSeq(old=>{const array=old;const index=array.indexOf(id);moveItemParaTras(index);if(index!==-1&&index>0){// Verifica se o elemento foi encontrado no array e não está na primeira posição\nconst novoArray=[...array];// Cria uma cópia do array original\nconst elementoMovido=novoArray.splice(index,1)[0];novoArray.splice(index-1,0,elementoMovido);return novoArray;}return array;});};function moveItemParaFrente(posicao){setElements(old=>{const array=old;if(posicao>=0&&posicao<array.length-1){const novoArray=[...array];// Cria uma cópia do array original\nconst elementoMovido=novoArray.splice(posicao,1)[0];novoArray.splice(posicao+1,0,elementoMovido);return novoArray;}return array;// Retorna o array original se a movimentação não for possível\n});}function moveItemParaTras(posicao){setElements(old=>{const array=old;if(posicao>0&&posicao<array.length){const novoArray=[...array];// Cria uma cópia do array original\nconst elementoMovido=novoArray.splice(posicao,1)[0];novoArray.splice(posicao-1,0,elementoMovido);return novoArray;}return array;// Retorna o array original se a movimentação não for possível\n});}const handleChangeMediasImg=(e,number)=>{if(!e.target.files){return;}if(e.target.files[0].size>2000000){toast.error(\"Arquivo é muito grande! 2MB máximo\");return;}const imgBlob=URL.createObjectURL(e.target.files[0]);// console.log(\"imgBlob\", imgBlob);\nsetPreviewImg(old=>[...old,{number:number,url:imgBlob,name:e.target.files[0].name}]);const selectedMedias=Array.from(e.target.files);setMedias(old=>[...old,selectedMedias[0]]);document.querySelector(\".img\".concat(number)).src=imgBlob;document.querySelector(\".btnImg\".concat(number)).remove();};const handleChangeAudios=(e,number)=>{if(!e.target.files){return;}if(e.target.files[0].size>5000000){toast.error(\"Arquivo é muito grande! 5MB máximo\");return;}const audioBlob=URL.createObjectURL(e.target.files[0]);setPreviewAudios(old=>[...old,{number:number,url:audioBlob,name:e.target.files[0].name}]);const selectedMedias=Array.from(e.target.files);setMedias(old=>[...old,selectedMedias[0]]);document.querySelector(\".audio\".concat(number)).innerHTML=\"<audio controls=\\\"controls\\\">\\n    <source src=\\\"\".concat(audioBlob,\"\\\" type=\\\"audio/mp3\\\" />\\n    seu navegador n\\xE3o suporta HTML5\\n  </audio>\");document.querySelector(\".btnAudio\".concat(number)).remove();};const handleChangeVideos=(e,number)=>{if(!e.target.files){return;}if(e.target.files[0].size>20000000){toast.error(\"Arquivo é muito grande! 20MB máximo\");return;}const videoBlob=URL.createObjectURL(e.target.files[0]);setPreviewVideos(old=>[...old,{number:number,url:videoBlob,name:e.target.files[0].name}]);var divConteudo=document.createElement(\"div\");const selectedMedias=Array.from(e.target.files);setMedias(old=>[...old,selectedMedias[0]]);divConteudo.innerHTML=\"<video controls=\\\"controls\\\" style=\\\"width: 200px;\\\">\\n    <source src=\\\"\".concat(videoBlob,\"\\\" type=\\\"video/mp4\\\" />\\n    seu navegador n\\xE3o suporta HTML5\\n  </video>\");document.querySelector(\".video\".concat(number)).appendChild(divConteudo);document.querySelector(\".btnVideo\".concat(number)).remove();};const imgLayout=function(number){let valueDefault=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"\";return/*#__PURE__*/_jsxs(Stack,{sx:{border:\"1px solid #9a00ed\",borderRadius:\"7px\",padding:\"6px\",position:\"relative\"},className:\"stackImg\".concat(number),children:[/*#__PURE__*/_jsx(Stack,{sx:{position:\"absolute\",right:6},children:/*#__PURE__*/_jsx(Delete,{onClick:()=>deleteElementsTypeOne(number,\"img\")})}),/*#__PURE__*/_jsx(Typography,{textAlign:\"center\",children:\"Imagem\"}),/*#__PURE__*/_jsx(Stack,{direction:\"row\",justifyContent:\"center\",children:/*#__PURE__*/_jsx(\"img\",{src:valueDefault.length>0?\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/public/company\").concat(companyId,\"/flow/\").concat(valueDefault):\"\",className:\"img\".concat(number),style:{width:\"200px\"}})}),valueDefault.length===0&&/*#__PURE__*/_jsxs(Button,{variant:\"contained\",component:\"label\",className:\"btnImg\".concat(number),children:[\"Enviar imagem\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/png, image/jpg, image/jpeg\",hidden:true,onChange:e=>handleChangeMediasImg(e,number)})]})]},\"stackImg\".concat(number));};const audioLayout=function(number){let valueDefault=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"\";let valueRecordDefault=arguments.length>2&&arguments[2]!==undefined?arguments[2]:\"\";return/*#__PURE__*/_jsxs(Stack,{sx:{border:\"1px solid #9a00ed\",borderRadius:\"7px\",padding:\"6px\",position:\"relative\"},className:\"stackAudio\".concat(number),children:[/*#__PURE__*/_jsx(Stack,{sx:{position:\"absolute\",right:6},direction:\"row\",gap:1,children:/*#__PURE__*/_jsx(Delete,{sx:{cursor:\"pointer\"},onClick:()=>deleteElementsTypeOne(number,\"audio\")})}),/*#__PURE__*/_jsx(Typography,{textAlign:\"center\",children:\"Audio\"}),/*#__PURE__*/_jsx(\"div\",{className:\"audio\".concat(number),style:{display:\"flex\",flexDirection:\"row\",justifyContent:\"center\"},children:valueDefault.length>0&&/*#__PURE__*/_jsxs(\"audio\",{controls:\"controls\",children:[/*#__PURE__*/_jsx(\"source\",{src:\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/public/company\").concat(companyId,\"/flow/\").concat(valueDefault),type:\"audio/mp3\"}),\"seu navegador n\\xE3o suporta HTML5\"]})}),valueDefault.length===0&&/*#__PURE__*/_jsxs(Button,{variant:\"contained\",component:\"label\",className:\"btnAudio\".concat(number),children:[\"Enviar audio\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"audio/ogg, audio/mp3, audio/opus\",hidden:true,onChange:e=>handleChangeAudios(e,number)})]}),/*#__PURE__*/_jsxs(Stack,{direction:\"row\",justifyContent:\"center\",children:[/*#__PURE__*/_jsx(Checkbox,{className:\"checkaudio\".concat(number),defaultChecked:valueRecordDefault===\"ok\"?false:true}),/*#__PURE__*/_jsx(Stack,{justifyContent:\"center\",children:/*#__PURE__*/_jsx(Typography,{children:\"Enviar como audio gravado na hora\"})})]})]},\"stackAudio\".concat(number));};const videoLayout=function(number){let valueDefault=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"\";return/*#__PURE__*/_jsxs(Stack,{sx:{border:\"1px solid #9a00ed\",borderRadius:\"7px\",padding:\"6px\",position:\"relative\"},className:\"stackVideo\".concat(number),children:[/*#__PURE__*/_jsx(Stack,{sx:{position:\"absolute\",right:6},children:/*#__PURE__*/_jsx(Delete,{onClick:()=>deleteElementsTypeOne(number,\"video\")})}),/*#__PURE__*/_jsx(Typography,{textAlign:\"center\",children:\"Video\"}),/*#__PURE__*/_jsx(\"div\",{className:\"video\".concat(number),style:{display:\"flex\",flexDirection:\"row\",justifyContent:\"center\"},children:valueDefault.length>0&&/*#__PURE__*/_jsxs(\"video\",{controls:\"controls\",style:{width:\"200px\"},children:[/*#__PURE__*/_jsx(\"source\",{src:\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/public/company\").concat(companyId,\"/flow/\").concat(valueDefault),type:\"video/mp4\"}),\"seu navegador n\\xE3o suporta HTML5\"]})}),valueDefault.length===0&&/*#__PURE__*/_jsxs(Button,{variant:\"contained\",component:\"label\",className:\"btnVideo\".concat(number),children:[\"Enviar video\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"video/mp4\",hidden:true,onChange:e=>handleChangeVideos(e,number)})]})]},\"stackVideo\".concat(number));};const messageLayout=function(number){let valueDefault=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"\";return/*#__PURE__*/_jsxs(Stack,{sx:{border:\"1px solid #9a00ed\",borderRadius:\"7px\",padding:\"6px\",position:\"relative\"},className:\"stackMessage\".concat(number),children:[/*#__PURE__*/_jsx(Stack,{sx:{position:\"absolute\",right:6},children:/*#__PURE__*/_jsx(Delete,{onClick:()=>deleteElementsTypeOne(number,\"message\")})}),/*#__PURE__*/_jsx(Typography,{textAlign:\"center\",children:\"Texto\"}),/*#__PURE__*/_jsx(TextField,{label:\"Mensagem\",defaultValue:valueDefault,multiline:true,rows:7,className:\"message\".concat(number),name:\"text\",variant:\"outlined\",margin:\"dense\",style:{width:\"100%\"}})]},\"stackMessage\".concat(number));};const intervalLayout=function(number){let valueDefault=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return/*#__PURE__*/_jsxs(Stack,{sx:{border:\"1px solid #9a00ed\",borderRadius:\"7px\",padding:\"6px\",position:\"relative\"},className:\"stackInterval\".concat(number),children:[/*#__PURE__*/_jsx(Stack,{sx:{position:\"absolute\",right:6},children:/*#__PURE__*/_jsx(Delete,{onClick:()=>deleteElementsTypeOne(number,\"interval\")})}),/*#__PURE__*/_jsx(Typography,{textAlign:\"center\",children:\"Intervalo\"}),/*#__PURE__*/_jsx(TextField,{label:\"Tempo em segundos\",className:\"interval\".concat(number),defaultValue:valueDefault,type:\"number\",InputProps:{inputProps:{min:0,max:120}},variant:\"outlined\",margin:\"dense\",style:{width:\"100%\"}})]},\"stackInterval\".concat(number));};const documentLayout=function(number){let valueDefault=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"\";return/*#__PURE__*/_jsxs(Stack,{sx:{border:\"1px solid #9a00ed\",borderRadius:\"7px\",padding:\"6px\",position:\"relative\"},className:\"stackDocument\".concat(number),children:[/*#__PURE__*/_jsx(Stack,{sx:{position:\"absolute\",right:6},children:/*#__PURE__*/_jsx(Delete,{onClick:()=>deleteElementsTypeOne(number,\"document\")})}),/*#__PURE__*/_jsx(Typography,{textAlign:\"center\",children:\"Documento\"}),/*#__PURE__*/_jsx(\"div\",{className:\"document\".concat(number),style:{display:\"flex\",flexDirection:\"row\",justifyContent:\"center\"},children:valueDefault.length>0?/*#__PURE__*/_jsx(\"embed\",{src:\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/public/company\").concat(companyId,\"/flow/\").concat(valueDefault),type:\"application/pdf\",width:\"200px\",height:\"200px\"}):null}),valueDefault.length===0&&/*#__PURE__*/_jsxs(Button,{variant:\"contained\",component:\"label\",className:\"btnDocument\".concat(number),children:[\"Enviar Documento\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".doc,.docx,.pdf\",hidden:true,onChange:e=>handleChangeDocuments(e,number)})]})]},\"stackDocument\".concat(number));};const handleChangeDocuments=(e,number)=>{if(!e.target.files){return;}if(e.target.files[0].size>10000000){toast.error(\"Arquivo é muito grande! 10MB máximo\");return;}const file=e.target.files[0];const documentBlob=URL.createObjectURL(file);// Verifica se o arquivo é PDF\nconst isPDF=file.type===\"application/pdf\";setPreviewDocs(old=>[...old,{number:number,url:documentBlob,name:file.name}]);const selectedMedias=Array.from(e.target.files);setMedias(old=>[...old,selectedMedias[0]]);if(isPDF){document.querySelector(\".document\".concat(number)).innerHTML=\"\\n        <embed src=\\\"\".concat(documentBlob,\"\\\" type=\\\"application/pdf\\\" width=\\\"200px\\\" height=\\\"200px\\\" />\\n      \");}else{document.querySelector(\".document\".concat(number)).innerHTML=\"\\n        <a href=\\\"\".concat(documentBlob,\"\\\" target=\\\"_blank\\\" rel=\\\"noopener noreferrer\\\">Visualizar Documento</a>\\n      \");}document.querySelector(\".btnDocument\".concat(number)).remove();};useEffect(()=>{const localVariables=localStorage.getItem(\"variables\");if(localVariables){setVariables(JSON.parse(localVariables));}if(open===\"edit\"){setLabels({title:\"Editar conteúdo\",btn:\"Salvar\"});setElementsSeq(data.data.seq);setElementsSeqEdit(data.data.seq);setElementsEdit(data.data.elements);if(data){const elementsEditLoc=data.data.elements;const sequence=data.data.seq;sequence.map(item=>{const itemNode=elementsEditLoc.filter(inode=>inode.number===item)[0];if(itemNode.type===\"message\"){const numberLoc=parseInt(item.replace(\"message\",\"\"));setElements(elm=>[...elm,messageLayout(numberLoc,itemNode.value)]);setNumberMessages(old=>{const arsOnly=sequence.filter(item=>item.includes(\"message\"));const arrNumberMax=arsOnly.map(item=>parseInt(item.replace(\"message\",\"\")));setNumberMessagesLast(Math.max.apply(null,arrNumberMax)+1);return old+1;});}if(itemNode.type===\"interval\"){const numberLoc=parseInt(item.replace(\"interval\",\"\"));setElements(elm=>[...elm,intervalLayout(numberLoc,itemNode.value)]);setNumberInterval(old=>{const arsOnly=sequence.filter(item=>item.includes(\"interval\"));const arrNumberMax=arsOnly.map(item=>parseInt(item.replace(\"interval\",\"\")));setNumberIntervalLast(Math.max.apply(null,arrNumberMax)+1);return old+1;});}if(itemNode.type===\"audio\"){const numberLoc=parseInt(item.replace(\"audio\",\"\"));setElements(elm=>[...elm,audioLayout(numberLoc,itemNode.value,itemNode.record?\"\":\"ok\")]);setNumberAudio(old=>{const arsOnly=sequence.filter(item=>item.includes(\"audio\"));const arrNumberMax=arsOnly.map(item=>parseInt(item.replace(\"audio\",\"\")));setNumberAudioLast(Math.max.apply(null,arrNumberMax)+1);return old+1;});}if(itemNode.type===\"img\"){const numberLoc=parseInt(item.replace(\"img\",\"\"));setElements(elm=>[...elm,imgLayout(numberLoc,itemNode.value)]);setNumberImg(old=>{const arsOnly=sequence.filter(item=>item.includes(\"img\"));const arrNumberMax=arsOnly.map(item=>parseInt(item.replace(\"img\",\"\")));setNumberImgLast(Math.max.apply(null,arrNumberMax)+1);return old+1;});}if(itemNode.type===\"video\"){const numberLoc=parseInt(item.replace(\"video\",\"\"));setElements(elm=>[...elm,videoLayout(numberLoc,itemNode.value)]);setNumberVideo(old=>{const arsOnly=sequence.filter(item=>item.includes(\"video\"));const arrNumberMax=arsOnly.map(item=>parseInt(item.replace(\"video\",\"\")));setNumberVideoLast(Math.max.apply(null,arrNumberMax)+1);return old+1;});}if(itemNode.type===\"document\"){const numberLoc=parseInt(item.replace(\"document\",\"\"));setElements(elm=>[...elm,documentLayout(numberLoc,itemNode.value)]);setNumberDocs(old=>{const arsOnly=sequence.filter(item=>item.includes(\"document\"));const arrNumberMax=arsOnly.map(item=>parseInt(item.replace(\"document\",\"\")));setNumberDocLast(Math.max.apply(null,arrNumberMax)+1);return old+1;});}});}setActiveModal(true);}if(open===\"create\"){setLabels({title:\"Adicionar menu ao fluxo\",btn:\"Adicionar\"});setTextDig();setArrayOption([]);setActiveModal(true);}},[open]);useEffect(()=>{return()=>{isMounted.current=false;};},[]);const handleClose=async()=>{close(null);setActiveModal(false);setTimeout(()=>{setMedias([]);setPreviewImg([]);setPreviewAudios([]);setPreviewVideos([]);setArrayOption([]);setElements([]);setElementsSeq([]);setElementsEdit([]);setElementsSeqEdit([]);setNumberMessages(0);setNumberMessagesLast(0);setNumberInterval(0);setNumberIntervalLast(0);setNumberAudio(0);setNumberAudioLast(0);setNumberVideo(0);setNumberVideoLast(0);setNumberImg(0);setNumberImgLast(0);},500);};const verifyButtonsUpload=()=>{const newArrImg=elementsSeq.filter(item=>item.includes(\"img\"));const newArrAudio=elementsSeq.filter(item=>item.includes(\"audio\"));const newArrVideo=elementsSeq.filter(item=>item.includes(\"video\"));const newArrDocs=elementsSeq.filter(item=>item.includes(\"document\"));for(let i=0;i<numberImg;i++){const imgVerify=document.querySelector(\".btn\".concat(capitalize(newArrImg[i])));if(imgVerify){return true;}}for(let i=0;i<numberAudio;i++){const audioVerify=document.querySelector(\".btn\".concat(capitalize(newArrAudio[i])));if(audioVerify){return true;}}for(let i=0;i<numberVideo;i++){const videoVerify=document.querySelector(\".btn\".concat(capitalize(newArrVideo[i])));if(videoVerify){return true;}}for(let i=0;i<numberDocs;i++){const docVerify=document.querySelector(\".btnDocument\".concat(i));if(docVerify){return true;}}};const handleSaveNode=async()=>{if(open===\"edit\"){setLoading(true);const formData=new FormData();medias.forEach(async(media,idx)=>{const file=media;if(!file){return;}if((media===null||media===void 0?void 0:media.type.split(\"/\")[0])===\"image\"){formData.append(\"typeArch\",\"flow\");formData.append(\"medias\",file);formData.append(\"body\",file.name);}else if((media===null||media===void 0?void 0:media.type.split(\"/\")[0])===\"audio\"){formData.append(\"typeArch\",\"flow\");formData.append(\"medias\",file);formData.append(\"body\",file.name);}else if((media===null||media===void 0?void 0:media.type.split(\"/\")[0])===\"video\"){formData.append(\"typeArch\",\"flow\");formData.append(\"medias\",file);formData.append(\"body\",file.name);}else if((media===null||media===void 0?void 0:media.type.split(\"/\")[0])===\"application\"||(media===null||media===void 0?void 0:media.type.split(\"/\")[1])===\"document\"||(media===null||media===void 0?void 0:media.type.split(\"/\")[1])===\"pdf\"){formData.append(\"typeArch\",\"flow\");formData.append(\"medias\",file);formData.append(\"body\",file.name);}else{formData.append(\"typeArch\",\"flow\");formData.append(\"medias\",file);formData.append(\"body\",file.name);}});setTimeout(async()=>{if(numberAudio===0&&numberVideo===0&&numberImg===0&&numberDocs===0||medias.length===0){try{const mountData={seq:elementsSeq,elements:handleElements(null)};onUpdate(_objectSpread(_objectSpread({},data),{},{data:mountData}));toast.success(\"Conteúdo adicionada com sucesso!\");handleClose();setLoading(false);return;}catch(e){console.log(\"error1\",e);setLoading(false);handleClose();}return;}const verify=verifyButtonsUpload();if(verify){setLoading(false);return toast.error(\"Delete os cards vazios(Imagem, Audio e Video)\");}await api.post(\"/flowbuilder/content\",formData).then(async res=>{const mountData={seq:elementsSeq,elements:handleElements(res.data)};onUpdate(_objectSpread(_objectSpread({},data),{},{data:mountData}));toast.success(\"Conteúdo adicionada com sucesso!\");handleClose();setLoading(false);}).catch(error=>{console.log(\"error2\",error);handleClose();setLoading(false);});},1500);}else if(open===\"create\"){setLoading(true);const formData=new FormData();medias.forEach(async(media,idx)=>{const file=media;if(!file){return;}if((media===null||media===void 0?void 0:media.type.split(\"/\")[0])===\"image\"){formData.append(\"typeArch\",\"flow\");formData.append(\"medias\",media);formData.append(\"body\",media.name);}else if((media===null||media===void 0?void 0:media.type.split(\"/\")[0])===\"audio\"){formData.append(\"typeArch\",\"flow\");formData.append(\"medias\",media);formData.append(\"body\",media.name);}else if((media===null||media===void 0?void 0:media.type.split(\"/\")[0])===\"video\"){formData.append(\"typeArch\",\"flow\");formData.append(\"medias\",media);formData.append(\"body\",media.name);}else if((media===null||media===void 0?void 0:media.type.split(\"/\")[0])===\"application\"||(media===null||media===void 0?void 0:media.type.split(\"/\")[1])===\"document\"||(media===null||media===void 0?void 0:media.type.split(\"/\")[1])===\"pdf\"){formData.append(\"typeArch\",\"flow\");formData.append(\"medias\",media);formData.append(\"body\",media.name);}else{formData.append(\"typeArch\",\"flow\");formData.append(\"medias\",media);formData.append(\"body\",media.name);}});setTimeout(async()=>{if(numberAudio===0&&numberVideo===0&&numberImg===0&&numberDocs===0){try{const mountData={seq:elementsSeq,elements:handleElements(null)};onSave(_objectSpread({},mountData));toast.success(\"Conteúdo adicionada com sucesso!\");handleClose();setLoading(false);return;}catch(e){console.log(\"error3\",e);setLoading(false);handleClose();}}const verify=verifyButtonsUpload();if(verify){setLoading(false);return toast.error(\"Delete os cards vazios(Imagem, Audio e Video)\");}await api.post(\"/flowbuilder/content\",formData).then(res=>{const mountData={seq:elementsSeq,elements:handleElements(res.data)};onSave(_objectSpread({},mountData));toast.success(\"Conteúdo adicionada com sucesso!\");handleClose();setLoading(false);}).catch(error=>{console.log(\"error4\",error);setLoading(false);handleClose();});},1500);}};const scrollToBottom=className=>{const element=document.querySelector(className);element.scrollTop=element.scrollHeight;};const variableFormatter=item=>{return\"{{\"+item+\"}}\";};return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Dialog,{open:activeModal,fullWidth:\"lg\",scroll:\"paper\",children:[!loading&&/*#__PURE__*/_jsx(DialogTitle,{id:\"form-dialog-title\",children:\"Adicionar conte\\xFAdo ao fluxo\"}),/*#__PURE__*/_jsxs(Stack,{children:[/*#__PURE__*/_jsxs(Stack,{className:\"body-card\",style:{gap:\"8px\",padding:\"16px\",overflow:\"auto\",height:\"70vh\",scrollBehavior:\"smooth\",display:loading&&\"none\"},children:[elements.map(item=>/*#__PURE__*/_jsx(_Fragment,{children:item})),/*#__PURE__*/_jsxs(Stack,{direction:\"row\",gap:1,children:[/*#__PURE__*/_jsxs(Button,{variant:\"contained\",color:\"primary\",onClick:()=>{setElements(old=>[...old,messageLayout(numberMessagesLast)]);setNumberMessages(old=>{setElementsSeq(oldEleme=>[...oldEleme,\"message\".concat(numberMessagesLast)]);return old+1;});setNumberMessagesLast(old=>old+1);setTimeout(()=>{scrollToBottom(\".body-card\");},100);},children:[/*#__PURE__*/_jsx(Message,{sx:{width:\"16px\",height:\"16px\",marginRight:\"4px\"}}),\"Texto\"]}),/*#__PURE__*/_jsxs(Button,{variant:\"contained\",color:\"primary\",onClick:()=>{setElements(old=>[...old,intervalLayout(numberIntervalLast)]);setNumberInterval(old=>{setElementsSeq(oldEleme=>[...oldEleme,\"interval\".concat(numberIntervalLast)]);return old+1;});setNumberIntervalLast(old=>old+1);setTimeout(()=>{scrollToBottom(\".body-card\");},100);},children:[/*#__PURE__*/_jsx(AccessTime,{sx:{width:\"16px\",height:\"16px\",marginRight:\"4px\"}}),\"Intervalo\"]}),/*#__PURE__*/_jsxs(Button,{variant:\"contained\",color:\"primary\",onClick:()=>{setElements(old=>[...old,imgLayout(numberImgLast)]);setNumberImg(old=>{setElementsSeq(oldEleme=>[...oldEleme,\"img\".concat(numberImgLast)]);return old+1;});setNumberImgLast(old=>old+1);setTimeout(()=>{scrollToBottom(\".body-card\");},100);},children:[/*#__PURE__*/_jsx(Image,{sx:{width:\"16px\",height:\"16px\",marginRight:\"4px\"}}),\"Imagem\"]}),/*#__PURE__*/_jsxs(Button,{variant:\"contained\",color:\"primary\",onClick:()=>{setElements(old=>[...old,audioLayout(numberAudioLast)]);setNumberAudio(old=>{setElementsSeq(oldEleme=>[...oldEleme,\"audio\".concat(numberAudioLast)]);return old+1;});setNumberAudioLast(old=>old+1);setTimeout(()=>{scrollToBottom(\".body-card\");},100);},children:[/*#__PURE__*/_jsx(MicNone,{sx:{width:\"16px\",height:\"16px\",marginRight:\"4px\"}}),\"Audio\"]}),/*#__PURE__*/_jsxs(Button,{variant:\"contained\",color:\"primary\",onClick:()=>{setElements(old=>[...old,videoLayout(numberVideoLast)]);setNumberVideo(old=>{setElementsSeq(oldEleme=>[...oldEleme,\"video\".concat(numberVideoLast)]);return old+1;});setNumberVideoLast(old=>old+1);setTimeout(()=>{scrollToBottom(\".body-card\");},100);},children:[/*#__PURE__*/_jsx(Videocam,{sx:{width:\"16px\",height:\"16px\",marginRight:\"4px\"}}),\"Video\"]}),/*#__PURE__*/_jsxs(Button,{variant:\"contained\",color:\"primary\",onClick:()=>{setElements(old=>[...old,documentLayout(numberDocLast)]);setNumberDocs(old=>{setElementsSeq(oldEleme=>[...oldEleme,\"document\".concat(numberDocLast)]);return old+1;});setNumberDocLast(old=>old+1);setTimeout(()=>{scrollToBottom(\".body-card\");},100);},children:[/*#__PURE__*/_jsx(InsertDriveFile,{sx:{width:\"16px\",height:\"16px\",marginRight:\"4px\"}}),\"Documento\"]})]}),/*#__PURE__*/_jsxs(Box,{style:{width:\"100%\",textAlign:\"center\"},children:[/*#__PURE__*/_jsx(\"div\",{className:\"shadow- py-2 font-bold bg-blue-900 rounded text-white\",children:\"Vari\\xE1veis\"}),variables&&/*#__PURE__*/_jsx(\"div\",{className:\"w-full  max-h-full overflow-y-auto space-y-2 py-2\",children:variables.map(item=>/*#__PURE__*/_jsx(\"div\",{className:\"rounded border-2 border-dashed border-zinc-800\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-zinc-600\",children:variableFormatter(item)})}))})]})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleClose,color:\"secondary\",variant:\"outlined\",style:{display:loading&&\"none\"},children:i18n.t(\"contactModal.buttons.cancel\")}),/*#__PURE__*/_jsx(Button,{type:\"submit\",color:\"primary\",variant:\"contained\",onClick:()=>handleSaveNode(),style:{display:loading&&\"none\"},children:\"\".concat(labels.btn)})]})]}),loading&&/*#__PURE__*/_jsx(Stack,{style:{gap:\"8px\",padding:\"16px\",height:\"70vh\",alignSelf:\"center\",justifyContent:\"center\"},children:/*#__PURE__*/_jsxs(Stack,{children:[/*#__PURE__*/_jsx(Typography,{children:\"Subindo os arquivos e criando o conte\\xFAdo...\"}),/*#__PURE__*/_jsx(Stack,{style:{alignSelf:\"center\",marginTop:\"12px\"},children:/*#__PURE__*/_jsx(CircularProgress,{})})]})})]})});};export default FlowBuilderSingleBlockModal;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}