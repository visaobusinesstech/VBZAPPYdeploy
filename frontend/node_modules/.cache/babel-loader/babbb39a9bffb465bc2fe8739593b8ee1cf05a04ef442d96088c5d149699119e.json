{"ast":null,"code":"import _objectSpread from\"/home/deploy/codigologlow/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{Button,ClickAwayListener,FormControl,IconButton,Input,InputAdornment,makeStyles,Paper,Typography,Avatar,Dialog,DialogTitle,DialogContent,DialogActions,TextField,List,ListItem,ListItemText}from\"@material-ui/core\";import MoodIcon from\"@material-ui/icons/Mood\";import SendIcon from\"@material-ui/icons/Send\";import{Picker}from\"emoji-mart\";import\"emoji-mart/css/emoji-mart.css\";import React,{Fragment,useContext,useEffect,useRef,useState}from\"react\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{useDate}from\"../../hooks/useDate\";import api from\"../../services/api\";import{i18n}from\"../../translate/i18n\";import{GetApp}from\"@mui/icons-material\";import AttachFileIcon from\"@mui/icons-material/AttachFile\";import CancelIcon from\"@mui/icons-material/Cancel\";import CheckCircleOutlineIcon from\"@mui/icons-material/CheckCircleOutline\";import HighlightOffIcon from\"@mui/icons-material/HighlightOff\";import MicIcon from\"@mui/icons-material/Mic\";import CircularProgress from\"@mui/material/CircularProgress\";import{green}from\"@mui/material/colors\";import MicRecorder from\"mic-recorder-to-mp3\";import MarkdownWrapper from\"../../components/MarkdownWrapper\";import RecordingTimer from\"../../components/MessageInput/RecordingTimer\";import ModalImageCors from\"../../components/ModalImageCors\";import toastError from\"../../errors/toastError\";import AudioModal from\"../../components/AudioModal\";import DocumentModal from\"../../components/DocumentModal\";import whatsBackground from\"../../assets/wa-background.png\";import whatsBackgroundDark from\"../../assets/wa-background-dark.png\";import{format,isSameDay,parseISO}from\"date-fns\";import ReplyIcon from\"@mui/icons-material/Reply\";import CloseIcon from\"@mui/icons-material/Close\";import EditIcon from\"@mui/icons-material/Edit\";import DeleteIcon from\"@mui/icons-material/Delete\";import ForwardIcon from\"@mui/icons-material/Forward\";import IosShareIcon from\"@mui/icons-material/IosShare\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({mainContainer:{display:\"flex\",flexDirection:\"column\",position:\"relative\",flex:1,overflow:\"hidden\",borderRadius:0,height:\"100%\",borderLeft:\"1px solid rgba(0, 0, 0, 0.12)\"},messageList:_objectSpread(_objectSpread({position:\"relative\",overflowY:\"auto\",height:\"100%\"},theme.scrollbarStyles),{},{backgroundImage:theme.mode===\"light\"?\"url(\".concat(whatsBackground,\")\"):\"url(\".concat(whatsBackgroundDark,\")\"),backgroundColor:theme.mode===\"light\"?\"transparent\":\"#0b0b0d\"}),inputArea:{position:\"relative\",height:\"auto\"},input:{padding:\"20px\"},buttonSend:{margin:theme.spacing(1)},messageContainer:{display:\"flex\",margin:\"10px\",alignItems:\"center\"},messageContainerSelf:{display:\"flex\",margin:\"10px\",alignItems:\"center\",justifyContent:\"flex-end\"},messageContainerWithAvatar:{display:\"flex\",margin:\"10px\",alignItems:\"flex-start\"},avatarContainer:{marginRight:10,display:\"flex\",alignItems:\"center\",alignSelf:\"center\"},messageBubble:{padding:\"15px\",position:\"relative\",backgroundColor:\"#ffffff\",color:\"#303030\",maxWidth:350,width:\"100%\",borderRadius:20,border:\"1px solid rgba(0, 0, 0, 0.12)\"},messageBubbleSelf:{padding:\"15px\",position:\"relative\",backgroundColor:\"#dcf8c6\",color:\"#303030\",maxWidth:350,width:\"100%\",borderRadius:20,border:\"1px solid rgba(0, 0, 0, 0.12)\"},bubbleContent:{marginTop:5,whiteSpace:\"pre-wrap\",wordBreak:\"break-word\",overflowWrap:\"break-word\"},senderInfo:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",marginBottom:5},senderName:{fontWeight:\"bold\"},sendMessageIcons:{color:\"grey\"},uploadInput:{display:\"none\"},circleLoading:{color:green[500],opacity:\"70%\",position:\"absolute\",top:\"20%\",left:\"50%\",marginLeft:-12},viewMediaInputWrapper:{display:\"flex\",padding:\"10px 13px\",position:\"relative\",justifyContent:\"space-between\",alignItems:\"center\",backgroundColor:\"#eee\",borderTop:\"1px solid rgba(0, 0, 0, 0.12)\"},downloadMedia:{display:\"flex\",alignItems:\"center\",justifyContent:\"center\",backgroundColor:\"inherit\",padding:10},messageMedia:{objectFit:\"cover\",width:250,height:200,borderTopLeftRadius:8,borderTopRightRadius:8,borderBottomLeftRadius:8,borderBottomRightRadius:8},recorderWrapper:{display:\"flex\",alignItems:\"center\",alignContent:\"middle\",justifyContent:\"flex-end\"},cancelAudioIcon:{color:\"red\"},audioLoading:{color:green[500],opacity:\"70%\"},sendAudioIcon:{color:\"green\"},messageDate:{fontSize:\"0.75rem\",color:\"#666\",marginTop:5},emojiBox:{position:\"absolute\",bottom:63,left:10,zIndex:1000},sendMessageIcons:{color:\"grey\"},dailyTimestampText:{color:\"#808888\",padding:8,textAlign:\"center\",width:\"100%\",display:\"block\",margin:\"0 auto\"},replyContainer:{display:\"flex\",alignItems:\"center\",padding:\"8px 16px\",backgroundColor:\"#f0f2f5\",borderTop:\"1px solid rgba(0, 0, 0, 0.12)\"},replyContent:{flex:1,marginLeft:8},replyText:{fontSize:\"0.875rem\",color:\"#666\",whiteSpace:\"nowrap\",overflow:\"hidden\",textOverflow:\"ellipsis\"},replySender:{fontSize:\"0.75rem\",color:\"#999\"},messageActions:{display:\"flex\",gap:4,marginLeft:8},replyPreview:{borderLeft:\"3px solid #128C7E\",paddingLeft:\"8px\",marginBottom:\"8px\",backgroundColor:\"rgba(0, 0, 0, 0.05)\",borderRadius:\"4px\",padding:\"4px 8px\"},replyPreviewSender:{fontSize:\"0.75rem\",color:\"#128C7E\",fontWeight:\"bold\"},replyPreviewText:{fontSize:\"0.75rem\",color:\"#666\",whiteSpace:\"nowrap\",overflow:\"hidden\",textOverflow:\"ellipsis\"},dailyTimestamp:{width:\"100%\",display:\"block\"},highlightedMessage:{backgroundColor:\"#ffe082\",transition:\"background 0.5s\"},forwardedMessage:{// borderLeft: \"3px solid #128C7E\",\n// paddingLeft: \"8px\",\n// marginBottom: \"8px\",\n// backgroundColor: \"rgba(0, 0, 0, 0.05)\",\n// borderRadius: \"4px\",\n// padding: \"4px 8px\",\n},forwardedMessageHeader:{display:\"flex\",alignItems:\"center\",gap:\"4px\",color:\"#999\",fontSize:\"0.75rem\",marginBottom:\"4px\"},forwardedMessageText:{// fontSize: \"0.875rem\",\n// color: \"#666\",\n}}));const Mp3Recorder=new MicRecorder({bitRate:128});export default function ChatMessages(_ref){var _medias$;let{chat,messages,handleSendMessage,handleLoadMore,scrollToBottomRef,pageInfo,loadingMore,onEdit,onDelete,onForward,// messageListRef,\n// isFirstPage,\njustOpenedChat,setJustOpenedChat,addOptimisticMessage}=_ref;const topRef=useRef(null);const classes=useStyles();const{user}=useContext(AuthContext);const{datetimeToClient}=useDate();const baseRef=useRef();const messageRefs=useRef({});const[contentMessage,setContentMessage]=useState(\"\");const[medias,setMedias]=useState([]);const[loading,setLoading]=useState(false);const[recording,setRecording]=useState(false);const[showEmoji,setShowEmoji]=useState(false);const inputRef=useRef();const[replyingTo,setReplyingTo]=useState(null);const[initialScrollDone,setInitialScrollDone]=useState(false);const[canLoadMore,setCanLoadMore]=useState(false);const scrollToBottom=()=>{if(baseRef.current){baseRef.current.scrollIntoView({});}};const unreadMessages=chat=>{if(chat&&chat.users&&Array.isArray(chat.users)){const currentUser=chat.users.find(u=>u.userId===user.id);return currentUser&&currentUser.unreads>0;}return false;};useEffect(()=>{if(justOpenedChat){setInitialScrollDone(false);}},[justOpenedChat]);useEffect(()=>{if(chat&&chat.id&&unreadMessages(chat)){try{api.post(\"/chats/\".concat(chat.id,\"/read\"),{userId:user.id});}catch(err){console.error(\"Erro ao marcar mensagens como lidas:\",err);}}scrollToBottomRef.current=scrollToBottom;// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(()=>{if(!messages||messages.length===0||loadingMore||initialScrollDone)return;const scrollToBottomSafely=()=>{requestAnimationFrame(()=>{setTimeout(()=>{const container=document.querySelector(\".messageList\");if(container){container.scrollTop=container.scrollHeight;setInitialScrollDone(true);}},100);// Aumentar o timeout para dar tempo das mensagens renderizarem\n});};scrollToBottomSafely();},[messages,loadingMore,initialScrollDone]);// Após o scroll automático inicial, liberar o carregamento incremental\nuseEffect(()=>{if(!loading&&!loadingMore&&initialScrollDone){setCanLoadMore(true);}},[loading,loadingMore,initialScrollDone]);// Adicionar um useEffect separado para quando justOpenedChat muda\nuseEffect(()=>{if(justOpenedChat&&messages&&messages.length>0){const scrollToBottomSafely=()=>{requestAnimationFrame(()=>{setTimeout(()=>{const container=document.querySelector(\".messageList\");if(container){container.scrollTop=container.scrollHeight;setJustOpenedChat(false);// Resetar após executar o scroll\n}},200);// Timeout maior para garantir que tudo foi renderizado\n});};scrollToBottomSafely();}},[justOpenedChat,messages]);const handleScroll=e=>{if(!initialScrollDone||!canLoadMore)return;const{scrollTop,scrollHeight,clientHeight}=e.currentTarget;if(!(pageInfo!==null&&pageInfo!==void 0&&pageInfo.hasMore)||loading)return;if(scrollTop<200){console.log(\"Carregando mais mensagens... ScrollTop:\",scrollTop);handleLoadMore();}};const handleChangeMedias=e=>{if(!e.target.files){return;}const selectedMedias=Array.from(e.target.files);setMedias(selectedMedias);};const handlePaste=e=>{if(e.clipboardData.files.length>0){const selectedMedias=Array.from(e.clipboardData.files);setMedias(selectedMedias);e.preventDefault();}};const handleAddEmoji=e=>{let emoji=e.native;setContentMessage(prevState=>prevState+emoji);inputRef.current.focus();};const[documentModalOpen,setDocumentModalOpen]=useState(false);const[selectedDocument,setSelectedDocument]=useState(null);const checkMessageMedia=message=>{if(message.mediaType===\"image\"){return/*#__PURE__*/_jsx(ModalImageCors,{imageUrl:message.mediaPath});}if(message.mediaType===\"audio\"){return/*#__PURE__*/_jsx(AudioModal,{url:message.mediaPath,message:message,disableTranscription:!chat.isGroup});}if(message.mediaType===\"video\"){return/*#__PURE__*/_jsx(\"video\",{className:classes.messageMedia,src:message.mediaPath,controls:true});}else{return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:classes.downloadMedia,children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(GetApp,{}),color:\"primary\",variant:\"outlined\",onClick:()=>{setSelectedDocument(message);setDocumentModalOpen(true);},children:\"Visualizar Documento\"})})});}};const handleSendMedia=async e=>{setLoading(true);e.preventDefault();const formData=new FormData();formData.append(\"fromMe\",true);medias.forEach(media=>{formData.append(\"typeArch\",\"chat\");formData.append(\"fileId\",chat.id);formData.append(\"medias\",media);formData.append(\"body\",media.name);});try{await api.post(\"/chats/\".concat(chat.id,\"/messages\"),formData);}catch(err){console.log(err);toastError(err);}setLoading(false);setMedias([]);};const handleStartRecording=async()=>{setLoading(true);try{await navigator.mediaDevices.getUserMedia({audio:true});await Mp3Recorder.start();setRecording(true);setLoading(false);}catch(err){toastError(err);setLoading(false);}};const handleUploadAudio=async()=>{setLoading(true);try{const[,blob]=await Mp3Recorder.stop().getMp3();if(blob.size<10000){setLoading(false);setRecording(false);return;}const formData=new FormData();const filename=\"audio-\".concat(new Date().getTime(),\".mp3\");formData.append(\"typeArch\",\"chat\");formData.append(\"fileId\",chat.id);formData.append(\"medias\",blob,filename);formData.append(\"body\",filename);formData.append(\"fromMe\",true);await api.post(\"/chats/\".concat(chat.id,\"/messages\"),formData);}catch(err){toastError(err);}setRecording(false);setLoading(false);};const handleCancelAudio=async()=>{try{await Mp3Recorder.stop().getMp3();setRecording(false);}catch(err){toastError(err);}};const handleReply=message=>{setReplyingTo(message);if(inputRef.current){inputRef.current.focus();}};const handleCancelReply=()=>{setReplyingTo(null);};const handleSendMessageWithReply=async content=>{if(content.trim()!==\"\"){// Adicione a mensagem localmente de forma otimista\nconst optimisticMessage={id:\"temp-\".concat(Date.now()),chatId:chat.id,senderId:user.id,message:content,createdAt:new Date().toISOString(),sender:{id:user.id,name:user.name,profileImage:user.profileImage},replyTo:replyingTo,isDeleted:false,isEdited:false,mediaType:\"text\"};addOptimisticMessage(optimisticMessage);setContentMessage(\"\");setReplyingTo(null);await api.post(\"/chats/\".concat(chat.id,\"/messages\"),{message:content,replyToId:replyingTo===null||replyingTo===void 0?void 0:replyingTo.id});// O socket vai substituir a mensagem otimista pela real depois\n}};const handleKeyPress=e=>{if(e.key===\"Enter\"&&!e.shiftKey&&contentMessage.trim()!==\"\"){handleSendMessageWithReply(contentMessage);}};const handleSendClick=()=>{if(contentMessage.trim()!==\"\"){handleSendMessageWithReply(contentMessage);}};const handleEdit=message=>{onEdit(message);};const handleDelete=message=>{onDelete(message);};const handleForward=message=>{onForward(message);};const renderDailyTimestamps=(message,index,messagesList,lastMessageRef,classes)=>{const today=format(new Date(),\"dd/MM/yyyy\");if(index===0){return/*#__PURE__*/_jsx(\"span\",{className:classes.dailyTimestamp,children:/*#__PURE__*/_jsx(\"div\",{className:classes.dailyTimestampText,children:today===format(parseISO(messagesList[index].createdAt),\"dd/MM/yyyy\")?\"HOJE\":format(parseISO(messagesList[index].createdAt),\"dd/MM/yyyy\")})},\"timestamp-\".concat(message.id));}else if(index<messagesList.length-1){let messageDay=parseISO(messagesList[index].createdAt);let previousMessageDay=parseISO(messagesList[index-1].createdAt);if(!isSameDay(messageDay,previousMessageDay)){return/*#__PURE__*/_jsx(\"span\",{className:classes.dailyTimestamp,children:/*#__PURE__*/_jsx(\"div\",{className:classes.dailyTimestampText,children:today===format(parseISO(messagesList[index].createdAt),\"dd/MM/yyyy\")?\"HOJE\":format(parseISO(messagesList[index].createdAt),\"dd/MM/yyyy\")})},\"timestamp-\".concat(message.id));}}else if(index===messagesList.length-1){return/*#__PURE__*/_jsx(\"div\",{ref:lastMessageRef,style:{float:\"left\",clear:\"both\"}},\"ref-\".concat(message.id));}};const scrollToMessage=messageId=>{const el=messageRefs.current[messageId];if(el){el.scrollIntoView({behavior:\"smooth\",block:\"center\"});el.classList.add(classes.highlightedMessage);setTimeout(()=>el.classList.remove(classes.highlightedMessage),1500);}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Paper,{className:classes.paper,style:{display:\"flex\",flexDirection:\"column\",height:\"100%\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"messageList \".concat(classes.messageList),onScroll:handleScroll,style:{flex:1,minHeight:0},children:[/*#__PURE__*/_jsx(\"div\",{ref:topRef,style:{height:1}}),loadingMore&&/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",justifyContent:\"center\",padding:\"10px\",position:\"sticky\",top:0,backgroundColor:\"rgba(255, 255, 255, 0.9)\",zIndex:1},children:[/*#__PURE__*/_jsx(CircularProgress,{size:20}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",style:{marginLeft:8,alignSelf:\"center\"},children:\"Carregando mensagens antigas...\"})]}),Array.isArray(messages)&&messages.map((item,key)=>{if(!item)return null;const repliedMessage=item.replyTo;return/*#__PURE__*/_jsxs(React.Fragment,{children:[renderDailyTimestamps(item,key,messages,baseRef,classes),/*#__PURE__*/_jsx(\"div\",{ref:el=>messageRefs.current[item.id]=el,className:item.senderId===user.id?classes.messageContainerSelf:classes.messageContainer,onDoubleClick:()=>handleReply(item),title:\"Clique duas vezes para responder\",children:item.senderId===user.id?/*#__PURE__*/_jsxs(\"div\",{className:classes.messageBubbleSelf,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.senderInfo,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle2\",className:classes.senderName,children:[item.sender&&item.sender.name?item.sender.name:\"Usuário\",\" \",\"- \",format(new Date(item.createdAt),\"HH:mm\")]}),/*#__PURE__*/_jsx(\"div\",{className:classes.messageActions,children:(!item.isDeleted||user.profile===\"admin\")&&/*#__PURE__*/_jsxs(_Fragment,{children:[item.senderId===user.id&&!item.isDeleted&&// Regra: só pode editar em até 10 minutos\nnew Date()-new Date(item.createdAt)<10*60*1000&&/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleEdit(item),title:i18n.t(\"chatMessages.edit\"),children:/*#__PURE__*/_jsx(EditIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleDelete(item),title:i18n.t(\"chatMessages.delete\"),children:/*#__PURE__*/_jsx(DeleteIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleForward(item),title:i18n.t(\"chatMessages.forward\"),children:/*#__PURE__*/_jsx(ForwardIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleReply(item),title:i18n.t(\"chatMessages.reply\"),children:/*#__PURE__*/_jsx(ReplyIcon,{fontSize:\"small\"})})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.bubbleContent,children:item.isDeleted&&user.profile!==\"admin\"?/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",style:{fontStyle:\"italic\"},children:i18n.t(\"chatMessages.deleted\")}):item.isDeleted&&user.profile===\"admin\"?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"caption\",style:{color:\"#888\",fontStyle:\"italic\",display:\"block\",marginBottom:4},children:i18n.t(\"chatMessages.deletedAdmin\")}),item.mediaPath&&checkMessageMedia(item),/*#__PURE__*/_jsx(MessageWithLineBreaks,{text:item.message,replyTo:repliedMessage,scrollToMessage:scrollToMessage,forwardedFrom:item.forwardedFrom,checkMessageMedia:checkMessageMedia})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[item.mediaPath&&checkMessageMedia(item),/*#__PURE__*/_jsx(MessageWithLineBreaks,{text:item.message,replyTo:repliedMessage,scrollToMessage:scrollToMessage,forwardedFrom:item.forwardedFrom,checkMessageMedia:checkMessageMedia})]})})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:classes.avatarContainer,children:/*#__PURE__*/_jsx(Avatar,{src:item.sender&&item.sender.profileImage?\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/public/company\").concat(item.companyId,\"/user/\").concat(item.sender.profileImage):undefined,alt:item.sender&&item.sender.name?item.sender.name:\"Usuário\",children:(!item.sender||!item.sender.profileImage)&&(item.sender&&item.sender.name?item.sender.name.charAt(0):\"?\")})}),/*#__PURE__*/_jsxs(\"div\",{className:classes.messageBubble,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.senderInfo,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle2\",className:classes.senderName,children:[item.sender&&item.sender.name?item.sender.name:\"Usuário\",\" \",\"- \",format(new Date(item.createdAt),\"HH:mm\")]}),/*#__PURE__*/_jsx(\"div\",{className:classes.messageActions,children:(!item.isDeleted||user.profile===\"admin\")&&/*#__PURE__*/_jsxs(_Fragment,{children:[item.senderId===user.id&&!item.isDeleted&&// Regra: só pode editar em até 10 minutos\nnew Date()-new Date(item.createdAt)<10*60*1000&&/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleEdit(item),title:i18n.t(\"chatMessages.edit\"),children:/*#__PURE__*/_jsx(EditIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleDelete(item),title:i18n.t(\"chatMessages.delete\"),children:/*#__PURE__*/_jsx(DeleteIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleForward(item),title:i18n.t(\"chatMessages.forward\"),children:/*#__PURE__*/_jsx(ForwardIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleReply(item),title:i18n.t(\"chatMessages.reply\"),children:/*#__PURE__*/_jsx(ReplyIcon,{fontSize:\"small\"})})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.bubbleContent,children:item.isDeleted&&user.profile!==\"admin\"?/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",style:{fontStyle:\"italic\"},children:i18n.t(\"chatMessages.deleted\")}):item.isDeleted&&user.profile===\"admin\"?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"caption\",style:{color:\"#888\",fontStyle:\"italic\",display:\"block\",marginBottom:4},children:i18n.t(\"chatMessages.deletedAdmin\")}),item.mediaPath&&checkMessageMedia(item),/*#__PURE__*/_jsx(MessageWithLineBreaks,{text:item.message,replyTo:repliedMessage,scrollToMessage:scrollToMessage,forwardedFrom:item.forwardedFrom,checkMessageMedia:checkMessageMedia})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[item.mediaPath&&checkMessageMedia(item),/*#__PURE__*/_jsx(MessageWithLineBreaks,{text:item.message,replyTo:repliedMessage,scrollToMessage:scrollToMessage,forwardedFrom:item.forwardedFrom,checkMessageMedia:checkMessageMedia})]})})]})]})})]},key);}),/*#__PURE__*/_jsx(\"div\",{ref:baseRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.inputArea,style:{flexShrink:0},children:[replyingTo&&/*#__PURE__*/_jsxs(\"div\",{className:classes.replyContainer,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.replyContent,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.replySender,children:[i18n.t(\"chatMessages.replyingTo\"),\" \",replyingTo.sender.name]}),/*#__PURE__*/_jsx(\"div\",{className:classes.replyText,children:replyingTo.message})]}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:handleCancelReply,children:/*#__PURE__*/_jsx(CloseIcon,{fontSize:\"small\"})})]}),/*#__PURE__*/_jsx(FormControl,{variant:\"outlined\",fullWidth:true,children:recording?/*#__PURE__*/_jsxs(\"div\",{className:classes.recorderWrapper,children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"cancelRecording\",component:\"span\",fontSize:\"large\",disabled:loading,onClick:handleCancelAudio,size:\"large\",children:/*#__PURE__*/_jsx(HighlightOffIcon,{className:classes.cancelAudioIcon})}),loading?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(CircularProgress,{className:classes.audioLoading})}):/*#__PURE__*/_jsx(RecordingTimer,{}),/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"sendRecordedAudio\",component:\"span\",onClick:handleUploadAudio,disabled:loading,size:\"large\",children:/*#__PURE__*/_jsx(CheckCircleOutlineIcon,{className:classes.sendAudioIcon})})]}):/*#__PURE__*/_jsx(_Fragment,{children:medias.length>0?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Paper,{elevation:0,square:true,className:classes.viewMediaInputWrapper,children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"cancel-upload\",component:\"span\",onClick:e=>setMedias([]),size:\"large\",children:/*#__PURE__*/_jsx(CancelIcon,{className:classes.sendMessageIcons})}),loading?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(CircularProgress,{className:classes.circleLoading})}):/*#__PURE__*/_jsx(\"span\",{children:(_medias$=medias[0])===null||_medias$===void 0?void 0:_medias$.name}),/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"send-upload\",component:\"span\",onClick:handleSendMedia,disabled:loading,size:\"large\",children:/*#__PURE__*/_jsx(SendIcon,{className:classes.sendMessageIcons})})]})}):/*#__PURE__*/_jsx(Fragment,{children:/*#__PURE__*/_jsx(Input,{inputRef:inputRef,multiline:true,value:contentMessage,onKeyUp:handleKeyPress,onChange:e=>setContentMessage(e.target.value),onPaste:handlePaste,className:classes.input,startAdornment:/*#__PURE__*/_jsxs(InputAdornment,{position:\"start\",children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"emojiPicker\",component:\"span\",disabled:loading,onClick:e=>setShowEmoji(prevState=>!prevState),children:/*#__PURE__*/_jsx(MoodIcon,{className:classes.sendMessageIcons})}),showEmoji?/*#__PURE__*/_jsx(\"div\",{className:classes.emojiBox,children:/*#__PURE__*/_jsx(ClickAwayListener,{onClickAway:e=>setShowEmoji(false),children:/*#__PURE__*/_jsx(Picker,{perLine:16,theme:\"dark\",showPreview:true,showSkinTones:false,onSelect:handleAddEmoji})})}):null,/*#__PURE__*/_jsx(FileInput,{disableOption:loading,handleChangeMedias:handleChangeMedias})]}),endAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"end\",children:contentMessage?/*#__PURE__*/_jsx(IconButton,{onClick:handleSendClick,className:classes.buttonSend,size:\"large\",children:/*#__PURE__*/_jsx(SendIcon,{})}):/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"showRecorder\",component:\"span\",disabled:loading,onClick:handleStartRecording,size:\"large\",children:/*#__PURE__*/_jsx(MicIcon,{className:classes.sendMessageIcons})})})})})})})]})]}),/*#__PURE__*/_jsx(DocumentModal,{open:documentModalOpen,onClose:()=>setDocumentModalOpen(false),document:selectedDocument})]});}const FileInput=props=>{const{handleChangeMedias,disableOption}=props;const classes=useStyles();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{multiple:true,type:\"file\",id:\"upload-button\",disabled:disableOption,className:classes.uploadInput,onChange:handleChangeMedias}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"upload-button\",children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"upload\",component:\"span\",disabled:disableOption,size:\"large\",children:/*#__PURE__*/_jsx(AttachFileIcon,{className:classes.sendMessageIcons})})})]});};const MessageWithLineBreaks=_ref2=>{var _replyTo$sender;let{text,replyTo,scrollToMessage,forwardedFrom,checkMessageMedia}=_ref2;const classes=useStyles();if(!text&&!replyTo&&!forwardedFrom)return null;return/*#__PURE__*/_jsxs(\"div\",{style:{whiteSpace:\"pre-wrap\",wordBreak:\"break-word\",overflowWrap:\"break-word\",width:\"100%\"},children:[forwardedFrom&&/*#__PURE__*/_jsxs(\"div\",{className:classes.forwardedMessage,children:[/*#__PURE__*/_jsx(\"div\",{className:classes.forwardedMessageHeader,children:/*#__PURE__*/_jsx(\"span\",{children:i18n.t(\"chatMessages.forwarded\")})}),forwardedFrom.mediaPath&&checkMessageMedia(forwardedFrom)]}),replyTo&&/*#__PURE__*/_jsxs(\"div\",{className:classes.replyPreview,style:{cursor:\"pointer\"},onClick:()=>scrollToMessage(replyTo.id),title:i18n.t(\"chatMessages.clickToGoToOriginal\"),children:[/*#__PURE__*/_jsx(\"div\",{className:classes.replyPreviewSender,children:((_replyTo$sender=replyTo.sender)===null||_replyTo$sender===void 0?void 0:_replyTo$sender.name)||\"Mensagem\"}),/*#__PURE__*/_jsx(\"div\",{className:classes.replyPreviewText,children:replyTo.message||\"[mensagem não encontrada]\"})]}),/*#__PURE__*/_jsx(MarkdownWrapper,{children:text})]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}