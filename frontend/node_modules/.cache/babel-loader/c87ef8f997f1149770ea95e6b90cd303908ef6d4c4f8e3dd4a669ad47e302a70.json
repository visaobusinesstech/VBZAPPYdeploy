{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from\"react\";import*as Yup from\"yup\";import{Formik,FieldArray,Form,Field}from\"formik\";import{toast}from\"react-toastify\";import{makeStyles}from\"@material-ui/core/styles\";import{green}from\"@material-ui/core/colors\";import Button from\"@material-ui/core/Button\";import TextField from\"@material-ui/core/TextField\";import Dialog from\"@material-ui/core/Dialog\";import DialogActions from\"@material-ui/core/DialogActions\";import DialogContent from\"@material-ui/core/DialogContent\";import DialogTitle from\"@material-ui/core/DialogTitle\";import Typography from\"@material-ui/core/Typography\";import IconButton from\"@material-ui/core/IconButton\";import DeleteOutlineIcon from\"@material-ui/icons/DeleteOutline\";import CircularProgress from\"@material-ui/core/CircularProgress\";import Compressor from\"compressorjs\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";import toastError from\"../../errors/toastError\";import{Checkbox,Stack}from\"@mui/material\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{display:\"flex\",flexWrap:\"wrap\"},textField:{marginRight:theme.spacing(1),flex:1},extraAttr:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\"},btnWrapper:{position:\"relative\"},buttonProgress:{color:green[500],position:\"absolute\",top:\"50%\",left:\"50%\",marginTop:-12,marginLeft:-12}}));const FlowBuilderAddVideoModal=_ref=>{let{open,onSave,onUpdate,data,close}=_ref;const classes=useStyles();const isMounted=useRef(true);const[activeModal,setActiveModal]=useState(false);const[loading,setLoading]=useState(false);const[record,setRecord]=useState(false);const[preview,setPreview]=useState();const[labels,setLabels]=useState({title:\"Adicionar video ao fluxo\",btn:\"Adicionar\"});const[medias,setMedias]=useState([]);useEffect(()=>{if(open===\"edit\"){setLabels({title:\"Editar video\",btn:\"Salvar\"});setPreview(process.env.REACT_APP_BACKEND_URL+'/public/'+data.data.url);setRecord(data.data.record);setActiveModal(true);}else if(open===\"create\"){setLabels({title:\"Adicionar video ao fluxo\",btn:\"Adicionar\"});setActiveModal(true);}else{setActiveModal(false);}},[open]);useEffect(()=>{return()=>{isMounted.current=false;};},[]);const handleClose=()=>{close(null);setActiveModal(false);};const handleSaveContact=async()=>{if(open===\"edit\"){handleClose();onUpdate(_objectSpread(_objectSpread({},data),{},{data:{url:data.data.url,record:record}}));return;}else if(open===\"create\"){setLoading(true);const formData=new FormData();formData.append(\"fromMe\",true);medias.forEach(async(media,idx)=>{const file=media;if(!file){return;}if((media===null||media===void 0?void 0:media.type.split(\"/\")[0])==\"image\"){new Compressor(file,{quality:0.7,async success(media){formData.append(\"medias\",media);formData.append(\"body\",media.name);},error(err){alert(\"erro\");console.log(err.message);}});}else{formData.append(\"medias\",media);formData.append(\"body\",media.name);}});setTimeout(async()=>{await api.post(\"/flowbuilder/audio\",formData).then(res=>{handleClose();onSave({url:res.data.name});toast.success(\"Audio adicionada com sucesso!\");setLoading(false);setMedias([]);setPreview();});},1000);}};const handleChangeMedias=e=>{if(!e.target.files){return;}if(e.target.files[0].size>20000000){toast.error(\"Arquivo é muito grande! 20MB máximo\");return;}const selectedMedias=Array.from(e.target.files);setPreview(URL.createObjectURL(e.target.files[0]));setMedias(selectedMedias);};return/*#__PURE__*/_jsx(\"div\",{className:classes.root,children:/*#__PURE__*/_jsxs(Dialog,{open:activeModal,onClose:handleClose,fullWidth:\"md\",scroll:\"paper\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"form-dialog-title\",children:labels.title}),/*#__PURE__*/_jsxs(Stack,{children:[/*#__PURE__*/_jsx(DialogContent,{dividers:true,children:/*#__PURE__*/_jsxs(Stack,{gap:\"16px\",children:[preview&&/*#__PURE__*/_jsx(Stack,{direction:'row',justifyContent:'center',children:/*#__PURE__*/_jsxs(\"video\",{controls:\"controls\",width:\"552px\",children:[/*#__PURE__*/_jsx(\"source\",{src:preview,type:\"video/mp4\"}),\"seu navegador n\\xE3o suporta HTML5\"]})}),!loading&&open!==\"edit\"&&!preview&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Button,{variant:\"contained\",component:\"label\",children:[\"Enviar video\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"video/mp4\",disabled:loading,hidden:true,onChange:handleChangeMedias})]}),/*#__PURE__*/_jsx(Typography,{children:\"ATEN\\xC7\\xC3O! Apenas videos em MP4!\"})]}),loading&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Stack,{justifyContent:\"center\",alignSelf:\"center\",children:/*#__PURE__*/_jsx(CircularProgress,{})})})]})}),/*#__PURE__*/_jsx(DialogActions,{children:!loading&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>{handleClose();setMedias([]);setPreview();},color:\"secondary\",variant:\"outlined\",children:i18n.t(\"contactModal.buttons.cancel\")}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:loading,color:\"primary\",variant:\"contained\",className:classes.btnWrapper,onClick:()=>handleSaveContact(),children:\"\".concat(labels.btn)})]})})]})]})});};export default FlowBuilderAddVideoModal;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}