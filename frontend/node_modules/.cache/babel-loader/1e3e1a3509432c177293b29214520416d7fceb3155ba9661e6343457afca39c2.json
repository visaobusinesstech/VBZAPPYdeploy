{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useReducer,useContext,useCallback}from\"react\";import{SiOpenai}from\"react-icons/si\";import{toast}from\"react-toastify\";import\"./mobile-styles.css\";import{makeStyles,useTheme}from\"@material-ui/core/styles\";import{Paper,Button,IconButton,List,ListItem,ListItemIcon,ListItemText,Divider,Typography,Box,Chip,Grid,Collapse,useMediaQuery,Menu,MenuItem,Fab,Slide,ClickAwayListener,Tooltip,ButtonGroup}from\"@material-ui/core\";import{Menu as MenuIcon,Close as CloseIcon,Add as AddIcon,ExpandLess,ExpandMore,Save as SaveIcon,ZoomIn as ZoomInIcon,ZoomOut as ZoomOutIcon,ChevronLeft,ChevronRight}from\"@material-ui/icons\";import WebAssetIcon from'@material-ui/icons/WebAsset';import MainHeader from\"../../components/MainHeader\";import Title from\"../../components/Title\";import{AuthContext}from\"../../context/Auth/AuthContext\";import api from\"../../services/api\";import toastError from\"../../errors/toastError\";import HttpIcon from\"@mui/icons-material/Http\";import DataObjectIcon from\"@mui/icons-material/DataObject\";import QuestionAnswerIcon from\"@mui/icons-material/QuestionAnswer\";import CompareArrows from\"@mui/icons-material/CompareArrows\";import ReactFlow,{MiniMap,Controls,Background,useNodesState,useEdgesState,addEdge,useReactFlow}from\"react-flow-renderer\";import{AccessTime,CallSplit,DynamicFeed,Image,ImportExport,LibraryBooks,Message,MicNone,RocketLaunch,Videocam,Tag,Queue,Person}from\"@mui/icons-material\";import ArrowForwardIcon from'@mui/icons-material/ArrowForward';// Import dos nós (mantendo os mesmos)\nimport messageNode from\"./nodes/messageNode.js\";import startNode from\"./nodes/startNode\";import openaiNode from\"./nodes/openaiNode\";import geminiNode from\"./nodes/geminiNode\";//import conditionNode from \"./nodes/conditionNode\";\nimport menuNode from\"./nodes/menuNode\";import intervalNode from\"./nodes/intervalNode\";import imgNode from\"./nodes/imgNode\";import randomizerNode from\"./nodes/randomizerNode\";import videoNode from\"./nodes/videoNode\";import switchFlowNode from\"./nodes/switchFlowNode\";import attendantNode from\"./nodes/attendantNode\";import RemoveEdge from\"./nodes/removeEdge\";import audioNode from\"./nodes/audioNode\";import{useNodeStorage}from\"../../stores/useNodeStorage\";import singleBlockNode from\"./nodes/singleBlockNode\";import ticketNode from\"./nodes/ticketNode\";import tagNode from\"./nodes/tagNode\";//import conditionCompareNode from \"./nodes/conditionCompareNode\";\nimport HttpRequestNode from\"./nodes/httpRequestNode\";import removeTagNode from\"./nodes/removeTagNode\";import VariableNode,{getFlowVariable,setFlowVariable}from\"./nodes/variableNode\";import inputNode from\"./nodes/inputNode\";// Imports dos modais (mantendo os mesmos)\nimport FlowBuilderAddImgModal from\"../../components/FlowBuilderAddImgModal\";import FlowBuilderTicketModal from\"../../components/FlowBuilderAddTicketModal\";import FlowBuilderAddAudioModal from\"../../components/FlowBuilderAddAudioModal\";import FlowBuilderAddTagModal from\"../../components/FlowBuilderAddTagModal\";import FlowBuilderRandomizerModal from\"../../components/FlowBuilderRandomizerModal\";import FlowBuilderAddVideoModal from\"../../components/FlowBuilderAddVideoModal\";import FlowBuilderSingleBlockModal from\"../../components/FlowBuilderSingleBlockModal\";import FlowBuilderAddTextModal from\"../../components/FlowBuilderAddTextModal\";import FlowBuilderIntervalModal from\"../../components/FlowBuilderIntervalModal\";//import FlowBuilderConditionModal from \"../../components/FlowBuilderConditionModal\";\nimport FlowBuilderMenuModal from\"../../components/FlowBuilderMenuModal\";import FlowBuilderAddSwitchFlowModal from\"../../components/FlowBuilderAddSwitchFlowModal\";import FlowBuilderAddAttendantModal from\"../../components/FlowBuilderAddAttendantModal\";import FlowBuilderInputModal from\"../../components/FlowBuilderInputModal\";//import FlowBuilderConditionCompareModal from \"../../components/FlowBuilderConditionCompareModal\";\nimport FlowBuilderRemoveTagModal from\"../../components/FlowBuilderRemoveTagModal\";import FlowBuilderOpenAIModal from\"../../components/FlowBuilderAddOpenAIModal\";import FlowBuilderGeminiModal from\"../../components/FlowBuilderGeminiModal\";import{useParams}from\"react-router-dom/cjs/react-router-dom.min\";import{CircularProgress}from\"@material-ui/core\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{display:\"flex\",flexDirection:\"column\",height:\"100vh\",overflow:\"hidden\",backgroundColor:theme.palette.background.default},header:{flexShrink:0,backgroundColor:theme.palette.background.paper,borderBottom:\"1px solid \".concat(theme.palette.divider)},content:{flex:1,display:\"flex\",position:\"relative\",overflow:\"hidden\"},// Sidebar colapsável para desktop\nsidebar:{width:props=>props.sidebarOpen?300:60,backgroundColor:theme.palette.background.paper,borderRight:\"1px solid \".concat(theme.palette.divider),transition:\"width 0.3s ease\",display:\"flex\",flexDirection:\"column\",zIndex:1000,[theme.breakpoints.down('md')]:{display:\"none\"// Ocultar sidebar em mobile\n}},sidebarHeader:{padding:theme.spacing(1),borderBottom:\"1px solid \".concat(theme.palette.divider),display:\"flex\",alignItems:\"center\",justifyContent:\"space-between\",minHeight:56,backgroundColor:theme.palette.background.paper},sidebarContent:_objectSpread({flex:1,overflowY:\"auto\",backgroundColor:theme.palette.background.paper},theme.scrollbarStyles),flowContainer:{flex:1,position:\"relative\",backgroundColor:theme.palette.type==='dark'?'#121212':'#F8F9FA','& .react-flow__controls':{zIndex:1100,// Garantir que fique acima de outros elementos\nbottom:theme.spacing(2),left:theme.spacing(2),[theme.breakpoints.down('md')]:{display:'none'// Ocultar em mobile já que temos controles customizados\n}}},// Bottom sheet para mobile\nbottomSheet:{position:\"fixed\",bottom:0,left:0,right:0,backgroundColor:theme.palette.background.paper,borderTopLeftRadius:20,borderTopRightRadius:20,boxShadow:theme.shadows[8],zIndex:1500,maxHeight:\"80vh\",display:\"flex\",flexDirection:\"column\",border:\"1px solid \".concat(theme.palette.divider),[theme.breakpoints.up('lg')]:{display:\"none\"// Ocultar em desktop\n}},bottomSheetHandle:{width:40,height:4,backgroundColor:theme.palette.divider,borderRadius:2,margin:\"8px auto\",cursor:\"pointer\"},bottomSheetHeader:{padding:theme.spacing(1,2),borderBottom:\"1px solid \".concat(theme.palette.divider),display:\"flex\",alignItems:\"center\",justifyContent:\"space-between\",backgroundColor:theme.palette.background.paper},bottomSheetContent:_objectSpread({flex:1,overflowY:\"auto\",padding:theme.spacing(1),backgroundColor:theme.palette.background.paper},theme.scrollbarStyles),// Floating Action Button\nfab:{position:\"fixed\",top:60,// Posicionar no topo, acima dos quickActions\nright:theme.spacing(2),zIndex:1400,backgroundColor:theme.palette.primary.main,color:theme.palette.primary.contrastText,'&:hover':{backgroundColor:theme.palette.primary.dark},[theme.breakpoints.down('md')]:{bottom:theme.spacing(9),top:'auto'}},addFab:{position:\"fixed\",bottom:theme.spacing(2),left:theme.spacing(2),zIndex:1400,backgroundColor:theme.palette.secondary.main,color:theme.palette.secondary.contrastText,'&:hover':{backgroundColor:theme.palette.secondary.dark},[theme.breakpoints.up('lg')]:{display:\"none\"}},// Categorias de nós\ncategoryButton:{margin:theme.spacing(0.5),textTransform:\"none\",borderRadius:theme.spacing(1),minWidth:\"auto\",fontSize:\"0.75rem\",color:theme.palette.text.primary,borderColor:theme.palette.divider},nodeButton:{justifyContent:\"flex-start\",textTransform:\"none\",padding:theme.spacing(1),marginBottom:theme.spacing(0.5),borderRadius:theme.spacing(1),transition:\"all 0.2s ease\",color:theme.palette.text.primary,\"&:hover\":{backgroundColor:theme.palette.action.hover,transform:\"translateX(4px)\"}},collapsedNodeButton:{width:48,height:48,minWidth:48,padding:0,margin:theme.spacing(0.5,0.5),justifyContent:\"center\",color:theme.palette.text.primary,'&:hover':{backgroundColor:theme.palette.action.hover}},categoryHeader:{padding:theme.spacing(1),backgroundColor:theme.palette.action.hover,fontWeight:\"bold\",color:theme.palette.text.primary,cursor:\"pointer\",userSelect:\"none\",'&:hover':{backgroundColor:theme.palette.action.selected}},quickActions:{position:\"fixed\",top:120,right:theme.spacing(2),display:\"flex\",flexDirection:\"column\",gap:theme.spacing(1),zIndex:1200,[theme.breakpoints.down('md')]:{display:\"none\"}},quickActionButton:{backgroundColor:theme.palette.background.paper,backdropFilter:\"blur(10px)\",boxShadow:theme.shadows[3],color:theme.palette.text.primary,border:\"1px solid \".concat(theme.palette.divider),\"&:hover\":{backgroundColor:theme.palette.action.hover,transform:\"scale(1.05)\",boxShadow:theme.shadows[6]}},// Mobile controls\nmobileControls:{position:\"fixed\",bottom:80,left:theme.spacing(2),display:\"flex\",flexDirection:\"column\",gap:theme.spacing(1),zIndex:1300,[theme.breakpoints.up('lg')]:{display:\"none\"}},controlButton:{backgroundColor:theme.palette.background.paper,backdropFilter:\"blur(10px)\",boxShadow:theme.shadows[3],width:48,height:48,color:theme.palette.text.primary,border:\"1px solid \".concat(theme.palette.divider),\"&:hover\":{backgroundColor:theme.palette.action.hover,transform:\"scale(1.05)\"}},categoryCard:{backgroundColor:theme.palette.background.paper,borderRadius:8,border:\"1px solid \".concat(theme.palette.divider),marginBottom:theme.spacing(1)},categoryTitle:{fontWeight:\"bold\",marginBottom:theme.spacing(1),display:\"flex\",alignItems:\"center\",gap:theme.spacing(1),color:theme.palette.text.primary},categoryNodeBtn:{width:\"100%\",marginBottom:theme.spacing(0.5),justifyContent:\"flex-start\",textTransform:\"none\",fontSize:\"0.8rem\",padding:theme.spacing(1,1.5),color:theme.palette.text.primary,'&:hover':{backgroundColor:theme.palette.action.hover}},loadingContainer:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\",height:\"70vh\",backgroundColor:theme.palette.background.paper}}));// Definição das categorias de nós\nconst nodeCategories=[{name:\"Básicos\",color:theme=>theme.palette.primary.main,icon:/*#__PURE__*/_jsx(RocketLaunch,{}),nodes:[{icon:/*#__PURE__*/_jsx(RocketLaunch,{}),name:\"Início\",type:\"start\",description:\"Ponto inicial do fluxo\"}]},{name:\"Conteúdo\",color:theme=>theme.palette.success.main,icon:/*#__PURE__*/_jsx(LibraryBooks,{}),nodes:[{icon:/*#__PURE__*/_jsx(LibraryBooks,{}),name:\"Conteúdo\",type:\"content\",description:\"Enviar texto, imagem, áudio ou vídeo\"},{icon:/*#__PURE__*/_jsx(Message,{}),name:\"Texto\",type:\"text\",description:\"Mensagem de texto simples\"}]},{name:\"Interação\",color:theme=>theme.palette.warning.main,icon:/*#__PURE__*/_jsx(DynamicFeed,{}),nodes:[{icon:/*#__PURE__*/_jsx(DynamicFeed,{}),name:\"Menu\",type:\"menu\",description:\"Menu de opções para o usuário\"},{icon:/*#__PURE__*/_jsx(QuestionAnswerIcon,{}),name:\"Input\",type:\"input\",description:\"Coletar entrada do usuário\"},{icon:/*#__PURE__*/_jsx(AccessTime,{}),name:\"Intervalo\",type:\"interval\",description:\"Pausar execução por tempo\"}]},{name:\"Lógica\",color:theme=>theme.palette.secondary.main,icon:/*#__PURE__*/_jsx(CallSplit,{}),nodes:[{icon:/*#__PURE__*/_jsx(CallSplit,{}),name:\"Randomizador\",type:\"random\",description:\"Escolha aleatória de caminhos\"}]},{name:\"Sistema\",color:theme=>theme.palette.info.main,icon:/*#__PURE__*/_jsx(Queue,{}),nodes:[{icon:/*#__PURE__*/_jsx(Queue,{}),name:\"Filas\",type:\"ticket\",description:\"Gerenciar filas de atendimento\"},{icon:/*#__PURE__*/_jsx(Tag,{}),name:\"Tags\",type:\"tag\",description:\"Adicionar tags ao contato\"},{icon:/*#__PURE__*/_jsx(Tag,{}),name:\"Remover Tag\",type:\"removeTag\",description:\"Remover tags do contato\"},{icon:/*#__PURE__*/_jsx(ArrowForwardIcon,{}),name:\"Trocar Flow\",type:\"switchFlow\",description:\"Direcionar para outro fluxo\"},{icon:/*#__PURE__*/_jsx(Person,{}),name:\"Atendente\",type:\"attendant\",description:\"Transferir para atendente\"}]},{name:\"Integrações\",color:theme=>theme.palette.error.main,icon:/*#__PURE__*/_jsx(HttpIcon,{}),nodes:[{icon:/*#__PURE__*/_jsx(HttpIcon,{}),name:\"HTTP Request\",type:\"httpRequest\",description:\"Requisição HTTP externa\"},{icon:/*#__PURE__*/_jsx(DataObjectIcon,{}),name:\"Variável\",type:\"variable\",description:\"Definir variáveis globais\"},{icon:/*#__PURE__*/_jsx(SiOpenai,{}),name:\"Gemini\",type:\"gemini\",description:\"Integração com Gemini\"},{icon:/*#__PURE__*/_jsx(SiOpenai,{}),name:\"OpenAI\",type:\"openai\",description:\"Integração com OpenAI/\"}]}];// Função para gerar string aleatória (mantida igual)\nfunction geraStringAleatoria(tamanho){var stringAleatoria=\"\";var caracteres=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";for(var i=0;i<tamanho;i++){stringAleatoria+=caracteres.charAt(Math.floor(Math.random()*caracteres.length));}return stringAleatoria;}// Tipos de nós (mantido igual)\nconst nodeTypes={message:messageNode,start:startNode,//condition: conditionNode,\nmenu:menuNode,interval:intervalNode,img:imgNode,gemini:geminiNode,audio:audioNode,randomizer:randomizerNode,video:videoNode,singleBlock:singleBlockNode,ticket:ticketNode,tag:tagNode,removeTag:removeTagNode,switchFlow:switchFlowNode,attendant:attendantNode,httpRequest:HttpRequestNode,variable:VariableNode,openai:openaiNode,input:inputNode//conditionCompare: conditionCompareNode,\n};const edgeTypes={buttonedge:RemoveEdge};const initialNodes=[{id:\"1\",position:{x:250,y:100},data:{label:\"Inicio do fluxo\"},type:\"start\"}];const initialEdges=[];// Função para detectar se é mobile\nconst isMobileDevice=()=>{return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||'ontouchstart'in window||navigator.maxTouchPoints>0;};// Componente de controles customizados para mobile\nconst MobileControls=()=>{const classes=useStyles();const{zoomIn,zoomOut,fitView}=useReactFlow();return/*#__PURE__*/_jsxs(\"div\",{className:classes.mobileControls,children:[/*#__PURE__*/_jsx(IconButton,{onClick:()=>zoomIn(),className:classes.controlButton,size:\"small\",children:/*#__PURE__*/_jsx(ZoomInIcon,{})}),/*#__PURE__*/_jsx(IconButton,{onClick:()=>zoomOut(),className:classes.controlButton,size:\"small\",children:/*#__PURE__*/_jsx(ZoomOutIcon,{})}),/*#__PURE__*/_jsx(IconButton,{onClick:()=>fitView({padding:0.2}),className:classes.controlButton,size:\"small\",children:/*#__PURE__*/_jsx(WebAssetIcon,{})})]});};// Componente de ações rápidas para desktop\nconst QuickActions=_ref=>{let{onActionClick}=_ref;const classes=useStyles();const quickActions=[{icon:/*#__PURE__*/_jsx(Message,{}),name:\"Texto\",type:\"text\"},{icon:/*#__PURE__*/_jsx(DynamicFeed,{}),name:\"Menu\",type:\"menu\"},{icon:/*#__PURE__*/_jsx(AccessTime,{}),name:\"Intervalo\",type:\"interval\"},{icon:/*#__PURE__*/_jsx(LibraryBooks,{}),name:\"Conteúdo\",type:\"content\"}];return/*#__PURE__*/_jsx(\"div\",{className:classes.quickActions,children:quickActions.map(action=>/*#__PURE__*/_jsx(Tooltip,{title:action.name,placement:\"left\",children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>onActionClick(action.type),className:classes.quickActionButton,size:\"medium\",children:action.icon})},action.type))});};export const FlowBuilderConfig=()=>{const theme=useTheme();const isMobile=useMediaQuery(theme.breakpoints.down('md'));const{id}=useParams();// Estados para interface\nconst[sidebarOpen,setSidebarOpen]=useState(!isMobile);const[bottomSheetOpen,setBottomSheetOpen]=useState(false);const[expandedCategories,setExpandedCategories]=useState(['Básicos']);const classes=useStyles({sidebarOpen});// Estados existentes (mantidos)\nconst{user}=useContext(AuthContext);const[loading,setLoading]=useState(false);const[pageNumber,setPageNumber]=useState(1);const[dataNode,setDataNode]=useState(null);const[hasMore,setHasMore]=useState(false);// Estados dos modais (mantidos)\nconst[modalAddText,setModalAddText]=useState(null);const[modalAddInterval,setModalAddInterval]=useState(false);//const [modalAddCondition, setModalAddCondition] = useState(null);\nconst[modalAddMenu,setModalAddMenu]=useState(null);const[modalAddImg,setModalAddImg]=useState(null);const[modalAddAudio,setModalAddAudio]=useState(null);const[modalAddRandomizer,setModalAddRandomizer]=useState(null);const[modalAddVideo,setModalAddVideo]=useState(null);const[modalAddSingleBlock,setModalAddSingleBlock]=useState(null);const[modalAddTicket,setModalAddTicket]=useState(null);const[modalAddTag,setModalAddTag]=useState(null);const[modalAddSwitchFlow,setModalAddSwitchFlow]=useState(null);const[modalAddAttendant,setModalAddAttendant]=useState(null);const[modalAddOpenAI,setModalAddOpenAI]=useState(null);const[modalAddGemini,setModalAddGemini]=useState(null);const[modalAddInput,setModalAddInput]=useState(null);//const [modalAddConditionCompare, setModalAddConditionCompare] = useState(null);\nconst[modalAddRemoveTag,setModalAddRemoveTag]=useState(null);// Estados ReactFlow (mantidos)\nconst[nodes,setNodes,onNodesChange]=useNodesState(initialNodes);const[edges,setEdges,onEdgesChange]=useEdgesState(initialEdges);const storageItems=useNodeStorage();const connectionLineStyle={stroke:theme.palette.primary.main,strokeWidth:isMobileDevice()?\"8px\":\"6px\"};// Inicializar sistema de variáveis globais\nuseEffect(()=>{if(!window.flowVariables){window.flowVariables={};console.log(\"Sistema de variáveis globais inicializado\");}window.getFlowVariable=getFlowVariable;window.setFlowVariable=setFlowVariable;},[]);// Função addNode COMPLETA (mantida igual - muito longa para reproduzir aqui)\nconst addNode=(type,data)=>{const posY=nodes[nodes.length-1].position.y;const posX=nodes[nodes.length-1].position.x+(nodes[nodes.length-1].width||200)+40;if(type===\"start\"){return setNodes(old=>{return[...old.filter(item=>item.id!==\"1\"),{id:\"1\",position:{x:posX,y:posY},data:{label:\"Inicio do fluxo\"},type:\"start\"}];});}if(type===\"text\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:{label:data.text},type:\"message\"}];});}if(type===\"interval\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:{label:\"Intervalo \".concat(data.sec,\" seg.\"),sec:data.sec},type:\"interval\"}];});}if(type===\"menu\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:{message:data.message,arrayOption:data.arrayOption},type:\"menu\"}];});}if(type===\"img\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:{url:data.url},type:\"img\"}];});}if(type===\"audio\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:{url:data.url,record:data.record},type:\"audio\"}];});}if(type===\"randomizer\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:{percent:data.percent},type:\"randomizer\"}];});}if(type===\"video\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:{url:data.url},type:\"video\"}];});}if(type===\"singleBlock\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:_objectSpread({},data),type:\"singleBlock\"}];});}if(type===\"ticket\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:_objectSpread({},data),type:\"ticket\"}];});}if(type===\"openai\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:_objectSpread({},data),type:\"openai\"}];});}if(type===\"gemini\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:_objectSpread({},data),type:\"gemini\"}];});}if(type===\"tag\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:_objectSpread({},data),type:\"tag\"}];});}if(type===\"removeTag\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:_objectSpread({tag:(data===null||data===void 0?void 0:data.tag)||\"\"},data),type:\"removeTag\"}];});}if(type===\"switchFlow\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:_objectSpread({},data),type:\"switchFlow\"}];});}if(type===\"attendant\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:_objectSpread({},data),type:\"attendant\"}];});}if(type===\"httpRequest\"){return setNodes(old=>[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:_objectSpread({url:\"\",method:(data===null||data===void 0?void 0:data.method)||\"POST\",requestBody:(data===null||data===void 0?void 0:data.requestBody)||\"{}\",headersString:(data===null||data===void 0?void 0:data.headersString)||\"\",queryParams:(data===null||data===void 0?void 0:data.queryParams)||[],saveVariables:(data===null||data===void 0?void 0:data.saveVariables)||[]},data),type:\"httpRequest\"}]);}if(type===\"variable\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:_objectSpread({variableName:(data===null||data===void 0?void 0:data.variableName)||\"\",variableValue:(data===null||data===void 0?void 0:data.variableValue)||\"\",variableType:(data===null||data===void 0?void 0:data.variableType)||\"text\",variableExpression:(data===null||data===void 0?void 0:data.variableExpression)||\"\",isExpression:(data===null||data===void 0?void 0:data.isExpression)||false},data),type:\"variable\"}];});}if(type===\"input\"){return setNodes(old=>{return[...old,{id:geraStringAleatoria(30),position:{x:posX,y:posY},data:_objectSpread({question:(data===null||data===void 0?void 0:data.question)||\"\",variableName:(data===null||data===void 0?void 0:data.variableName)||\"\"},data),type:\"input\"}];});}};// Funções de adição (mantidas)\nconst textAdd=data=>addNode(\"text\",data);const intervalAdd=data=>addNode(\"interval\",data);//const conditionAdd = data => addNode(\"condition\", data);\nconst menuAdd=data=>addNode(\"menu\",data);const imgAdd=data=>addNode(\"img\",data);const audioAdd=data=>addNode(\"audio\",data);const randomizerAdd=data=>addNode(\"randomizer\",data);const videoAdd=data=>addNode(\"video\",data);const singleBlockAdd=data=>addNode(\"singleBlock\",data);const ticketAdd=data=>addNode(\"ticket\",data);const tagAdd=data=>addNode(\"tag\",data);const openaiAdd=data=>addNode(\"openai\",data);const geminiAdd=data=>addNode(\"gemini\",data);const removeTagAdd=data=>addNode(\"removeTag\",data);const switchFlowAdd=data=>addNode(\"switchFlow\",data);const attendantAdd=data=>addNode(\"attendant\",data);const variableAdd=data=>addNode(\"variable\",data);const inputAdd=data=>addNode(\"input\",data);// useEffect para carregar fluxo COMPLETO (mantido)\nuseEffect(()=>{setLoading(true);const delayDebounceFn=setTimeout(()=>{const fetchContacts=async()=>{try{const{data}=await api.get(\"/flowbuilder/flow/\".concat(id));if(data.flow.flow!==null){const preparedNodes=data.flow.flow.nodes.map(node=>{if(node.type===\"httpRequest\"){var _node$data$saveVariab,_node$data$responseVa;console.log(\"[FlowBuilder] Processando n\\xF3 HTTP Request: \".concat(node.id));if(node.data.saveVariables&&node.data.saveVariables.length>0){console.log(\"[FlowBuilder] N\\xF3 \".concat(node.id,\" tem \").concat(node.data.saveVariables.length,\" vari\\xE1veis configuradas\"));if(!node.data.responseVariables||!Array.isArray(node.data.responseVariables)){console.log(\"[FlowBuilder] Configurando responseVariables para n\\xF3 \".concat(node.id));node.data.responseVariables=node.data.saveVariables.map(item=>({path:item.path,variableName:item.variable}));}}else{node.data.saveVariables=node.data.saveVariables||[];node.data.responseVariables=node.data.responseVariables||[];}console.log(\"[FlowBuilder] N\\xF3 HTTP Request \".concat(node.id,\" processado:\"),{url:node.data.url,method:node.data.method,saveVariables:((_node$data$saveVariab=node.data.saveVariables)===null||_node$data$saveVariab===void 0?void 0:_node$data$saveVariab.length)||0,responseVariables:((_node$data$responseVa=node.data.responseVariables)===null||_node$data$responseVa===void 0?void 0:_node$data$responseVa.length)||0});}return node;});setNodes(preparedNodes);setEdges(data.flow.flow.connections);}setLoading(false);}catch(err){toastError(err);}};fetchContacts();},500);return()=>clearTimeout(delayDebounceFn);},[id]);// useEffect para storage COMPLETO (mantido)\nuseEffect(()=>{if(storageItems.action===\"delete\"){setNodes(old=>old.filter(item=>item.id!==storageItems.node));setEdges(old=>{const newData=old.filter(item=>item.source!==storageItems.node);const newClearTarget=newData.filter(item=>item.target!==storageItems.node);return newClearTarget;});storageItems.setNodesStorage(\"\");storageItems.setAct(\"idle\");}if(storageItems.action===\"duplicate\"){const nodeDuplicate=nodes.filter(item=>item.id===storageItems.node)[0];const maioresX=nodes.map(node=>node.position.x);const maiorX=Math.max(...maioresX);const finalY=nodes[nodes.length-1].position.y;const nodeNew=_objectSpread(_objectSpread({},nodeDuplicate),{},{id:geraStringAleatoria(30),position:{x:maiorX+240,y:finalY},selected:false,style:{backgroundColor:theme.palette.grey[800],padding:0,borderRadius:8,border:\"1px solid \".concat(theme.palette.divider)}});setNodes(old=>[...old,nodeNew]);storageItems.setNodesStorage(\"\");storageItems.setAct(\"idle\");}},[storageItems.action,nodes,theme]);const onConnect=useCallback(params=>setEdges(eds=>addEdge(params,eds)),[setEdges]);// Função de salvar COMPLETA (mantida)\nconst saveFlow=async()=>{try{console.log(\"[FlowBuilder] Preparando para salvar fluxo...\");const processedNodes=nodes.map(node=>{if(node.type===\"httpRequest\"){var _node$data$saveVariab2,_node$data$responseVa2;console.log(\"[FlowBuilder] Processando n\\xF3 HTTP Request: \".concat(node.id));if(node.data.saveVariables&&node.data.saveVariables.length>0){console.log(\"[FlowBuilder] N\\xF3 \".concat(node.id,\" tem \").concat(node.data.saveVariables.length,\" vari\\xE1veis configuradas\"));if(!node.data.responseVariables||!Array.isArray(node.data.responseVariables)){console.log(\"[FlowBuilder] Configurando responseVariables para n\\xF3 \".concat(node.id));node.data.responseVariables=node.data.saveVariables.map(item=>({path:item.path,variableName:item.variable}));}}else{node.data.saveVariables=node.data.saveVariables||[];node.data.responseVariables=node.data.responseVariables||[];}console.log(\"[FlowBuilder] N\\xF3 HTTP Request \".concat(node.id,\" processado:\"),{url:node.data.url,method:node.data.method,saveVariables:((_node$data$saveVariab2=node.data.saveVariables)===null||_node$data$saveVariab2===void 0?void 0:_node$data$saveVariab2.length)||0,responseVariables:((_node$data$responseVa2=node.data.responseVariables)===null||_node$data$responseVa2===void 0?void 0:_node$data$responseVa2.length)||0});}return node;});console.log(\"[FlowBuilder] Enviando fluxo para o servidor...\");await api.post(\"/flowbuilder/flow\",{idFlow:id,nodes:processedNodes,connections:edges}).then(res=>{toast.success(\"Fluxo salvo com sucesso\");setNodes(processedNodes);});}catch(error){toast.error(\"Erro ao salvar o fluxo\");console.error(\"Erro ao salvar o fluxo:\",error);}};// Event handlers COMPLETOS (mantidos mas adaptados para tema)\nconst doubleClick=(event,node)=>{setDataNode(node);if(node.type===\"message\")setModalAddText(\"edit\");if(node.type===\"interval\")setModalAddInterval(\"edit\");if(node.type===\"menu\")setModalAddMenu(\"edit\");if(node.type===\"img\")setModalAddImg(\"edit\");if(node.type===\"audio\")setModalAddAudio(\"edit\");if(node.type===\"randomizer\")setModalAddRandomizer(\"edit\");if(node.type===\"video\")setModalAddVideo(\"edit\");if(node.type===\"singleBlock\")setModalAddSingleBlock(\"edit\");if(node.type===\"ticket\")setModalAddTicket(\"edit\");if(node.type===\"tag\")setModalAddTag(\"edit\");if(node.type===\"removeTag\")setModalAddRemoveTag(\"edit\");if(node.type===\"switchFlow\")setModalAddSwitchFlow(\"edit\");if(node.type===\"openai\")setModalAddOpenAI(\"edit\");if(node.type===\"gemini\")setModalAddGemini(\"edit\");if(node.type===\"attendant\")setModalAddAttendant(\"edit\");if(node.type===\"httpRequest\"){if(node.data.saveVariables&&node.data.saveVariables.length>0){if(!node.data.responseVariables||!Array.isArray(node.data.responseVariables)){node.data.responseVariables=node.data.saveVariables.map(item=>({path:item.path,variableName:item.variable}));setNodes(old=>old.map(itemNode=>{if(itemNode.id===node.id){return node;}return itemNode;}));console.log(\"[FlowBuilder] Nó HTTP Request atualizado:\",node.id);}}}if(node.type===\"input\")setModalAddInput(\"edit\");};const clickNode=(event,node)=>{setNodes(old=>old.map(item=>{if(item.id===node.id){return _objectSpread(_objectSpread({},item),{},{style:{backgroundColor:theme.palette.primary.main,padding:1,borderRadius:8,border:\"2px solid \".concat(theme.palette.primary.dark)}});}return _objectSpread(_objectSpread({},item),{},{style:{backgroundColor:theme.palette.grey[800],padding:0,borderRadius:8,border:\"1px solid \".concat(theme.palette.divider)}});}));};const clickEdge=(event,node)=>{setNodes(old=>old.map(item=>{return _objectSpread(_objectSpread({},item),{},{style:{backgroundColor:theme.palette.grey[800],padding:0,borderRadius:8,border:\"1px solid \".concat(theme.palette.divider)}});}));};const updateNode=dataAlter=>{setNodes(old=>old.map(itemNode=>{if(itemNode.id===dataAlter.id){return dataAlter;}return itemNode;}));// Fechar todos os modais\nsetModalAddText(null);setModalAddInterval(null);setModalAddMenu(null);setModalAddImg(null);setModalAddOpenAI(null);setModalAddAudio(null);setModalAddRandomizer(null);setModalAddVideo(null);setModalAddGemini(null);setModalAddSingleBlock(null);setModalAddTicket(null);setModalAddRemoveTag(null);setModalAddTag(null);setModalAddSwitchFlow(null);setModalAddAttendant(null);setModalAddInput(null);};// Handler para categoria expand/collapse\nconst handleCategoryToggle=categoryName=>{setExpandedCategories(prev=>prev.includes(categoryName)?prev.filter(name=>name!==categoryName):[...prev,categoryName]);};// Handler para ações de nós\nconst clickActions=type=>{setBottomSheetOpen(false);switch(type){case\"start\":addNode(\"start\");break;case\"menu\":setModalAddMenu(\"create\");break;case\"content\":setModalAddSingleBlock(\"create\");break;case\"text\":setModalAddText(\"create\");break;case\"random\":setModalAddRandomizer(\"create\");break;case\"interval\":setModalAddInterval(\"create\");break;case\"ticket\":setModalAddTicket(\"create\");break;case\"tag\":setModalAddTag(\"create\");break;case\"removeTag\":setModalAddRemoveTag(\"create\");break;case\"switchFlow\":setModalAddSwitchFlow(\"create\");break;case\"attendant\":setModalAddAttendant(\"create\");break;case\"httpRequest\":addNode(\"httpRequest\");break;case\"variable\":addNode(\"variable\");break;case\"input\":setModalAddInput(\"create\");break;case\"openai\":setModalAddOpenAI(\"create\");break;case\"gemini\":setModalAddGemini(\"create\");break;case\"img\":setModalAddImg(\"create\");break;case\"audio\":setModalAddAudio(\"create\");break;case\"video\":setModalAddVideo(\"create\");break;default:}};// Componente do Sidebar\nconst SidebarContent=()=>/*#__PURE__*/_jsx(\"div\",{className:classes.sidebarContent,children:nodeCategories.map(category=>/*#__PURE__*/_jsx(\"div\",{children:sidebarOpen?/*#__PURE__*/// Modo expandido\n_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:classes.categoryHeader,children:/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",justifyContent:\"space-between\",onClick:()=>handleCategoryToggle(category.name),style:{cursor:\"pointer\"},children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",gap:1,children:[/*#__PURE__*/_jsx(Box,{sx:{color:typeof category.color==='function'?category.color(theme):category.color},children:category.icon}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:category.name})]}),expandedCategories.includes(category.name)?/*#__PURE__*/_jsx(ExpandLess,{}):/*#__PURE__*/_jsx(ExpandMore,{})]})}),/*#__PURE__*/_jsx(Collapse,{in:expandedCategories.includes(category.name),children:/*#__PURE__*/_jsx(List,{dense:true,children:category.nodes.map(node=>/*#__PURE__*/_jsx(ListItem,{disablePadding:true,children:/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"text\",className:classes.nodeButton,onClick:()=>clickActions(node.type),startIcon:/*#__PURE__*/_jsx(Box,{sx:{color:typeof category.color==='function'?category.color(theme):category.color},children:node.icon}),children:/*#__PURE__*/_jsxs(Box,{textAlign:\"left\",width:\"100%\",children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:node.name}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",children:node.description})]})})},node.type))})})]}):/*#__PURE__*/// Modo colapsado - só ícones\n_jsx(\"div\",{children:category.nodes.map(node=>/*#__PURE__*/_jsx(Tooltip,{title:node.name,placement:\"right\",children:/*#__PURE__*/_jsx(IconButton,{className:classes.collapsedNodeButton,onClick:()=>clickActions(node.type),style:{color:typeof category.color==='function'?category.color(theme):category.color},children:node.icon})},node.type))})},category.name))});// Componente do Bottom Sheet\nconst BottomSheetContent=()=>/*#__PURE__*/_jsx(Slide,{direction:\"up\",in:bottomSheetOpen,mountOnEnter:true,unmountOnExit:true,children:/*#__PURE__*/_jsxs(\"div\",{className:classes.bottomSheet,children:[/*#__PURE__*/_jsx(\"div\",{className:classes.bottomSheetHandle,onClick:()=>setBottomSheetOpen(false)}),/*#__PURE__*/_jsxs(\"div\",{className:classes.bottomSheetHeader,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Adicionar N\\xF3s\"}),/*#__PURE__*/_jsx(IconButton,{onClick:()=>setBottomSheetOpen(false),size:\"small\",children:/*#__PURE__*/_jsx(CloseIcon,{})})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.bottomSheetContent,children:/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:nodeCategories.map(category=>/*#__PURE__*/_jsx(Grid,{item:true,xs:6,children:/*#__PURE__*/_jsxs(Paper,{elevation:1,className:classes.categoryCard,style:{padding:8},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",className:classes.categoryTitle,style:{color:typeof category.color==='function'?category.color(theme):category.color,marginBottom:8},children:category.name}),category.nodes.map(node=>/*#__PURE__*/_jsx(Button,{fullWidth:true,variant:\"outlined\",onClick:()=>clickActions(node.type),startIcon:/*#__PURE__*/_jsx(Box,{sx:{color:typeof category.color==='function'?category.color(theme):category.color},children:node.icon}),className:classes.categoryNodeBtn,size:\"small\",children:node.name},node.type))]})},category.name))})})]})});if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:classes.root,children:[/*#__PURE__*/_jsx(\"div\",{className:classes.header,children:/*#__PURE__*/_jsx(MainHeader,{children:/*#__PURE__*/_jsx(Title,{children:\"Editor de Fluxos\"})})}),/*#__PURE__*/_jsx(\"div\",{className:classes.loadingContainer,children:/*#__PURE__*/_jsx(CircularProgress,{style:{color:theme.palette.primary.main}})})]});}return/*#__PURE__*/_jsxs(\"div\",{className:classes.root,children:[/*#__PURE__*/_jsx(\"div\",{className:classes.header,children:/*#__PURE__*/_jsx(MainHeader,{children:/*#__PURE__*/_jsx(Title,{children:\"Editor de Fluxos\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:classes.content,children:[!isMobile&&/*#__PURE__*/_jsxs(\"div\",{className:classes.sidebar,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.sidebarHeader,children:[sidebarOpen&&/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",fontWeight:\"bold\",children:\"Adicionar N\\xF3s\"}),/*#__PURE__*/_jsx(IconButton,{onClick:()=>setSidebarOpen(!sidebarOpen),size:\"small\",children:sidebarOpen?/*#__PURE__*/_jsx(ChevronLeft,{}):/*#__PURE__*/_jsx(ChevronRight,{})})]}),/*#__PURE__*/_jsx(SidebarContent,{})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.flowContainer,children:/*#__PURE__*/_jsxs(ReactFlow,{nodes:nodes,edges:edges,deleteKeyCode:[\"Backspace\",\"Delete\"],onNodesChange:onNodesChange,onEdgesChange:onEdgesChange,onNodeDoubleClick:doubleClick,onNodeClick:clickNode,onEdgeClick:clickEdge,onConnect:onConnect,nodeTypes:nodeTypes,fitView:true,connectionLineStyle:connectionLineStyle,style:{//backgroundImage: `url(${imgBackground})`,\n//backgroundSize: \"cover\"\nbackgroundColor:\"#F8F9FA\"},edgeTypes:edgeTypes,variant:\"cross\",defaultEdgeOptions:{style:{color:\"#ff0000\",strokeWidth:\"6px\"},animated:false},children:[/*#__PURE__*/_jsx(Controls,{}),/*#__PURE__*/_jsx(MiniMap,{}),/*#__PURE__*/_jsx(Background,{variant:\"dots\",gap:12,size:-1})]})})]}),isMobile&&/*#__PURE__*/_jsx(MobileControls,{}),/*#__PURE__*/_jsx(Fab,{color:\"primary\",className:classes.fab,onClick:saveFlow,title:\"Salvar Fluxo\",children:/*#__PURE__*/_jsx(SaveIcon,{})}),!isMobile&&/*#__PURE__*/_jsx(QuickActions,{onActionClick:clickActions}),isMobile&&/*#__PURE__*/_jsx(BottomSheetContent,{}),isMobile&&/*#__PURE__*/_jsx(Fab,{color:\"secondary\",className:classes.addFab,onClick:()=>setBottomSheetOpen(true),children:/*#__PURE__*/_jsx(AddIcon,{})}),isMobile&&bottomSheetOpen&&/*#__PURE__*/_jsx(ClickAwayListener,{onClickAway:()=>setBottomSheetOpen(false),children:/*#__PURE__*/_jsx(\"div\",{})}),/*#__PURE__*/_jsx(FlowBuilderAddTextModal,{open:modalAddText,onSave:textAdd,data:dataNode,onUpdate:updateNode,close:setModalAddText}),/*#__PURE__*/_jsx(FlowBuilderIntervalModal,{open:modalAddInterval,onSave:intervalAdd,data:dataNode,onUpdate:updateNode,close:setModalAddInterval}),/*#__PURE__*/_jsx(FlowBuilderMenuModal,{open:modalAddMenu,onSave:menuAdd,data:dataNode,onUpdate:updateNode,close:setModalAddMenu}),/*#__PURE__*/_jsx(FlowBuilderAddImgModal,{open:modalAddImg,onSave:imgAdd,data:dataNode,onUpdate:updateNode,close:setModalAddImg}),/*#__PURE__*/_jsx(FlowBuilderAddAudioModal,{open:modalAddAudio,onSave:audioAdd,data:dataNode,onUpdate:updateNode,close:setModalAddAudio}),/*#__PURE__*/_jsx(FlowBuilderRandomizerModal,{open:modalAddRandomizer,onSave:randomizerAdd,data:dataNode,onUpdate:updateNode,close:setModalAddRandomizer}),/*#__PURE__*/_jsx(FlowBuilderAddVideoModal,{open:modalAddVideo,onSave:videoAdd,data:dataNode,onUpdate:updateNode,close:setModalAddVideo}),/*#__PURE__*/_jsx(FlowBuilderSingleBlockModal,{open:modalAddSingleBlock,onSave:singleBlockAdd,data:dataNode,onUpdate:updateNode,close:setModalAddSingleBlock}),/*#__PURE__*/_jsx(FlowBuilderTicketModal,{open:modalAddTicket,onSave:ticketAdd,data:dataNode,onUpdate:updateNode,close:setModalAddTicket}),/*#__PURE__*/_jsx(FlowBuilderOpenAIModal,{open:modalAddOpenAI,onSave:openaiAdd,data:dataNode,onUpdate:updateNode,close:setModalAddOpenAI}),/*#__PURE__*/_jsx(FlowBuilderGeminiModal,{open:modalAddGemini,onSave:geminiAdd,data:dataNode,onUpdate:updateNode,close:setModalAddGemini}),/*#__PURE__*/_jsx(FlowBuilderAddTagModal,{open:modalAddTag,onSave:tagAdd,data:dataNode,onUpdate:updateNode,close:setModalAddTag}),/*#__PURE__*/_jsx(FlowBuilderRemoveTagModal,{open:modalAddRemoveTag,onSave:removeTagAdd,data:dataNode,onUpdate:updateNode,close:()=>setModalAddRemoveTag(null)}),/*#__PURE__*/_jsx(FlowBuilderAddSwitchFlowModal,{open:modalAddSwitchFlow,onSave:switchFlowAdd,data:dataNode,onUpdate:updateNode,close:setModalAddSwitchFlow}),/*#__PURE__*/_jsx(FlowBuilderAddAttendantModal,{open:modalAddAttendant,onSave:attendantAdd,data:dataNode,onUpdate:updateNode,close:setModalAddAttendant}),/*#__PURE__*/_jsx(FlowBuilderInputModal,{open:modalAddInput,onSave:inputAdd,data:dataNode,onUpdate:updateNode,close:setModalAddInput})]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}