{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from\"react\";import{makeStyles}from\"@material-ui/core/styles\";import{Dialog,DialogContent,DialogActions,Button,Typography,Avatar,List,ListItem,ListItemAvatar,ListItemText,ListItemSecondaryAction,IconButton,Chip,Paper,Box,Fade,Slide}from\"@material-ui/core\";import{Cake as CakeIcon,Send as SendIcon,Person as PersonIcon,Phone as PhoneIcon,Close as CloseIcon}from\"@material-ui/icons\";import{toast}from\"react-toastify\";import api from\"../../services/api\";import{i18n}from\"../../translate/i18n\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({dialog:{\"& .MuiDialog-paper\":{borderRadius:16,maxWidth:600,width:\"90%\",overflow:\"hidden\"}},header:{background:\"linear-gradient(135deg, #ff6b6b 0%, #feca57 50%, #48dbfb 100%)\",padding:theme.spacing(4,3),textAlign:\"center\",position:\"relative\",overflow:\"hidden\",\"&::before\":{content:'\"\"',position:\"absolute\",top:0,left:0,right:0,bottom:0,background:\"url(\\\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20zm15 0c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\\\")\",opacity:0.3}},headerIcon:{fontSize:48,marginBottom:theme.spacing(2),animation:\"$rotate 2s linear infinite\"},headerTitle:{color:\"white\",fontWeight:700,fontSize:\"1.8rem\",textShadow:\"0 2px 4px rgba(0,0,0,0.2)\",marginBottom:theme.spacing(1),position:\"relative\",zIndex:1},headerSubtitle:{color:\"rgba(255, 255, 255, 0.9)\",fontSize:\"1rem\",position:\"relative\",zIndex:1},content:{padding:theme.spacing(3),maxHeight:\"60vh\",overflowY:\"auto\"},birthdayList:{width:\"100%\"},birthdayItem:{marginBottom:theme.spacing(2),backgroundColor:theme.palette.background.paper,border:\"1px solid \".concat(theme.palette.divider),borderRadius:12,borderLeft:\"4px solid \".concat(theme.palette.primary.main),transition:\"all 0.3s ease\",\"&:hover\":{transform:\"translateX(4px)\",boxShadow:theme.shadows[4]}},birthdayItemUser:{borderLeft:\"4px solid \".concat(theme.palette.secondary.main),background:\"linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%)\"},avatar:{width:56,height:56,background:\"linear-gradient(135deg, #667eea 0%, #764ba2 100%)\",position:\"relative\",\"&::after\":{content:'\"üéÇ\"',position:\"absolute\",bottom:-2,right:-2,fontSize:16,background:\"white\",borderRadius:\"50%\",padding:2,lineHeight:1}},avatarUser:{background:\"linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)\",animation:\"$birthdayPulse 2s infinite\"},personName:{fontSize:\"1.1rem\",fontWeight:600,color:theme.palette.text.primary,marginBottom:4},personType:{display:\"flex\",alignItems:\"center\",gap:4,color:theme.palette.text.secondary,fontSize:\"0.875rem\"},ageChip:{backgroundColor:theme.palette.primary.main,color:\"white\",fontWeight:\"bold\",fontSize:\"0.875rem\",\"& .MuiChip-icon\":{color:\"white\"}},sendButton:{background:\"linear-gradient(135deg, #10b981 0%, #059669 100%)\",color:\"white\",minWidth:120,fontWeight:600,textTransform:\"none\",borderRadius:8,transition:\"all 0.3s ease\",\"&:hover\":{transform:\"translateY(-1px)\",boxShadow:\"0 4px 12px rgba(16, 185, 129, 0.3)\"},\"&:disabled\":{background:\"#9ca3af\",color:\"white\"}},actions:{padding:theme.spacing(2,3),borderTop:\"1px solid \".concat(theme.palette.divider),justifyContent:\"space-between\"},actionButton:{textTransform:\"none\",fontWeight:600,borderRadius:8,minWidth:120},closeButton:{position:\"absolute\",top:theme.spacing(1),right:theme.spacing(1),color:\"rgba(255, 255, 255, 0.8)\",zIndex:2,\"&:hover\":{backgroundColor:\"rgba(255, 255, 255, 0.1)\"}},noDataMessage:{textAlign:\"center\",padding:theme.spacing(4),color:theme.palette.text.secondary},// Anima√ß√µes\n\"@keyframes rotate\":{from:{transform:\"rotate(0deg)\"},to:{transform:\"rotate(360deg)\"}},\"@keyframes birthdayPulse\":{\"0%, 100%\":{transform:\"scale(1)\",boxShadow:\"0 0 20px rgba(255, 107, 107, 0.5)\"},\"50%\":{transform:\"scale(1.05)\",boxShadow:\"0 0 30px rgba(255, 107, 107, 0.8)\"}}}));const Transition=/*#__PURE__*/React.forwardRef(function Transition(props,ref){return/*#__PURE__*/_jsx(Slide,_objectSpread({direction:\"up\",ref:ref},props));});const BirthdayModal=_ref=>{let{open,onClose,user}=_ref;const classes=useStyles();const[birthdayData,setBirthdayData]=useState({users:[],contacts:[],settings:null});const[loading,setLoading]=useState(false);const[sendingMessages,setSendingMessages]=useState(new Set());useEffect(()=>{if(open){fetchTodayBirthdays();}},[open]);const fetchTodayBirthdays=async()=>{setLoading(true);try{const{data}=await api.get(\"/birthdays/today\");setBirthdayData(data.data);}catch(error){toast.error(\"Erro ao carregar aniversariantes\");}finally{setLoading(false);}};const handleSendBirthdayMessage=async(contactId,contactName)=>{setSendingMessages(prev=>new Set([...prev,contactId]));try{await api.post(\"/birthdays/send-message\",{contactId});toast.success(\"Mensagem de parab\\xE9ns enviada para \".concat(contactName,\"! \\uD83C\\uDF89\"));// Atualizar o estado local para marcar como enviada\nsetBirthdayData(prev=>_objectSpread(_objectSpread({},prev),{},{contacts:prev.contacts.map(contact=>contact.id===contactId?_objectSpread(_objectSpread({},contact),{},{messageSent:true}):contact)}));}catch(error){var _error$response;// Verificar se √© erro de mensagem j√° enviada\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===409){toast.warning(\"Mensagem de anivers√°rio j√° foi enviada hoje para este contato\");// Atualizar o estado local para marcar como enviada\nsetBirthdayData(prev=>_objectSpread(_objectSpread({},prev),{},{contacts:prev.contacts.map(contact=>contact.id===contactId?_objectSpread(_objectSpread({},contact),{},{messageSent:true}):contact)}));}else{toast.error(\"Erro ao enviar mensagem de anivers√°rio\");}}finally{setSendingMessages(prev=>{const newSet=new Set(prev);newSet.delete(contactId);return newSet;});}};const getInitials=name=>{return name.split(' ').map(word=>word.charAt(0)).join('').toUpperCase().slice(0,2);};const formatAge=age=>{if(!age)return\"N/A\";return\"\".concat(age,\" ano\").concat(age!==1?'s':'');};const hasBirthdays=birthdayData.users.length>0||birthdayData.contacts.length>0;if(!hasBirthdays&&!loading){return null;// N√£o mostrar modal se n√£o h√° aniversariantes\n}return/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:onClose,className:classes.dialog,TransitionComponent:Transition,maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsxs(Box,{className:classes.header,children:[/*#__PURE__*/_jsx(IconButton,{className:classes.closeButton,onClick:onClose,children:/*#__PURE__*/_jsx(CloseIcon,{})}),/*#__PURE__*/_jsx(CakeIcon,{className:classes.headerIcon}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",className:classes.headerTitle,children:\"\\uD83C\\uDF89 Parab\\xE9ns!\"}),/*#__PURE__*/_jsx(Typography,{className:classes.headerSubtitle,children:\"Hoje \\xE9 um dia especial!\"})]}),/*#__PURE__*/_jsx(DialogContent,{className:classes.content,children:loading?/*#__PURE__*/_jsx(Box,{className:classes.noDataMessage,children:/*#__PURE__*/_jsx(Typography,{children:\"Carregando aniversariantes...\"})}):/*#__PURE__*/_jsxs(List,{className:classes.birthdayList,children:[birthdayData.users.map(birthdayUser=>/*#__PURE__*/_jsxs(ListItem,{className:\"\".concat(classes.birthdayItem,\" \").concat(classes.birthdayItemUser),children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{className:\"\".concat(classes.avatar,\" \").concat(classes.avatarUser),children:getInitials(birthdayUser.name)})}),/*#__PURE__*/_jsx(ListItemText,{primary:/*#__PURE__*/_jsxs(Typography,{className:classes.personName,children:[birthdayUser.name,birthdayUser.id===(user===null||user===void 0?void 0:user.id)&&\" (Voc√™!)\"]}),secondary:/*#__PURE__*/_jsxs(Box,{className:classes.personType,children:[/*#__PURE__*/_jsx(PersonIcon,{fontSize:\"small\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Usu\\xE1rio do Sistema\"})]})}),/*#__PURE__*/_jsx(ListItemSecondaryAction,{children:/*#__PURE__*/_jsx(Chip,{icon:/*#__PURE__*/_jsx(CakeIcon,{}),label:formatAge(birthdayUser.age),className:classes.ageChip})})]},\"user-\".concat(birthdayUser.id))),birthdayData.contacts.map(birthdayContact=>/*#__PURE__*/_jsxs(ListItem,{className:classes.birthdayItem,children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{className:classes.avatar,children:getInitials(birthdayContact.name)})}),/*#__PURE__*/_jsx(ListItemText,{primary:/*#__PURE__*/_jsx(Typography,{className:classes.personName,children:birthdayContact.name}),secondary:/*#__PURE__*/_jsxs(Box,{className:classes.personType,children:[/*#__PURE__*/_jsx(PhoneIcon,{fontSize:\"small\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Contato\"}),/*#__PURE__*/_jsx(Chip,{icon:/*#__PURE__*/_jsx(CakeIcon,{}),label:formatAge(birthdayContact.age),size:\"small\",style:{marginLeft:8}})]})}),/*#__PURE__*/_jsx(ListItemSecondaryAction,{children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",className:classes.sendButton,startIcon:/*#__PURE__*/_jsx(SendIcon,{}),onClick:()=>handleSendBirthdayMessage(birthdayContact.id,birthdayContact.name),disabled:sendingMessages.has(birthdayContact.id)||birthdayContact.messageSent,children:sendingMessages.has(birthdayContact.id)?\"Enviando...\":birthdayContact.messageSent?\"Mensagem j√° enviada\":\"Enviar Parab√©ns\"})})]},\"contact-\".concat(birthdayContact.id)))]})}),/*#__PURE__*/_jsxs(DialogActions,{className:classes.actions,children:[/*#__PURE__*/_jsx(Button,{onClick:onClose,color:\"default\",className:classes.actionButton,variant:\"outlined\",children:\"Lembrar mais tarde\"}),/*#__PURE__*/_jsx(Button,{onClick:onClose,color:\"primary\",className:classes.actionButton,variant:\"contained\",children:\"Entendi, obrigado!\"})]})]});};export default BirthdayModal;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}