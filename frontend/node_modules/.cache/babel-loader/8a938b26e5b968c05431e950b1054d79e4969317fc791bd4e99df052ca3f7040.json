{"ast":null,"code":"import{Button}from\"@material-ui/core\";import React,{useRef,useEffect,useState}from\"react\";import api from\"../../services/api\";import{Typography}from\"@material-ui/core\";import{useTheme,makeStyles}from\"@material-ui/core/styles\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LS_NAME=\"audioMessageRate\";// ✅ CORREÇÃO: Estilos específicos para controlar tamanho e aparência\nconst useStyles=makeStyles(theme=>({audioContainer:{display:'flex',flexDirection:'column',width:'100%',maxWidth:'380px',// ✅ Limita largura máxima\nminWidth:'300px',// ✅ Largura mínima\npadding:0,margin:0,backgroundColor:'transparent',border:'none'},audioPlayerContainer:{position:'relative',width:'100%',height:'40px',// ✅ Altura fixa\nmarginBottom:theme.spacing(1)},audioPlayer:{width:'100%',height:'40px',// ✅ Altura específica\noutline:'none',border:'none',backgroundColor:'transparent',// ✅ Remove aparência padrão problemática\n'&::-webkit-media-controls-panel':{backgroundColor:'transparent'},'&::-webkit-media-controls-current-time-display, &::-webkit-media-controls-time-remaining-display':{fontSize:'12px'}},controlsContainer:{display:'flex',flexDirection:'column',width:'100%',gap:theme.spacing(1)},transcriptionContainer:{width:'100%',marginTop:theme.spacing(1),// ✅ CORREÇÃO: Centralizar o botão\ndisplay:'flex',flexDirection:'column',alignItems:'center'},transcriptionText:{fontSize:'0.875rem',lineHeight:1.4,wordBreak:'break-word',padding:theme.spacing(1),backgroundColor:theme.palette.action.hover,borderRadius:theme.shape.borderRadius,border:\"1px solid \".concat(theme.palette.divider),width:'100%',boxSizing:'border-box'},transcribeButton:{fontSize:'0.75rem',padding:theme.spacing(0.5,1),minWidth:'auto',height:'32px',// ✅ CORREÇÃO: Centralizar o botão\nalignSelf:'center'},rateButton:{position:'absolute',top:'2px',right:'8px',fontSize:'0.7rem',minWidth:'auto',padding:'1px 6px',height:'18px',backgroundColor:'rgba(0,0,0,0.6)',color:'white',borderRadius:'9px',zIndex:10,lineHeight:1,'&:hover':{backgroundColor:'rgba(0,0,0,0.8)'},// ✅ Remover estilos de botão padrão\nborder:'none',textTransform:'none',boxShadow:'none'}}));const AudioModal=_ref=>{var _message$body,_message$transcrito;let{url,message,disableTranscription=false}=_ref;const theme=useTheme();const classes=useStyles();const audioRef=useRef(null);const[audioRate,setAudioRate]=useState(parseFloat(localStorage.getItem(LS_NAME)||\"1\"));const[showButtonRate,setShowButtonRate]=useState(false);const isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;const[transcription,setTranscription]=useState(null);const[isTranscribing,setIsTranscribing]=useState(false);const body=(_message$body=message===null||message===void 0?void 0:message.body)!==null&&_message$body!==void 0?_message$body:\"\";const transcrito=(_message$transcrito=message===null||message===void 0?void 0:message.transcrito)!==null&&_message$transcrito!==void 0?_message$transcrito:false;useEffect(()=>{if(audioRef.current){audioRef.current.playbackRate=audioRate;localStorage.setItem(LS_NAME,audioRate);}},[audioRate]);useEffect(()=>{if(audioRef.current){audioRef.current.onplaying=()=>{setShowButtonRate(true);};audioRef.current.onpause=()=>{setShowButtonRate(false);};audioRef.current.onended=()=>{setShowButtonRate(false);};}},[]);const toggleRate=()=>{let newRate=null;switch(audioRate){case 0.5:newRate=1;break;case 1:newRate=1.5;break;case 1.5:newRate=2;break;case 2:newRate=0.5;break;default:newRate=1;break;}setAudioRate(newRate);};const getAudioSource=()=>{let sourceUrl=url;if(isIOS){sourceUrl=sourceUrl.replace(\".ogg\",\".mp3\");}return/*#__PURE__*/_jsx(\"source\",{src:sourceUrl,type:isIOS?\"audio/mp3\":\"audio/ogg\"});};const handleTranscribe=async()=>{setIsTranscribing(true);try{let audioData={wid:message.wid};const{data}=await api.post(\"/message/transcribeAudio\",audioData);if(data){setTranscription(data);}else{console.error(\"Invalid response data:\",data);}}catch(error){console.error(\"Erro ao transcrever áudio:\",error);}finally{setIsTranscribing(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:classes.audioContainer,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.audioPlayerContainer,children:[/*#__PURE__*/_jsx(\"audio\",{ref:audioRef,controls:true,className:classes.audioPlayer,preload:\"metadata\",children:getAudioSource()}),showButtonRate&&/*#__PURE__*/_jsxs(Button,{className:classes.rateButton,onClick:toggleRate,size:\"small\",disableRipple:true,children:[audioRate,\"x\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.controlsContainer,children:!disableTranscription&&/*#__PURE__*/_jsx(\"div\",{className:classes.transcriptionContainer,children:!transcrito?transcription?/*#__PURE__*/_jsxs(Typography,{className:classes.transcriptionText,variant:\"body2\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Transcri\\xE7\\xE3o:\"}),\" \",transcription]}):/*#__PURE__*/_jsx(Button,{onClick:handleTranscribe,variant:\"contained\",className:classes.transcribeButton,disabled:isTranscribing,style:{backgroundColor:isTranscribing?\"#ccc\":theme.palette.primary.main,color:\"#fff\"},children:isTranscribing?\"Transcrevendo...\":\"Transcrever\"}):/*#__PURE__*/_jsxs(Typography,{className:classes.transcriptionText,variant:\"body2\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Transcri\\xE7\\xE3o:\"}),\" \",body]})})})]});};export default AudioModal;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}