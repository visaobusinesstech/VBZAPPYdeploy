{"ast":null,"code":"import React,{useEffect,useState,useContext}from'react';import{useHistory}from\"react-router-dom\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";import Avatar from\"@material-ui/core/Avatar\";import Typography from\"@material-ui/core/Typography\";import Grid from\"@material-ui/core/Grid\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{Button,Divider}from\"@material-ui/core\";import{isNil}from'lodash';import ShowTicketOpen from'../ShowTicketOpenModal';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const VcardPreview=_ref=>{let{contact,numbers,queueId,whatsappId,channel}=_ref;const history=useHistory();const{user}=useContext(AuthContext);const companyId=user.companyId;const[openAlert,setOpenAlert]=useState(false);const[userTicketOpen,setUserTicketOpen]=useState(\"\");const[queueTicketOpen,setQueueTicketOpen]=useState(\"\");const[selectedContact,setContact]=useState({id:0,name:\"\",number:0,profilePicUrl:\"\"});useEffect(()=>{const delayDebounceFn=setTimeout(()=>{const fetchContacts=async()=>{try{if(isNil(numbers)){return;}const number=numbers.replace(/\\D/g,\"\");const getData=await api.get(\"/contacts/profile/\".concat(number),{params:{channel:channel}});if(getData.data.contactId&&getData.data.contactId!==0){let obj={id:getData.data.contactId,name:contact,number:numbers,urlPicture:getData.data.urlPicture};setContact(obj);}else{let contactObj={name:contact,number:number,email:\"\",companyId:companyId};const{data}=await api.post(\"/contacts\",contactObj);setContact(data);}}catch(err){console.log(err);toastError(err);}};fetchContacts();},500);return()=>clearTimeout(delayDebounceFn);},[companyId,contact,numbers]);const handleCloseAlert=()=>{setOpenAlert(false);setOpenAlert(false);setUserTicketOpen(\"\");setQueueTicketOpen(\"\");};const handleNewChat=async()=>{try{const{data:ticket}=await api.post(\"/tickets\",{contactId:selectedContact.id,userId:user.id,status:\"open\",queueId,companyId:companyId,whatsappId});history.push(\"/tickets/\".concat(ticket.uuid));}catch(err){const ticket=JSON.parse(err.response.data.error);if(ticket.userId!==(user===null||user===void 0?void 0:user.id)){var _ticket$user,_ticket$queue;setOpenAlert(true);setUserTicketOpen(ticket===null||ticket===void 0?void 0:(_ticket$user=ticket.user)===null||_ticket$user===void 0?void 0:_ticket$user.name);setQueueTicketOpen(ticket===null||ticket===void 0?void 0:(_ticket$queue=ticket.queue)===null||_ticket$queue===void 0?void 0:_ticket$queue.name);}else{setOpenAlert(false);setUserTicketOpen(\"\");setQueueTicketOpen(\"\");history.push(\"/tickets/\".concat(ticket.uuid));}}};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{style:{minWidth:\"250px\"},children:[/*#__PURE__*/_jsx(ShowTicketOpen,{isOpen:openAlert,handleClose:handleCloseAlert,user:userTicketOpen,queue:queueTicketOpen}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:2,children:/*#__PURE__*/_jsx(Avatar,{src:\"\".concat(selectedContact===null||selectedContact===void 0?void 0:selectedContact.urlPicture)})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:9,children:/*#__PURE__*/_jsx(Typography,{style:{marginTop:\"12px\",marginLeft:\"10px\"},color:\"primary\",variant:\"subtitle1\",gutterBottom:true,children:selectedContact.name})}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Button,{fullWidth:true,color:\"primary\",onClick:handleNewChat,disabled:!selectedContact.number,children:\"Conversar\"})]})]})]})});};export default VcardPreview;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}