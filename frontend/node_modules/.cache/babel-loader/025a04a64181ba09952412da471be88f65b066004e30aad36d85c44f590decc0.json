{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useReducer,useContext,useRef}from\"react\";import{toast}from\"react-toastify\";import{makeStyles}from\"@material-ui/core/styles\";import Paper from\"@material-ui/core/Paper\";import Button from\"@material-ui/core/Button\";import Table from\"@material-ui/core/Table\";import TableBody from\"@material-ui/core/TableBody\";import TableCell from\"@material-ui/core/TableCell\";import TableHead from\"@material-ui/core/TableHead\";import TableRow from\"@material-ui/core/TableRow\";import IconButton from\"@material-ui/core/IconButton\";import SearchIcon from\"@material-ui/icons/Search\";import TextField from\"@material-ui/core/TextField\";import InputAdornment from\"@material-ui/core/InputAdornment\";import{FormControl,InputLabel,Select,MenuItem}from\"@material-ui/core\";import DeleteOutlineIcon from\"@material-ui/icons/DeleteOutline\";import EditIcon from\"@material-ui/icons/Edit\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import MainHeaderButtonsWrapper from\"../../components/MainHeaderButtonsWrapper\";import Title from\"../../components/Title\";import api from\"../../services/api\";import{i18n}from\"../../translate/i18n\";import TableRowSkeleton from\"../../components/TableRowSkeleton\";import TagModal from\"../../components/TagModal\";import ConfirmationModal from\"../../components/ConfirmationModal\";import toastError from\"../../errors/toastError\";import{Chip}from\"@material-ui/core\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{MoreHoriz}from\"@material-ui/icons\";import ContactTagListModal from\"../../components/ContactTagListModal\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const reducer=(state,action)=>{switch(action.type){case\"LOAD_TAGS\":return[...state,...action.payload];case\"UPDATE_TAGS\":const tag=action.payload;const tagIndex=state.findIndex(s=>s.id===tag.id);if(tagIndex!==-1){state[tagIndex]=tag;return[...state];}else{return[tag,...state];}case\"DELETE_TAGS\":const tagId=action.payload;return state.filter(tag=>tag.id!==tagId);case\"RESET\":return[];default:return state;}};const useStyles=makeStyles(theme=>({mainPaper:_objectSpread({flex:1,padding:theme.spacing(1),overflowY:\"scroll\"},theme.scrollbarStyles)}));const Tags=()=>{const classes=useStyles();const{user,socket}=useContext(AuthContext);const[selectedTagContacts,setSelectedTagContacts]=useState([]);const[contactModalOpen,setContactModalOpen]=useState(false);const[loading,setLoading]=useState(false);const[pageNumber,setPageNumber]=useState(1);const[hasMore,setHasMore]=useState(false);const[pageSize,setPageSize]=useState(50);const[selectedTagName,setSelectedTagName]=useState(\"\");const[selectedTag,setSelectedTag]=useState(null);const[deletingTag,setDeletingTag]=useState(null);const[confirmModalOpen,setConfirmModalOpen]=useState(false);const[searchParam,setSearchParam]=useState(\"\");const[tags,dispatch]=useReducer(reducer,[]);const[tagModalOpen,setTagModalOpen]=useState(false);const pageNumberRef=useRef(1);useEffect(()=>{const delayDebounceFn=setTimeout(()=>{const fetchMoreTags=async()=>{try{const{data}=await api.get(\"/tags/\",{params:{searchParam,pageNumber,kanban:0,limit:pageSize}});dispatch({type:\"LOAD_TAGS\",payload:data.tags});setHasMore(data.hasMore);setLoading(false);}catch(err){toastError(err);}};if(pageNumber>0){setLoading(true);fetchMoreTags();}},300);return()=>clearTimeout(delayDebounceFn);},[searchParam,pageNumber,pageSize]);useEffect(()=>{const onCompanyTags=data=>{if(data.action===\"update\"||data.action===\"create\"){dispatch({type:\"UPDATE_TAGS\",payload:data.tag});}if(data.action===\"delete\"){dispatch({type:\"DELETE_TAGS\",payload:+data.tagId});}};socket.on(\"company\".concat(user.companyId,\"-tag\"),onCompanyTags);return()=>{socket.off(\"company\".concat(user.companyId,\"-tag\"),onCompanyTags);};},[socket,user.companyId]);const handleOpenTagModal=()=>{setSelectedTag(null);setTagModalOpen(true);};const handleCloseTagModal=()=>{setSelectedTag(null);setTagModalOpen(false);};const handleSearch=event=>{const newSearchParam=event.target.value.toLowerCase();setSearchParam(newSearchParam);setPageNumber(1);dispatch({type:\"RESET\"});};const handlePageSizeChange=event=>{const newSize=Number(event.target.value);setPageSize(newSize);setPageNumber(1);dispatch({type:\"RESET\"});};const handleEditTag=tag=>{setSelectedTag(tag);setTagModalOpen(true);};const handleShowContacts=(contacts,tag)=>{setSelectedTagContacts(contacts);setContactModalOpen(true);setSelectedTagName(tag);};const handleCloseContactModal=()=>{setContactModalOpen(false);setSelectedTagContacts([]);setSelectedTagName(\"\");};const handleDeleteTag=async tagId=>{try{await api.delete(\"/tags/\".concat(tagId));toast.success(i18n.t(\"tags.toasts.deleted\"));}catch(err){toastError(err);}setDeletingTag(null);setSearchParam(\"\");setPageNumber(1);};const loadMore=()=>{setPageNumber(prevPageNumber=>prevPageNumber+1);};const handleScroll=e=>{if(!hasMore||loading)return;const{scrollTop,scrollHeight,clientHeight}=e.currentTarget;if(scrollHeight-(scrollTop+100)<clientHeight){loadMore();}};return/*#__PURE__*/_jsxs(MainContainer,{className:classes.mainContainer,children:[contactModalOpen&&/*#__PURE__*/_jsx(ContactTagListModal,{open:contactModalOpen,onClose:handleCloseContactModal,tag:selectedTagName}),/*#__PURE__*/_jsx(ConfirmationModal,{title:deletingTag&&\"\".concat(i18n.t(\"tags.confirmationModal.deleteTitle\")),open:confirmModalOpen,onClose:()=>setConfirmModalOpen(false),onConfirm:()=>handleDeleteTag(deletingTag.id),children:i18n.t(\"tags.confirmationModal.deleteMessage\")}),/*#__PURE__*/_jsx(TagModal,{open:tagModalOpen,onClose:handleCloseTagModal,\"aria-labelledby\":\"form-dialog-title\",tagId:selectedTag&&selectedTag.id,kanban:0}),/*#__PURE__*/_jsxs(MainHeader,{children:[/*#__PURE__*/_jsxs(Title,{children:[i18n.t(\"tags.title\"),\" (\",tags.length,\")\"]}),/*#__PURE__*/_jsxs(MainHeaderButtonsWrapper,{children:[/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",size:\"small\",style:{minWidth:140},children:[/*#__PURE__*/_jsx(InputLabel,{id:\"page-size-label\",children:\"Itens/p\\xE1gina\"}),/*#__PURE__*/_jsxs(Select,{labelId:\"page-size-label\",value:pageSize,onChange:handlePageSizeChange,label:\"Itens/p\\xE1gina\",children:[/*#__PURE__*/_jsx(MenuItem,{value:20,children:\"20\"}),/*#__PURE__*/_jsx(MenuItem,{value:50,children:\"50\"}),/*#__PURE__*/_jsx(MenuItem,{value:100,children:\"100\"})]})]}),/*#__PURE__*/_jsx(TextField,{placeholder:i18n.t(\"contacts.searchPlaceholder\"),type:\"search\",value:searchParam,onChange:handleSearch,InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(SearchIcon,{style:{color:\"gray\"}})})}}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:handleOpenTagModal,children:i18n.t(\"tags.buttons.add\")})]})]}),/*#__PURE__*/_jsxs(Paper,{className:classes.mainPaper,variant:\"outlined\",onScroll:handleScroll,children:[/*#__PURE__*/_jsxs(Table,{size:\"small\",stickyHeader:true,children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"tags.table.id\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"tags.table.name\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"tags.table.contacts\")}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:i18n.t(\"tags.table.actions\")})]})}),/*#__PURE__*/_jsx(TableBody,{children:/*#__PURE__*/_jsxs(_Fragment,{children:[tags.map(tag=>{var _tag$contacts,_tag$contacts2;return/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:tag.id}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsx(Chip,{variant:\"outlined\",style:{backgroundColor:tag.color,textShadow:\"1px 1px #000\",color:\"white\"},label:tag.name,size:\"small\"})}),/*#__PURE__*/_jsxs(TableCell,{align:\"center\",children:[tag===null||tag===void 0?void 0:(_tag$contacts=tag.contacts)===null||_tag$contacts===void 0?void 0:_tag$contacts.length,/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleShowContacts(tag===null||tag===void 0?void 0:tag.contacts,tag),disabled:(tag===null||tag===void 0?void 0:(_tag$contacts2=tag.contacts)===null||_tag$contacts2===void 0?void 0:_tag$contacts2.length)===0,children:/*#__PURE__*/_jsx(MoreHoriz,{})})]}),/*#__PURE__*/_jsxs(TableCell,{align:\"center\",children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleEditTag(tag),children:/*#__PURE__*/_jsx(EditIcon,{})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>{setConfirmModalOpen(true);setDeletingTag(tag);},children:/*#__PURE__*/_jsx(DeleteOutlineIcon,{})})]})]},tag.id);}),loading&&Array.from({length:5}).map((_,idx)=>/*#__PURE__*/_jsx(TableRowSkeleton,{columns:4},\"skeleton-\".concat(idx)))]})})]}),hasMore&&/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',padding:8},children:/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"primary\",onClick:loadMore,disabled:loading,children:loading?i18n.t(\"contacts.loading\"):i18n.t(\"contacts.loadMore\")})})]})]});};export default Tags;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}