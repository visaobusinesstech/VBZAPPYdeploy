{"ast":null,"code":"import _objectSpread from\"/home/deploy/codigologlow/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from\"react\";import*as Yup from\"yup\";import{Formik,Form,Field}from\"formik\";import{toast}from\"react-toastify\";import{Button,Dialog,DialogActions,DialogContent,DialogTitle,CircularProgress,Select,InputLabel,MenuItem,FormControl,TextField,Grid,Paper}from\"@material-ui/core\";import{makeStyles}from\"@material-ui/core/styles\";import{green}from\"@material-ui/core/colors\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";import toastError from\"../../errors/toastError\";import{logError,logInfo}from\"../../utils/logger\";import{validateSgpConfig,SGP_PASSWORD_OPTIONS}from\"../../utils/sgp\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{display:\"flex\",flexWrap:\"wrap\",gap:4},textField:{marginRight:theme.spacing(1),flex:1},btnWrapper:{position:\"relative\"},buttonProgress:{color:green[500],position:\"absolute\",top:\"50%\",left:\"50%\",marginTop:-12,marginLeft:-12},btnLeft:{display:\"flex\",marginRight:\"auto\",marginLeft:12},colorAdorment:{width:20,height:20}}));const DialogflowSchema=Yup.object().shape({name:Yup.string().min(2,\"Too Short!\").max(50,\"Too Long!\").required(\"Required\")// projectName: Yup.string()\n//   .min(3, \"Too Short!\")\n//   .max(100, \"Too Long!\")\n//   .required(),\n// jsonContent: Yup.string().min(3, \"Too Short!\").required(),\n// language: Yup.string().min(2, \"Too Short!\").max(50, \"Too Long!\").required(),\n});const QueueIntegration=_ref=>{let{open,onClose,integrationId}=_ref;const classes=useStyles();const initialState={type:\"typebot\",name:\"\",projectName:\"\",jsonContent:\"\",language:\"\",urlN8N:\"\",typebotDelayMessage:1000,typebotExpires:1,typebotKeywordFinish:\"\",typebotKeywordRestart:\"\",typebotRestartMessage:\"\",typebotSlug:\"\",typebotUnknownMessage:\"\",// SGP integration fields\nsgpIeSenha:\"\",sgpUrl:\"\",sgpWidePayToken:\"\"};const[integration,setIntegration]=useState(initialState);useEffect(()=>{(async()=>{if(!integrationId)return;try{const{data}=await api.get(\"/queueIntegration/\".concat(integrationId));let sgpFromJson={};try{sgpFromJson=data!==null&&data!==void 0&&data.jsonContent?JSON.parse(data.jsonContent):{};}catch(e){logError(\"Falha ao parsear jsonContent da integração\",e);}setIntegration(prevState=>_objectSpread(_objectSpread(_objectSpread({},prevState),data),{},{sgpIeSenha:sgpFromJson.sgpIeSenha||prevState.sgpIeSenha,sgpUrl:sgpFromJson.sgpUrl||prevState.sgpUrl,sgpWidePayToken:sgpFromJson.sgpWidePayToken||prevState.sgpWidePayToken}));}catch(err){toastError(err);}})();return()=>{setIntegration({type:\"dialogflow\",name:\"\",projectName:\"\",jsonContent:\"\",language:\"\",urlN8N:\"\",typebotDelayMessage:1000});};},[integrationId,open]);const handleClose=()=>{onClose();setIntegration(initialState);};const handleTestSession=async(event,values)=>{try{const{projectName,jsonContent,language}=values;await api.post(\"/queueIntegration/testSession\",{projectName,jsonContent,language});toast.success(i18n.t(\"queueIntegrationModal.messages.testSuccess\"));}catch(err){toastError(err);}};const handleSaveDialogflow=async values=>{try{if(values.type===\"n8n\"||values.type===\"webhook\"||values.type===\"typebot\"||values.type===\"flowbuilder\"||values.type===\"SGP\"){values.projectName=values.name;}// Basic validation for SGP\nif(values.type===\"SGP\"){const errors=validateSgpConfig(values);if(errors.length){errors.forEach(e=>toast.error(e));logError(\"Falha de validação SGP\",{errors,values});return;}logInfo(\"Salvando integração SGP\",{name:values.name});}// Persist SGP settings into jsonContent\nlet payload=_objectSpread({},values);if(values.type===\"SGP\"){let baseJson={};try{baseJson=values.jsonContent?JSON.parse(values.jsonContent):{};}catch(_unused){}const jsonContent=_objectSpread(_objectSpread({},baseJson),{},{sgpIeSenha:values.sgpIeSenha,sgpUrl:values.sgpUrl,sgpWidePayToken:values.sgpWidePayToken});payload=_objectSpread(_objectSpread({},values),{},{jsonContent:JSON.stringify(jsonContent)});// Avoid sending unknown top-level attrs (backend model lacks columns)\ndelete payload.sgpIeSenha;delete payload.sgpUrl;delete payload.sgpWidePayToken;}if(integrationId){await api.put(\"/queueIntegration/\".concat(integrationId),payload);toast.success(i18n.t(\"queueIntegrationModal.messages.editSuccess\"));}else{await api.post(\"/queueIntegration\",payload);toast.success(i18n.t(\"queueIntegrationModal.messages.addSuccess\"));}handleClose();}catch(err){toastError(err);}};return/*#__PURE__*/_jsx(\"div\",{className:classes.root,children:/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleClose,fullWidth:true,maxWidth:\"md\",scroll:\"paper\",children:[/*#__PURE__*/_jsx(DialogTitle,{children:integrationId?\"\".concat(i18n.t(\"queueIntegrationModal.title.edit\")):\"\".concat(i18n.t(\"queueIntegrationModal.title.add\"))}),/*#__PURE__*/_jsx(Formik,{initialValues:integration,enableReinitialize:true,validationSchema:DialogflowSchema,onSubmit:(values,actions,event)=>{setTimeout(()=>{handleSaveDialogflow(values);actions.setSubmitting(false);},400);},children:_ref2=>{let{touched,errors,isSubmitting,values}=_ref2;return/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsx(Paper,{square:true,className:classes.mainPaper,elevation:1,children:/*#__PURE__*/_jsx(DialogContent,{dividers:true,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",className:classes.formControl,margin:\"dense\",fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"type-selection-input-label\",children:i18n.t(\"queueIntegrationModal.form.type\")}),/*#__PURE__*/_jsxs(Field,{as:Select,label:i18n.t(\"queueIntegrationModal.form.type\"),name:\"type\",labelId:\"profile-selection-label\",error:touched.type&&Boolean(errors.type),helpertext:touched.type&&errors.type,id:\"type\",required:true,children:[/*#__PURE__*/_jsx(MenuItem,{value:\"SGP\",children:\"SGP\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"dialogflow\",children:\"DialogFlow\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"n8n\",children:\"N8N\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"webhook\",children:\"WebHooks\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"typebot\",children:\"Typebot\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"flowbuilder\",children:\"Flowbuilder\"})]})]})}),values.type===\"SGP\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.name\"),autoFocus:true,name:\"name\",fullWidth:true,error:touched.name&&Boolean(errors.name),helpertext:touched.name&&errors.name,variant:\"outlined\",margin:\"dense\",className:classes.textField})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",className:classes.formControl,margin:\"dense\",fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"sgpIeSenha-selection-input-label\",children:\"Usu\\xE1rio Informa Senha\"}),/*#__PURE__*/_jsx(Field,{as:Select,label:\"Usu\\xE1rio Informa Senha\",name:\"sgpIeSenha\",labelId:\"profile-selection-label\",fullWidth:true,error:touched.sgpIeSenha&&Boolean(errors.sgpIeSenha),helpertext:touched.sgpIeSenha&&errors.sgpIeSenha,id:\"sgpIeSenha-selection\",required:true,children:SGP_PASSWORD_OPTIONS.map(opt=>/*#__PURE__*/_jsx(MenuItem,{value:opt.value,children:opt.label},opt.value))})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:\"SGP URL\",name:\"sgpUrl\",error:touched.sgpUrl&&Boolean(errors.sgpUrl),helpertext:touched.sgpUrl&&errors.sgpUrl,fullWidth:true,variant:\"outlined\",margin:\"dense\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:\"Widepay Token\",name:\"sgpWidePayToken\",error:touched.sgpWidePayToken&&Boolean(errors.sgpWidePayToken),helpertext:touched.sgpWidePayToken&&errors.sgpWidePayToken,fullWidth:true,variant:\"outlined\",margin:\"dense\"})})]}),values.type===\"dialogflow\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.name\"),autoFocus:true,name:\"name\",fullWidth:true,error:touched.name&&Boolean(errors.name),helpertext:touched.name&&errors.name,variant:\"outlined\",margin:\"dense\",className:classes.textField})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",className:classes.formControl,margin:\"dense\",fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"language-selection-input-label\",children:i18n.t(\"queueIntegrationModal.form.language\")}),/*#__PURE__*/_jsxs(Field,{as:Select,label:i18n.t(\"queueIntegrationModal.form.language\"),name:\"language\",labelId:\"profile-selection-label\",fullWidth:true,error:touched.language&&Boolean(errors.language),helpertext:touched.language&&errors.language,id:\"language-selection\",required:true,children:[/*#__PURE__*/_jsx(MenuItem,{value:\"pt-BR\",children:\"Portugues\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"en\",children:\"Ingl\\xEAs\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"es\",children:\"Espa\\xF1ol\"})]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.projectName\"),name:\"projectName\",error:touched.projectName&&Boolean(errors.projectName),helpertext:touched.projectName&&errors.projectName,fullWidth:true,variant:\"outlined\",margin:\"dense\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:12,xl:12,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.jsonContent\"),type:\"jsonContent\",multiline:true//inputRef={greetingRef}\n,maxRows:5,minRows:5,fullWidth:true,name:\"jsonContent\",error:touched.jsonContent&&Boolean(errors.jsonContent),helpertext:touched.jsonContent&&errors.jsonContent,variant:\"outlined\",margin:\"dense\"})})]}),(values.type===\"n8n\"||values.type===\"webhook\")&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.name\"),autoFocus:true,required:true,name:\"name\",error:touched.name&&Boolean(errors.name),helpertext:touched.name&&errors.name,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:12,xl:12,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.urlN8N\"),name:\"urlN8N\",error:touched.urlN8N&&Boolean(errors.urlN8N),helpertext:touched.urlN8N&&errors.urlN8N,variant:\"outlined\",margin:\"dense\",required:true,fullWidth:true,className:classes.textField})})]}),values.type===\"flowbuilder\"&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.name\"),autoFocus:true,name:\"name\",fullWidth:true,error:touched.name&&Boolean(errors.name),helpertext:touched.name&&errors.name,variant:\"outlined\",margin:\"dense\",className:classes.textField})}),values.type===\"typebot\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.name\"),autoFocus:true,name:\"name\",error:touched.name&&Boolean(errors.name),helpertext:touched.name&&errors.name,variant:\"outlined\",margin:\"dense\",required:true,fullWidth:true,className:classes.textField})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:12,xl:12,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.urlN8N\"),name:\"urlN8N\",error:touched.urlN8N&&Boolean(errors.urlN8N),helpertext:touched.urlN8N&&errors.urlN8N,variant:\"outlined\",margin:\"dense\",required:true,fullWidth:true,className:classes.textField})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotSlug\"),name:\"typebotSlug\",error:touched.typebotSlug&&Boolean(errors.typebotSlug),helpertext:touched.typebotSlug&&errors.typebotSlug,required:true,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotExpires\"),name:\"typebotExpires\",error:touched.typebotExpires&&Boolean(errors.typebotExpires),helpertext:touched.typebotExpires&&errors.typebotExpires,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotDelayMessage\"),name:\"typebotDelayMessage\",error:touched.typebotDelayMessage&&Boolean(errors.typebotDelayMessage),helpertext:touched.typebotDelayMessage&&errors.typebotDelayMessage,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotKeywordFinish\"),name:\"typebotKeywordFinish\",error:touched.typebotKeywordFinish&&Boolean(errors.typebotKeywordFinish),helpertext:touched.typebotKeywordFinish&&errors.typebotKeywordFinish,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotKeywordRestart\"),name:\"typebotKeywordRestart\",error:touched.typebotKeywordRestart&&Boolean(errors.typebotKeywordRestart),helpertext:touched.typebotKeywordRestart&&errors.typebotKeywordRestart,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,xl:6,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotUnknownMessage\"),name:\"typebotUnknownMessage\",error:touched.typebotUnknownMessage&&Boolean(errors.typebotUnknownMessage),helpertext:touched.typebotUnknownMessage&&errors.typebotUnknownMessage,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:12,xl:12,children:/*#__PURE__*/_jsx(Field,{as:TextField,label:i18n.t(\"queueIntegrationModal.form.typebotRestartMessage\"),name:\"typebotRestartMessage\",error:touched.typebotRestartMessage&&Boolean(errors.typebotRestartMessage),helpertext:touched.typebotRestartMessage&&errors.typebotRestartMessage,variant:\"outlined\",margin:\"dense\",fullWidth:true,className:classes.textField})})]})]})})}),/*#__PURE__*/_jsxs(DialogActions,{children:[values.type===\"dialogflow\"&&/*#__PURE__*/_jsx(Button//type=\"submit\"\n,{onClick:e=>handleTestSession(e,values),color:\"inherit\",disabled:isSubmitting,name:\"testSession\",variant:\"outlined\",className:classes.btnLeft,children:i18n.t(\"queueIntegrationModal.buttons.test\")}),/*#__PURE__*/_jsx(Button,{onClick:handleClose,color:\"secondary\",disabled:isSubmitting,variant:\"outlined\",children:i18n.t(\"queueIntegrationModal.buttons.cancel\")}),/*#__PURE__*/_jsxs(Button,{type:\"submit\",color:\"primary\",disabled:isSubmitting,variant:\"contained\",className:classes.btnWrapper,children:[integrationId?\"\".concat(i18n.t(\"queueIntegrationModal.buttons.okEdit\")):\"\".concat(i18n.t(\"queueIntegrationModal.buttons.okAdd\")),isSubmitting&&/*#__PURE__*/_jsx(CircularProgress,{size:24,className:classes.buttonProgress})]})]})]});}})]})});};export default QueueIntegration;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}