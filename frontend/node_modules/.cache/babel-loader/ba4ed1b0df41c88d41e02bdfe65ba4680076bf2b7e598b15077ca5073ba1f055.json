{"ast":null,"code":"import _objectSpread from\"/home/deploy/codigologlow/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useContext}from\"react\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import Title from\"../../components/Title\";import{makeStyles,Paper,Tabs,Tab}from\"@material-ui/core\";import TabPanel from\"../../components/TabPanel\";import SchedulesForm from\"../../components/SchedulesForm\";import CompaniesManager from\"../../components/CompaniesManager\";import PlansManager from\"../../components/PlansManager\";import HelpsManager from\"../../components/HelpsManager\";import Options from\"../../components/Settings/Options\";import Whitelabel from\"../../components/Settings/Whitelabel\";import FinalizacaoAtendimento from\"../../components/Settings/FinalizacaoAtendimento\";import{i18n}from\"../../translate/i18n\";import{toast}from\"react-toastify\";import useCompanies from\"../../hooks/useCompanies\";import{AuthContext}from\"../../context/Auth/AuthContext\";import OnlyForSuperUser from\"../../components/OnlyForSuperUser\";import useCompanySettings from\"../../hooks/useSettings/companySettings\";import useSettings from\"../../hooks/useSettings\";import ForbiddenPage from\"../../components/ForbiddenPage\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{flex:1,backgroundColor:theme.palette.background.paper},mainPaper:_objectSpread(_objectSpread({},theme.scrollbarStyles),{},{overflowY:\"scroll\",flex:1}),tab:{backgroundColor:theme.mode===\"light\"?\"#f2f2f2\":\"#7f7f7f\",borderRadius:4},paper:_objectSpread(_objectSpread({},theme.scrollbarStyles),{},{overflowY:\"scroll\",padding:theme.spacing(2),display:\"flex\",alignItems:\"center\",width:\"100%\"}),container:{width:\"100%\",maxHeight:\"100%\"},control:{padding:theme.spacing(1)},textfield:{width:\"100%\"}}));const SettingsCustom=()=>{const classes=useStyles();const[tab,setTab]=useState(\"options\");const[schedules,setSchedules]=useState([]);const[company,setCompany]=useState({});const[loading,setLoading]=useState(false);const[currentUser,setCurrentUser]=useState({});const[settings,setSettings]=useState({});const[oldSettings,setOldSettings]=useState({});const[schedulesEnabled,setSchedulesEnabled]=useState(false);const{find,updateSchedules}=useCompanies();const{getAll:getAllSettings}=useCompanySettings();const{getAll:getAllSettingsOld}=useSettings();const{user,socket}=useContext(AuthContext);useEffect(()=>{async function findData(){if(!user||!user.companyId){return;}setLoading(true);try{const companyId=user.companyId;const company=await find(companyId);const settingList=await getAllSettings(companyId);const settingListOld=await getAllSettingsOld();setCompany(company);setSchedules(company.schedules);setSettings(settingList);setOldSettings(settingListOld);setSchedulesEnabled(settingList.scheduleType===\"company\");setCurrentUser(user);}catch(e){toast.error(e);}setLoading(false);}findData();},[]);useEffect(()=>{if(!socket||!user||!user.companyId)return;const onSettingsEvent=()=>{getAllSettingsOld().then(setOldSettings);};socket.on(\"company-\".concat(user.companyId,\"-settings\"),onSettingsEvent);return()=>{socket.off(\"company-\".concat(user.companyId,\"-settings\"),onSettingsEvent);};},[socket,user]);const handleTabChange=(event,newValue)=>{setTab(newValue);};const handleSubmitSchedules=async data=>{setLoading(true);try{setSchedules(data);await updateSchedules({id:company.id,schedules:data});toast.success(\"HorÃ¡rios atualizados com sucesso.\");}catch(e){toast.error(e);}setLoading(false);};const isSuper=()=>{return currentUser&&currentUser.super;};return/*#__PURE__*/_jsx(MainContainer,{className:classes.root,children:user.profile===\"user\"?/*#__PURE__*/_jsx(ForbiddenPage,{}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(MainHeader,{children:/*#__PURE__*/_jsx(Title,{children:i18n.t(\"settings.title\")})}),/*#__PURE__*/_jsxs(Paper,{className:classes.mainPaper,elevation:1,children:[/*#__PURE__*/_jsxs(Tabs,{value:tab,indicatorColor:\"primary\",textColor:\"primary\",scrollButtons:\"on\",variant:\"scrollable\",onChange:handleTabChange,className:classes.tab,children:[/*#__PURE__*/_jsx(Tab,{label:i18n.t(\"settings.tabs.options\"),value:\"options\"}),schedulesEnabled&&/*#__PURE__*/_jsx(Tab,{label:\"Hor\\xE1rios\",value:\"schedules\"}),user.profile===\"admin\"&&user.finalizacaoComValorVendaAtiva&&/*#__PURE__*/_jsx(Tab,{label:\"Finaliza\\xE7\\xE3o do Atendimento\",value:\"finalizacao\"}),isSuper()?/*#__PURE__*/_jsx(Tab,{label:i18n.t(\"settings.tabs.companies\"),value:\"companies\"}):null,isSuper()?/*#__PURE__*/_jsx(Tab,{label:i18n.t(\"settings.tabs.plans\"),value:\"plans\"}):null,isSuper()?/*#__PURE__*/_jsx(Tab,{label:i18n.t(\"settings.tabs.helps\"),value:\"helps\"}):null,isSuper()?/*#__PURE__*/_jsx(Tab,{label:\"Whitelabel\",value:\"whitelabel\"}):null]}),/*#__PURE__*/_jsxs(Paper,{className:classes.paper,elevation:0,children:[tab===\"schedules\"&&/*#__PURE__*/_jsx(\"div\",{className:classes.container,children:/*#__PURE__*/_jsx(SchedulesForm,{loading:loading,onSubmit:handleSubmitSchedules,initialValues:schedules})}),tab===\"companies\"&&isSuper()&&/*#__PURE__*/_jsx(\"div\",{className:classes.container,children:/*#__PURE__*/_jsx(CompaniesManager,{})}),tab===\"plans\"&&isSuper()&&/*#__PURE__*/_jsx(\"div\",{className:classes.container,children:/*#__PURE__*/_jsx(PlansManager,{})}),tab===\"helps\"&&isSuper()&&/*#__PURE__*/_jsx(\"div\",{className:classes.container,children:/*#__PURE__*/_jsx(HelpsManager,{})}),tab===\"whitelabel\"&&isSuper()&&/*#__PURE__*/_jsx(\"div\",{className:classes.container,children:/*#__PURE__*/_jsx(Whitelabel,{settings:oldSettings})}),tab===\"finalizacao\"&&/*#__PURE__*/_jsx(\"div\",{className:classes.container,children:/*#__PURE__*/_jsx(FinalizacaoAtendimento,{settings:settings,onSettingsChange:newSettings=>setSettings(newSettings)})}),tab===\"options\"&&/*#__PURE__*/_jsx(\"div\",{className:classes.container,children:/*#__PURE__*/_jsx(Options,{settings:settings,oldSettings:oldSettings,user:currentUser,scheduleTypeChanged:value=>setSchedulesEnabled(value===\"company\")})})]})]})]})});};export default SettingsCustom;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}