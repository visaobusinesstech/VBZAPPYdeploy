{"ast":null,"code":"import _objectSpread from\"/home/deploy/codigologlow/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import Button from'@material-ui/core/Button';import TextField from'@material-ui/core/TextField';import List from'@material-ui/core/List';import{makeStyles}from'@material-ui/core/styles';import*as Yup from\"yup\";import{Formik,Form,Field}from\"formik\";import ContactNotesDialogListItem from'../ContactNotesDialogListItem';import ConfirmationModal from'../ConfirmationModal';import ContactNotesEditModal from'../ContactNotesEditModal';import{toast}from\"react-toastify\";import{i18n}from\"../../translate/i18n\";import ButtonWithSpinner from'../ButtonWithSpinner';import useTicketNotes from'../../hooks/useTicketNotes';import{Grid}from'@material-ui/core';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{'& .MuiTextField-root':{margin:theme.spacing(1),width:'350px'}},list:{width:'100%',maxWidth:'350px',maxHeight:'200px',backgroundColor:theme.palette.background.paper,overflow:'auto'},inline:{width:'100%'}}));const NoteSchema=Yup.object().shape({note:Yup.string().min(2,\"Too Short!\").required(\"Required\")});export function ContactNotes(_ref){let{ticket}=_ref;const{id:ticketId,contactId}=ticket;const classes=useStyles();const[newNote,setNewNote]=useState({note:\"\"});const[loading,setLoading]=useState(false);const[showOnDeleteDialog,setShowOnDeleteDialog]=useState(false);const[selectedNote,setSelectedNote]=useState({});const[notes,setNotes]=useState([]);const{saveNote,deleteNote,listNotes}=useTicketNotes();const[editingNote,setEditingNote]=useState(null);useEffect(()=>{async function openAndFetchData(){handleResetState();await loadNotes();}openAndFetchData();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);const handleResetState=()=>{setNewNote({note:\"\"});setLoading(false);};const handleChangeComment=e=>{setNewNote({note:e.target.value});};const handleEdit=note=>{console.log(note);setEditingNote(note);};const handleSave=async values=>{setLoading(true);try{await saveNote(_objectSpread(_objectSpread({},values),{},{ticketId,contactId}));await loadNotes();setNewNote({note:''});toast.success('Observação adicionada com sucesso!');}catch(e){toast.error(e);}setLoading(false);};const handleOpenDialogDelete=item=>{setSelectedNote(item);setShowOnDeleteDialog(true);};const handleDelete=async()=>{setLoading(true);try{await deleteNote(selectedNote.id);await loadNotes();setSelectedNote({});toast.success('Observação excluída com sucesso!');}catch(e){toast.error(e);}setLoading(false);};const loadNotes=async()=>{setLoading(true);try{const notes=await listNotes({ticketId,contactId});setNotes(notes);}catch(e){toast.error(e);}setLoading(false);};const renderNoteList=()=>{return notes.map(note=>{return/*#__PURE__*/_jsx(ContactNotesDialogListItem,{note:note,deleteItem:handleOpenDialogDelete,editItem:()=>handleEdit(note)},note.id);});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ContactNotesEditModal,{open:editingNote!==null,onClose:()=>setEditingNote(null),note:editingNote?editingNote.note:'',onSave:handleSave}),/*#__PURE__*/_jsx(ConfirmationModal,{title:\"Excluir Registro\",open:showOnDeleteDialog,onClose:setShowOnDeleteDialog,onConfirm:handleDelete,children:\"Deseja realmente excluir este registro?\"}),/*#__PURE__*/_jsx(Formik,{initialValues:newNote,enableReinitialize:true,validationSchema:NoteSchema,onSubmit:(values,actions)=>{setTimeout(()=>{handleSave(values);actions.setSubmitting(false);},400);},children:_ref2=>{let{touched,errors,setErrors}=_ref2;return/*#__PURE__*/_jsx(Form,{children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsx(Field,{as:TextField,name:\"note\",rows:3,label:i18n.t(\"ticketOptionsMenu.appointmentsModal.textarea\"),placeholder:i18n.t(\"ticketOptionsMenu.appointmentsModal.placeholder\"),multiline:true,error:touched.note&&Boolean(errors.note),helperText:touched.note&&errors.note,variant:\"outlined\",onChange:handleChangeComment,fullWidth:true})}),notes.length>0&&/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsx(List,{className:classes.list,children:renderNoteList()})}),/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{xs:6,item:true,children:/*#__PURE__*/_jsx(Button,{onClick:()=>{setNewNote(\"\");setErrors({});},color:\"primary\",variant:\"outlined\",fullWidth:true,children:\"Cancelar\"})}),/*#__PURE__*/_jsx(Grid,{xs:6,item:true,children:/*#__PURE__*/_jsx(ButtonWithSpinner,{loading:loading,color:\"primary\",type:\"submit\",variant:\"contained\",autoFocus:true,fullWidth:true,children:\"Salvar\"})})]})})]})});}})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}