{"ast":null,"code":"import _objectSpread from\"/home/deploy/codigologlow/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{Button,ClickAwayListener,FormControl,IconButton,Input,InputAdornment,makeStyles,Paper,Typography,Avatar,Dialog,DialogTitle,DialogContent,DialogActions,TextField,List,ListItem,ListItemText}from\"@material-ui/core\";import MoodIcon from\"@material-ui/icons/Mood\";import SendIcon from\"@material-ui/icons/Send\";import{Picker}from\"emoji-mart\";import\"emoji-mart/css/emoji-mart.css\";import React,{Fragment,useContext,useEffect,useRef,useState}from\"react\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{useDate}from\"../../hooks/useDate\";import api from\"../../services/api\";import{i18n}from\"../../translate/i18n\";import{GetApp}from\"@mui/icons-material\";import AttachFileIcon from\"@mui/icons-material/AttachFile\";import CancelIcon from\"@mui/icons-material/Cancel\";import CheckCircleOutlineIcon from\"@mui/icons-material/CheckCircleOutline\";import HighlightOffIcon from\"@mui/icons-material/HighlightOff\";import MicIcon from\"@mui/icons-material/Mic\";import CircularProgress from\"@mui/material/CircularProgress\";import{green}from\"@mui/material/colors\";import MicRecorder from\"mic-recorder-to-mp3\";import MarkdownWrapper from\"../../components/MarkdownWrapper\";import RecordingTimer from\"../../components/MessageInput/RecordingTimer\";import ModalImageCors from\"../../components/ModalImageCors\";import toastError from\"../../errors/toastError\";import AudioModal from\"../../components/AudioModal\";import DocumentModal from\"../../components/DocumentModal\";import whatsBackground from\"../../assets/wa-background.png\";import whatsBackgroundDark from\"../../assets/wa-background-dark.png\";import{format,isSameDay,parseISO}from\"date-fns\";import ReplyIcon from\"@mui/icons-material/Reply\";import CloseIcon from\"@mui/icons-material/Close\";import EditIcon from\"@mui/icons-material/Edit\";import DeleteIcon from\"@mui/icons-material/Delete\";import ForwardIcon from\"@mui/icons-material/Forward\";import IosShareIcon from\"@mui/icons-material/IosShare\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({mainContainer:{display:\"flex\",flexDirection:\"column\",position:\"relative\",flex:1,overflow:\"hidden\",borderRadius:0,height:\"100%\",borderLeft:\"1px solid rgba(0, 0, 0, 0.12)\"},messageList:_objectSpread(_objectSpread({position:\"relative\",overflowY:\"auto\",height:\"100%\"},theme.scrollbarStyles),{},{backgroundImage:theme.mode===\"light\"?\"url(\".concat(whatsBackground,\")\"):\"url(\".concat(whatsBackgroundDark,\")\"),backgroundColor:theme.mode===\"light\"?\"transparent\":\"#0b0b0d\"}),inputArea:{position:\"relative\",height:\"auto\"},input:{padding:\"20px\"},buttonSend:{margin:theme.spacing(1)},messageContainer:{display:\"flex\",margin:\"10px\",alignItems:\"center\"},messageContainerSelf:{display:\"flex\",margin:\"10px\",alignItems:\"center\",justifyContent:\"flex-end\"},messageContainerWithAvatar:{display:\"flex\",margin:\"10px\",alignItems:\"flex-start\"},avatarContainer:{marginRight:10,display:\"flex\",alignItems:\"center\",alignSelf:\"center\"},messageBubble:{padding:\"15px\",position:\"relative\",backgroundColor:\"#ffffff\",color:\"#303030\",maxWidth:350,width:\"100%\",borderRadius:20,border:\"1px solid rgba(0, 0, 0, 0.12)\"},messageBubbleSelf:{padding:\"15px\",position:\"relative\",backgroundColor:\"#dcf8c6\",color:\"#303030\",maxWidth:350,width:\"100%\",borderRadius:20,border:\"1px solid rgba(0, 0, 0, 0.12)\"},bubbleContent:{marginTop:5,whiteSpace:\"pre-wrap\",wordBreak:\"break-word\",overflowWrap:\"break-word\"},senderInfo:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",marginBottom:5},senderName:{fontWeight:\"bold\"},sendMessageIcons:{color:\"grey\"},uploadInput:{display:\"none\"},circleLoading:{color:green[500],opacity:\"70%\",position:\"absolute\",top:\"20%\",left:\"50%\",marginLeft:-12},viewMediaInputWrapper:{display:\"flex\",padding:\"10px 13px\",position:\"relative\",justifyContent:\"space-between\",alignItems:\"center\",backgroundColor:\"#eee\",borderTop:\"1px solid rgba(0, 0, 0, 0.12)\"},downloadMedia:{display:\"flex\",alignItems:\"center\",justifyContent:\"center\",backgroundColor:\"inherit\",padding:10},messageMedia:{objectFit:\"cover\",width:250,height:200,borderTopLeftRadius:8,borderTopRightRadius:8,borderBottomLeftRadius:8,borderBottomRightRadius:8},recorderWrapper:{display:\"flex\",alignItems:\"center\",alignContent:\"middle\",justifyContent:\"flex-end\"},cancelAudioIcon:{color:\"red\"},audioLoading:{color:green[500],opacity:\"70%\"},sendAudioIcon:{color:\"green\"},messageDate:{fontSize:\"0.75rem\",color:\"#666\",marginTop:5},emojiBox:{position:\"absolute\",bottom:63,left:10,zIndex:1000},sendMessageIcons:{color:\"grey\"},dailyTimestampText:{color:\"#808888\",padding:8,textAlign:\"center\",width:\"100%\",display:\"block\",margin:\"0 auto\"},replyContainer:{display:\"flex\",alignItems:\"center\",padding:\"8px 16px\",backgroundColor:\"#f0f2f5\",borderTop:\"1px solid rgba(0, 0, 0, 0.12)\"},replyContent:{flex:1,marginLeft:8},replyText:{fontSize:\"0.875rem\",color:\"#666\",whiteSpace:\"nowrap\",overflow:\"hidden\",textOverflow:\"ellipsis\"},replySender:{fontSize:\"0.75rem\",color:\"#999\"},messageActions:{display:\"flex\",gap:4,marginLeft:8},replyPreview:{borderLeft:\"3px solid #128C7E\",paddingLeft:\"8px\",marginBottom:\"8px\",backgroundColor:\"rgba(0, 0, 0, 0.05)\",borderRadius:\"4px\",padding:\"4px 8px\"},replyPreviewSender:{fontSize:\"0.75rem\",color:\"#128C7E\",fontWeight:\"bold\"},replyPreviewText:{fontSize:\"0.75rem\",color:\"#666\",whiteSpace:\"nowrap\",overflow:\"hidden\",textOverflow:\"ellipsis\"},dailyTimestamp:{width:\"100%\",display:\"block\"},highlightedMessage:{backgroundColor:\"#ffe082\",transition:\"background 0.5s\"},forwardedMessage:{// borderLeft: \"3px solid #128C7E\",\n// paddingLeft: \"8px\",\n// marginBottom: \"8px\",\n// backgroundColor: \"rgba(0, 0, 0, 0.05)\",\n// borderRadius: \"4px\",\n// padding: \"4px 8px\",\n},forwardedMessageHeader:{display:\"flex\",alignItems:\"center\",gap:\"4px\",color:\"#999\",fontSize:\"0.75rem\",marginBottom:\"4px\"},forwardedMessageText:{// fontSize: \"0.875rem\",\n// color: \"#666\",\n}}));const Mp3Recorder=new MicRecorder({bitRate:128});export default function ChatMessages(_ref){var _medias$;let{chat,messages,handleSendMessage,handleLoadMore,scrollToBottomRef,pageInfo,loadingMore,onEdit,onDelete,onForward,// messageListRef,\n// isFirstPage,\njustOpenedChat,setJustOpenedChat,addOptimisticMessage}=_ref;const topRef=useRef(null);const classes=useStyles();const{user}=useContext(AuthContext);const{datetimeToClient}=useDate();const baseRef=useRef();const messageRefs=useRef({});const[contentMessage,setContentMessage]=useState(\"\");const[medias,setMedias]=useState([]);const[loading,setLoading]=useState(false);const[recording,setRecording]=useState(false);const[showEmoji,setShowEmoji]=useState(false);const inputRef=useRef();const[replyingTo,setReplyingTo]=useState(null);const[initialScrollDone,setInitialScrollDone]=useState(false);const[canLoadMore,setCanLoadMore]=useState(false);const scrollToBottom=()=>{if(baseRef.current){baseRef.current.scrollIntoView({});}};const unreadMessages=chat=>{if(chat&&chat.users&&Array.isArray(chat.users)){const currentUser=chat.users.find(u=>u.userId===user.id);return currentUser&&currentUser.unreads>0;}return false;};useEffect(()=>{if(justOpenedChat){setInitialScrollDone(false);}},[justOpenedChat]);useEffect(()=>{if(chat&&chat.id&&unreadMessages(chat)){try{api.post(\"/chats/\".concat(chat.id,\"/read\"),{userId:user.id});}catch(err){console.error(\"Erro ao marcar mensagens como lidas:\",err);}}scrollToBottomRef.current=scrollToBottom;// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(()=>{if(!messages||messages.length===0||loadingMore||initialScrollDone)return;const scrollToBottomSafely=()=>{requestAnimationFrame(()=>{setTimeout(()=>{const container=document.querySelector(\".messageList\");if(container){container.scrollTop=container.scrollHeight;setInitialScrollDone(true);}},100);// Aumentar o timeout para dar tempo das mensagens renderizarem\n});};scrollToBottomSafely();},[messages,loadingMore,initialScrollDone]);// Após o scroll automático inicial, liberar o carregamento incremental\nuseEffect(()=>{if(!loading&&!loadingMore&&initialScrollDone){setCanLoadMore(true);}},[loading,loadingMore,initialScrollDone]);// Adicionar um useEffect separado para quando justOpenedChat muda\nuseEffect(()=>{if(justOpenedChat&&messages&&messages.length>0){const scrollToBottomSafely=()=>{requestAnimationFrame(()=>{setTimeout(()=>{const container=document.querySelector(\".messageList\");if(container){container.scrollTop=container.scrollHeight;setJustOpenedChat(false);// Resetar após executar o scroll\n}},200);// Timeout maior para garantir que tudo foi renderizado\n});};scrollToBottomSafely();}},[justOpenedChat,messages]);const handleScroll=e=>{if(!initialScrollDone||!canLoadMore)return;const{scrollTop,scrollHeight,clientHeight}=e.currentTarget;if(!(pageInfo!==null&&pageInfo!==void 0&&pageInfo.hasMore)||loading)return;if(scrollTop<200){console.log(\"Carregando mais mensagens... ScrollTop:\",scrollTop);handleLoadMore();}};const handleChangeMedias=e=>{if(!e.target.files){return;}const selectedMedias=Array.from(e.target.files);setMedias(selectedMedias);};const handlePaste=e=>{if(e.clipboardData.files.length>0){const selectedMedias=Array.from(e.clipboardData.files);setMedias(selectedMedias);e.preventDefault();}};const handleAddEmoji=e=>{let emoji=e.native;setContentMessage(prevState=>prevState+emoji);inputRef.current.focus();};const[documentModalOpen,setDocumentModalOpen]=useState(false);const[selectedDocument,setSelectedDocument]=useState(null);const checkMessageMedia=message=>{if(message.mediaType===\"image\"){return/*#__PURE__*/_jsx(ModalImageCors,{imageUrl:message.mediaPath});}if(message.mediaType===\"audio\"){return/*#__PURE__*/_jsx(AudioModal,{url:message.mediaPath,message:message,disableTranscription:!chat.isGroup});}if(message.mediaType===\"video\"){return/*#__PURE__*/_jsx(\"video\",{className:classes.messageMedia,src:message.mediaPath,controls:true});}else{return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:classes.downloadMedia,children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(GetApp,{}),color:\"primary\",variant:\"outlined\",onClick:()=>{setSelectedDocument(message);setDocumentModalOpen(true);},children:\"Visualizar Documento\"})})});}};const handleSendMedia=async e=>{setLoading(true);e.preventDefault();const formData=new FormData();formData.append(\"fromMe\",true);medias.forEach(media=>{formData.append(\"typeArch\",\"chat\");formData.append(\"fileId\",chat.id);formData.append(\"medias\",media);formData.append(\"body\",media.name);});try{await api.post(\"/chats/\".concat(chat.id,\"/messages\"),formData);}catch(err){console.log(err);toastError(err);}setLoading(false);setMedias([]);};const handleStartRecording=async()=>{setLoading(true);try{await navigator.mediaDevices.getUserMedia({audio:true});await Mp3Recorder.start();setRecording(true);setLoading(false);}catch(err){toastError(err);setLoading(false);}};const handleUploadAudio=async()=>{setLoading(true);try{const[,blob]=await Mp3Recorder.stop().getMp3();if(blob.size<10000){setLoading(false);setRecording(false);return;}const formData=new FormData();const filename=\"audio-\".concat(new Date().getTime(),\".mp3\");formData.append(\"typeArch\",\"chat\");formData.append(\"fileId\",chat.id);formData.append(\"medias\",blob,filename);formData.append(\"body\",filename);formData.append(\"fromMe\",true);await api.post(\"/chats/\".concat(chat.id,\"/messages\"),formData);}catch(err){toastError(err);}setRecording(false);setLoading(false);};const handleCancelAudio=async()=>{try{await Mp3Recorder.stop().getMp3();setRecording(false);}catch(err){toastError(err);}};const handleReply=message=>{setReplyingTo(message);if(inputRef.current){inputRef.current.focus();}};const handleCancelReply=()=>{setReplyingTo(null);};const handleSendMessageWithReply=async content=>{if(content.trim()!==\"\"){// Adicione a mensagem localmente de forma otimista\nconst optimisticMessage={id:\"temp-\".concat(Date.now()),chatId:chat.id,senderId:user.id,message:content,createdAt:new Date().toISOString(),sender:{id:user.id,name:user.name,profileImage:user.profileImage},replyTo:replyingTo,isDeleted:false,isEdited:false,mediaType:\"text\"};addOptimisticMessage(optimisticMessage);setContentMessage(\"\");setReplyingTo(null);await api.post(\"/chats/\".concat(chat.id,\"/messages\"),{message:content,replyToId:replyingTo===null||replyingTo===void 0?void 0:replyingTo.id});// O socket vai substituir a mensagem otimista pela real depois\n}};const handleKeyPress=e=>{if(e.key===\"Enter\"&&!e.shiftKey&&contentMessage.trim()!==\"\"){handleSendMessageWithReply(contentMessage);}};const handleSendClick=()=>{if(contentMessage.trim()!==\"\"){handleSendMessageWithReply(contentMessage);}};const handleEdit=message=>{onEdit(message);};const handleDelete=message=>{onDelete(message);};const handleForward=message=>{onForward(message);};const renderDailyTimestamps=(message,index,messagesList,lastMessageRef,classes)=>{const today=format(new Date(),\"dd/MM/yyyy\");if(index===0){return/*#__PURE__*/_jsx(\"span\",{className:classes.dailyTimestamp,children:/*#__PURE__*/_jsx(\"div\",{className:classes.dailyTimestampText,children:today===format(parseISO(messagesList[index].createdAt),\"dd/MM/yyyy\")?\"HOJE\":format(parseISO(messagesList[index].createdAt),\"dd/MM/yyyy\")})},\"timestamp-\".concat(message.id));}else if(index<messagesList.length-1){let messageDay=parseISO(messagesList[index].createdAt);let previousMessageDay=parseISO(messagesList[index-1].createdAt);if(!isSameDay(messageDay,previousMessageDay)){return/*#__PURE__*/_jsx(\"span\",{className:classes.dailyTimestamp,children:/*#__PURE__*/_jsx(\"div\",{className:classes.dailyTimestampText,children:today===format(parseISO(messagesList[index].createdAt),\"dd/MM/yyyy\")?\"HOJE\":format(parseISO(messagesList[index].createdAt),\"dd/MM/yyyy\")})},\"timestamp-\".concat(message.id));}}else if(index===messagesList.length-1){return/*#__PURE__*/_jsx(\"div\",{ref:lastMessageRef,style:{float:\"left\",clear:\"both\"}},\"ref-\".concat(message.id));}};const scrollToMessage=messageId=>{const el=messageRefs.current[messageId];if(el){el.scrollIntoView({behavior:\"smooth\",block:\"center\"});el.classList.add(classes.highlightedMessage);setTimeout(()=>el.classList.remove(classes.highlightedMessage),1500);}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Paper,{className:classes.paper,style:{display:\"flex\",flexDirection:\"column\",height:\"100%\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"messageList \".concat(classes.messageList),onScroll:handleScroll,style:{flex:1,minHeight:0},children:[/*#__PURE__*/_jsx(\"div\",{ref:topRef,style:{height:1}}),loadingMore&&/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",justifyContent:\"center\",padding:\"10px\",position:\"sticky\",top:0,backgroundColor:\"rgba(255, 255, 255, 0.9)\",zIndex:1},children:[/*#__PURE__*/_jsx(CircularProgress,{size:20}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",style:{marginLeft:8,alignSelf:\"center\"},children:\"Carregando mensagens antigas...\"})]}),Array.isArray(messages)&&messages.map((item,key)=>{if(!item)return null;const repliedMessage=item.replyTo;return/*#__PURE__*/_jsxs(React.Fragment,{children:[renderDailyTimestamps(item,key,messages,baseRef,classes),/*#__PURE__*/_jsx(\"div\",{ref:el=>messageRefs.current[item.id]=el,className:item.senderId===user.id?classes.messageContainerSelf:classes.messageContainer,onDoubleClick:()=>handleReply(item),title:\"Clique duas vezes para responder\",children:item.senderId===user.id?/*#__PURE__*/_jsxs(\"div\",{className:classes.messageBubbleSelf,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.senderInfo,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle2\",className:classes.senderName,children:[item.sender&&item.sender.name?item.sender.name:\"Usuário\",\" \",\"- \",format(new Date(item.createdAt),\"HH:mm\")]}),/*#__PURE__*/_jsx(\"div\",{className:classes.messageActions,children:(!item.isDeleted||user.profile===\"admin\")&&/*#__PURE__*/_jsxs(_Fragment,{children:[item.senderId===user.id&&!item.isDeleted&&// Regra: só pode editar em até 10 minutos\nnew Date()-new Date(item.createdAt)<10*60*1000&&/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleEdit(item),title:i18n.t(\"chatMessages.edit\"),children:/*#__PURE__*/_jsx(EditIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleDelete(item),title:i18n.t(\"chatMessages.delete\"),children:/*#__PURE__*/_jsx(DeleteIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleForward(item),title:i18n.t(\"chatMessages.forward\"),children:/*#__PURE__*/_jsx(ForwardIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleReply(item),title:i18n.t(\"chatMessages.reply\"),children:/*#__PURE__*/_jsx(ReplyIcon,{fontSize:\"small\"})})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.bubbleContent,children:item.isDeleted&&user.profile!==\"admin\"?/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",style:{fontStyle:\"italic\"},children:i18n.t(\"chatMessages.deleted\")}):item.isDeleted&&user.profile===\"admin\"?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"caption\",style:{color:\"#888\",fontStyle:\"italic\",display:\"block\",marginBottom:4},children:i18n.t(\"chatMessages.deletedAdmin\")}),item.mediaPath&&checkMessageMedia(item),/*#__PURE__*/_jsx(MessageWithLineBreaks,{text:item.message,replyTo:repliedMessage,scrollToMessage:scrollToMessage,forwardedFrom:item.forwardedFrom,checkMessageMedia:checkMessageMedia})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[item.mediaPath&&checkMessageMedia(item),/*#__PURE__*/_jsx(MessageWithLineBreaks,{text:item.message,replyTo:repliedMessage,scrollToMessage:scrollToMessage,forwardedFrom:item.forwardedFrom,checkMessageMedia:checkMessageMedia})]})})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:classes.avatarContainer,children:/*#__PURE__*/_jsx(Avatar,{src:item.sender&&item.sender.profileImage?\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/public/company\").concat(item.companyId,\"/user/\").concat(item.sender.profileImage):undefined,alt:item.sender&&item.sender.name?item.sender.name:\"Usuário\",children:(!item.sender||!item.sender.profileImage)&&(item.sender&&item.sender.name?item.sender.name.charAt(0):\"?\")})}),/*#__PURE__*/_jsxs(\"div\",{className:classes.messageBubble,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.senderInfo,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle2\",className:classes.senderName,children:[item.sender&&item.sender.name?item.sender.name:\"Usuário\",\" \",\"- \",format(new Date(item.createdAt),\"HH:mm\")]}),/*#__PURE__*/_jsx(\"div\",{className:classes.messageActions,children:(!item.isDeleted||user.profile===\"admin\")&&/*#__PURE__*/_jsxs(_Fragment,{children:[item.senderId===user.id&&!item.isDeleted&&// Regra: só pode editar em até 10 minutos\nnew Date()-new Date(item.createdAt)<10*60*1000&&/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleEdit(item),title:i18n.t(\"chatMessages.edit\"),children:/*#__PURE__*/_jsx(EditIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleDelete(item),title:i18n.t(\"chatMessages.delete\"),children:/*#__PURE__*/_jsx(DeleteIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleForward(item),title:i18n.t(\"chatMessages.forward\"),children:/*#__PURE__*/_jsx(ForwardIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>handleReply(item),title:i18n.t(\"chatMessages.reply\"),children:/*#__PURE__*/_jsx(ReplyIcon,{fontSize:\"small\"})})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.bubbleContent,children:item.isDeleted&&user.profile!==\"admin\"?/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",style:{fontStyle:\"italic\"},children:i18n.t(\"chatMessages.deleted\")}):item.isDeleted&&user.profile===\"admin\"?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"caption\",style:{color:\"#888\",fontStyle:\"italic\",display:\"block\",marginBottom:4},children:i18n.t(\"chatMessages.deletedAdmin\")}),item.mediaPath&&checkMessageMedia(item),/*#__PURE__*/_jsx(MessageWithLineBreaks,{text:item.message,replyTo:repliedMessage,scrollToMessage:scrollToMessage,forwardedFrom:item.forwardedFrom,checkMessageMedia:checkMessageMedia})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[item.mediaPath&&checkMessageMedia(item),/*#__PURE__*/_jsx(MessageWithLineBreaks,{text:item.message,replyTo:repliedMessage,scrollToMessage:scrollToMessage,forwardedFrom:item.forwardedFrom,checkMessageMedia:checkMessageMedia})]})})]})]})})]},key);}),/*#__PURE__*/_jsx(\"div\",{ref:baseRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.inputArea,style:{flexShrink:0},children:[replyingTo&&/*#__PURE__*/_jsxs(\"div\",{className:classes.replyContainer,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.replyContent,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.replySender,children:[i18n.t(\"chatMessages.replyingTo\"),\" \",replyingTo.sender.name]}),/*#__PURE__*/_jsx(\"div\",{className:classes.replyText,children:replyingTo.message})]}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:handleCancelReply,children:/*#__PURE__*/_jsx(CloseIcon,{fontSize:\"small\"})})]}),/*#__PURE__*/_jsx(FormControl,{variant:\"outlined\",fullWidth:true,children:recording?/*#__PURE__*/_jsxs(\"div\",{className:classes.recorderWrapper,children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"cancelRecording\",component:\"span\",fontSize:\"large\",disabled:loading,onClick:handleCancelAudio,size:\"large\",children:/*#__PURE__*/_jsx(HighlightOffIcon,{className:classes.cancelAudioIcon})}),loading?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(CircularProgress,{className:classes.audioLoading})}):/*#__PURE__*/_jsx(RecordingTimer,{}),/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"sendRecordedAudio\",component:\"span\",onClick:handleUploadAudio,disabled:loading,size:\"large\",children:/*#__PURE__*/_jsx(CheckCircleOutlineIcon,{className:classes.sendAudioIcon})})]}):/*#__PURE__*/_jsx(_Fragment,{children:medias.length>0?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Paper,{elevation:0,square:true,className:classes.viewMediaInputWrapper,children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"cancel-upload\",component:\"span\",onClick:e=>setMedias([]),size:\"large\",children:/*#__PURE__*/_jsx(CancelIcon,{className:classes.sendMessageIcons})}),loading?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(CircularProgress,{className:classes.circleLoading})}):/*#__PURE__*/_jsx(\"span\",{children:(_medias$=medias[0])===null||_medias$===void 0?void 0:_medias$.name}),/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"send-upload\",component:\"span\",onClick:handleSendMedia,disabled:loading,size:\"large\",children:/*#__PURE__*/_jsx(SendIcon,{className:classes.sendMessageIcons})})]})}):/*#__PURE__*/_jsx(Fragment,{children:/*#__PURE__*/_jsx(Input,{inputRef:inputRef,multiline:true,value:contentMessage,onKeyUp:handleKeyPress,onChange:e=>setContentMessage(e.target.value),onPaste:handlePaste,className:classes.input,startAdornment:/*#__PURE__*/_jsxs(InputAdornment,{position:\"start\",children:[/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"emojiPicker\",component:\"span\",disabled:loading,onClick:e=>setShowEmoji(prevState=>!prevState),children:/*#__PURE__*/_jsx(MoodIcon,{className:classes.sendMessageIcons})}),showEmoji?/*#__PURE__*/_jsx(\"div\",{className:classes.emojiBox,children:/*#__PURE__*/_jsx(ClickAwayListener,{onClickAway:e=>setShowEmoji(false),children:/*#__PURE__*/_jsx(Picker,{perLine:16,theme:\"dark\",showPreview:true,showSkinTones:false,onSelect:handleAddEmoji})})}):null,/*#__PURE__*/_jsx(FileInput,{disableOption:loading,handleChangeMedias:handleChangeMedias})]}),endAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"end\",children:contentMessage?/*#__PURE__*/_jsx(IconButton,{onClick:handleSendClick,className:classes.buttonSend,size:\"large\",children:/*#__PURE__*/_jsx(SendIcon,{})}):/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"showRecorder\",component:\"span\",disabled:loading,onClick:handleStartRecording,size:\"large\",children:/*#__PURE__*/_jsx(MicIcon,{className:classes.sendMessageIcons})})})})})})})]})]}),/*#__PURE__*/_jsx(DocumentModal,{open:documentModalOpen,onClose:()=>setDocumentModalOpen(false),document:selectedDocument})]});}const FileInput=props=>{const{handleChangeMedias,disableOption}=props;const classes=useStyles();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{multiple:true,type:\"file\",id:\"upload-button\",disabled:disableOption,className:classes.uploadInput,onChange:handleChangeMedias}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"upload-button\",children:/*#__PURE__*/_jsx(IconButton,{\"aria-label\":\"upload\",component:\"span\",disabled:disableOption,size:\"large\",children:/*#__PURE__*/_jsx(AttachFileIcon,{className:classes.sendMessageIcons})})})]});};const MessageWithLineBreaks=_ref2=>{var _replyTo$sender;let{text,replyTo,scrollToMessage,forwardedFrom,checkMessageMedia}=_ref2;const classes=useStyles();if(!text&&!replyTo&&!forwardedFrom)return null;return/*#__PURE__*/_jsxs(\"div\",{style:{whiteSpace:\"pre-wrap\",wordBreak:\"break-word\",overflowWrap:\"break-word\",width:\"100%\"},children:[forwardedFrom&&/*#__PURE__*/_jsxs(\"div\",{className:classes.forwardedMessage,children:[/*#__PURE__*/_jsx(\"div\",{className:classes.forwardedMessageHeader,children:/*#__PURE__*/_jsx(\"span\",{children:i18n.t(\"chatMessages.forwarded\")})}),forwardedFrom.mediaPath&&checkMessageMedia(forwardedFrom)]}),replyTo&&/*#__PURE__*/_jsxs(\"div\",{className:classes.replyPreview,style:{cursor:\"pointer\"},onClick:()=>scrollToMessage(replyTo.id),title:i18n.t(\"chatMessages.clickToGoToOriginal\"),children:[/*#__PURE__*/_jsx(\"div\",{className:classes.replyPreviewSender,children:((_replyTo$sender=replyTo.sender)===null||_replyTo$sender===void 0?void 0:_replyTo$sender.name)||\"Mensagem\"}),/*#__PURE__*/_jsx(\"div\",{className:classes.replyPreviewText,children:replyTo.message||\"[mensagem não encontrada]\"})]}),/*#__PURE__*/_jsx(MarkdownWrapper,{children:text})]});};","map":{"version":3,"names":["Button","ClickAwayListener","FormControl","IconButton","Input","InputAdornment","makeStyles","Paper","Typography","Avatar","Dialog","DialogTitle","DialogContent","DialogActions","TextField","List","ListItem","ListItemText","MoodIcon","SendIcon","Picker","React","Fragment","useContext","useEffect","useRef","useState","AuthContext","useDate","api","i18n","GetApp","AttachFileIcon","CancelIcon","CheckCircleOutlineIcon","HighlightOffIcon","MicIcon","CircularProgress","green","MicRecorder","MarkdownWrapper","RecordingTimer","ModalImageCors","toastError","AudioModal","DocumentModal","whatsBackground","whatsBackgroundDark","format","isSameDay","parseISO","ReplyIcon","CloseIcon","EditIcon","DeleteIcon","ForwardIcon","IosShareIcon","jsx","_jsx","_Fragment","jsxs","_jsxs","useStyles","theme","mainContainer","display","flexDirection","position","flex","overflow","borderRadius","height","borderLeft","messageList","_objectSpread","overflowY","scrollbarStyles","backgroundImage","mode","concat","backgroundColor","inputArea","input","padding","buttonSend","margin","spacing","messageContainer","alignItems","messageContainerSelf","justifyContent","messageContainerWithAvatar","avatarContainer","marginRight","alignSelf","messageBubble","color","maxWidth","width","border","messageBubbleSelf","bubbleContent","marginTop","whiteSpace","wordBreak","overflowWrap","senderInfo","marginBottom","senderName","fontWeight","sendMessageIcons","uploadInput","circleLoading","opacity","top","left","marginLeft","viewMediaInputWrapper","borderTop","downloadMedia","messageMedia","objectFit","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","recorderWrapper","alignContent","cancelAudioIcon","audioLoading","sendAudioIcon","messageDate","fontSize","emojiBox","bottom","zIndex","dailyTimestampText","textAlign","replyContainer","replyContent","replyText","textOverflow","replySender","messageActions","gap","replyPreview","paddingLeft","replyPreviewSender","replyPreviewText","dailyTimestamp","highlightedMessage","transition","forwardedMessage","forwardedMessageHeader","forwardedMessageText","Mp3Recorder","bitRate","ChatMessages","_ref","_medias$","chat","messages","handleSendMessage","handleLoadMore","scrollToBottomRef","pageInfo","loadingMore","onEdit","onDelete","onForward","justOpenedChat","setJustOpenedChat","addOptimisticMessage","topRef","classes","user","datetimeToClient","baseRef","messageRefs","contentMessage","setContentMessage","medias","setMedias","loading","setLoading","recording","setRecording","showEmoji","setShowEmoji","inputRef","replyingTo","setReplyingTo","initialScrollDone","setInitialScrollDone","canLoadMore","setCanLoadMore","scrollToBottom","current","scrollIntoView","unreadMessages","users","Array","isArray","currentUser","find","u","userId","id","unreads","post","err","console","error","length","scrollToBottomSafely","requestAnimationFrame","setTimeout","container","document","querySelector","scrollTop","scrollHeight","handleScroll","e","clientHeight","currentTarget","hasMore","log","handleChangeMedias","target","files","selectedMedias","from","handlePaste","clipboardData","preventDefault","handleAddEmoji","emoji","native","prevState","focus","documentModalOpen","setDocumentModalOpen","selectedDocument","setSelectedDocument","checkMessageMedia","message","mediaType","imageUrl","mediaPath","url","disableTranscription","isGroup","className","src","controls","children","startIcon","variant","onClick","handleSendMedia","formData","FormData","append","forEach","media","name","handleStartRecording","navigator","mediaDevices","getUserMedia","audio","start","handleUploadAudio","blob","stop","getMp3","size","filename","Date","getTime","handleCancelAudio","handleReply","handleCancelReply","handleSendMessageWithReply","content","trim","optimisticMessage","now","chatId","senderId","createdAt","toISOString","sender","profileImage","replyTo","isDeleted","isEdited","replyToId","handleKeyPress","key","shiftKey","handleSendClick","handleEdit","handleDelete","handleForward","renderDailyTimestamps","index","messagesList","lastMessageRef","today","messageDay","previousMessageDay","ref","style","float","clear","scrollToMessage","messageId","el","behavior","block","classList","add","remove","paper","onScroll","minHeight","map","item","repliedMessage","onDoubleClick","title","profile","t","fontStyle","MessageWithLineBreaks","text","forwardedFrom","process","env","REACT_APP_BACKEND_URL","companyId","undefined","alt","charAt","flexShrink","fullWidth","component","disabled","elevation","square","multiline","value","onKeyUp","onChange","onPaste","startAdornment","onClickAway","perLine","showPreview","showSkinTones","onSelect","FileInput","disableOption","endAdornment","open","onClose","props","multiple","type","htmlFor","_ref2","_replyTo$sender","cursor"],"sources":["/home/deploy/codigologlow/frontend/src/pages/Chat/ChatMessages.js"],"sourcesContent":["import {\n  Button,\n  ClickAwayListener,\n  FormControl,\n  IconButton,\n  Input,\n  InputAdornment,\n  makeStyles,\n  Paper,\n  Typography,\n  Avatar,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  TextField,\n  List,\n  ListItem,\n  ListItemText,\n} from \"@material-ui/core\";\nimport MoodIcon from \"@material-ui/icons/Mood\";\nimport SendIcon from \"@material-ui/icons/Send\";\nimport { Picker } from \"emoji-mart\";\nimport \"emoji-mart/css/emoji-mart.css\";\nimport React, {\n  Fragment,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\nimport { useDate } from \"../../hooks/useDate\";\nimport api from \"../../services/api\";\nimport { i18n } from \"../../translate/i18n\";\n\nimport { GetApp } from \"@mui/icons-material\";\nimport AttachFileIcon from \"@mui/icons-material/AttachFile\";\nimport CancelIcon from \"@mui/icons-material/Cancel\";\nimport CheckCircleOutlineIcon from \"@mui/icons-material/CheckCircleOutline\";\nimport HighlightOffIcon from \"@mui/icons-material/HighlightOff\";\nimport MicIcon from \"@mui/icons-material/Mic\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport { green } from \"@mui/material/colors\";\nimport MicRecorder from \"mic-recorder-to-mp3\";\nimport MarkdownWrapper from \"../../components/MarkdownWrapper\";\nimport RecordingTimer from \"../../components/MessageInput/RecordingTimer\";\nimport ModalImageCors from \"../../components/ModalImageCors\";\nimport toastError from \"../../errors/toastError\";\nimport AudioModal from \"../../components/AudioModal\";\nimport DocumentModal from \"../../components/DocumentModal\";\n\nimport whatsBackground from \"../../assets/wa-background.png\";\nimport whatsBackgroundDark from \"../../assets/wa-background-dark.png\";\nimport { format, isSameDay, parseISO } from \"date-fns\";\nimport ReplyIcon from \"@mui/icons-material/Reply\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport EditIcon from \"@mui/icons-material/Edit\";\nimport DeleteIcon from \"@mui/icons-material/Delete\";\nimport ForwardIcon from \"@mui/icons-material/Forward\";\nimport IosShareIcon from \"@mui/icons-material/IosShare\";\n\nconst useStyles = makeStyles((theme) => ({\n  mainContainer: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    position: \"relative\",\n    flex: 1,\n    overflow: \"hidden\",\n    borderRadius: 0,\n    height: \"100%\",\n    borderLeft: \"1px solid rgba(0, 0, 0, 0.12)\",\n  },\n  messageList: {\n    position: \"relative\",\n    overflowY: \"auto\",\n    height: \"100%\",\n    ...theme.scrollbarStyles,\n    backgroundImage:\n      theme.mode === \"light\"\n        ? `url(${whatsBackground})`\n        : `url(${whatsBackgroundDark})`,\n    backgroundColor: theme.mode === \"light\" ? \"transparent\" : \"#0b0b0d\",\n  },\n  inputArea: {\n    position: \"relative\",\n    height: \"auto\",\n  },\n  input: {\n    padding: \"20px\",\n  },\n  buttonSend: {\n    margin: theme.spacing(1),\n  },\n  messageContainer: {\n    display: \"flex\",\n    margin: \"10px\",\n    alignItems: \"center\",\n  },\n  messageContainerSelf: {\n    display: \"flex\",\n    margin: \"10px\",\n    alignItems: \"center\",\n    justifyContent: \"flex-end\",\n  },\n  messageContainerWithAvatar: {\n    display: \"flex\",\n    margin: \"10px\",\n    alignItems: \"flex-start\",\n  },\n  avatarContainer: {\n    marginRight: 10,\n    display: \"flex\",\n    alignItems: \"center\",\n    alignSelf: \"center\",\n  },\n  messageBubble: {\n    padding: \"15px\",\n    position: \"relative\",\n    backgroundColor: \"#ffffff\",\n    color: \"#303030\",\n    maxWidth: 350,\n    width: \"100%\",\n    borderRadius: 20,\n    border: \"1px solid rgba(0, 0, 0, 0.12)\",\n  },\n  messageBubbleSelf: {\n    padding: \"15px\",\n    position: \"relative\",\n    backgroundColor: \"#dcf8c6\",\n    color: \"#303030\",\n    maxWidth: 350,\n    width: \"100%\",\n    borderRadius: 20,\n    border: \"1px solid rgba(0, 0, 0, 0.12)\",\n  },\n  bubbleContent: {\n    marginTop: 5,\n    whiteSpace: \"pre-wrap\",\n    wordBreak: \"break-word\",\n    overflowWrap: \"break-word\",\n  },\n  senderInfo: {\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    marginBottom: 5,\n  },\n  senderName: {\n    fontWeight: \"bold\",\n  },\n  sendMessageIcons: {\n    color: \"grey\",\n  },\n  uploadInput: {\n    display: \"none\",\n  },\n  circleLoading: {\n    color: green[500],\n    opacity: \"70%\",\n    position: \"absolute\",\n    top: \"20%\",\n    left: \"50%\",\n    marginLeft: -12,\n  },\n  viewMediaInputWrapper: {\n    display: \"flex\",\n    padding: \"10px 13px\",\n    position: \"relative\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    backgroundColor: \"#eee\",\n    borderTop: \"1px solid rgba(0, 0, 0, 0.12)\",\n  },\n  downloadMedia: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    backgroundColor: \"inherit\",\n    padding: 10,\n  },\n  messageMedia: {\n    objectFit: \"cover\",\n    width: 250,\n    height: 200,\n    borderTopLeftRadius: 8,\n    borderTopRightRadius: 8,\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 8,\n  },\n  recorderWrapper: {\n    display: \"flex\",\n    alignItems: \"center\",\n    alignContent: \"middle\",\n    justifyContent: \"flex-end\",\n  },\n  cancelAudioIcon: {\n    color: \"red\",\n  },\n  audioLoading: {\n    color: green[500],\n    opacity: \"70%\",\n  },\n  sendAudioIcon: {\n    color: \"green\",\n  },\n  messageDate: {\n    fontSize: \"0.75rem\",\n    color: \"#666\",\n    marginTop: 5,\n  },\n  emojiBox: {\n    position: \"absolute\",\n    bottom: 63,\n    left: 10,\n    zIndex: 1000,\n  },\n  sendMessageIcons: {\n    color: \"grey\",\n  },\n  dailyTimestampText: {\n    color: \"#808888\",\n    padding: 8,\n    textAlign: \"center\",\n    width: \"100%\",\n    display: \"block\",\n    margin: \"0 auto\",\n  },\n  replyContainer: {\n    display: \"flex\",\n    alignItems: \"center\",\n    padding: \"8px 16px\",\n    backgroundColor: \"#f0f2f5\",\n    borderTop: \"1px solid rgba(0, 0, 0, 0.12)\",\n  },\n  replyContent: {\n    flex: 1,\n    marginLeft: 8,\n  },\n  replyText: {\n    fontSize: \"0.875rem\",\n    color: \"#666\",\n    whiteSpace: \"nowrap\",\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\",\n  },\n  replySender: {\n    fontSize: \"0.75rem\",\n    color: \"#999\",\n  },\n  messageActions: {\n    display: \"flex\",\n    gap: 4,\n    marginLeft: 8,\n  },\n  replyPreview: {\n    borderLeft: \"3px solid #128C7E\",\n    paddingLeft: \"8px\",\n    marginBottom: \"8px\",\n    backgroundColor: \"rgba(0, 0, 0, 0.05)\",\n    borderRadius: \"4px\",\n    padding: \"4px 8px\",\n  },\n  replyPreviewSender: {\n    fontSize: \"0.75rem\",\n    color: \"#128C7E\",\n    fontWeight: \"bold\",\n  },\n  replyPreviewText: {\n    fontSize: \"0.75rem\",\n    color: \"#666\",\n    whiteSpace: \"nowrap\",\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\",\n  },\n  dailyTimestamp: {\n    width: \"100%\",\n    display: \"block\",\n  },\n  highlightedMessage: {\n    backgroundColor: \"#ffe082\",\n    transition: \"background 0.5s\",\n  },\n  forwardedMessage: {\n    // borderLeft: \"3px solid #128C7E\",\n    // paddingLeft: \"8px\",\n    // marginBottom: \"8px\",\n    // backgroundColor: \"rgba(0, 0, 0, 0.05)\",\n    // borderRadius: \"4px\",\n    // padding: \"4px 8px\",\n  },\n  forwardedMessageHeader: {\n    display: \"flex\",\n    alignItems: \"center\",\n    gap: \"4px\",\n    color: \"#999\",\n    fontSize: \"0.75rem\",\n    marginBottom: \"4px\",\n  },\n  forwardedMessageText: {\n    // fontSize: \"0.875rem\",\n    // color: \"#666\",\n  },\n}));\n\nconst Mp3Recorder = new MicRecorder({ bitRate: 128 });\n\nexport default function ChatMessages({\n  chat,\n  messages,\n  handleSendMessage,\n  handleLoadMore,\n  scrollToBottomRef,\n  pageInfo,\n  loadingMore,\n  onEdit,\n  onDelete,\n  onForward,\n  // messageListRef,\n  // isFirstPage,\n  justOpenedChat,\n  setJustOpenedChat,\n  addOptimisticMessage,\n}) {\n  const topRef = useRef(null);\n\n  const classes = useStyles();\n  const { user } = useContext(AuthContext);\n  const { datetimeToClient } = useDate();\n  const baseRef = useRef();\n  const messageRefs = useRef({});\n\n  const [contentMessage, setContentMessage] = useState(\"\");\n  const [medias, setMedias] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [recording, setRecording] = useState(false);\n  const [showEmoji, setShowEmoji] = useState(false);\n  const inputRef = useRef();\n  const [replyingTo, setReplyingTo] = useState(null);\n  const [initialScrollDone, setInitialScrollDone] = useState(false);\n  const [canLoadMore, setCanLoadMore] = useState(false);\n\n  const scrollToBottom = () => {\n    if (baseRef.current) {\n      baseRef.current.scrollIntoView({});\n    }\n  };\n\n  const unreadMessages = (chat) => {\n    if (chat && chat.users && Array.isArray(chat.users)) {\n      const currentUser = chat.users.find((u) => u.userId === user.id);\n      return currentUser && currentUser.unreads > 0;\n    }\n    return false;\n  };\n\n  useEffect(() => {\n    if (justOpenedChat) {\n      setInitialScrollDone(false);\n    }\n  }, [justOpenedChat]);\n\n  useEffect(() => {\n    if (chat && chat.id && unreadMessages(chat)) {\n      try {\n        api.post(`/chats/${chat.id}/read`, { userId: user.id });\n      } catch (err) {\n        console.error(\"Erro ao marcar mensagens como lidas:\", err);\n      }\n    }\n    scrollToBottomRef.current = scrollToBottom;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (!messages || messages.length === 0 || loadingMore || initialScrollDone)\n      return;\n\n    const scrollToBottomSafely = () => {\n      requestAnimationFrame(() => {\n        setTimeout(() => {\n          const container = document.querySelector(\".messageList\");\n          if (container) {\n            container.scrollTop = container.scrollHeight;\n            setInitialScrollDone(true);\n          }\n        }, 100); // Aumentar o timeout para dar tempo das mensagens renderizarem\n      });\n    };\n\n    scrollToBottomSafely();\n  }, [messages, loadingMore, initialScrollDone]);\n\n  // Após o scroll automático inicial, liberar o carregamento incremental\n  useEffect(() => {\n    if (!loading && !loadingMore && initialScrollDone) {\n      setCanLoadMore(true);\n    }\n  }, [loading, loadingMore, initialScrollDone]);\n\n  // Adicionar um useEffect separado para quando justOpenedChat muda\n  useEffect(() => {\n    if (justOpenedChat && messages && messages.length > 0) {\n      const scrollToBottomSafely = () => {\n        requestAnimationFrame(() => {\n          setTimeout(() => {\n            const container = document.querySelector(\".messageList\");\n            if (container) {\n              container.scrollTop = container.scrollHeight;\n              setJustOpenedChat(false); // Resetar após executar o scroll\n            }\n          }, 200); // Timeout maior para garantir que tudo foi renderizado\n        });\n      };\n\n      scrollToBottomSafely();\n    }\n  }, [justOpenedChat, messages]);\n\n  const handleScroll = (e) => {\n    if (!initialScrollDone || !canLoadMore) return;\n    const { scrollTop, scrollHeight, clientHeight } = e.currentTarget;\n\n    if (!pageInfo?.hasMore || loading) return;\n\n    if (scrollTop < 200) {\n      console.log(\"Carregando mais mensagens... ScrollTop:\", scrollTop);\n      handleLoadMore();\n    }\n  };\n\n  const handleChangeMedias = (e) => {\n    if (!e.target.files) {\n      return;\n    }\n\n    const selectedMedias = Array.from(e.target.files);\n    setMedias(selectedMedias);\n  };\n\n  const handlePaste = (e) => {\n    if (e.clipboardData.files.length > 0) {\n      const selectedMedias = Array.from(e.clipboardData.files);\n      setMedias(selectedMedias);\n      e.preventDefault();\n    }\n  };\n\n  const handleAddEmoji = (e) => {\n    let emoji = e.native;\n    setContentMessage((prevState) => prevState + emoji);\n    inputRef.current.focus();\n  };\n\n  const [documentModalOpen, setDocumentModalOpen] = useState(false);\n  const [selectedDocument, setSelectedDocument] = useState(null);\n\n  const checkMessageMedia = (message) => {\n    if (message.mediaType === \"image\") {\n      return <ModalImageCors imageUrl={message.mediaPath} />;\n    }\n    if (message.mediaType === \"audio\") {\n      return (\n        <AudioModal\n          url={message.mediaPath}\n          message={message}\n          disableTranscription={!chat.isGroup}\n        />\n      );\n    }\n    if (message.mediaType === \"video\") {\n      return (\n        <video\n          className={classes.messageMedia}\n          src={message.mediaPath}\n          controls\n        />\n      );\n    } else {\n      return (\n        <>\n          <div className={classes.downloadMedia}>\n            <Button\n              startIcon={<GetApp />}\n              color=\"primary\"\n              variant=\"outlined\"\n              onClick={() => {\n                setSelectedDocument(message);\n                setDocumentModalOpen(true);\n              }}\n            >\n              Visualizar Documento\n            </Button>\n          </div>\n        </>\n      );\n    }\n  };\n\n  const handleSendMedia = async (e) => {\n    setLoading(true);\n    e.preventDefault();\n\n    const formData = new FormData();\n    formData.append(\"fromMe\", true);\n    medias.forEach((media) => {\n      formData.append(\"typeArch\", \"chat\");\n      formData.append(\"fileId\", chat.id);\n      formData.append(\"medias\", media);\n      formData.append(\"body\", media.name);\n    });\n\n    try {\n      await api.post(`/chats/${chat.id}/messages`, formData);\n    } catch (err) {\n      console.log(err);\n      toastError(err);\n    }\n\n    setLoading(false);\n    setMedias([]);\n  };\n\n  const handleStartRecording = async () => {\n    setLoading(true);\n    try {\n      await navigator.mediaDevices.getUserMedia({ audio: true });\n      await Mp3Recorder.start();\n      setRecording(true);\n      setLoading(false);\n    } catch (err) {\n      toastError(err);\n      setLoading(false);\n    }\n  };\n\n  const handleUploadAudio = async () => {\n    setLoading(true);\n    try {\n      const [, blob] = await Mp3Recorder.stop().getMp3();\n\n      if (blob.size < 10000) {\n        setLoading(false);\n        setRecording(false);\n        return;\n      }\n\n      const formData = new FormData();\n      const filename = `audio-${new Date().getTime()}.mp3`;\n      formData.append(\"typeArch\", \"chat\");\n      formData.append(\"fileId\", chat.id);\n      formData.append(\"medias\", blob, filename);\n      formData.append(\"body\", filename);\n      formData.append(\"fromMe\", true);\n\n      await api.post(`/chats/${chat.id}/messages`, formData);\n    } catch (err) {\n      toastError(err);\n    }\n\n    setRecording(false);\n    setLoading(false);\n  };\n\n  const handleCancelAudio = async () => {\n    try {\n      await Mp3Recorder.stop().getMp3();\n      setRecording(false);\n    } catch (err) {\n      toastError(err);\n    }\n  };\n\n  const handleReply = (message) => {\n    setReplyingTo(message);\n    if (inputRef.current) {\n      inputRef.current.focus();\n    }\n  };\n\n  const handleCancelReply = () => {\n    setReplyingTo(null);\n  };\n\n  const handleSendMessageWithReply = async (content) => {\n    if (content.trim() !== \"\") {\n      // Adicione a mensagem localmente de forma otimista\n      const optimisticMessage = {\n        id: `temp-${Date.now()}`,\n        chatId: chat.id,\n        senderId: user.id,\n        message: content,\n        createdAt: new Date().toISOString(),\n        sender: {\n          id: user.id,\n          name: user.name,\n          profileImage: user.profileImage,\n        },\n        replyTo: replyingTo,\n        isDeleted: false,\n        isEdited: false,\n        mediaType: \"text\",\n      };\n      addOptimisticMessage(optimisticMessage);\n      setContentMessage(\"\");\n      setReplyingTo(null);\n      await api.post(`/chats/${chat.id}/messages`, {\n        message: content,\n        replyToId: replyingTo?.id,\n      });\n      // O socket vai substituir a mensagem otimista pela real depois\n    }\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === \"Enter\" && !e.shiftKey && contentMessage.trim() !== \"\") {\n      handleSendMessageWithReply(contentMessage);\n    }\n  };\n\n  const handleSendClick = () => {\n    if (contentMessage.trim() !== \"\") {\n      handleSendMessageWithReply(contentMessage);\n    }\n  };\n\n  const handleEdit = (message) => {\n    onEdit(message);\n  };\n\n  const handleDelete = (message) => {\n    onDelete(message);\n  };\n\n  const handleForward = (message) => {\n    onForward(message);\n  };\n\n  const renderDailyTimestamps = (\n    message,\n    index,\n    messagesList,\n    lastMessageRef,\n    classes\n  ) => {\n    const today = format(new Date(), \"dd/MM/yyyy\");\n\n    if (index === 0) {\n      return (\n        <span\n          className={classes.dailyTimestamp}\n          key={`timestamp-${message.id}`}\n        >\n          <div className={classes.dailyTimestampText}>\n            {today ===\n            format(parseISO(messagesList[index].createdAt), \"dd/MM/yyyy\")\n              ? \"HOJE\"\n              : format(parseISO(messagesList[index].createdAt), \"dd/MM/yyyy\")}\n          </div>\n        </span>\n      );\n    } else if (index < messagesList.length - 1) {\n      let messageDay = parseISO(messagesList[index].createdAt);\n      let previousMessageDay = parseISO(messagesList[index - 1].createdAt);\n\n      if (!isSameDay(messageDay, previousMessageDay)) {\n        return (\n          <span\n            className={classes.dailyTimestamp}\n            key={`timestamp-${message.id}`}\n          >\n            <div className={classes.dailyTimestampText}>\n              {today ===\n              format(parseISO(messagesList[index].createdAt), \"dd/MM/yyyy\")\n                ? \"HOJE\"\n                : format(parseISO(messagesList[index].createdAt), \"dd/MM/yyyy\")}\n            </div>\n          </span>\n        );\n      }\n    } else if (index === messagesList.length - 1) {\n      return (\n        <div\n          key={`ref-${message.id}`}\n          ref={lastMessageRef}\n          style={{ float: \"left\", clear: \"both\" }}\n        />\n      );\n    }\n  };\n\n  const scrollToMessage = (messageId) => {\n    const el = messageRefs.current[messageId];\n    if (el) {\n      el.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n      el.classList.add(classes.highlightedMessage);\n      setTimeout(() => el.classList.remove(classes.highlightedMessage), 1500);\n    }\n  };\n\n  return (\n    <>\n      <Paper\n        className={classes.paper}\n        style={{ display: \"flex\", flexDirection: \"column\", height: \"100%\" }}\n      >\n        {/* Área de mensagens rolável com background */}\n        <div\n          className={`messageList ${classes.messageList}`}\n          onScroll={handleScroll}\n          style={{ flex: 1, minHeight: 0 }}\n        >\n          <div ref={topRef} style={{ height: 1 }} />\n          {loadingMore && (\n            <div\n              style={{\n                display: \"flex\",\n                justifyContent: \"center\",\n                padding: \"10px\",\n                position: \"sticky\",\n                top: 0,\n                backgroundColor: \"rgba(255, 255, 255, 0.9)\",\n                zIndex: 1,\n              }}\n            >\n              <CircularProgress size={20} />\n              <Typography\n                variant=\"caption\"\n                style={{ marginLeft: 8, alignSelf: \"center\" }}\n              >\n                Carregando mensagens antigas...\n              </Typography>\n            </div>\n          )}\n\n          {Array.isArray(messages) &&\n            messages.map((item, key) => {\n              if (!item) return null;\n              const repliedMessage = item.replyTo;\n\n              return (\n                <React.Fragment key={key}>\n                  {renderDailyTimestamps(item, key, messages, baseRef, classes)}\n                  <div\n                    ref={(el) => (messageRefs.current[item.id] = el)}\n                    className={\n                      item.senderId === user.id\n                        ? classes.messageContainerSelf\n                        : classes.messageContainer\n                    }\n                    onDoubleClick={() => handleReply(item)}\n                    title=\"Clique duas vezes para responder\"\n                  >\n                    {item.senderId === user.id ? (\n                      <div className={classes.messageBubbleSelf}>\n                        <div className={classes.senderInfo}>\n                          <Typography\n                            variant=\"subtitle2\"\n                            className={classes.senderName}\n                          >\n                            {item.sender && item.sender.name\n                              ? item.sender.name\n                              : \"Usuário\"}{\" \"}\n                            - {format(new Date(item.createdAt), \"HH:mm\")}\n                          </Typography>\n                          <div className={classes.messageActions}>\n                            {(!item.isDeleted || user.profile === \"admin\") && (\n                              <>\n                                {item.senderId === user.id &&\n                                  !item.isDeleted &&\n                                  // Regra: só pode editar em até 10 minutos\n                                  new Date() - new Date(item.createdAt) <\n                                    10 * 60 * 1000 && (\n                                    <IconButton\n                                      size=\"small\"\n                                      onClick={() => handleEdit(item)}\n                                      title={i18n.t(\"chatMessages.edit\")}\n                                    >\n                                      <EditIcon fontSize=\"small\" />\n                                    </IconButton>\n                                  )}\n                                <IconButton\n                                  size=\"small\"\n                                  onClick={() => handleDelete(item)}\n                                  title={i18n.t(\"chatMessages.delete\")}\n                                >\n                                  <DeleteIcon fontSize=\"small\" />\n                                </IconButton>\n                                <IconButton\n                                  size=\"small\"\n                                  onClick={() => handleForward(item)}\n                                  title={i18n.t(\"chatMessages.forward\")}\n                                >\n                                  <ForwardIcon fontSize=\"small\" />\n                                </IconButton>\n                                <IconButton\n                                  size=\"small\"\n                                  onClick={() => handleReply(item)}\n                                  title={i18n.t(\"chatMessages.reply\")}\n                                >\n                                  <ReplyIcon fontSize=\"small\" />\n                                </IconButton>\n                              </>\n                            )}\n                          </div>\n                        </div>\n                        <div className={classes.bubbleContent}>\n                          {item.isDeleted && user.profile !== \"admin\" ? (\n                            <Typography\n                              variant=\"body2\"\n                              color=\"textSecondary\"\n                              style={{ fontStyle: \"italic\" }}\n                            >\n                              {i18n.t(\"chatMessages.deleted\")}\n                            </Typography>\n                          ) : item.isDeleted && user.profile === \"admin\" ? (\n                            <>\n                              <Typography\n                                variant=\"caption\"\n                                style={{\n                                  color: \"#888\",\n                                  fontStyle: \"italic\",\n                                  display: \"block\",\n                                  marginBottom: 4,\n                                }}\n                              >\n                                {i18n.t(\"chatMessages.deletedAdmin\")}\n                              </Typography>\n                              {item.mediaPath && checkMessageMedia(item)}\n                              <MessageWithLineBreaks\n                                text={item.message}\n                                replyTo={repliedMessage}\n                                scrollToMessage={scrollToMessage}\n                                forwardedFrom={item.forwardedFrom}\n                                checkMessageMedia={checkMessageMedia}\n                              />\n                            </>\n                          ) : (\n                            <>\n                              {item.mediaPath && checkMessageMedia(item)}\n                              <MessageWithLineBreaks\n                                text={item.message}\n                                replyTo={repliedMessage}\n                                scrollToMessage={scrollToMessage}\n                                forwardedFrom={item.forwardedFrom}\n                                checkMessageMedia={checkMessageMedia}\n                              />\n                            </>\n                          )}\n                        </div>\n                      </div>\n                    ) : (\n                      <>\n                        <div className={classes.avatarContainer}>\n                          <Avatar\n                            src={\n                              item.sender && item.sender.profileImage\n                                ? `${process.env.REACT_APP_BACKEND_URL}/public/company${item.companyId}/user/${item.sender.profileImage}`\n                                : undefined\n                            }\n                            alt={\n                              item.sender && item.sender.name\n                                ? item.sender.name\n                                : \"Usuário\"\n                            }\n                          >\n                            {(!item.sender || !item.sender.profileImage) &&\n                              (item.sender && item.sender.name\n                                ? item.sender.name.charAt(0)\n                                : \"?\")}\n                          </Avatar>\n                        </div>\n                        <div className={classes.messageBubble}>\n                          <div className={classes.senderInfo}>\n                            <Typography\n                              variant=\"subtitle2\"\n                              className={classes.senderName}\n                            >\n                              {item.sender && item.sender.name\n                                ? item.sender.name\n                                : \"Usuário\"}{\" \"}\n                              - {format(new Date(item.createdAt), \"HH:mm\")}\n                            </Typography>\n                            <div className={classes.messageActions}>\n                              {(!item.isDeleted ||\n                                user.profile === \"admin\") && (\n                                <>\n                                  {item.senderId === user.id &&\n                                    !item.isDeleted &&\n                                    // Regra: só pode editar em até 10 minutos\n                                    new Date() - new Date(item.createdAt) <\n                                      10 * 60 * 1000 && (\n                                      <IconButton\n                                        size=\"small\"\n                                        onClick={() => handleEdit(item)}\n                                        title={i18n.t(\"chatMessages.edit\")}\n                                      >\n                                        <EditIcon fontSize=\"small\" />\n                                      </IconButton>\n                                    )}\n                                  <IconButton\n                                    size=\"small\"\n                                    onClick={() => handleDelete(item)}\n                                    title={i18n.t(\"chatMessages.delete\")}\n                                  >\n                                    <DeleteIcon fontSize=\"small\" />\n                                  </IconButton>\n                                  <IconButton\n                                    size=\"small\"\n                                    onClick={() => handleForward(item)}\n                                    title={i18n.t(\"chatMessages.forward\")}\n                                  >\n                                    <ForwardIcon fontSize=\"small\" />\n                                  </IconButton>\n                                  <IconButton\n                                    size=\"small\"\n                                    onClick={() => handleReply(item)}\n                                    title={i18n.t(\"chatMessages.reply\")}\n                                  >\n                                    <ReplyIcon fontSize=\"small\" />\n                                  </IconButton>\n                                </>\n                              )}\n                            </div>\n                          </div>\n                          <div className={classes.bubbleContent}>\n                            {item.isDeleted && user.profile !== \"admin\" ? (\n                              <Typography\n                                variant=\"body2\"\n                                color=\"textSecondary\"\n                                style={{ fontStyle: \"italic\" }}\n                              >\n                                {i18n.t(\"chatMessages.deleted\")}\n                              </Typography>\n                            ) : item.isDeleted && user.profile === \"admin\" ? (\n                              <>\n                                <Typography\n                                  variant=\"caption\"\n                                  style={{\n                                    color: \"#888\",\n                                    fontStyle: \"italic\",\n                                    display: \"block\",\n                                    marginBottom: 4,\n                                  }}\n                                >\n                                  {i18n.t(\"chatMessages.deletedAdmin\")}\n                                </Typography>\n                                {item.mediaPath && checkMessageMedia(item)}\n                                <MessageWithLineBreaks\n                                  text={item.message}\n                                  replyTo={repliedMessage}\n                                  scrollToMessage={scrollToMessage}\n                                  forwardedFrom={item.forwardedFrom}\n                                  checkMessageMedia={checkMessageMedia}\n                                />\n                              </>\n                            ) : (\n                              <>\n                                {item.mediaPath && checkMessageMedia(item)}\n                                <MessageWithLineBreaks\n                                  text={item.message}\n                                  replyTo={repliedMessage}\n                                  scrollToMessage={scrollToMessage}\n                                  forwardedFrom={item.forwardedFrom}\n                                  checkMessageMedia={checkMessageMedia}\n                                />\n                              </>\n                            )}\n                          </div>\n                        </div>\n                      </>\n                    )}\n                  </div>\n                </React.Fragment>\n              );\n            })}\n\n          <div ref={baseRef}></div>\n        </div>\n        {/* Input fixo */}\n        <div className={classes.inputArea} style={{ flexShrink: 0 }}>\n          {replyingTo && (\n            <div className={classes.replyContainer}>\n              <div className={classes.replyContent}>\n                <div className={classes.replySender}>\n                  {i18n.t(\"chatMessages.replyingTo\")} {replyingTo.sender.name}\n                </div>\n                <div className={classes.replyText}>{replyingTo.message}</div>\n              </div>\n              <IconButton size=\"small\" onClick={handleCancelReply}>\n                <CloseIcon fontSize=\"small\" />\n              </IconButton>\n            </div>\n          )}\n          <FormControl variant=\"outlined\" fullWidth>\n            {recording ? (\n              <div className={classes.recorderWrapper}>\n                <IconButton\n                  aria-label=\"cancelRecording\"\n                  component=\"span\"\n                  fontSize=\"large\"\n                  disabled={loading}\n                  onClick={handleCancelAudio}\n                  size=\"large\"\n                >\n                  <HighlightOffIcon className={classes.cancelAudioIcon} />\n                </IconButton>\n                {loading ? (\n                  <div>\n                    <CircularProgress className={classes.audioLoading} />\n                  </div>\n                ) : (\n                  <RecordingTimer />\n                )}\n\n                <IconButton\n                  aria-label=\"sendRecordedAudio\"\n                  component=\"span\"\n                  onClick={handleUploadAudio}\n                  disabled={loading}\n                  size=\"large\"\n                >\n                  <CheckCircleOutlineIcon className={classes.sendAudioIcon} />\n                </IconButton>\n              </div>\n            ) : (\n              <>\n                {medias.length > 0 ? (\n                  <>\n                    <Paper\n                      elevation={0}\n                      square\n                      className={classes.viewMediaInputWrapper}\n                    >\n                      <IconButton\n                        aria-label=\"cancel-upload\"\n                        component=\"span\"\n                        onClick={(e) => setMedias([])}\n                        size=\"large\"\n                      >\n                        <CancelIcon className={classes.sendMessageIcons} />\n                      </IconButton>\n\n                      {loading ? (\n                        <div>\n                          <CircularProgress className={classes.circleLoading} />\n                        </div>\n                      ) : (\n                        <span>{medias[0]?.name}</span>\n                      )}\n                      <IconButton\n                        aria-label=\"send-upload\"\n                        component=\"span\"\n                        onClick={handleSendMedia}\n                        disabled={loading}\n                        size=\"large\"\n                      >\n                        <SendIcon className={classes.sendMessageIcons} />\n                      </IconButton>\n                    </Paper>\n                  </>\n                ) : (\n                  <Fragment>\n                    <Input\n                      inputRef={inputRef}\n                      multiline\n                      value={contentMessage}\n                      onKeyUp={handleKeyPress}\n                      onChange={(e) => setContentMessage(e.target.value)}\n                      onPaste={handlePaste}\n                      className={classes.input}\n                      startAdornment={\n                        <InputAdornment position=\"start\">\n                          <IconButton\n                            aria-label=\"emojiPicker\"\n                            component=\"span\"\n                            disabled={loading}\n                            onClick={(e) =>\n                              setShowEmoji((prevState) => !prevState)\n                            }\n                          >\n                            <MoodIcon className={classes.sendMessageIcons} />\n                          </IconButton>\n                          {showEmoji ? (\n                            <div className={classes.emojiBox}>\n                              <ClickAwayListener\n                                onClickAway={(e) => setShowEmoji(false)}\n                              >\n                                <Picker\n                                  perLine={16}\n                                  theme={\"dark\"}\n                                  showPreview={true}\n                                  showSkinTones={false}\n                                  onSelect={handleAddEmoji}\n                                />\n                              </ClickAwayListener>\n                            </div>\n                          ) : null}\n                          <FileInput\n                            disableOption={loading}\n                            handleChangeMedias={handleChangeMedias}\n                          />\n                        </InputAdornment>\n                      }\n                      endAdornment={\n                        <InputAdornment position=\"end\">\n                          {contentMessage ? (\n                            <IconButton\n                              onClick={handleSendClick}\n                              className={classes.buttonSend}\n                              size=\"large\"\n                            >\n                              <SendIcon />\n                            </IconButton>\n                          ) : (\n                            <IconButton\n                              aria-label=\"showRecorder\"\n                              component=\"span\"\n                              disabled={loading}\n                              onClick={handleStartRecording}\n                              size=\"large\"\n                            >\n                              <MicIcon className={classes.sendMessageIcons} />\n                            </IconButton>\n                          )}\n                        </InputAdornment>\n                      }\n                    />\n                  </Fragment>\n                )}\n              </>\n            )}\n          </FormControl>\n        </div>\n      </Paper>\n\n      <DocumentModal\n        open={documentModalOpen}\n        onClose={() => setDocumentModalOpen(false)}\n        document={selectedDocument}\n      />\n    </>\n  );\n}\n\nconst FileInput = (props) => {\n  const { handleChangeMedias, disableOption } = props;\n  const classes = useStyles();\n  return (\n    <>\n      <input\n        multiple\n        type=\"file\"\n        id=\"upload-button\"\n        disabled={disableOption}\n        className={classes.uploadInput}\n        onChange={handleChangeMedias}\n      />\n      <label htmlFor=\"upload-button\">\n        <IconButton\n          aria-label=\"upload\"\n          component=\"span\"\n          disabled={disableOption}\n          size=\"large\"\n        >\n          <AttachFileIcon className={classes.sendMessageIcons} />\n        </IconButton>\n      </label>\n    </>\n  );\n};\n\nconst MessageWithLineBreaks = ({\n  text,\n  replyTo,\n  scrollToMessage,\n  forwardedFrom,\n  checkMessageMedia,\n}) => {\n  const classes = useStyles();\n\n  if (!text && !replyTo && !forwardedFrom) return null;\n\n  return (\n    <div\n      style={{\n        whiteSpace: \"pre-wrap\",\n        wordBreak: \"break-word\",\n        overflowWrap: \"break-word\",\n        width: \"100%\",\n      }}\n    >\n      {forwardedFrom && (\n        <div className={classes.forwardedMessage}>\n          <div className={classes.forwardedMessageHeader}>\n            <span>{i18n.t(\"chatMessages.forwarded\")}</span>\n          </div>\n          {forwardedFrom.mediaPath && checkMessageMedia(forwardedFrom)}\n        </div>\n      )}\n      {replyTo && (\n        <div\n          className={classes.replyPreview}\n          style={{ cursor: \"pointer\" }}\n          onClick={() => scrollToMessage(replyTo.id)}\n          title={i18n.t(\"chatMessages.clickToGoToOriginal\")}\n        >\n          <div className={classes.replyPreviewSender}>\n            {replyTo.sender?.name || \"Mensagem\"}\n          </div>\n          <div className={classes.replyPreviewText}>\n            {replyTo.message || \"[mensagem não encontrada]\"}\n          </div>\n        </div>\n      )}\n      <MarkdownWrapper>{text}</MarkdownWrapper>\n    </div>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}