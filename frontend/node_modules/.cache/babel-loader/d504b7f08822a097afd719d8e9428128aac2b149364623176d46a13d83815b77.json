{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useContext,useEffect,useRef,useState}from\"react\";import{useParams,useHistory}from\"react-router-dom\";import{Button,Dialog,DialogActions,DialogContent,DialogTitle,Grid,makeStyles,Paper,Tab,Tabs,TextField,Chip,Typography,FormControl,InputLabel,Select,MenuItem,Badge,Avatar,IconButton}from\"@material-ui/core\";import ChatList from\"./ChatList\";import ChatMessages from\"./ChatMessages\";import{UsersFilter}from\"../../components/UsersFilter\";import api from\"../../services/api\";import useResponsive from\"../../utils/useResponsive\";import{socketConnection}from\"../../services/socket\";import{has,isObject}from\"lodash\";import{getBackendUrl}from\"../../config\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{i18n}from\"../../translate/i18n\";import{toast}from\"react-hot-toast\";import ArrowBackIcon from\"@material-ui/icons/ArrowBack\";// FIXME checkout https://mui.com/components/use-media-query/#migrating-from-withwidth\nimport{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const withWidth=()=>WrappedComponent=>props=>/*#__PURE__*/_jsx(WrappedComponent,_objectSpread(_objectSpread({},props),{},{width:\"xs\"}));const useStyles=makeStyles(theme=>({mainContainer:{display:\"flex\",flexDirection:\"column\",position:\"relative\",flex:1,padding:theme.spacing(2),height:\"calc(100% - 48px)\",overflowY:\"hidden\",border:\"1px solid rgba(0, 0, 0, 0.12)\"},gridContainer:{flex:1,height:\"100%\",border:\"1px solid rgba(0, 0, 0, 0.12)\",background:theme.palette.background.color},gridItem:{height:\"100%\"},gridItemTab:{height:\"92%\",width:\"100%\"},btnContainer:{textAlign:\"right\",padding:10}}));export function ChatModal(_ref){let{open,chat,type,handleClose,handleLoadNewChat,findChats,setChats,setChatsPageInfo,chats,loggedInUserId}=_ref;const[users,setUsers]=useState([]);const[title,setTitle]=useState(\"\");const[description,setDescription]=useState(\"\");const[groupImage,setGroupImage]=useState(\"\");const[imageFile,setImageFile]=useState(null);useEffect(()=>{if(open){setTitle(\"\");setUsers([]);setDescription(\"\");setGroupImage(\"\");setImageFile(null);if(type===\"edit\"&&chat&&chat.users){const userList=chat.users.map(u=>({id:u.user.id,name:u.user.name}));setUsers(userList);setTitle(chat.title||\"\");setDescription(chat.description||\"\");if(chat.groupImage){setGroupImage(chat.groupImage);}}}},[chat,open,type]);// const handleImageChange = (e) => {\n//   if (e.target.files && e.target.files[0]) {\n//     setImageFile(e.target.files[0]);\n//     setGroupImage(URL.createObjectURL(e.target.files[0]));\n//   }\n// };\nconst handleImageChange=e=>{if(e.target.files&&e.target.files[0]){const file=e.target.files[0];const previewUrl=URL.createObjectURL(file);setImageFile(file);setGroupImage(previewUrl);console.log(\"Preview URL:\",previewUrl);}};const handleSave=async()=>{try{let uploadedImageUrl=groupImage;if(imageFile){const formData=new FormData();formData.append(\"file\",imageFile);const uploadRes=await api.post(\"/chats/upload\",formData,{headers:{\"Content-Type\":\"multipart/form-data\"}});uploadedImageUrl=uploadRes.data.url;}if(type===\"edit\"&&chat){const{data}=await api.put(\"/chats/\".concat(chat.id),{users,title,description,groupImage:uploadedImageUrl});handleLoadNewChat(data);}else{const isCreatingGroup=users.length>1||title!==\"\";console.log(\"isCreatingGroup:\",isCreatingGroup);if(!isCreatingGroup){var _users$;const selectedUserId=(_users$=users[0])===null||_users$===void 0?void 0:_users$.id;console.log(\"selectedUserId:\",selectedUserId);console.log(\"loggedInUserId:\",loggedInUserId);console.log(\"chats available:\",chats);const existingChat=chats.find(c=>{const hasSelectedUser=c.users.some(u=>u.userId===selectedUserId);const hasLoggedInUser=c.users.some(u=>u.userId===loggedInUserId);const isIndividualChat=!c.isGroup&&c.users.length===2;console.log(\"Checking chat \".concat(c.id,\": isIndividualChat=\").concat(isIndividualChat,\", hasSelectedUser=\").concat(hasSelectedUser,\", hasLoggedInUser=\").concat(hasLoggedInUser));return isIndividualChat&&hasSelectedUser&&hasLoggedInUser;});console.log(\"Found existingChat:\",existingChat);if(existingChat){toast.info(\"Chat com este usuário já existe!\");handleLoadNewChat(existingChat);handleClose();return;}}const{data}=await api.post(\"/chats\",{users,title,description,groupImage:uploadedImageUrl,isGroup:isCreatingGroup});handleLoadNewChat(data);}handleClose();}catch(err){console.error(err);toast.error(\"Erro ao criar/editar chat\");}};return/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleClose,\"aria-labelledby\":\"alert-dialog-title\",\"aria-describedby\":\"alert-dialog-description\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"alert-dialog-title\",children:type===\"edit\"?i18n.t(\"chatIndex.modal.editTitle\")||\"Editar Grupo\":i18n.t(\"chatIndex.modal.title\")||\"Criar Grupo\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Grid,{spacing:2,container:true,children:[/*#__PURE__*/_jsxs(Grid,{xs:12,style:{padding:18,textAlign:\"center\"},item:true,children:[/*#__PURE__*/_jsx(\"input\",{accept:\"image/*\",style:{display:\"none\"},id:\"group-image-upload\",type:\"file\",onChange:handleImageChange}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"group-image-upload\",children:/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"primary\",component:\"span\",children:groupImage?\"Alterar Foto do Grupo\":\"Adicionar Foto do Grupo\"})}),groupImage&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{style:{marginTop:10},children:/*#__PURE__*/_jsx(\"img\",{src:typeof groupImage===\"string\"?groupImage.startsWith(\"http\")||groupImage.startsWith(\"blob:\")?groupImage:\"\".concat(getBackendUrl()).concat(groupImage):URL.createObjectURL(groupImage),alt:\"Group\",style:{width:80,height:80,borderRadius:\"50%\",objectFit:\"cover\"}})})})]}),/*#__PURE__*/_jsx(Grid,{xs:12,style:{padding:18},item:true,children:/*#__PURE__*/_jsx(TextField,{label:\"T\\xEDtulo\",placeholder:\"T\\xEDtulo\",value:title,onChange:e=>setTitle(e.target.value),variant:\"outlined\",size:\"small\",fullWidth:true})}),/*#__PURE__*/_jsx(Grid,{xs:12,style:{padding:18},item:true,children:/*#__PURE__*/_jsx(TextField,{label:\"Descri\\xE7\\xE3o\",placeholder:\"Descri\\xE7\\xE3o do grupo\",value:description,onChange:e=>setDescription(e.target.value),variant:\"outlined\",size:\"small\",fullWidth:true,multiline:true,rows:2})}),/*#__PURE__*/_jsx(Grid,{xs:12,item:true,children:/*#__PURE__*/_jsx(UsersFilter,{onFiltered:users=>setUsers(users),initialUsers:users})})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleClose,color:\"primary\",children:i18n.t(\"chatIndex.modal.cancel\")}),/*#__PURE__*/_jsx(Button,{onClick:handleSave,color:\"primary\",variant:\"contained\",disabled:users===undefined||users.length===0||title===null||title===\"\"||title===undefined,children:i18n.t(\"chatIndex.modal.save\")})]})]});}function Chat(props){const classes=useStyles();const{user}=useContext(AuthContext);const history=useHistory();const[showDialog,setShowDialog]=useState(false);const[dialogType,setDialogType]=useState(\"new\");const[currentChat,setCurrentChat]=useState({});const[chats,setChats]=useState([]);const[chatsPageInfo,setChatsPageInfo]=useState({hasMore:false});const[messages,setMessages]=useState([]);const[messagesPageInfo,setMessagesPageInfo]=useState({hasMore:false});const[messagesPage,setMessagesPage]=useState(1);const[loading,setLoading]=useState(false);const[loadingMore,setLoadingMore]=useState(false);const[tab,setTab]=useState(0);const[showGroupChats,setShowGroupChats]=useState(false);const isMounted=useRef(true);const scrollToBottomRef=useRef();const messageListRef=useRef();const{id}=useParams();const isMdUp=useResponsive();const[editModalOpen,setEditModalOpen]=useState(false);const[deleteModalOpen,setDeleteModalOpen]=useState(false);const[forwardModalOpen,setForwardModalOpen]=useState(false);const[selectedMessage,setSelectedMessage]=useState(null);const[editText,setEditText]=useState(\"\");const[selectedChatForForward,setSelectedChatForForward]=useState(null);const[justOpenedChat,setJustOpenedChat]=useState(false);// Definir socket e companyId no escopo da função\nconst companyId=user===null||user===void 0?void 0:user.companyId;const socket=companyId?socketConnection({companyId,userId:user===null||user===void 0?void 0:user.id}):null;// Monitorar mudanças no estado chats\nuseEffect(()=>{const groups=chats.filter(chat=>chat.isGroup===true||chat.isGroup===\"true\");const individualChats=chats.filter(chat=>!(chat.isGroup===true||chat.isGroup===\"true\"));},[chats,showGroupChats]);useEffect(()=>{return()=>{isMounted.current=false;};},[]);useEffect(()=>{if(isMounted.current&&user!==null&&user!==void 0&&user.id){findChats().then(data=>{const{records}=data;console.log(\"Chats encontrados:\",records.length);if(isMounted.current&&records.length>0){setChats(records);setChatsPageInfo(data);if(id&&records.length){const chat=records.find(r=>r.uuid===id);if(chat){selectChat(chat,\"useEffect[user?.id] (carregar chats iniciais)\");}}}else{console.log(\"Nenhum chat encontrado ou componente desmontado\");}}).catch(err=>{console.error(\"Erro ao carregar chats iniciais:\",err);});}else{console.log(\"Componente não montado ou usuário não disponível\");}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[user===null||user===void 0?void 0:user.id]);useEffect(()=>{if(!user.id)return;const onChatUser=data=>{if(isMounted.current){if(data.action===\"create\"){setChats(prev=>[data.record,...prev]);}if(data.action===\"update\"){setChats(prev=>prev.map(chat=>chat.id===data.record.id?_objectSpread(_objectSpread({},chat),data.record):chat));if(currentChat&&currentChat.id===data.record.id){setCurrentChat(data.record);}}}};const onChat=data=>{if(!isMounted.current)return;if(isMounted.current){if(data.action===\"delete\"){setChats(prev=>prev.filter(c=>c.id!==+data.id));setMessages([]);setMessagesPage(1);setMessagesPageInfo({hasMore:false});setCurrentChat({});history.push(\"/chats\");setTab(0);}if(data.action===\"new-message\"||data.action===\"update\"){// Só atualize se NÃO for o chat atualmente aberto\nif(!currentChat||currentChat.id!==data.chat.id){setChats(prev=>prev.map(chat=>chat.id===data.chat.id?_objectSpread(_objectSpread({},chat),data.chat):chat));}}}};if(socket&&companyId){socket.on(\"company-\".concat(companyId,\"-chat-user-\").concat(user.id),onChatUser);socket.on(\"company-\".concat(companyId,\"-chat\"),onChat);return()=>{socket.off(\"company-\".concat(companyId,\"-chat-user-\").concat(user.id),onChatUser);socket.off(\"company-\".concat(companyId,\"-chat\"),onChat);};}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[user,socket,companyId]);useEffect(()=>{if(isObject(currentChat)&&has(currentChat,\"id\")&&socket&&companyId){const onCurrentChat=data=>{if(isMounted.current){if(data.action===\"new-message\"){setMessages(prev=>{// Remove mensagem otimista (temp) com mesmo conteúdo e usuário\nconst filtered=prev.filter(msg=>{var _msg$id;return!((_msg$id=msg.id)!==null&&_msg$id!==void 0&&_msg$id.toString().startsWith(\"temp-\")&&msg.senderId===data.newMessage.senderId&&msg.message===data.newMessage.message);});// Evita duplicidade da real\nif(filtered.some(msg=>msg.id===data.newMessage.id)){return filtered;}return[...filtered,data.newMessage];});const changedChats=chats.map(chat=>{if(chat.id===data.newMessage.chatId){return _objectSpread(_objectSpread(_objectSpread({},chat),data.chat),{},{lastMessage:data.newMessage,updatedAt:data.newMessage.createdAt});}return chat;});setChats(changedChats);if(typeof scrollToBottomRef.current===\"function\"){setTimeout(()=>{scrollToBottomRef.current();},300);}// NÃO altere setMessagesPage aqui!\n}else if(data.action===\"edit-message\"){setMessages(prevMessages=>prevMessages.map(msg=>msg.id===data.message.id?data.message:msg));}else if(data.action===\"delete-message\"){setMessages(prevMessages=>prevMessages.map(msg=>msg.id===data.message.id?data.message:msg));}if(data.action===\"update\"){const changedChats=chats.map(chat=>{if(chat.id===data.chat.id){return _objectSpread(_objectSpread({},chat),data.chat);}return chat;});setChats(changedChats);if(typeof scrollToBottomRef.current===\"function\"){scrollToBottomRef.current();}}}};socket.on(\"company-\".concat(companyId,\"-chat-\").concat(currentChat.id),onCurrentChat);return()=>{socket.off(\"company-\".concat(companyId,\"-chat-\").concat(currentChat.id),onCurrentChat);};}},[currentChat,chats,companyId,socket]);// Modifique selectChat para buscar apenas a primeira página ao abrir o chat\nconst selectChat=async function(chat){let reason=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"manual\";console.log(\"[selectChat] Motivo: \".concat(reason),chat);if(!isMounted.current)return;setMessages([]);setMessagesPage(1);setMessagesPageInfo(null);setJustOpenedChat(true);try{// Buscar chat atualizado do backend usando UUID\nconst{data}=await api.get(\"/chats/\".concat(chat.uuid));if(!isMounted.current)return;setCurrentChat(data);// Buscar apenas a primeira página de mensagens\nawait findMessages(data.id,false,1);// Passa página 1 explicitamente\n}catch(err){if(!isMounted.current)return;setCurrentChat(chat);await findMessages(chat.id,false,1);}};// No sendMessage, garanta que NENHUM findMessages, selectChat ou loadMoreMessages é chamado após o envio.\nconst sendMessage=async contentMessage=>{if(!currentChat||!currentChat.id){console.error(\"Nenhum chat selecionado para enviar mensagem\");return;}setLoading(true);try{await api.post(\"/chats/\".concat(currentChat.id,\"/messages\"),{message:contentMessage});// Não chame findMessages, selectChat ou loadMoreMessages aqui!\n// Apenas limpe o campo de input, a mensagem será adicionada pelo socket\n}catch(err){console.error(\"Erro ao enviar mensagem:\",err);}setLoading(false);};const deleteChat=async chat=>{try{await api.delete(\"/chats/\".concat(chat.id));}catch(err){}};// Modifique findMessages para aceitar página explicitamente\nconst findMessages=async function(chatId){let isLoadMore=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let page=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(!isMounted.current||!chatId)return;if(isLoadMore){setLoadingMore(true);}else{setLoading(true);}let currentScrollHeight=0;let currentScrollTop=0;if(isLoadMore){const messageListElement=document.querySelector(\".messageList\");currentScrollHeight=(messageListElement===null||messageListElement===void 0?void 0:messageListElement.scrollHeight)||0;currentScrollTop=(messageListElement===null||messageListElement===void 0?void 0:messageListElement.scrollTop)||0;}try{const pageToFetch=page!==null?page:messagesPage;const url=\"/chats/\".concat(chatId,\"/messages?pageNumber=\").concat(pageToFetch);const{data}=await api.get(url);if(!isMounted.current)return;if(isMounted.current){const isFirstPage=pageToFetch===1;if(isLoadMore){setMessagesPage(prev=>prev+1);}setMessagesPageInfo(data);if(isFirstPage){setMessages(data.records);}else{setMessages(prev=>[...data.records,...prev]);if(isLoadMore){setTimeout(()=>{if(!isMounted.current)return;const messageListElement=document.querySelector(\".messageList\");if(messageListElement){const newScrollHeight=messageListElement.scrollHeight;const scrollDifference=newScrollHeight-currentScrollHeight;messageListElement.scrollTop=currentScrollTop+scrollDifference;}},100);}}}}catch(err){if(!isMounted.current)return;console.error(\"Erro ao carregar mensagens:\",err);}finally{if(isMounted.current){if(isLoadMore){setLoadingMore(false);}else{setLoading(false);}}}};const loadMoreMessages=async()=>{if(!loadingMore&&currentChat&&currentChat.id&&messagesPageInfo!==null&&messagesPageInfo!==void 0&&messagesPageInfo.hasMore){await findMessages(currentChat.id,true);// Não passe page aqui!\n}};const findChats=async()=>{if(!isMounted.current)return;setLoading(true);try{const{data}=await api.get(\"/chats\");// Contar grupos e chats individuais\nconst groups=data.records.filter(chat=>chat.isGroup===true||chat.isGroup===\"true\");const individualChats=data.records.filter(chat=>!(chat.isGroup===true||chat.isGroup===\"true\"));if(isMounted.current){setChats(data.records);setChatsPageInfo(data);console.log(\"Chats definidos no estado\");}return data;}catch(err){console.log(\"Erro ao carregar chats:\",err);return{records:[],hasMore:false};}finally{if(isMounted.current){setLoading(false);}}};const handleLoadNewChat=data=>{if(!isMounted.current)return;// Limpar estado anterior\nsetMessages([]);setMessagesPage(1);setMessagesPageInfo(null);setCurrentChat(data);setJustOpenedChat(true);// Ativar scroll automático\n// No mobile, não mudar a tab automaticamente\n// Deixar o usuário escolher qual tab usar\nhistory.push(\"/chats/\".concat(data.uuid));// Não chame findMessages aqui, selectChat já faz isso\nselectChat(data,\"handleLoadNewChat (novo chat criado/editado)\");// Atualiza a lista de chats\nfindChats().then(chatsData=>{if(isMounted.current&&chatsData&&chatsData.records){setChats(chatsData.records);setChatsPageInfo(chatsData);}});};const handleEditMessage=message=>{// Regra: só pode editar em até 10 minutos\nif(new Date()-new Date(message.createdAt)>10*60*1000){alert(\"Só é possível editar mensagens enviadas há menos de 10 minutos.\");return;}setSelectedMessage(message);setEditText(message.message);setEditModalOpen(true);};const handleDeleteMessage=message=>{setSelectedMessage(message);setDeleteModalOpen(true);};const handleEditSubmit=async()=>{try{const{data}=await api.put(\"/chats/messages/\".concat(selectedMessage.id),{message:editText});setMessages(prevMessages=>prevMessages.map(msg=>msg.id===selectedMessage.id?_objectSpread(_objectSpread({},msg),{},{message:editText}):msg));setEditModalOpen(false);setSelectedMessage(null);setEditText(\"\");}catch(err){console.error(err);}};const handleDeleteSubmit=async()=>{try{await api.delete(\"/chats/messages/\".concat(selectedMessage.id));setMessages(prevMessages=>prevMessages.map(msg=>msg.id===selectedMessage.id?_objectSpread(_objectSpread({},msg),{},{isDeleted:true,message:\"Esta mensagem foi apagada\",mediaPath:null,forwardedFrom:null,replyTo:null}):msg));setDeleteModalOpen(false);setSelectedMessage(null);}catch(err){console.error(err);}};const handleForwardMessage=message=>{setSelectedMessage(message);setForwardModalOpen(true);};const handleForwardSubmit=async()=>{try{await api.post(\"/chats/messages/\".concat(selectedMessage.id,\"/forward\"),{targetChatId:selectedChatForForward});setForwardModalOpen(false);setSelectedMessage(null);setSelectedChatForForward(null);}catch(err){console.error(err);}};const renderGrid=()=>{const filteredChats=chats.filter(chat=>{const isGroup=chat.isGroup===true||chat.isGroup===\"true\";const shouldShow=showGroupChats?isGroup:!isGroup;return shouldShow;}).sort((a,b)=>new Date(b.updatedAt)-new Date(a.updatedAt));return/*#__PURE__*/_jsxs(Grid,{className:classes.gridContainer,container:true,children:[/*#__PURE__*/_jsxs(Grid,{className:classes.gridItem,md:3,item:true,children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",gap:8,marginBottom:12},children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setShowGroupChats(false),color:!showGroupChats?\"primary\":\"default\",variant:!showGroupChats?\"contained\":\"outlined\",fullWidth:true,children:i18n.t(\"chatIndex.chats\")}),/*#__PURE__*/_jsx(Button,{onClick:()=>setShowGroupChats(true),color:showGroupChats?\"primary\":\"default\",variant:showGroupChats?\"contained\":\"outlined\",fullWidth:true,children:i18n.t(\"chatIndex.groups\")}),/*#__PURE__*/_jsx(Button,{onClick:()=>{setDialogType(\"new\");setShowDialog(true);},color:\"secondary\",variant:\"contained\",fullWidth:true,children:i18n.t(\"chatIndex.createGroup\")})]}),/*#__PURE__*/_jsx(ChatList,{chats:filteredChats,pageInfo:chatsPageInfo,loading:loading,handleSelectChat:chat=>selectChat(chat,\"seleção manual na lista\"),handleDeleteChat:chat=>deleteChat(chat),handleEditChat:chat=>{setCurrentChat(chat);setDialogType(\"edit\");setShowDialog(true);},findChats:findChats})]}),/*#__PURE__*/_jsx(Grid,{className:classes.gridItem,md:9,item:true,children:isObject(currentChat)&&has(currentChat,\"id\")&&/*#__PURE__*/_jsx(ChatMessages,{chat:currentChat,scrollToBottomRef:scrollToBottomRef,pageInfo:messagesPageInfo,messages:messages,loading:loading,loadingMore:loadingMore,handleSendMessage:sendMessage,handleLoadMore:loadMoreMessages,onEdit:handleEditMessage,onDelete:handleDeleteMessage,onForward:handleForwardMessage,justOpenedChat:justOpenedChat,setJustOpenedChat:setJustOpenedChat,messageListRef:messageListRef,addOptimisticMessage:addOptimisticMessage})})]});};const renderTab=()=>{return/*#__PURE__*/_jsx(Grid,{className:classes.gridContainer,container:true,children:!currentChat.id?/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(\"div\",{style:{display:\"flex\",alignItems:\"center\",justifyContent:\"flex-end\",padding:\"16px 16px 0 16px\",background:\"#fff\",borderBottom:\"1px solid #eee\",position:\"sticky\",top:0,zIndex:100},children:/*#__PURE__*/_jsx(Button,{onClick:()=>setShowDialog(true),color:\"primary\",variant:\"contained\",style:{minWidth:120},children:i18n.t(\"chatIndex.createGroup\")||\"Criar grupo\"})}),/*#__PURE__*/_jsx(\"div\",{style:{background:\"#fff\",position:\"sticky\",top:56,zIndex:99},children:/*#__PURE__*/_jsxs(Tabs,{value:tab,onChange:(e,v)=>setTab(v),indicatorColor:\"primary\",textColor:\"primary\",variant:\"fullWidth\",children:[/*#__PURE__*/_jsx(Tab,{label:i18n.t(\"chatIndex.chats\")||\"Chats\"}),/*#__PURE__*/_jsx(Tab,{label:i18n.t(\"chatIndex.groups\")||\"Grupos\"})]})}),tab===0&&/*#__PURE__*/_jsx(Grid,{className:classes.gridItemTab,md:12,item:true,children:/*#__PURE__*/_jsx(ChatList,{chats:chats.filter(chat=>{const isGroup=chat.isGroup===true||chat.isGroup===\"true\";return!isGroup;}),pageInfo:chatsPageInfo,loading:loading,handleSelectChat:chat=>selectChat(chat),handleDeleteChat:chat=>deleteChat(chat),findChats:findChats})}),tab===1&&/*#__PURE__*/_jsx(Grid,{className:classes.gridItemTab,md:12,item:true,children:/*#__PURE__*/_jsx(ChatList,{chats:chats.filter(chat=>{const isGroup=chat.isGroup===true||chat.isGroup===\"true\";return isGroup;}),pageInfo:chatsPageInfo,loading:loading,handleSelectChat:chat=>selectChat(chat),handleDeleteChat:chat=>deleteChat(chat),handleEditChat:chat=>{setCurrentChat(chat);setDialogType(\"edit\");setShowDialog(true);},findChats:findChats})})]}):/*#__PURE__*/_jsxs(Grid,{className:classes.gridItemTab,md:12,item:true,style:{display:\"flex\",flexDirection:\"column\",height:\"100%\",minHeight:0,padding:0},children:[/*#__PURE__*/_jsx(\"div\",{style:{display:\"flex\",alignItems:\"center\",padding:\"10px\",borderBottom:\"1px solid #eee\",background:\"#fff\",position:\"sticky\",top:0,zIndex:100},children:/*#__PURE__*/_jsx(IconButton,{onClick:()=>setCurrentChat({}),children:/*#__PURE__*/_jsx(ArrowBackIcon,{})})}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1,minHeight:0,display:\"flex\",flexDirection:\"column\"},children:/*#__PURE__*/_jsx(ChatMessages,{chat:currentChat,scrollToBottomRef:scrollToBottomRef,pageInfo:messagesPageInfo,messages:messages,loading:loading,loadingMore:loadingMore,handleSendMessage:sendMessage,handleLoadMore:loadMoreMessages,onEdit:handleEditMessage,onDelete:handleDeleteMessage,onForward:handleForwardMessage// messageListRef={messageListRef}\n// isFirstPage={messagesPage === 2}\n,justOpenedChat:justOpenedChat,setJustOpenedChat:setJustOpenedChat,addOptimisticMessage:addOptimisticMessage})})]})});};useEffect(()=>{if(id&&chats.length){const chat=chats.find(r=>r.uuid===id);// Só chama selectChat se o chat atual for diferente\nif(chat&&(!currentChat||currentChat.id!==chat.id)){selectChat(chat,\"useEffect[id, chats] (mudança de rota ou lista de chats)\");}}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[id,chats]);const addOptimisticMessage=msg=>{setMessages(prev=>[...prev,msg]);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ChatModal,{type:dialogType,open:showDialog,chat:currentChat,handleLoadNewChat:handleLoadNewChat,handleClose:()=>setShowDialog(false),findChats:findChats,setChats:setChats,setChatsPageInfo:setChatsPageInfo,chats:chats,loggedInUserId:user.id}),/*#__PURE__*/_jsx(Paper,{className:classes.mainContainer// style={{\n//   height: \"100%\",\n//   minHeight: 0,\n//   display: \"flex\",\n//   flexDirection: \"column\",\n//   padding: 0,\n// }}\n,children:isMdUp?renderGrid():renderTab()}),/*#__PURE__*/_jsxs(Dialog,{open:editModalOpen,onClose:()=>setEditModalOpen(false),maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Editar Mensagem\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(TextField,{autoFocus:true,margin:\"dense\",label:\"Mensagem\",type:\"text\",fullWidth:true,value:editText,onChange:e=>setEditText(e.target.value),multiline:true,minRows:3,maxRows:10,inputProps:{style:{fontSize:18}}})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setEditModalOpen(false),color:\"secondary\",children:i18n.t(\"chatIndex.cancel\")}),/*#__PURE__*/_jsx(Button,{onClick:handleEditSubmit,color:\"primary\",children:i18n.t(\"chatIndex.save\")})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:deleteModalOpen,onClose:()=>setDeleteModalOpen(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:i18n.t(\"chatIndex.deleteGroup\")}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(Typography,{children:i18n.t(\"chatIndex.deleteGroupConfirm\")})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setDeleteModalOpen(false),color:\"secondary\",children:i18n.t(\"chatIndex.cancel\")}),/*#__PURE__*/_jsx(Button,{onClick:handleDeleteSubmit,color:\"primary\",children:i18n.t(\"chatIndex.delete\")})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:forwardModalOpen,onClose:()=>setForwardModalOpen(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Encaminhar Mensagem\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,margin:\"dense\",children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Selecione o chat\"}),/*#__PURE__*/_jsx(Select,{value:selectedChatForForward||\"\",onChange:e=>setSelectedChatForForward(e.target.value),children:chats.map(chat=>{var _chat$users$find,_chat$users$find$user;return/*#__PURE__*/_jsx(MenuItem,{value:chat.id,children:chat.isGroup?chat.title:(_chat$users$find=chat.users.find(u=>u.userId!==user.id))===null||_chat$users$find===void 0?void 0:(_chat$users$find$user=_chat$users$find.user)===null||_chat$users$find$user===void 0?void 0:_chat$users$find$user.name},chat.id);})})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setForwardModalOpen(false),color:\"secondary\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(Button,{onClick:handleForwardSubmit,color:\"primary\",disabled:!selectedChatForForward,children:\"Encaminhar\"})]})]})]});}export default withWidth()(Chat);","map":{"version":3,"names":["React","useContext","useEffect","useRef","useState","useParams","useHistory","Button","Dialog","DialogActions","DialogContent","DialogTitle","Grid","makeStyles","Paper","Tab","Tabs","TextField","Chip","Typography","FormControl","InputLabel","Select","MenuItem","Badge","Avatar","IconButton","ChatList","ChatMessages","UsersFilter","api","useResponsive","socketConnection","has","isObject","getBackendUrl","AuthContext","i18n","toast","ArrowBackIcon","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","withWidth","WrappedComponent","props","_objectSpread","width","useStyles","theme","mainContainer","display","flexDirection","position","flex","padding","spacing","height","overflowY","border","gridContainer","background","palette","color","gridItem","gridItemTab","btnContainer","textAlign","ChatModal","_ref","open","chat","type","handleClose","handleLoadNewChat","findChats","setChats","setChatsPageInfo","chats","loggedInUserId","users","setUsers","title","setTitle","description","setDescription","groupImage","setGroupImage","imageFile","setImageFile","userList","map","u","id","user","name","handleImageChange","e","target","files","file","previewUrl","URL","createObjectURL","console","log","handleSave","uploadedImageUrl","formData","FormData","append","uploadRes","post","headers","data","url","put","concat","isCreatingGroup","length","_users$","selectedUserId","existingChat","find","c","hasSelectedUser","some","userId","hasLoggedInUser","isIndividualChat","isGroup","info","err","error","onClose","children","t","container","xs","style","item","accept","onChange","htmlFor","variant","component","marginTop","src","startsWith","alt","borderRadius","objectFit","label","placeholder","value","size","fullWidth","multiline","rows","onFiltered","initialUsers","onClick","disabled","undefined","Chat","classes","history","showDialog","setShowDialog","dialogType","setDialogType","currentChat","setCurrentChat","chatsPageInfo","hasMore","messages","setMessages","messagesPageInfo","setMessagesPageInfo","messagesPage","setMessagesPage","loading","setLoading","loadingMore","setLoadingMore","tab","setTab","showGroupChats","setShowGroupChats","isMounted","scrollToBottomRef","messageListRef","isMdUp","editModalOpen","setEditModalOpen","deleteModalOpen","setDeleteModalOpen","forwardModalOpen","setForwardModalOpen","selectedMessage","setSelectedMessage","editText","setEditText","selectedChatForForward","setSelectedChatForForward","justOpenedChat","setJustOpenedChat","companyId","socket","groups","filter","individualChats","current","then","records","r","uuid","selectChat","catch","onChatUser","action","prev","record","onChat","push","on","off","onCurrentChat","filtered","msg","_msg$id","toString","senderId","newMessage","message","changedChats","chatId","lastMessage","updatedAt","createdAt","setTimeout","prevMessages","reason","arguments","get","findMessages","sendMessage","contentMessage","deleteChat","delete","isLoadMore","page","currentScrollHeight","currentScrollTop","messageListElement","document","querySelector","scrollHeight","scrollTop","pageToFetch","isFirstPage","newScrollHeight","scrollDifference","loadMoreMessages","chatsData","handleEditMessage","Date","alert","handleDeleteMessage","handleEditSubmit","handleDeleteSubmit","isDeleted","mediaPath","forwardedFrom","replyTo","handleForwardMessage","handleForwardSubmit","targetChatId","renderGrid","filteredChats","shouldShow","sort","a","b","className","md","gap","marginBottom","pageInfo","handleSelectChat","handleDeleteChat","handleEditChat","handleSendMessage","handleLoadMore","onEdit","onDelete","onForward","addOptimisticMessage","renderTab","alignItems","justifyContent","borderBottom","top","zIndex","minWidth","v","indicatorColor","textColor","minHeight","maxWidth","autoFocus","margin","minRows","maxRows","inputProps","fontSize","_chat$users$find","_chat$users$find$user"],"sources":["/home/deploy/atendechatop/frontend/src/pages/Chat/index.js"],"sourcesContent":["import React, { useContext, useEffect, useRef, useState } from \"react\";\n\nimport { useParams, useHistory } from \"react-router-dom\";\n\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Grid,\n  makeStyles,\n  Paper,\n  Tab,\n  Tabs,\n  TextField,\n  Chip,\n  Typography,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  Badge,\n  Avatar,\n  IconButton,\n} from \"@material-ui/core\";\nimport ChatList from \"./ChatList\";\nimport ChatMessages from \"./ChatMessages\";\nimport { UsersFilter } from \"../../components/UsersFilter\";\nimport api from \"../../services/api\";\nimport useResponsive from \"../../utils/useResponsive\";\nimport { socketConnection } from \"../../services/socket\";\nimport { has, isObject } from \"lodash\";\nimport { getBackendUrl } from \"../../config\";\n\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\nimport { i18n } from \"../../translate/i18n\";\nimport { toast } from \"react-hot-toast\";\nimport ArrowBackIcon from \"@material-ui/icons/ArrowBack\";\n\n// FIXME checkout https://mui.com/components/use-media-query/#migrating-from-withwidth\nconst withWidth = () => (WrappedComponent) => (props) =>\n  <WrappedComponent {...props} width=\"xs\" />;\n\nconst useStyles = makeStyles((theme) => ({\n  mainContainer: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    position: \"relative\",\n    flex: 1,\n    padding: theme.spacing(2),\n    height: `calc(100% - 48px)`,\n    overflowY: \"hidden\",\n    border: \"1px solid rgba(0, 0, 0, 0.12)\",\n  },\n  gridContainer: {\n    flex: 1,\n    height: \"100%\",\n    border: \"1px solid rgba(0, 0, 0, 0.12)\",\n    background: theme.palette.background.color,\n  },\n  gridItem: {\n    height: \"100%\",\n  },\n  gridItemTab: {\n    height: \"92%\",\n    width: \"100%\",\n  },\n  btnContainer: {\n    textAlign: \"right\",\n    padding: 10,\n  },\n}));\n\nexport function ChatModal({\n  open,\n  chat,\n  type,\n  handleClose,\n  handleLoadNewChat,\n  findChats,\n  setChats,\n  setChatsPageInfo,\n  chats,\n  loggedInUserId,\n}) {\n  const [users, setUsers] = useState([]);\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [groupImage, setGroupImage] = useState(\"\");\n  const [imageFile, setImageFile] = useState(null);\n\n  useEffect(() => {\n    if (open) {\n      setTitle(\"\");\n      setUsers([]);\n      setDescription(\"\");\n      setGroupImage(\"\");\n      setImageFile(null);\n      if (type === \"edit\" && chat && chat.users) {\n        const userList = chat.users.map((u) => ({\n          id: u.user.id,\n          name: u.user.name,\n        }));\n        setUsers(userList);\n        setTitle(chat.title || \"\");\n        setDescription(chat.description || \"\");\n        if (chat.groupImage) {\n          setGroupImage(chat.groupImage);\n        }\n      }\n    }\n  }, [chat, open, type]);\n\n  // const handleImageChange = (e) => {\n  //   if (e.target.files && e.target.files[0]) {\n  //     setImageFile(e.target.files[0]);\n  //     setGroupImage(URL.createObjectURL(e.target.files[0]));\n  //   }\n  // };\n\n  const handleImageChange = (e) => {\n    if (e.target.files && e.target.files[0]) {\n      const file = e.target.files[0];\n      const previewUrl = URL.createObjectURL(file);\n      setImageFile(file);\n      setGroupImage(previewUrl);\n      console.log(\"Preview URL:\", previewUrl);\n    }\n  };\n\n  const handleSave = async () => {\n    try {\n      let uploadedImageUrl = groupImage;\n      if (imageFile) {\n        const formData = new FormData();\n        formData.append(\"file\", imageFile);\n        const uploadRes = await api.post(\"/chats/upload\", formData, {\n          headers: { \"Content-Type\": \"multipart/form-data\" },\n        });\n        uploadedImageUrl = uploadRes.data.url;\n      }\n\n      if (type === \"edit\" && chat) {\n        const { data } = await api.put(`/chats/${chat.id}`, {\n          users,\n          title,\n          description,\n          groupImage: uploadedImageUrl,\n        });\n        handleLoadNewChat(data);\n      } else {\n        const isCreatingGroup = users.length > 1 || title !== \"\";\n        console.log(\"isCreatingGroup:\", isCreatingGroup);\n\n        if (!isCreatingGroup) {\n          const selectedUserId = users[0]?.id;\n          console.log(\"selectedUserId:\", selectedUserId);\n          console.log(\"loggedInUserId:\", loggedInUserId);\n          console.log(\"chats available:\", chats);\n\n          const existingChat = chats.find((c) => {\n            const hasSelectedUser = c.users.some(\n              (u) => u.userId === selectedUserId\n            );\n            const hasLoggedInUser = c.users.some(\n              (u) => u.userId === loggedInUserId\n            );\n            const isIndividualChat = !c.isGroup && c.users.length === 2;\n\n            console.log(\n              `Checking chat ${c.id}: isIndividualChat=${isIndividualChat}, hasSelectedUser=${hasSelectedUser}, hasLoggedInUser=${hasLoggedInUser}`\n            );\n\n            return isIndividualChat && hasSelectedUser && hasLoggedInUser;\n          });\n\n          console.log(\"Found existingChat:\", existingChat);\n\n          if (existingChat) {\n            toast.info(\"Chat com este usuário já existe!\");\n            handleLoadNewChat(existingChat);\n            handleClose();\n            return;\n          }\n        }\n\n        const { data } = await api.post(\"/chats\", {\n          users,\n          title,\n          description,\n          groupImage: uploadedImageUrl,\n          isGroup: isCreatingGroup,\n        });\n        handleLoadNewChat(data);\n      }\n      handleClose();\n    } catch (err) {\n      console.error(err);\n      toast.error(\"Erro ao criar/editar chat\");\n    }\n  };\n\n  return (\n    <Dialog\n      open={open}\n      onClose={handleClose}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogTitle id=\"alert-dialog-title\">\n        {type === \"edit\"\n          ? i18n.t(\"chatIndex.modal.editTitle\") || \"Editar Grupo\"\n          : i18n.t(\"chatIndex.modal.title\") || \"Criar Grupo\"}\n      </DialogTitle>\n      <DialogContent>\n        <Grid spacing={2} container>\n          <Grid xs={12} style={{ padding: 18, textAlign: \"center\" }} item>\n            <input\n              accept=\"image/*\"\n              style={{ display: \"none\" }}\n              id=\"group-image-upload\"\n              type=\"file\"\n              onChange={handleImageChange}\n            />\n            <label htmlFor=\"group-image-upload\">\n              <Button variant=\"outlined\" color=\"primary\" component=\"span\">\n                {groupImage\n                  ? \"Alterar Foto do Grupo\"\n                  : \"Adicionar Foto do Grupo\"}\n              </Button>\n            </label>\n            {groupImage && (\n              <>\n                <div style={{ marginTop: 10 }}>\n                  <img\n                    src={\n                      typeof groupImage === \"string\"\n                        ? groupImage.startsWith(\"http\") ||\n                          groupImage.startsWith(\"blob:\")\n                          ? groupImage\n                          : `${getBackendUrl()}${groupImage}`\n                        : URL.createObjectURL(groupImage)\n                    }\n                    alt=\"Group\"\n                    style={{\n                      width: 80,\n                      height: 80,\n                      borderRadius: \"50%\",\n                      objectFit: \"cover\",\n                    }}\n                  />\n                </div>\n              </>\n            )}\n          </Grid>\n          <Grid xs={12} style={{ padding: 18 }} item>\n            <TextField\n              label=\"Título\"\n              placeholder=\"Título\"\n              value={title}\n              onChange={(e) => setTitle(e.target.value)}\n              variant=\"outlined\"\n              size=\"small\"\n              fullWidth\n            />\n          </Grid>\n          <Grid xs={12} style={{ padding: 18 }} item>\n            <TextField\n              label=\"Descrição\"\n              placeholder=\"Descrição do grupo\"\n              value={description}\n              onChange={(e) => setDescription(e.target.value)}\n              variant=\"outlined\"\n              size=\"small\"\n              fullWidth\n              multiline\n              rows={2}\n            />\n          </Grid>\n\n          <Grid xs={12} item>\n            <UsersFilter\n              onFiltered={(users) => setUsers(users)}\n              initialUsers={users}\n            />\n          </Grid>\n        </Grid>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={handleClose} color=\"primary\">\n          {i18n.t(\"chatIndex.modal.cancel\")}\n        </Button>\n        <Button\n          onClick={handleSave}\n          color=\"primary\"\n          variant=\"contained\"\n          disabled={\n            users === undefined ||\n            users.length === 0 ||\n            title === null ||\n            title === \"\" ||\n            title === undefined\n          }\n        >\n          {i18n.t(\"chatIndex.modal.save\")}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n\nfunction Chat(props) {\n  const classes = useStyles();\n  const { user } = useContext(AuthContext);\n  const history = useHistory();\n\n  const [showDialog, setShowDialog] = useState(false);\n  const [dialogType, setDialogType] = useState(\"new\");\n  const [currentChat, setCurrentChat] = useState({});\n  const [chats, setChats] = useState([]);\n  const [chatsPageInfo, setChatsPageInfo] = useState({ hasMore: false });\n  const [messages, setMessages] = useState([]);\n  const [messagesPageInfo, setMessagesPageInfo] = useState({ hasMore: false });\n  const [messagesPage, setMessagesPage] = useState(1);\n  const [loading, setLoading] = useState(false);\n  const [loadingMore, setLoadingMore] = useState(false);\n  const [tab, setTab] = useState(0);\n  const [showGroupChats, setShowGroupChats] = useState(false);\n  const isMounted = useRef(true);\n  const scrollToBottomRef = useRef();\n  const messageListRef = useRef();\n  const { id } = useParams();\n  const isMdUp = useResponsive();\n  const [editModalOpen, setEditModalOpen] = useState(false);\n  const [deleteModalOpen, setDeleteModalOpen] = useState(false);\n  const [forwardModalOpen, setForwardModalOpen] = useState(false);\n  const [selectedMessage, setSelectedMessage] = useState(null);\n  const [editText, setEditText] = useState(\"\");\n  const [selectedChatForForward, setSelectedChatForForward] = useState(null);\n  const [justOpenedChat, setJustOpenedChat] = useState(false);\n\n  // Definir socket e companyId no escopo da função\n  const companyId = user?.companyId;\n  const socket = companyId\n    ? socketConnection({ companyId, userId: user?.id })\n    : null;\n\n  // Monitorar mudanças no estado chats\n  useEffect(() => {\n    const groups = chats.filter(\n      (chat) => chat.isGroup === true || chat.isGroup === \"true\"\n    );\n    const individualChats = chats.filter(\n      (chat) => !(chat.isGroup === true || chat.isGroup === \"true\")\n    );\n  }, [chats, showGroupChats]);\n\n  useEffect(() => {\n    return () => {\n      isMounted.current = false;\n    };\n  }, []);\n\n  useEffect(() => {\n    if (isMounted.current && user?.id) {\n      findChats()\n        .then((data) => {\n          const { records } = data;\n          console.log(\"Chats encontrados:\", records.length);\n          if (isMounted.current && records.length > 0) {\n            setChats(records);\n            setChatsPageInfo(data);\n\n            if (id && records.length) {\n              const chat = records.find((r) => r.uuid === id);\n              if (chat) {\n                selectChat(\n                  chat,\n                  \"useEffect[user?.id] (carregar chats iniciais)\"\n                );\n              }\n            }\n          } else {\n            console.log(\"Nenhum chat encontrado ou componente desmontado\");\n          }\n        })\n        .catch((err) => {\n          console.error(\"Erro ao carregar chats iniciais:\", err);\n        });\n    } else {\n      console.log(\"Componente não montado ou usuário não disponível\");\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [user?.id]);\n\n  useEffect(() => {\n    if (!user.id) return;\n\n    const onChatUser = (data) => {\n      if (isMounted.current) {\n        if (data.action === \"create\") {\n          setChats((prev) => [data.record, ...prev]);\n        }\n        if (data.action === \"update\") {\n          setChats((prev) =>\n            prev.map((chat) =>\n              chat.id === data.record.id ? { ...chat, ...data.record } : chat\n            )\n          );\n          if (currentChat && currentChat.id === data.record.id) {\n            setCurrentChat(data.record);\n          }\n        }\n      }\n    };\n    const onChat = (data) => {\n      if (!isMounted.current) return;\n      if (isMounted.current) {\n        if (data.action === \"delete\") {\n          setChats((prev) => prev.filter((c) => c.id !== +data.id));\n          setMessages([]);\n          setMessagesPage(1);\n          setMessagesPageInfo({ hasMore: false });\n          setCurrentChat({});\n          history.push(\"/chats\");\n          setTab(0);\n        }\n        if (data.action === \"new-message\" || data.action === \"update\") {\n          // Só atualize se NÃO for o chat atualmente aberto\n          if (!currentChat || currentChat.id !== data.chat.id) {\n            setChats((prev) =>\n              prev.map((chat) =>\n                chat.id === data.chat.id ? { ...chat, ...data.chat } : chat\n              )\n            );\n          }\n        }\n      }\n    };\n\n    if (socket && companyId) {\n      socket.on(`company-${companyId}-chat-user-${user.id}`, onChatUser);\n      socket.on(`company-${companyId}-chat`, onChat);\n\n      return () => {\n        socket.off(`company-${companyId}-chat-user-${user.id}`, onChatUser);\n        socket.off(`company-${companyId}-chat`, onChat);\n      };\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [user, socket, companyId]);\n\n  useEffect(() => {\n    if (\n      isObject(currentChat) &&\n      has(currentChat, \"id\") &&\n      socket &&\n      companyId\n    ) {\n      const onCurrentChat = (data) => {\n        if (isMounted.current) {\n          if (data.action === \"new-message\") {\n            setMessages((prev) => {\n              // Remove mensagem otimista (temp) com mesmo conteúdo e usuário\n              const filtered = prev.filter(\n                (msg) =>\n                  !(\n                    msg.id?.toString().startsWith(\"temp-\") &&\n                    msg.senderId === data.newMessage.senderId &&\n                    msg.message === data.newMessage.message\n                  )\n              );\n              // Evita duplicidade da real\n              if (filtered.some((msg) => msg.id === data.newMessage.id)) {\n                return filtered;\n              }\n              return [...filtered, data.newMessage];\n            });\n            const changedChats = chats.map((chat) => {\n              if (chat.id === data.newMessage.chatId) {\n                return {\n                  ...chat,\n                  ...data.chat,\n                  lastMessage: data.newMessage,\n                  updatedAt: data.newMessage.createdAt,\n                };\n              }\n              return chat;\n            });\n            setChats(changedChats);\n            if (typeof scrollToBottomRef.current === \"function\") {\n              setTimeout(() => {\n                scrollToBottomRef.current();\n              }, 300);\n            }\n            // NÃO altere setMessagesPage aqui!\n          } else if (data.action === \"edit-message\") {\n            setMessages((prevMessages) =>\n              prevMessages.map((msg) =>\n                msg.id === data.message.id ? data.message : msg\n              )\n            );\n          } else if (data.action === \"delete-message\") {\n            setMessages((prevMessages) =>\n              prevMessages.map((msg) =>\n                msg.id === data.message.id ? data.message : msg\n              )\n            );\n          }\n\n          if (data.action === \"update\") {\n            const changedChats = chats.map((chat) => {\n              if (chat.id === data.chat.id) {\n                return {\n                  ...chat,\n                  ...data.chat,\n                };\n              }\n              return chat;\n            });\n            setChats(changedChats);\n            if (typeof scrollToBottomRef.current === \"function\") {\n              scrollToBottomRef.current();\n            }\n          }\n        }\n      };\n\n      socket.on(`company-${companyId}-chat-${currentChat.id}`, onCurrentChat);\n\n      return () => {\n        socket.off(\n          `company-${companyId}-chat-${currentChat.id}`,\n          onCurrentChat\n        );\n      };\n    }\n  }, [currentChat, chats, companyId, socket]);\n\n  // Modifique selectChat para buscar apenas a primeira página ao abrir o chat\n  const selectChat = async (chat, reason = \"manual\") => {\n    console.log(`[selectChat] Motivo: ${reason}`, chat);\n    if (!isMounted.current) return;\n    setMessages([]);\n    setMessagesPage(1);\n    setMessagesPageInfo(null);\n    setJustOpenedChat(true);\n\n    try {\n      // Buscar chat atualizado do backend usando UUID\n      const { data } = await api.get(`/chats/${chat.uuid}`);\n      if (!isMounted.current) return;\n      setCurrentChat(data);\n\n      // Buscar apenas a primeira página de mensagens\n      await findMessages(data.id, false, 1); // Passa página 1 explicitamente\n    } catch (err) {\n      if (!isMounted.current) return;\n      setCurrentChat(chat);\n      await findMessages(chat.id, false, 1);\n    }\n  };\n\n  // No sendMessage, garanta que NENHUM findMessages, selectChat ou loadMoreMessages é chamado após o envio.\n  const sendMessage = async (contentMessage) => {\n    if (!currentChat || !currentChat.id) {\n      console.error(\"Nenhum chat selecionado para enviar mensagem\");\n      return;\n    }\n    setLoading(true);\n    try {\n      await api.post(`/chats/${currentChat.id}/messages`, {\n        message: contentMessage,\n      });\n      // Não chame findMessages, selectChat ou loadMoreMessages aqui!\n      // Apenas limpe o campo de input, a mensagem será adicionada pelo socket\n    } catch (err) {\n      console.error(\"Erro ao enviar mensagem:\", err);\n    }\n    setLoading(false);\n  };\n\n  const deleteChat = async (chat) => {\n    try {\n      await api.delete(`/chats/${chat.id}`);\n    } catch (err) {}\n  };\n\n  // Modifique findMessages para aceitar página explicitamente\n  const findMessages = async (chatId, isLoadMore = false, page = null) => {\n    if (!isMounted.current || !chatId) return;\n\n    if (isLoadMore) {\n      setLoadingMore(true);\n    } else {\n      setLoading(true);\n    }\n\n    let currentScrollHeight = 0;\n    let currentScrollTop = 0;\n    if (isLoadMore) {\n      const messageListElement = document.querySelector(\".messageList\");\n      currentScrollHeight = messageListElement?.scrollHeight || 0;\n      currentScrollTop = messageListElement?.scrollTop || 0;\n    }\n\n    try {\n      const pageToFetch = page !== null ? page : messagesPage;\n      const url = `/chats/${chatId}/messages?pageNumber=${pageToFetch}`;\n      const { data } = await api.get(url);\n      if (!isMounted.current) return;\n\n      if (isMounted.current) {\n        const isFirstPage = pageToFetch === 1;\n        if (isLoadMore) {\n          setMessagesPage((prev) => prev + 1);\n        }\n        setMessagesPageInfo(data);\n        if (isFirstPage) {\n          setMessages(data.records);\n        } else {\n          setMessages((prev) => [...data.records, ...prev]);\n          if (isLoadMore) {\n            setTimeout(() => {\n              if (!isMounted.current) return;\n              const messageListElement = document.querySelector(\".messageList\");\n              if (messageListElement) {\n                const newScrollHeight = messageListElement.scrollHeight;\n                const scrollDifference = newScrollHeight - currentScrollHeight;\n                messageListElement.scrollTop =\n                  currentScrollTop + scrollDifference;\n              }\n            }, 100);\n          }\n        }\n      }\n    } catch (err) {\n      if (!isMounted.current) return;\n      console.error(\"Erro ao carregar mensagens:\", err);\n    } finally {\n      if (isMounted.current) {\n        if (isLoadMore) {\n          setLoadingMore(false);\n        } else {\n          setLoading(false);\n        }\n      }\n    }\n  };\n\n  const loadMoreMessages = async () => {\n    if (\n      !loadingMore &&\n      currentChat &&\n      currentChat.id &&\n      messagesPageInfo?.hasMore\n    ) {\n      await findMessages(currentChat.id, true); // Não passe page aqui!\n    }\n  };\n\n  const findChats = async () => {\n    if (!isMounted.current) return;\n    setLoading(true);\n    try {\n      const { data } = await api.get(`/chats`);\n\n      // Contar grupos e chats individuais\n      const groups = data.records.filter(\n        (chat) => chat.isGroup === true || chat.isGroup === \"true\"\n      );\n      const individualChats = data.records.filter(\n        (chat) => !(chat.isGroup === true || chat.isGroup === \"true\")\n      );\n\n      if (isMounted.current) {\n        setChats(data.records);\n        setChatsPageInfo(data);\n        console.log(\"Chats definidos no estado\");\n      }\n      return data;\n    } catch (err) {\n      console.log(\"Erro ao carregar chats:\", err);\n      return { records: [], hasMore: false };\n    } finally {\n      if (isMounted.current) {\n        setLoading(false);\n      }\n    }\n  };\n\n  const handleLoadNewChat = (data) => {\n    if (!isMounted.current) return;\n\n    // Limpar estado anterior\n    setMessages([]);\n    setMessagesPage(1);\n    setMessagesPageInfo(null);\n    setCurrentChat(data);\n    setJustOpenedChat(true); // Ativar scroll automático\n\n    // No mobile, não mudar a tab automaticamente\n    // Deixar o usuário escolher qual tab usar\n\n    history.push(`/chats/${data.uuid}`);\n\n    // Não chame findMessages aqui, selectChat já faz isso\n    selectChat(data, \"handleLoadNewChat (novo chat criado/editado)\");\n    // Atualiza a lista de chats\n    findChats().then((chatsData) => {\n      if (isMounted.current && chatsData && chatsData.records) {\n        setChats(chatsData.records);\n        setChatsPageInfo(chatsData);\n      }\n    });\n  };\n\n  const handleEditMessage = (message) => {\n    // Regra: só pode editar em até 10 minutos\n    if (new Date() - new Date(message.createdAt) > 10 * 60 * 1000) {\n      alert(\"Só é possível editar mensagens enviadas há menos de 10 minutos.\");\n      return;\n    }\n    setSelectedMessage(message);\n    setEditText(message.message);\n    setEditModalOpen(true);\n  };\n\n  const handleDeleteMessage = (message) => {\n    setSelectedMessage(message);\n    setDeleteModalOpen(true);\n  };\n\n  const handleEditSubmit = async () => {\n    try {\n      const { data } = await api.put(`/chats/messages/${selectedMessage.id}`, {\n        message: editText,\n      });\n      setMessages((prevMessages) =>\n        prevMessages.map((msg) =>\n          msg.id === selectedMessage.id ? { ...msg, message: editText } : msg\n        )\n      );\n      setEditModalOpen(false);\n      setSelectedMessage(null);\n      setEditText(\"\");\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  const handleDeleteSubmit = async () => {\n    try {\n      await api.delete(`/chats/messages/${selectedMessage.id}`);\n      setMessages((prevMessages) =>\n        prevMessages.map((msg) =>\n          msg.id === selectedMessage.id\n            ? {\n                ...msg,\n                isDeleted: true,\n                message: \"Esta mensagem foi apagada\",\n                mediaPath: null,\n                forwardedFrom: null,\n                replyTo: null,\n              }\n            : msg\n        )\n      );\n      setDeleteModalOpen(false);\n      setSelectedMessage(null);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  const handleForwardMessage = (message) => {\n    setSelectedMessage(message);\n    setForwardModalOpen(true);\n  };\n\n  const handleForwardSubmit = async () => {\n    try {\n      await api.post(`/chats/messages/${selectedMessage.id}/forward`, {\n        targetChatId: selectedChatForForward,\n      });\n      setForwardModalOpen(false);\n      setSelectedMessage(null);\n      setSelectedChatForForward(null);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  const renderGrid = () => {\n    const filteredChats = chats\n      .filter((chat) => {\n        const isGroup = chat.isGroup === true || chat.isGroup === \"true\";\n        const shouldShow = showGroupChats ? isGroup : !isGroup;\n\n        return shouldShow;\n      })\n      .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));\n\n    return (\n      <Grid className={classes.gridContainer} container>\n        <Grid className={classes.gridItem} md={3} item>\n          <div style={{ display: \"flex\", gap: 8, marginBottom: 12 }}>\n            <Button\n              onClick={() => setShowGroupChats(false)}\n              color={!showGroupChats ? \"primary\" : \"default\"}\n              variant={!showGroupChats ? \"contained\" : \"outlined\"}\n              fullWidth\n            >\n              {i18n.t(\"chatIndex.chats\")}\n            </Button>\n            <Button\n              onClick={() => setShowGroupChats(true)}\n              color={showGroupChats ? \"primary\" : \"default\"}\n              variant={showGroupChats ? \"contained\" : \"outlined\"}\n              fullWidth\n            >\n              {i18n.t(\"chatIndex.groups\")}\n            </Button>\n            <Button\n              onClick={() => {\n                setDialogType(\"new\");\n                setShowDialog(true);\n              }}\n              color=\"secondary\"\n              variant=\"contained\"\n              fullWidth\n            >\n              {i18n.t(\"chatIndex.createGroup\")}\n            </Button>\n          </div>\n          <ChatList\n            chats={filteredChats}\n            pageInfo={chatsPageInfo}\n            loading={loading}\n            handleSelectChat={(chat) =>\n              selectChat(chat, \"seleção manual na lista\")\n            }\n            handleDeleteChat={(chat) => deleteChat(chat)}\n            handleEditChat={(chat) => {\n              setCurrentChat(chat);\n              setDialogType(\"edit\");\n              setShowDialog(true);\n            }}\n            findChats={findChats}\n          />\n        </Grid>\n        <Grid className={classes.gridItem} md={9} item>\n          {isObject(currentChat) && has(currentChat, \"id\") && (\n            <ChatMessages\n              chat={currentChat}\n              scrollToBottomRef={scrollToBottomRef}\n              pageInfo={messagesPageInfo}\n              messages={messages}\n              loading={loading}\n              loadingMore={loadingMore}\n              handleSendMessage={sendMessage}\n              handleLoadMore={loadMoreMessages}\n              onEdit={handleEditMessage}\n              onDelete={handleDeleteMessage}\n              onForward={handleForwardMessage}\n              justOpenedChat={justOpenedChat}\n              setJustOpenedChat={setJustOpenedChat}\n              messageListRef={messageListRef}\n              addOptimisticMessage={addOptimisticMessage}\n            />\n          )}\n        </Grid>\n      </Grid>\n    );\n  };\n\n  const renderTab = () => {\n    return (\n      <Grid className={classes.gridContainer} container>\n        {!currentChat.id ? (\n          <Grid item xs={12}>\n            {/* Cabeçalho da lista com botão Criar grupo */}\n            <div\n              style={{\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"flex-end\",\n                padding: \"16px 16px 0 16px\",\n                background: \"#fff\",\n                borderBottom: \"1px solid #eee\",\n                position: \"sticky\",\n                top: 0,\n                zIndex: 100,\n              }}\n            >\n              <Button\n                onClick={() => setShowDialog(true)}\n                color=\"primary\"\n                variant=\"contained\"\n                style={{ minWidth: 120 }}\n              >\n                {i18n.t(\"chatIndex.createGroup\") || \"Criar grupo\"}\n              </Button>\n            </div>\n            {/* Abas de Chats e Grupos */}\n            <div\n              style={{\n                background: \"#fff\",\n                position: \"sticky\",\n                top: 56,\n                zIndex: 99,\n              }}\n            >\n              <Tabs\n                value={tab}\n                onChange={(e, v) => setTab(v)}\n                indicatorColor=\"primary\"\n                textColor=\"primary\"\n                variant=\"fullWidth\"\n              >\n                <Tab label={i18n.t(\"chatIndex.chats\") || \"Chats\"} />\n                <Tab label={i18n.t(\"chatIndex.groups\") || \"Grupos\"} />\n              </Tabs>\n            </div>\n            {tab === 0 && (\n              <Grid className={classes.gridItemTab} md={12} item>\n                <ChatList\n                  chats={chats.filter((chat) => {\n                    const isGroup =\n                      chat.isGroup === true || chat.isGroup === \"true\";\n                    return !isGroup;\n                  })}\n                  pageInfo={chatsPageInfo}\n                  loading={loading}\n                  handleSelectChat={(chat) => selectChat(chat)}\n                  handleDeleteChat={(chat) => deleteChat(chat)}\n                  findChats={findChats}\n                />\n              </Grid>\n            )}\n            {tab === 1 && (\n              <Grid className={classes.gridItemTab} md={12} item>\n                <ChatList\n                  chats={chats.filter((chat) => {\n                    const isGroup =\n                      chat.isGroup === true || chat.isGroup === \"true\";\n                    return isGroup;\n                  })}\n                  pageInfo={chatsPageInfo}\n                  loading={loading}\n                  handleSelectChat={(chat) => selectChat(chat)}\n                  handleDeleteChat={(chat) => deleteChat(chat)}\n                  handleEditChat={(chat) => {\n                    setCurrentChat(chat);\n                    setDialogType(\"edit\");\n                    setShowDialog(true);\n                  }}\n                  findChats={findChats}\n                />\n              </Grid>\n            )}\n          </Grid>\n        ) : (\n          <Grid\n            className={classes.gridItemTab}\n            md={12}\n            item\n            style={{\n              display: \"flex\",\n              flexDirection: \"column\",\n              height: \"100%\",\n              minHeight: 0,\n              padding: 0,\n            }}\n          >\n            {/* Cabeçalho mobile da conversa */}\n            <div\n              style={{\n                display: \"flex\",\n                alignItems: \"center\",\n                padding: \"10px\",\n                borderBottom: \"1px solid #eee\",\n                background: \"#fff\",\n                position: \"sticky\",\n                top: 0,\n                zIndex: 100,\n              }}\n            >\n              <IconButton onClick={() => setCurrentChat({})}>\n                <ArrowBackIcon />\n              </IconButton>\n              {/* <Avatar\n                src={\n                  currentChat.isGroup\n                    ? currentChat.groupImage\n                      ? currentChat.groupImage.startsWith(\"http\")\n                        ? currentChat.groupImage\n                        : `${getBackendUrl()}${currentChat.groupImage}`\n                      : undefined\n                    : currentChat.users &&\n                      currentChat.users.find((u) => u.userId !== user.id)?.user\n                        ?.profileImage\n                    ? currentChat.users\n                        .find((u) => u.userId !== user.id)\n                        .user.profileImage.startsWith(\"http\")\n                      ? currentChat.users.find((u) => u.userId !== user.id).user\n                          .profileImage\n                      : `${getBackendUrl()}/public/company${\n                          currentChat.users.find((u) => u.userId !== user.id)\n                            .user.companyId\n                        }/user/${\n                          currentChat.users.find((u) => u.userId !== user.id)\n                            .user.profileImage\n                        }`\n                    : undefined\n                }\n                style={{ marginRight: 12 }}\n              >\n                {currentChat.isGroup\n                  ? currentChat.title?.charAt(0) || \"G\"\n                  : (currentChat.users &&\n                      currentChat.users\n                        .find((u) => u.userId !== user.id)\n                        ?.user?.name?.charAt(0)) ||\n                    \"?\"}\n              </Avatar> */}\n\n              {/* Nome do usuário ou grupo */}\n              {/* <Typography variant=\"subtitle1\" style={{ fontWeight: 600 }}>\n                {currentChat.isGroup\n                  ? currentChat.title || \"Grupo\"\n                  : (currentChat.users &&\n                      currentChat.users.find((u) => u.userId !== user.id)?.user\n                        ?.name) ||\n                    \"Usuário\"}\n              </Typography> */}\n            </div>\n            {/* Container flexível para ChatMessages */}\n            <div\n              style={{\n                flex: 1,\n                minHeight: 0,\n                display: \"flex\",\n                flexDirection: \"column\",\n              }}\n            >\n              <ChatMessages\n                chat={currentChat}\n                scrollToBottomRef={scrollToBottomRef}\n                pageInfo={messagesPageInfo}\n                messages={messages}\n                loading={loading}\n                loadingMore={loadingMore}\n                handleSendMessage={sendMessage}\n                handleLoadMore={loadMoreMessages}\n                onEdit={handleEditMessage}\n                onDelete={handleDeleteMessage}\n                onForward={handleForwardMessage}\n                // messageListRef={messageListRef}\n                // isFirstPage={messagesPage === 2}\n                justOpenedChat={justOpenedChat}\n                setJustOpenedChat={setJustOpenedChat}\n                addOptimisticMessage={addOptimisticMessage}\n              />\n            </div>\n          </Grid>\n        )}\n      </Grid>\n    );\n  };\n\n  useEffect(() => {\n    if (id && chats.length) {\n      const chat = chats.find((r) => r.uuid === id);\n      // Só chama selectChat se o chat atual for diferente\n      if (chat && (!currentChat || currentChat.id !== chat.id)) {\n        selectChat(\n          chat,\n          \"useEffect[id, chats] (mudança de rota ou lista de chats)\"\n        );\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id, chats]);\n\n  const addOptimisticMessage = (msg) => {\n    setMessages((prev) => [...prev, msg]);\n  };\n\n  return (\n    <>\n      <ChatModal\n        type={dialogType}\n        open={showDialog}\n        chat={currentChat}\n        handleLoadNewChat={handleLoadNewChat}\n        handleClose={() => setShowDialog(false)}\n        findChats={findChats}\n        setChats={setChats}\n        setChatsPageInfo={setChatsPageInfo}\n        chats={chats}\n        loggedInUserId={user.id}\n      />\n      <Paper\n        className={classes.mainContainer}\n        // style={{\n        //   height: \"100%\",\n        //   minHeight: 0,\n        //   display: \"flex\",\n        //   flexDirection: \"column\",\n        //   padding: 0,\n        // }}\n      >\n        {isMdUp ? renderGrid() : renderTab()}\n      </Paper>\n      <Dialog\n        open={editModalOpen}\n        onClose={() => setEditModalOpen(false)}\n        maxWidth=\"md\"\n        fullWidth\n      >\n        <DialogTitle>Editar Mensagem</DialogTitle>\n        <DialogContent>\n          <TextField\n            autoFocus\n            margin=\"dense\"\n            label=\"Mensagem\"\n            type=\"text\"\n            fullWidth\n            value={editText}\n            onChange={(e) => setEditText(e.target.value)}\n            multiline\n            minRows={3}\n            maxRows={10}\n            inputProps={{ style: { fontSize: 18 } }}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setEditModalOpen(false)} color=\"secondary\">\n            {i18n.t(\"chatIndex.cancel\")}\n          </Button>\n          <Button onClick={handleEditSubmit} color=\"primary\">\n            {i18n.t(\"chatIndex.save\")}\n          </Button>\n        </DialogActions>\n      </Dialog>\n\n      <Dialog open={deleteModalOpen} onClose={() => setDeleteModalOpen(false)}>\n        <DialogTitle>{i18n.t(\"chatIndex.deleteGroup\")}</DialogTitle>\n        <DialogContent>\n          <Typography>{i18n.t(\"chatIndex.deleteGroupConfirm\")}</Typography>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setDeleteModalOpen(false)} color=\"secondary\">\n            {i18n.t(\"chatIndex.cancel\")}\n          </Button>\n          <Button onClick={handleDeleteSubmit} color=\"primary\">\n            {i18n.t(\"chatIndex.delete\")}\n          </Button>\n        </DialogActions>\n      </Dialog>\n\n      <Dialog\n        open={forwardModalOpen}\n        onClose={() => setForwardModalOpen(false)}\n      >\n        <DialogTitle>Encaminhar Mensagem</DialogTitle>\n        <DialogContent>\n          <FormControl fullWidth margin=\"dense\">\n            <InputLabel>Selecione o chat</InputLabel>\n            <Select\n              value={selectedChatForForward || \"\"}\n              onChange={(e) => setSelectedChatForForward(e.target.value)}\n            >\n              {chats.map((chat) => (\n                <MenuItem key={chat.id} value={chat.id}>\n                  {chat.isGroup\n                    ? chat.title\n                    : chat.users.find((u) => u.userId !== user.id)?.user?.name}\n                </MenuItem>\n              ))}\n            </Select>\n          </FormControl>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setForwardModalOpen(false)} color=\"secondary\">\n            Cancelar\n          </Button>\n          <Button\n            onClick={handleForwardSubmit}\n            color=\"primary\"\n            disabled={!selectedChatForForward}\n          >\n            Encaminhar\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n}\n\nexport default withWidth()(Chat);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}