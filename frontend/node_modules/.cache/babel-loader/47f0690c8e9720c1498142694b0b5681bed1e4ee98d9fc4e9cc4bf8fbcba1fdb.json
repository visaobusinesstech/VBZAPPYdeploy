{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState,useContext}from\"react\";import{useParams}from\"react-router-dom\";import{useHistory}from\"react-router-dom\";import{makeStyles}from\"@material-ui/core/styles\";import Paper from\"@material-ui/core/Paper\";import{toast}from\"react-toastify\";import*as XLSX from\"xlsx\";import MainContainer from\"../../components/MainContainer\";import MainHeader from\"../../components/MainHeader\";import Title from\"../../components/Title\";import{Grid,LinearProgress,Typography,Button,Divider,Card,CardHeader,CardContent,Box,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,TablePagination,IconButton,Chip,Avatar,Tooltip}from\"@material-ui/core\";import ArrowBackIcon from\"@material-ui/icons/ArrowBack\";import SendIcon from\"@material-ui/icons/Send\";import PhoneIcon from\"@material-ui/icons/Phone\";import MessageIcon from\"@material-ui/icons/Message\";import ScheduleIcon from\"@material-ui/icons/Schedule\";import EventAvailableIcon from\"@material-ui/icons/EventAvailable\";import DoneIcon from\"@material-ui/icons/Done\";import DoneAllIcon from\"@material-ui/icons/DoneAll\";import CheckCircleIcon from\"@material-ui/icons/CheckCircle\";import ErrorIcon from\"@material-ui/icons/Error\";import WhatsAppIcon from\"@material-ui/icons/WhatsApp\";import ListAltIcon from\"@material-ui/icons/ListAlt\";import PieChartIcon from'@material-ui/icons/PieChart';import BarChartIcon from'@material-ui/icons/BarChart';import GetAppIcon from\"@material-ui/icons/GetApp\";import{useDate}from\"../../hooks/useDate\";import usePlans from\"../../hooks/usePlans\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{format}from\"date-fns\";import{ptBR}from\"date-fns/locale\";import{has,get,isNull}from\"lodash\";import api from\"../../services/api\";import{Chart as ChartJS,CategoryScale,LinearScale,PointElement,LineElement,BarElement,ArcElement,Title as ChartTitle,Tooltip as ChartTooltip,Legend,Filler}from'chart.js';import{Line,Pie,Doughnut}from'react-chartjs-2';// import { SocketContext } from \"../../context/Socket/SocketContext\";\nimport{i18n}from\"../../translate/i18n\";// Registrar componentes do Chart.js\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";ChartJS.register(CategoryScale,LinearScale,PointElement,LineElement,BarElement,ArcElement,ChartTitle,ChartTooltip,Legend,Filler);const useStyles=makeStyles(theme=>({mainPaper:_objectSpread(_objectSpread({flex:1,padding:theme.spacing(2),overflowY:\"scroll\"},theme.scrollbarStyles),{},{marginBottom:theme.spacing(2)}),textRight:{textAlign:\"right\"},tabPanelsContainer:{padding:theme.spacing(2)},summaryCards:{marginTop:theme.spacing(2),marginBottom:theme.spacing(2)},summaryCard:{padding:theme.spacing(2),height:'100%',display:'flex',flexDirection:'column'},cardHeader:{paddingBottom:0},cardIcon:{color:theme.palette.primary.main,fontSize:40,marginBottom:theme.spacing(1)},progressContainer:{padding:theme.spacing(2),marginBottom:theme.spacing(2)},tableContainer:{marginTop:theme.spacing(3)},tableTitle:{margin:theme.spacing(2,0),fontWeight:500},chartContainer:{height:300,marginBottom:theme.spacing(4)},chip:{margin:theme.spacing(0.5)},statusChip:{color:'#fff',fontWeight:'bold'},deliveredChip:{backgroundColor:theme.palette.success.main},pendingChip:{backgroundColor:theme.palette.warning.main},failedChip:{backgroundColor:theme.palette.error.main},pieChartContainer:{height:250,position:'relative',marginTop:theme.spacing(2)},sectionTitle:{fontWeight:500,margin:theme.spacing(2,0)},detailsCard:{marginBottom:theme.spacing(2)},fullWidthGrid:{width:'100%'},avatar:{backgroundColor:theme.palette.primary.main,color:'#fff'}}));const CampaignReport=()=>{var _campaign$whatsapp,_campaign$contactList;const classes=useStyles();const history=useHistory();const{campaignId}=useParams();const[campaign,setCampaign]=useState({});const[validContacts,setValidContacts]=useState(0);const[delivered,setDelivered]=useState(0);const[confirmationRequested,setConfirmationRequested]=useState(0);const[confirmed,setConfirmed]=useState(0);const[percent,setPercent]=useState(0);const[loading,setLoading]=useState(false);const[messageRows,setMessageRows]=useState([]);const[page,setPage]=useState(0);const[rowsPerPage,setRowsPerPage]=useState(10);const[shippingPage,setShippingPage]=useState(1);const[totalShippingPages,setTotalShippingPages]=useState(1);const[uniqueNumbers,setUniqueNumbers]=useState(0);const[failedMessages,setFailedMessages]=useState(0);const[totalMessagesSent,setTotalMessagesSent]=useState(0);const mounted=useRef(true);const{user,socket}=useContext(AuthContext);const{datetimeToClient}=useDate();const{getPlanCompany}=usePlans();// Dados para o gráfico de pizza\nconst[chartData,setChartData]=useState({labels:['Entregues','Aguardando','Falhas'],datasets:[{data:[0,0,0],backgroundColor:['rgba(75, 192, 192, 0.7)','rgba(255, 206, 86, 0.7)','rgba(255, 99, 132, 0.7)'],borderColor:['rgba(75, 192, 192, 1)','rgba(255, 206, 86, 1)','rgba(255, 99, 132, 1)'],borderWidth:1}]});// Opções para o gráfico de pizza\nconst chartOptions={responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}}};useEffect(()=>{async function fetchData(){const companyId=user.companyId;const planConfigs=await getPlanCompany(undefined,companyId);if(!planConfigs.plan.useCampaigns){toast.error(\"Esta empresa não possui permissão para acessar essa página! Estamos lhe redirecionando.\");setTimeout(()=>{history.push(\"/\");},1000);}}fetchData();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(()=>{if(mounted.current){findCampaign();}return()=>{mounted.current=false;};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(()=>{if(mounted.current){if(has(campaign,\"contactList\")&&has(campaign.contactList,\"contacts\")){const contactList=get(campaign,\"contactList\");const valids=contactList.contacts.filter(c=>c.isWhatsappValid);setValidContacts(valids.length);}else if(has(campaign,\"tagListId\")){// Se estamos usando tags em vez de listas de contato\nsetValidContacts(delivered);// Usamos as entregas como contatos válidos\n}if(has(campaign,\"shipping\")&&Array.isArray(campaign.shipping)){const contacts=get(campaign,\"shipping\");const delivered=contacts.filter(c=>!isNull(c.deliveredAt));const confirmationRequested=contacts.filter(c=>!isNull(c.confirmationRequestedAt));const confirmed=contacts.filter(c=>!isNull(c.deliveredAt)&&!isNull(c.confirmationRequestedAt));setDelivered(delivered.length);setConfirmationRequested(confirmationRequested.length);setConfirmed(confirmed.length);}}},[campaign]);useEffect(()=>{// Evitar divisão por zero\nif(validContacts>0){setPercent(delivered/validContacts*100);}else{setPercent(0);}},[delivered,validContacts]);useEffect(()=>{const companyId=user.companyId;// const socket = socketManager.GetSocket();\nconst onCampaignEvent=data=>{if(data.record.id===+campaignId){setCampaign(data.record);if(data.record.status===\"FINALIZADA\"){setTimeout(()=>{findCampaign();},5000);}}};socket.on(\"company-\".concat(companyId,\"-campaign\"),onCampaignEvent);return()=>{socket.off(\"company-\".concat(companyId,\"-campaign\"),onCampaignEvent);};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[campaignId]);const findCampaign=async()=>{try{setLoading(true);// Buscar dados básicos da campanha (sem shipping para evitar estouro de memória)\nconst{data:campaign}=await api.get(\"/campaigns/\".concat(campaignId));setCampaign(campaign);// Buscar estatísticas separadamente usando o novo endpoint\ntry{const{data:stats}=await api.get(\"/campaigns/\".concat(campaignId,\"/stats\"));setDelivered(stats.deliveredMessages);setValidContacts(stats.totalMessages);// Total da lista/tag\nsetUniqueNumbers(stats.uniqueNumbers);// Destinatários únicos processados\nsetFailedMessages(stats.failedMessages);setTotalMessagesSent(stats.totalMessages);// Total de mensagens (mesmo que total da lista)\n// Atualizar dados do gráfico com estatísticas do servidor\nsetChartData({labels:['Entregues','Aguardando','Falhas'],datasets:[{data:[stats.deliveredMessages,stats.pendingMessages,stats.failedMessages],backgroundColor:['rgba(75, 192, 192, 0.7)','rgba(255, 206, 86, 0.7)','rgba(255, 99, 132, 0.7)'],borderColor:['rgba(75, 192, 192, 1)','rgba(255, 206, 86, 1)','rgba(255, 99, 132, 1)'],borderWidth:1}]});}catch(statsError){console.error(\"Erro ao buscar estatísticas:\",statsError);// Fallback para valores padrão\nsetDelivered(0);setValidContacts(0);setUniqueNumbers(0);setFailedMessages(0);setTotalMessagesSent(0);}// Buscar dados de shipping com paginação usando o novo endpoint\ntry{const{data:shippingResponse}=await api.get(\"/campaigns/\".concat(campaignId,\"/shipping?page=1&pageSize=\").concat(rowsPerPage));if(shippingResponse&&shippingResponse.shipping){const shippingData=shippingResponse.shipping;// Processar dados para a tabela\nconst formattedRows=shippingData.map(item=>({id:item.id,jobId:item.jobId,number:item.number,message:item.message?item.message.substring(0,50)+(item.message.length>50?'...':''):'',fullMessage:item.message||'',deliveredAt:item.deliveredAt?datetimeToClient(item.deliveredAt):null,createdAt:item.createdAt?datetimeToClient(item.createdAt):null,status:item.deliveredAt?'delivered':'pending'}));setMessageRows(formattedRows);// Armazenar informações de paginação\nsetTotalShippingPages(shippingResponse.totalPages||1);setShippingPage(shippingResponse.currentPage||1);}}catch(shippingError){console.error(\"Erro ao buscar dados de envio:\",shippingError);// Manter array vazio em caso de erro\nsetMessageRows([]);}}catch(error){console.error(\"Erro ao buscar campanha:\",error);toast.error(i18n.t(\"campaignReport.fetchError\"));}finally{setLoading(false);}};const formatStatus=val=>{switch(val){case\"INATIVA\":return i18n.t(\"campaignReport.inactive\");case\"PROGRAMADA\":return i18n.t(\"campaignReport.scheduled\");case\"EM_ANDAMENTO\":return i18n.t(\"campaignReport.process\");case\"CANCELADA\":return i18n.t(\"campaignReport.cancelled\");case\"FINALIZADA\":return i18n.t(\"campaignReport.finished\");default:return val;}};// Manipuladores para a paginação da tabela\nconst handleChangePage=(event,newPage)=>{setPage(newPage);};const handleChangeRowsPerPage=event=>{setRowsPerPage(parseInt(event.target.value,10));setPage(0);// Carregar dados com novo tamanho de página\nloadMoreShipping(1,parseInt(event.target.value,10));};// Função para carregar mais dados de shipping\nconst loadMoreShipping=async function(){let newPage=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;let pageSize=arguments.length>1&&arguments[1]!==undefined?arguments[1]:50;try{setLoading(true);const url=\"/campaigns/\".concat(campaignId,\"/shipping?page=\").concat(newPage,\"&pageSize=\").concat(pageSize);const{data:shippingResponse}=await api.get(url);if(shippingResponse&&shippingResponse.shipping){const shippingData=shippingResponse.shipping;// Processar dados para a tabela\nconst formattedRows=shippingData.map(item=>({id:item.id,jobId:item.jobId,number:item.number,message:item.message?item.message.substring(0,50)+(item.message.length>50?'...':''):'',fullMessage:item.message||'',deliveredAt:item.deliveredAt?datetimeToClient(item.deliveredAt):null,createdAt:item.createdAt?datetimeToClient(item.createdAt):null,status:item.deliveredAt?'delivered':'pending'}));setMessageRows(formattedRows);setTotalShippingPages(shippingResponse.totalPages||1);setShippingPage(shippingResponse.currentPage||1);}else{setMessageRows([]);}}catch(error){console.error(\"Erro ao carregar mais dados de envio:\",error);toast.error(\"Erro ao carregar dados de envio\");setMessageRows([]);}finally{setLoading(false);}};// Função para formatar o número de telefone\nconst formatPhoneNumber=number=>{if(!number)return'';// Verifica se é um ID de grupo (normalmente começa com números grandes)\nif(number.length>15){return\"Grupo (\".concat(number.substring(0,6),\"...)\");}// Formata número normal\nif(number.length===12&&number.startsWith('55')){const ddd=number.substring(2,4);const firstPart=number.substring(4,9);const lastPart=number.substring(9);return\"+55 (\".concat(ddd,\") \").concat(firstPart,\"-\").concat(lastPart);}return number;};// Função para obter o status do envio\nconst getMessageStatusChip=status=>{switch(status){case'delivered':return/*#__PURE__*/_jsx(Chip,{label:\"Entregue\",size:\"small\",icon:/*#__PURE__*/_jsx(DoneAllIcon,{fontSize:\"small\"}),className:\"\".concat(classes.statusChip,\" \").concat(classes.deliveredChip)});case'pending':return/*#__PURE__*/_jsx(Chip,{label:\"Pendente\",size:\"small\",icon:/*#__PURE__*/_jsx(ScheduleIcon,{fontSize:\"small\"}),className:\"\".concat(classes.statusChip,\" \").concat(classes.pendingChip)});case'failed':return/*#__PURE__*/_jsx(Chip,{label:\"Falha\",size:\"small\",icon:/*#__PURE__*/_jsx(ErrorIcon,{fontSize:\"small\"}),className:\"\".concat(classes.statusChip,\" \").concat(classes.failedChip)});default:return/*#__PURE__*/_jsx(Chip,{label:\"Desconhecido\",size:\"small\",variant:\"outlined\"});}};// Função para exportar dados para Excel\nconst exportToExcel=async()=>{try{toast.info(\"Gerando relatório Excel, aguarde...\");// Buscar todos os dados de shipping em lotes (máximo 1000 por página)\nlet allShippingData=[];let currentPage=1;let hasMoreData=true;const pageSize=1000;// Limite máximo do backend\nwhile(hasMoreData){const{data:shippingResponse}=await api.get(\"/campaigns/\".concat(campaignId,\"/shipping?page=\").concat(currentPage,\"&pageSize=\").concat(pageSize));if(!shippingResponse||!shippingResponse.shipping){break;}allShippingData=[...allShippingData,...shippingResponse.shipping];// Verificar se há mais páginas\nhasMoreData=currentPage<shippingResponse.totalPages;currentPage++;// Atualizar progresso\ntoast.info(\"Carregando dados... \".concat(allShippingData.length,\" registros encontrados\"));}if(allShippingData.length===0){toast.error(\"Nenhum dado encontrado para exportar\");return;}const shippingData=allShippingData;// Preparar dados para Excel\nconst excelData=[// Cabeçalho\n[\"Relatório de Campanha\",\"\",\"\",\"\",\"\",\"\"],[\"Campanha: \".concat(campaign.name),\"\",\"\",\"\",\"\",\"\"],[\"Data de Gera\\xE7\\xE3o: \".concat(new Date().toLocaleString('pt-BR')),\"\",\"\",\"\",\"\",\"\"],[\"\",\"\",\"\",\"\",\"\",\"\"],// Cabeçalhos das colunas\n[\"ID\",\"Destinatário\",\"Mensagem\",\"Enviado em\",\"Entregue em\",\"Status\"]];// Adicionar dados das mensagens\nshippingData.forEach(item=>{excelData.push([item.jobId||'',item.number||'',item.message||'',item.createdAt?new Date(item.createdAt).toLocaleString('pt-BR'):'',item.deliveredAt?new Date(item.deliveredAt).toLocaleString('pt-BR'):'',item.deliveredAt?'Entregue':'Pendente']);});// Criar workbook e worksheet\nconst wb=XLSX.utils.book_new();const ws=XLSX.utils.aoa_to_sheet(excelData);// Configurar larguras das colunas\nws['!cols']=[{wch:15},// ID\n{wch:20},// Destinatário\n{wch:50},// Mensagem\n{wch:20},// Enviado em\n{wch:20},// Entregue em\n{wch:15}// Status\n];// Mesclar células do cabeçalho\nws['!merges']=[{s:{c:0,r:0},e:{c:5,r:0}},// Título\n{s:{c:0,r:1},e:{c:5,r:1}},// Nome da campanha\n{s:{c:0,r:2},e:{c:5,r:2}}// Data de geração\n];// Adicionar worksheet ao workbook\nXLSX.utils.book_append_sheet(wb,ws,\"Relatório de Campanha\");// Gerar nome do arquivo\nconst fileName=\"relatorio_campanha_\".concat(campaign.name.replace(/[^a-zA-Z0-9]/g,'_'),\"_\").concat(new Date().toISOString().split('T')[0],\".xlsx\");// Fazer download\nXLSX.writeFile(wb,fileName);toast.success(\"Relat\\xF3rio Excel gerado com sucesso! \".concat(shippingData.length,\" registros exportados.\"));}catch(error){console.error(\"Erro ao exportar para Excel:\",error);toast.error(\"Erro ao gerar relatório Excel\");}};return/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsx(MainHeader,{children:/*#__PURE__*/_jsx(Grid,{style:{width:\"99.6%\"},container:true,children:/*#__PURE__*/_jsxs(Grid,{xs:12,item:true,style:{display:\"flex\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"primary\",style:{marginRight:10},onClick:()=>history.push('/campaigns'),startIcon:/*#__PURE__*/_jsx(ArrowBackIcon,{}),children:i18n.t(\"campaignReport.backButton\")}),/*#__PURE__*/_jsxs(Title,{children:[i18n.t(\"campaignReport.title\"),\" \",campaign.name||i18n.t(\"campaignReport.campaign\")]})]})})}),/*#__PURE__*/_jsxs(Paper,{className:classes.mainPaper,variant:\"outlined\",children:[/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",component:\"h2\",gutterBottom:true,children:campaign.name||i18n.t(\"campaignReport.campaign\")}),/*#__PURE__*/_jsx(Chip,{label:formatStatus(campaign.status),color:campaign.status===\"FINALIZADA\"?\"primary\":\"default\",style:{fontWeight:'bold',marginRight:8}})]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,className:classes.summaryCards,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,lg:3,children:/*#__PURE__*/_jsx(Card,{className:classes.summaryCard,variant:\"outlined\",children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"textSecondary\",gutterBottom:true,children:\"Status de Entrega\"}),/*#__PURE__*/_jsx(Box,{className:classes.pieChartContainer,children:/*#__PURE__*/_jsx(Doughnut,{data:chartData,options:chartOptions})})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,lg:3,children:/*#__PURE__*/_jsx(Card,{className:classes.summaryCard,variant:\"outlined\",children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(SendIcon,{className:classes.cardIcon}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"div\",children:delivered}),/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",children:\"Mensagens Enviadas\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,lg:3,children:/*#__PURE__*/_jsx(Card,{className:classes.summaryCard,variant:\"outlined\",children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(PhoneIcon,{className:classes.cardIcon}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"div\",children:uniqueNumbers}),/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",children:\"Destinat\\xE1rios \\xDAnicos\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,lg:3,children:/*#__PURE__*/_jsx(Card,{className:classes.summaryCard,variant:\"outlined\",children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(CheckCircleIcon,{className:classes.cardIcon}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"div\",children:delivered}),/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",children:\"Mensagens Entregues\"})]})})})]}),/*#__PURE__*/_jsxs(Box,{className:classes.progressContainer,children:[/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,alignItems:\"center\",children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:true,children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:i18n.t(\"campaignReport.deliver\")})}),/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textPrimary\",children:[delivered,\" de \",totalMessagesSent]})})]}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",style:{height:10,borderRadius:5,margin:\"8px 0\"},value:delivered/(totalMessagesSent||1)*100})]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[campaign.whatsappId&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Card,{variant:\"outlined\",className:classes.detailsCard,children:/*#__PURE__*/_jsx(CardHeader,{avatar:/*#__PURE__*/_jsx(Avatar,{className:classes.avatar,children:/*#__PURE__*/_jsx(WhatsAppIcon,{})}),title:\"Conex\\xE3o WhatsApp\",subheader:((_campaign$whatsapp=campaign.whatsapp)===null||_campaign$whatsapp===void 0?void 0:_campaign$whatsapp.name)||\"Não especificado\"})})}),campaign.tagListId&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Card,{variant:\"outlined\",className:classes.detailsCard,children:/*#__PURE__*/_jsx(CardHeader,{avatar:/*#__PURE__*/_jsx(Avatar,{className:classes.avatar,children:/*#__PURE__*/_jsx(ListAltIcon,{})}),title:\"Tag Utilizada\",subheader:\"ID: \".concat(campaign.tagListId)})})}),campaign.contactListId&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Card,{variant:\"outlined\",className:classes.detailsCard,children:/*#__PURE__*/_jsx(CardHeader,{avatar:/*#__PURE__*/_jsx(Avatar,{className:classes.avatar,children:/*#__PURE__*/_jsx(ListAltIcon,{})}),title:i18n.t(\"campaignReport.contactLists\"),subheader:((_campaign$contactList=campaign.contactList)===null||_campaign$contactList===void 0?void 0:_campaign$contactList.name)||\"Não especificado\"})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Card,{variant:\"outlined\",className:classes.detailsCard,children:/*#__PURE__*/_jsx(CardHeader,{avatar:/*#__PURE__*/_jsx(Avatar,{className:classes.avatar,children:/*#__PURE__*/_jsx(ScheduleIcon,{})}),title:i18n.t(\"campaignReport.schedule\"),subheader:datetimeToClient(campaign.scheduledAt)||\"Não agendado\"})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Card,{variant:\"outlined\",className:classes.detailsCard,children:/*#__PURE__*/_jsx(CardHeader,{avatar:/*#__PURE__*/_jsx(Avatar,{className:classes.avatar,children:/*#__PURE__*/_jsx(EventAvailableIcon,{})}),title:i18n.t(\"campaignReport.conclusion\"),subheader:datetimeToClient(campaign.completedAt)||\"Não concluído\"})})})]}),/*#__PURE__*/_jsxs(Box,{mt:4,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",mb:2,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",className:classes.sectionTitle,children:[/*#__PURE__*/_jsx(MessageIcon,{style:{verticalAlign:'middle',marginRight:8}}),\"Detalhes das Mensagens\"]}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",startIcon:/*#__PURE__*/_jsx(GetAppIcon,{}),onClick:exportToExcel,style:{borderRadius:20,textTransform:'none',fontWeight:'bold',boxShadow:'0 4px 12px rgba(0,0,0,0.15)',background:'linear-gradient(45deg, #4CAF50 30%, #45a049 90%)','&:hover':{background:'linear-gradient(45deg, #45a049 30%, #4CAF50 90%)',boxShadow:'0 6px 16px rgba(0,0,0,0.2)'}},children:\"Exportar Excel\"})]}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(TableContainer,{className:classes.tableContainer,children:[/*#__PURE__*/_jsxs(Table,{\"aria-label\":\"tabela de mensagens\",children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"ID\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Destinat\\xE1rio\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Mensagem\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Enviado em\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Entregue em\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Status\"})]})}),/*#__PURE__*/_jsxs(TableBody,{children:[messageRows.map(row=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:row.jobId}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Tooltip,{title:row.number,children:/*#__PURE__*/_jsx(\"span\",{children:formatPhoneNumber(row.number)})})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Tooltip,{title:row.fullMessage,children:/*#__PURE__*/_jsx(\"span\",{children:row.message})})}),/*#__PURE__*/_jsx(TableCell,{children:row.createdAt}),/*#__PURE__*/_jsx(TableCell,{children:row.deliveredAt||'-'}),/*#__PURE__*/_jsx(TableCell,{children:getMessageStatusChip(row.status)})]},row.id)),messageRows.length===0&&/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:6,align:\"center\",children:loading?\"Carregando...\":\"Nenhuma mensagem encontrada\"})})]})]}),/*#__PURE__*/_jsx(TablePagination,{rowsPerPageOptions:[10,25,50,100],component:\"div\",count:totalMessagesSent,rowsPerPage:rowsPerPage,page:page,onPageChange:(event,newPage)=>{setPage(newPage);// Calcular qual página de dados carregar do servidor\nconst serverPage=newPage+1;loadMoreShipping(serverPage,rowsPerPage);},onRowsPerPageChange:handleChangeRowsPerPage,labelRowsPerPage:\"Linhas por p\\xE1gina:\",labelDisplayedRows:_ref=>{let{from,to,count}=_ref;return\"\".concat(from,\"-\").concat(to,\" de \").concat(count);}})]})]})]})]});};export default CampaignReport;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}