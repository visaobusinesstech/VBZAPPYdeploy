{"ast":null,"code":"import _objectSpread from\"/home/deploy/atendechatop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState}from\"react\";import{useDropzone}from\"react-dropzone\";import makeStyles from\"@material-ui/core/styles/makeStyles\";import{read,utils}from\"xlsx\";import{Button,CircularProgress,FormControlLabel,FormGroup,MenuItem,Select,Switch,Table,TableBody,TableCell,TableContainer,TableHead,TableRow}from\"@material-ui/core\";import api from\"../../services/api\";import upload from\"../../assets/upload.gif\";import{useHistory}from\"react-router-dom\";import toastError from\"../../errors/toastError\";import useWindowDimensions from\"../../hooks/useWindowDimensions\";import{toast}from\"react-toastify\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function WorksheetToDatagrid(ws){/* create an array of arrays - mantendo formata√ß√£o de c√©lulas */const rows=utils.sheet_to_json(ws,{header:1,defval:\"\",raw:false});/* create column array */const range=utils.decode_range(ws[\"!ref\"]||\"A1\");const columns=Array.from({length:range.e.c+1},(_,i)=>({key:String(i),// RDG will access row[\"0\"], row[\"1\"], etc\nname:utils.encode_col(i)// the column labels will be A, B, etc\n//editor: textEditor // enable cell editing\n}));return{rows,columns};// these can be fed to setRows / setColumns\n}const useStyles=makeStyles(theme=>({xlsTable:{width:\"100%\"},tableContainer:_objectSpread({flex:1,padding:1,overflowX:\"auto\",overflowY:\"scroll\"},theme.scrollbarStyles),actions:{padding:2,border:\"1px solid #CCC\",boxShadow:\"1px 1px 5px #CCC\",marginTop:2,display:\"flex\",justifyContent:\"center\"},importOptions:{padding:2,border:\"1px solid #CCC\",boxShadow:\"1px 1px 5px #CCC\",marginTop:2,marginBottom:2},error:{color:\"red\",marginTop:1},buttonImport:{marginRight:1},select:{minWidth:200},backButtonContainer:{textAlign:\"center\",marginTop:20}}));const ContactImport=()=>{const size=useWindowDimensions();const[rows,setRows]=useState(null);const[columns,setColumns]=useState(null);const classes=useStyles();const history=useHistory();const[contactFieldsAvailable,setContactFieldsAvailable]=useState([]);const[columnValue,setColumnValue]=useState({});const[selectedFields,setSelectedFields]=useState({});// Para rastrear sele√ß√µes √∫nicas\nconst[openingFile,setOpeningFile]=useState(false);const[selection,setSelection]=useState({});const[invalidFile,setInvalidFile]=useState(false);const[error,setError]=useState(null);const[countCreated,setCountCreated]=useState(0);const[countIgnored,setCountIgnored]=useState(0);const[uploading,setUploading]=useState(false);const[imported,setImported]=useState(false);const[selectedRows,setSelectedRows]=useState({});const[validateContact,setValidateContact]=useState(true);// Fun√ß√£o para converter n√∫mero serial do Excel para data JavaScript\nconst excelSerialToDate=serialNumber=>{if(!serialNumber||serialNumber<0)return null;// Excel armazena datas desde 01/01/1900\n// Serial 1 = 01/01/1900\n// Serial 2 = 02/01/1900\n// Diferen√ßa em dias entre 01/01/1900 e 01/01/1970 (Unix epoch)\nconst daysDifference=25569;// Converter serial para Unix timestamp (millisegundos)\nconst timestamp=(serialNumber-daysDifference)*86400000;// Criar Date object\nconst date=new Date(timestamp);// Verificar se √© v√°lido\nif(isNaN(date.getTime())){console.warn('Invalid Excel serial:',serialNumber);return null;}return date;};// Fun√ß√£o helper para detectar e corrigir formato de data MM/DD vs DD/MM\nconst parseAndFixDateFormat=dateStr=>{if(!dateStr||typeof dateStr!=='string')return null;// Processar datas com formato MM/DD/YYYY (Excel americano) e inverter para DD/MM/YYYY\nif(dateStr.includes('/')){const parts=dateStr.split('/');if(parts.length===3){const first=parseInt(parts[0]);const second=parseInt(parts[1]);const year=parts[2];// Sempre assumir que √© MM/DD/YYYY do Excel e converter para DD/MM/YYYY\n// Excel usa formato americano mesmo quando digitamos DD/MM\nconsole.log(\"\\uD83D\\uDCC5 Invertendo MM/DD para DD/MM: \".concat(first,\"/\").concat(second,\"/\").concat(year));// Retornar como DD/MM/YYYY (invertendo)\nreturn new Date(parseInt(year),first-1,second);}}return new Date(dateStr);};const contactFields=[{id:\"name\",label:\"Nome\",required:true},{id:\"number\",label:\"N√∫mero\",required:true},{id:\"email\",label:\"E-mail\",required:false},{id:\"birthDate\",label:\"Data de Nascimento\",required:false},{id:\"tags\",label:\"Tags\",required:false},{id:\"carteira\",label:\"Carteira\",required:false}];useEffect(()=>{setContactFieldsAvailable(contactFields);},[]);const processImport=async()=>{setUploading(true);setCountCreated(0);setCountIgnored(0);console.log(selection);if(!selection.number){toastError(\"N√£o foi selecionado o campo de n√∫mero do contato\");setUploading(false);return;}if(!selection.name){toastError(\"N√£o foi selecionado o campo de nome do contato\");setUploading(false);return;}if(Object.keys(selectedRows).length===0){toastError(\"Nenhum contato selecionado\");setUploading(false);return;}if((rows===null||rows===void 0?void 0:rows.length)>1){let importedCount=0;let ignoredCount=0;for(let index=1;index<rows.length;index++){if(selectedRows[index]){// Importar apenas as linhas selecionadas\nconst item=rows[index];const contactData={};for(let columnIndex=0;columnIndex<columns.length;columnIndex++){const column=columns[columnIndex];const selectedField=columnValue[column.key];if(selectedField){// Garantir que n√∫mero seja sempre string\nif(selectedField==='number'&&item[columnIndex]){contactData[selectedField]=String(item[columnIndex]).trim();}else if(selectedField==='birthDate'&&item[columnIndex]!==null&&item[columnIndex]!==undefined&&item[columnIndex]!==''){// Processar data de nascimento\nlet dateValue=item[columnIndex];let parsedDate=null;try{// Excel armazena datas como n√∫meros seriais (dias desde 30/12/1899)\nif(typeof dateValue==='number'&&dateValue>1&&dateValue<100000){// Converter n√∫mero serial do Excel para JavaScript Date\nparsedDate=excelSerialToDate(dateValue);console.log('Convertendo Excel serial:',dateValue,'para data:',parsedDate);}else if(typeof dateValue==='string'){// Processar strings de data\n// Usar fun√ß√£o helper para detectar e corrigir formato\nparsedDate=parseAndFixDateFormat(dateValue);console.log('üìÖ Data parseada:',dateValue,'‚Üí',parsedDate);}// Validar e converter para formato YYYY-MM-DD\nif(parsedDate&&!isNaN(parsedDate.getTime())&&parsedDate<=new Date()){contactData[selectedField]=parsedDate.toISOString().split('T')[0];console.log('‚úÖ Data processada com sucesso:',dateValue,'‚Üí',contactData[selectedField]);}else if(parsedDate){console.warn('‚ö†Ô∏è Data de nascimento inv√°lida ou futura:',dateValue);}}catch(error){console.warn('‚ùå Erro ao processar data de nascimento:',dateValue,error);}}else{contactData[selectedField]=item[columnIndex];}}}// Verificar se os campos obrigat√≥rios est√£o presentes\nconst missingRequiredFields=contactFields.some(field=>field.required&&(!contactData[field.id]||contactData[field.id]===''));if(missingRequiredFields){ignoredCount++;continue;}// Formatar n√∫mero se necess√°rio\nif(contactData.number){// Remover caracteres n√£o num√©ricos\ncontactData.number=contactData.number.toString().replace(/\\D/g,'');// Garantir que tenha o formato correto com c√≥digo do pa√≠s\nif(!contactData.number.startsWith('55')&&contactData.number.length<=11){contactData.number=\"55\".concat(contactData.number);}}try{console.log(\"Enviando dados para importa√ß√£o:\",contactData);const response=await api.post('/contactsImport',_objectSpread(_objectSpread({},contactData),{},{validateContact:validateContact?\"true\":\"false\"}));console.log(\"Resposta da API:\",response);if(response.status===200){importedCount++;}else{ignoredCount++;}}catch(error){console.error(\"Erro na importa√ß√£o:\",error);ignoredCount++;}}}setCountCreated(importedCount);setCountIgnored(ignoredCount);setValidateContact(false);setSelectedRows({});setImported(true);setUploading(false);if(importedCount>0){if(ignoredCount===0){toast.success(\"Importa\\xE7\\xE3o realizada com sucesso! \".concat(importedCount,\" contatos importados.\"));}else{toast.warn(\"Importa\\xE7\\xE3o conclu\\xEDda: \".concat(importedCount,\" contatos importados e \").concat(ignoredCount,\" ignorados.\"));}}else{toast.error(\"Falha na importa√ß√£o. Nenhum contato foi importado.\");}}};const onChangeFile=acceptedFiles=>{if(acceptedFiles.length===0)return;setOpeningFile(true);setInvalidFile(false);setImported(false);setUploading(false);const file=acceptedFiles[0];const reader=new FileReader();reader.onload=function(e){try{const data=e.target.result;const wb=read(data);const ws=wb.Sheets[wb.SheetNames[0]];const{rows,columns}=WorksheetToDatagrid(ws);setRows(rows);setColumns(columns);setOpeningFile(false);}catch(e){console.error(e);setInvalidFile(true);setOpeningFile(false);}};reader.readAsArrayBuffer(file);};const handleSelectChange=event=>{const newValue=event.target.value;const columnKey=event.target.name;if(columnValue[columnKey]){const oldValue=columnValue[columnKey];setSelectedFields(prevSelectedFields=>{const newSelectedFields=_objectSpread({},prevSelectedFields);delete newSelectedFields[oldValue];return newSelectedFields;});}if(newValue===\"\"){setColumnValue(prevColumnValue=>{const newColumnValue=_objectSpread({},prevColumnValue);delete newColumnValue[columnKey];return newColumnValue;});setSelection(prevSelection=>{const newSelection=_objectSpread({},prevSelection);Object.keys(newSelection).forEach(key=>{if(newSelection[key]===columnKey){delete newSelection[key];}});return newSelection;});return;}if(selectedFields[newValue]){toastError(\"O campo \".concat(newValue,\" j\\xE1 foi selecionado.\"));return;}setSelection(selection=>_objectSpread(_objectSpread({},selection),{},{[newValue]:columnKey}));setSelectedFields(prevSelectedFields=>_objectSpread(_objectSpread({},prevSelectedFields),{},{[newValue]:columnKey}));setColumnValue(columnValue=>_objectSpread(_objectSpread({},columnValue),{},{[columnKey]:newValue}));};const renderSelectbox=column=>{return/*#__PURE__*/_jsxs(Select,{value:columnValue[column.key],name:column.key,onChange:handleSelectChange,children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"\\xA0\"}),contactFieldsAvailable.map(contactField=>/*#__PURE__*/_jsx(MenuItem,{value:contactField.id,children:contactField.label}))]});};const renderXls=()=>{return/*#__PURE__*/_jsx(TableContainer,{className:classes.tableContainer,style:{height:size.height*0.75},children:/*#__PURE__*/_jsxs(Table,{stickyHeader:true,children:[/*#__PURE__*/_jsxs(TableHead,{children:[/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:Object.keys(selectedRows).length===rows.length-1// Se todas as linhas, exceto a primeira, estiverem marcadas\n,onChange:event=>{const isChecked=event.target.checked;const newSelectedRows={};if(isChecked){// Marcar todas as linhas, exceto a primeira\nfor(let i=1;i<rows.length;i++){newSelectedRows[i]=true;}}setSelectedRows(newSelectedRows);}})}),columns.map(column=>/*#__PURE__*/_jsx(TableCell,{children:column.name},column.key))]}),/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{}),columns.map(column=>/*#__PURE__*/_jsx(TableCell,{children:renderSelectbox(column)},column.key))]})]},columns.length),/*#__PURE__*/_jsx(TableBody,{children:rows.map((row,rowIndex)=>/*#__PURE__*/_jsxs(TableRow,{children:[rowIndex!==0&&/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:!!selectedRows[rowIndex],onChange:()=>{setSelectedRows(prevSelectedRows=>_objectSpread(_objectSpread({},prevSelectedRows),{},{[rowIndex]:!prevSelectedRows[rowIndex]}));}})}),rowIndex!==0&&row.map((column,columnIndex)=>{// Formatar data se a coluna √© birthDate\nlet cellValue=column;// Verificar se esta coluna foi mapeada como birthDate\nif(columnValue[columnIndex]==='birthDate'&&column){try{// Se for n√∫mero (Excel serial), converter\nif(typeof column==='number'&&column>1&&column<100000){const convertedDate=excelSerialToDate(column);if(convertedDate&&!isNaN(convertedDate.getTime())){// Formatar como DD/MM/YYYY\nconst day=String(convertedDate.getDate()).padStart(2,'0');const month=String(convertedDate.getMonth()+1).padStart(2,'0');const year=convertedDate.getFullYear();cellValue=\"\".concat(day,\"/\").concat(month,\"/\").concat(year);}}// Se for string, formatar corretamente\nelse if(typeof column==='string'&&column.includes('/')){const parts=column.split('/');if(parts.length===3){let first=parseInt(parts[0]);let second=parseInt(parts[1]);let third=parts[2];// Se first > 12, definitivamente √© DD/MM\nif(first>12){// J√° est√° DD/MM/YYYY - apenas formatar\ncellValue=\"\".concat(String(first).padStart(2,'0'),\"/\").concat(String(second).padStart(2,'0'),\"/\").concat(third.padStart(4,'0'));}else{// Ambig√ºidade: pode ser MM/DD ou DD/MM\n// Converter para DD/MM/YYYY assumindo formato americano (MM/DD)\n// e invertendo para brasileiro (DD/MM)\nconst year=third.length===2?'19'+third:third.padStart(4,'0');// Inverter: MM/DD -> DD/MM\ncellValue=\"\".concat(String(second).padStart(2,'0'),\"/\").concat(String(first).padStart(2,'0'),\"/\").concat(year);}}}}catch(error){console.warn('Erro ao formatar data para visualiza√ß√£o:',error);}}return/*#__PURE__*/_jsx(TableCell,{children:cellValue},columnIndex);})]},rowIndex))})]})});};const handleCloseImport=async()=>{try{history.push(\"/contacts\");}catch(err){toastError(err);}};const renderContent=()=>{return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:classes.importOptions,children:/*#__PURE__*/_jsx(FormGroup,{row:true,style:{width:'100%',display:'flex',justifyContent:'space-around'},children:/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:validateContact,onChange:event=>setValidateContact(event.target.checked),color:\"primary\"}),label:\"Validar contatos no WhatsApp\"})})}),renderXls(),/*#__PURE__*/_jsxs(\"div\",{className:classes.actions,children:[uploading&&/*#__PURE__*/_jsx(\"div\",{children:\"Importando... Aguarde\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",disabled:uploading,className:classes.buttonImport,onClick:()=>processImport(),children:\"Importar contatos\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"secondary\",disabled:uploading,onClick:()=>{setRows(null);setColumns(null);},children:\"Cancelar\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:classes.error,children:error})]})]});};const{getRootProps,getInputProps}=useDropzone({onDrop:onChangeFile,maxFiles:1,accept:{'application/vnd.ms-excel':['.xls'],'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':['.xlsx'],'text/csv':['.csv'],'text/plain':['.txt']}});return/*#__PURE__*/_jsxs(\"div\",{style:{alignContent:\"center\"},children:[imported&&/*#__PURE__*/_jsxs(\"div\",{style:{padding:'15px',margin:'15px auto',maxWidth:'500px',border:'1px solid #ddd',borderRadius:'8px',backgroundColor:'#f9f9f9'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{textAlign:'center'},children:\"Resultado da importa\\xE7\\xE3o\"}),/*#__PURE__*/_jsxs(\"ul\",{style:{listStyle:'none',padding:'10px'},children:[/*#__PURE__*/_jsxs(\"li\",{style:{padding:'8px',marginBottom:'5px',backgroundColor:countCreated>0?'#d4edda':'#f8f9fa',borderRadius:'4px',color:countCreated>0?'#155724':'#6c757d'},children:[\"\\u2705 \",countCreated,\" contatos criados com sucesso\"]}),/*#__PURE__*/_jsxs(\"li\",{style:{padding:'8px',backgroundColor:countIgnored>0?'#fff3cd':'#f8f9fa',borderRadius:'4px',color:countIgnored>0?'#856404':'#6c757d'},children:[\"\\u26A0\\uFE0F \",countIgnored,\" contatos ignorados (n\\xFAmero inv\\xE1lido ou n\\xE3o marcados para atualizar)\"]})]}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',marginTop:'10px'},children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:()=>{setImported(false);setRows(null);setColumns(null);setColumnValue({});setSelectedFields({});},children:\"Importar mais contatos\"})})]}),openingFile&&/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',padding:'20px',margin:'20px auto',maxWidth:'500px'},children:[/*#__PURE__*/_jsx(CircularProgress,{}),/*#__PURE__*/_jsx(\"p\",{children:\"Processando arquivo...\"})]}),invalidFile&&/*#__PURE__*/_jsxs(\"div\",{style:{padding:'15px',margin:'15px auto',maxWidth:'500px',border:'1px solid #f5c6cb',borderRadius:'8px',backgroundColor:'#f8d7da',color:'#721c24',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Arquivo inv\\xE1lido!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"O arquivo que voc\\xEA tentou importar n\\xE3o \\xE9 v\\xE1lido. Por favor, tente novamente com um arquivo no formato correto.\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:()=>{setInvalidFile(false);setRows(null);setColumns(null);},style:{marginTop:'10px'},children:\"Tentar novamente\"})]}),!imported&&!invalidFile&&rows&&columns?renderContent():!imported&&!invalidFile&&!openingFile&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",_objectSpread(_objectSpread({},getRootProps()),{},{className:\"uploaderDrop\",style:{borderRadius:20,maxWidth:500,margin:\"20px auto\",border:\"3px dotted #ddd\",padding:20,display:\"flex\",justifyContent:\"center\",alignItems:\"center\",flexDirection:\"column\",cursor:\"pointer\",transition:\"all 0.3s ease\",backgroundColor:\"#f9f9f9\",\"&:hover\":{backgroundColor:\"#f0f0f0\",borderColor:\"#aaa\"}},children:[/*#__PURE__*/_jsx(\"img\",{src:upload,height:200,alt:\"Upload\"}),/*#__PURE__*/_jsx(\"h5\",{children:\"Clique ou arraste um arquivo Excel\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:\"#e74c3c\",fontWeight:\"bold\",textAlign:\"center\"},children:\"* Formatos aceitos: xls, xlsx, csv, txt\"}),/*#__PURE__*/_jsx(\"p\",{style:{textAlign:\"center\",fontSize:\"14px\",marginTop:\"10px\",color:\"#666\"},children:\"Para importar contatos, voc\\xEA deve ter pelo menos as colunas de nome e n\\xFAmero de telefone.\"})]})),/*#__PURE__*/_jsx(\"input\",_objectSpread({},getInputProps())),/*#__PURE__*/_jsx(\"div\",{className:classes.backButtonContainer,children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"secondary\",disabled:uploading,onClick:handleCloseImport,children:\"Voltar\"})})]})]});};export default ContactImport;","map":{"version":3,"names":["React","useEffect","useRef","useState","useDropzone","makeStyles","read","utils","Button","CircularProgress","FormControlLabel","FormGroup","MenuItem","Select","Switch","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","api","upload","useHistory","toastError","useWindowDimensions","toast","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","WorksheetToDatagrid","ws","rows","sheet_to_json","header","defval","raw","range","decode_range","columns","Array","from","length","e","c","_","i","key","String","name","encode_col","useStyles","theme","xlsTable","width","tableContainer","_objectSpread","flex","padding","overflowX","overflowY","scrollbarStyles","actions","border","boxShadow","marginTop","display","justifyContent","importOptions","marginBottom","error","color","buttonImport","marginRight","select","minWidth","backButtonContainer","textAlign","ContactImport","size","setRows","setColumns","classes","history","contactFieldsAvailable","setContactFieldsAvailable","columnValue","setColumnValue","selectedFields","setSelectedFields","openingFile","setOpeningFile","selection","setSelection","invalidFile","setInvalidFile","setError","countCreated","setCountCreated","countIgnored","setCountIgnored","uploading","setUploading","imported","setImported","selectedRows","setSelectedRows","validateContact","setValidateContact","excelSerialToDate","serialNumber","daysDifference","timestamp","date","Date","isNaN","getTime","console","warn","parseAndFixDateFormat","dateStr","includes","parts","split","first","parseInt","second","year","log","concat","contactFields","id","label","required","processImport","number","Object","keys","importedCount","ignoredCount","index","item","contactData","columnIndex","column","selectedField","trim","undefined","dateValue","parsedDate","toISOString","missingRequiredFields","some","field","toString","replace","startsWith","response","post","status","success","onChangeFile","acceptedFiles","file","reader","FileReader","onload","data","target","result","wb","Sheets","SheetNames","readAsArrayBuffer","handleSelectChange","event","newValue","value","columnKey","oldValue","prevSelectedFields","newSelectedFields","prevColumnValue","newColumnValue","prevSelection","newSelection","forEach","renderSelectbox","onChange","children","map","contactField","renderXls","className","style","height","stickyHeader","type","checked","isChecked","newSelectedRows","row","rowIndex","prevSelectedRows","cellValue","convertedDate","day","getDate","padStart","month","getMonth","getFullYear","third","handleCloseImport","push","err","renderContent","control","variant","disabled","onClick","getRootProps","getInputProps","onDrop","maxFiles","accept","alignContent","margin","maxWidth","borderRadius","backgroundColor","listStyle","alignItems","flexDirection","cursor","transition","borderColor","src","alt","fontWeight","fontSize"],"sources":["/home/deploy/atendechatop/frontend/src/components/ContactImport/index.js"],"sourcesContent":["import React, {useEffect, useRef, useState} from \"react\";\nimport {useDropzone} from \"react-dropzone\";\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\nimport {read, utils} from \"xlsx\";\nimport {\n    Button,\n    CircularProgress,\n    FormControlLabel,\n    FormGroup,\n    MenuItem,\n    Select,\n    Switch,\n    Table,\n    TableBody,\n    TableCell,\n    TableContainer,\n    TableHead,\n    TableRow,\n} from \"@material-ui/core\";\nimport api from \"../../services/api\";\nimport upload from \"../../assets/upload.gif\";\nimport {useHistory} from \"react-router-dom\";\nimport toastError from \"../../errors/toastError\";\nimport useWindowDimensions from \"../../hooks/useWindowDimensions\";\nimport {toast} from \"react-toastify\";\n\nfunction WorksheetToDatagrid(ws) {\n    /* create an array of arrays - mantendo formata√ß√£o de c√©lulas */\n    const rows = utils.sheet_to_json(ws, {header: 1, defval: \"\", raw: false});\n\n    /* create column array */\n    const range = utils.decode_range(ws[\"!ref\"] || \"A1\");\n    const columns = Array.from({length: range.e.c + 1}, (_, i) => ({\n        key: String(i), // RDG will access row[\"0\"], row[\"1\"], etc\n        name: utils.encode_col(i), // the column labels will be A, B, etc\n        //editor: textEditor // enable cell editing\n    }));\n\n    return {rows, columns}; // these can be fed to setRows / setColumns\n}\n\n\nconst useStyles = makeStyles((theme) => ({\n    xlsTable: {\n        width: \"100%\",\n    },\n    tableContainer: {\n        flex: 1,\n        padding: 1,\n        overflowX: \"auto\",\n        overflowY: \"scroll\",\n        ...theme.scrollbarStyles,\n    },\n    actions: {\n        padding: 2,\n        border: \"1px solid #CCC\",\n        boxShadow: \"1px 1px 5px #CCC\",\n        marginTop: 2,\n        display: \"flex\",\n        justifyContent: \"center\",\n    },\n    importOptions: {\n        padding: 2,\n        border: \"1px solid #CCC\",\n        boxShadow: \"1px 1px 5px #CCC\",\n        marginTop: 2,\n        marginBottom: 2,\n    },\n    error: {\n        color: \"red\",\n        marginTop: 1,\n    },\n    buttonImport: {\n        marginRight: 1,\n    },\n    select: {\n        minWidth: 200,\n    },\n    backButtonContainer: {\n        textAlign: \"center\",\n        marginTop: 20,\n    },\n}));\n\nconst ContactImport = () => {\n    const size = useWindowDimensions();\n\n    const [rows, setRows] = useState(null);\n    const [columns, setColumns] = useState(null);\n    const classes = useStyles();\n    const history = useHistory();\n    const [contactFieldsAvailable, setContactFieldsAvailable] = useState([]);\n    const [columnValue, setColumnValue] = useState({});\n    const [selectedFields, setSelectedFields] = useState({}); // Para rastrear sele√ß√µes √∫nicas\n\n    const [openingFile, setOpeningFile] = useState(false);\n    const [selection, setSelection] = useState({});\n    const [invalidFile, setInvalidFile] = useState(false);\n    const [error, setError] = useState(null);\n    const [countCreated, setCountCreated] = useState(0);\n    const [countIgnored, setCountIgnored] = useState(0);\n    const [uploading, setUploading] = useState(false);\n    const [imported, setImported] = useState(false);\n    const [selectedRows, setSelectedRows] = useState({});\n    const [validateContact, setValidateContact] = useState(true);\n\n    // Fun√ß√£o para converter n√∫mero serial do Excel para data JavaScript\n    const excelSerialToDate = (serialNumber) => {\n        if (!serialNumber || serialNumber < 0) return null;\n        \n        // Excel armazena datas desde 01/01/1900\n        // Serial 1 = 01/01/1900\n        // Serial 2 = 02/01/1900\n        \n        // Diferen√ßa em dias entre 01/01/1900 e 01/01/1970 (Unix epoch)\n        const daysDifference = 25569;\n        \n        // Converter serial para Unix timestamp (millisegundos)\n        const timestamp = (serialNumber - daysDifference) * 86400000;\n        \n        // Criar Date object\n        const date = new Date(timestamp);\n        \n        // Verificar se √© v√°lido\n        if (isNaN(date.getTime())) {\n            console.warn('Invalid Excel serial:', serialNumber);\n            return null;\n        }\n        \n        return date;\n    };\n\n    // Fun√ß√£o helper para detectar e corrigir formato de data MM/DD vs DD/MM\n    const parseAndFixDateFormat = (dateStr) => {\n        if (!dateStr || typeof dateStr !== 'string') return null;\n        \n        // Processar datas com formato MM/DD/YYYY (Excel americano) e inverter para DD/MM/YYYY\n        if (dateStr.includes('/')) {\n            const parts = dateStr.split('/');\n            if (parts.length === 3) {\n                const first = parseInt(parts[0]);\n                const second = parseInt(parts[1]);\n                const year = parts[2];\n                \n                // Sempre assumir que √© MM/DD/YYYY do Excel e converter para DD/MM/YYYY\n                // Excel usa formato americano mesmo quando digitamos DD/MM\n                console.log(`üìÖ Invertendo MM/DD para DD/MM: ${first}/${second}/${year}`);\n                \n                // Retornar como DD/MM/YYYY (invertendo)\n                return new Date(parseInt(year), first - 1, second);\n            }\n        }\n        \n        return new Date(dateStr);\n    };\n    const contactFields = [\n        {id: \"name\", label: \"Nome\", required: true},\n        {id: \"number\", label: \"N√∫mero\", required: true},\n        {id: \"email\", label: \"E-mail\", required: false},\n        {id: \"birthDate\", label: \"Data de Nascimento\", required: false},\n        {id: \"tags\", label: \"Tags\", required: false},\n        {id: \"carteira\", label: \"Carteira\", required: false},\n    ];\n\n    useEffect(() => {\n        setContactFieldsAvailable(contactFields);\n    }, []);\n\n    const processImport = async () => {\n        setUploading(true);\n        setCountCreated(0);\n        setCountIgnored(0);\n\n        console.log(selection)\n\n        if (!selection.number) {\n            toastError(\"N√£o foi selecionado o campo de n√∫mero do contato\");\n            setUploading(false);\n            return;\n        }\n\n        if (!selection.name) {\n            toastError(\"N√£o foi selecionado o campo de nome do contato\");\n            setUploading(false);\n            return;\n        }\n\n        if (Object.keys(selectedRows).length === 0) {\n            toastError(\"Nenhum contato selecionado\");\n            setUploading(false);\n            return;\n        }\n\n        if (rows?.length > 1) {\n            let importedCount = 0;\n            let ignoredCount = 0;\n\n            for (let index = 1; index < rows.length; index++) {\n                if (selectedRows[index]) { // Importar apenas as linhas selecionadas\n                    const item = rows[index];\n                    const contactData = {};\n\n                    for (let columnIndex = 0; columnIndex < columns.length; columnIndex++) {\n                        const column = columns[columnIndex];\n                        const selectedField = columnValue[column.key];\n\n                        if (selectedField) {\n                            // Garantir que n√∫mero seja sempre string\n                            if (selectedField === 'number' && item[columnIndex]) {\n                                contactData[selectedField] = String(item[columnIndex]).trim();\n                            } else if (selectedField === 'birthDate' && item[columnIndex] !== null && item[columnIndex] !== undefined && item[columnIndex] !== '') {\n                                // Processar data de nascimento\n                                let dateValue = item[columnIndex];\n                                let parsedDate = null;\n                                \n                                try {\n                                    // Excel armazena datas como n√∫meros seriais (dias desde 30/12/1899)\n                                    if (typeof dateValue === 'number' && dateValue > 1 && dateValue < 100000) {\n                                        // Converter n√∫mero serial do Excel para JavaScript Date\n                                        parsedDate = excelSerialToDate(dateValue);\n                                        console.log('Convertendo Excel serial:', dateValue, 'para data:', parsedDate);\n                                    } else if (typeof dateValue === 'string') {\n                                        // Processar strings de data\n                                        // Usar fun√ß√£o helper para detectar e corrigir formato\n                                        parsedDate = parseAndFixDateFormat(dateValue);\n                                        console.log('üìÖ Data parseada:', dateValue, '‚Üí', parsedDate);\n                                    }\n                                    \n                                    // Validar e converter para formato YYYY-MM-DD\n                                    if (parsedDate && !isNaN(parsedDate.getTime()) && parsedDate <= new Date()) {\n                                        contactData[selectedField] = parsedDate.toISOString().split('T')[0];\n                                        console.log('‚úÖ Data processada com sucesso:', dateValue, '‚Üí', contactData[selectedField]);\n                                    } else if (parsedDate) {\n                                        console.warn('‚ö†Ô∏è Data de nascimento inv√°lida ou futura:', dateValue);\n                                    }\n                                } catch (error) {\n                                    console.warn('‚ùå Erro ao processar data de nascimento:', dateValue, error);\n                                }\n                            } else {\n                                contactData[selectedField] = item[columnIndex];\n                            }\n                        }\n                    }\n\n                    // Verificar se os campos obrigat√≥rios est√£o presentes\n                    const missingRequiredFields = contactFields.some(field =>\n                        field.required && (!contactData[field.id] || contactData[field.id] === '')\n                    );\n\n                    if (missingRequiredFields) {\n                        ignoredCount++;\n                        continue;\n                    }\n\n                    // Formatar n√∫mero se necess√°rio\n                    if (contactData.number) {\n                        // Remover caracteres n√£o num√©ricos\n                        contactData.number = contactData.number.toString().replace(/\\D/g, '');\n\n                        // Garantir que tenha o formato correto com c√≥digo do pa√≠s\n                        if (!contactData.number.startsWith('55') && contactData.number.length <= 11) {\n                            contactData.number = `55${contactData.number}`;\n                        }\n                    }\n\n                    try {\n                        console.log(\"Enviando dados para importa√ß√£o:\", contactData);\n                        const response = await api.post('/contactsImport', {\n                            ...contactData,\n                            validateContact: validateContact ? \"true\" : \"false\",\n                        });\n\n                        console.log(\"Resposta da API:\", response);\n\n                        if (response.status === 200) {\n                            importedCount++;\n                        } else {\n                            ignoredCount++;\n                        }\n                    } catch (error) {\n                        console.error(\"Erro na importa√ß√£o:\", error);\n                        ignoredCount++;\n                    }\n                }\n            }\n\n            setCountCreated(importedCount);\n            setCountIgnored(ignoredCount);\n            setValidateContact(false);\n            setSelectedRows({});\n            setImported(true);\n            setUploading(false);\n\n            if (importedCount > 0) {\n                if (ignoredCount === 0) {\n                    toast.success(`Importa√ß√£o realizada com sucesso! ${importedCount} contatos importados.`);\n                } else {\n                    toast.warn(`Importa√ß√£o conclu√≠da: ${importedCount} contatos importados e ${ignoredCount} ignorados.`);\n                }\n            } else {\n                toast.error(\"Falha na importa√ß√£o. Nenhum contato foi importado.\");\n            }\n        }\n    };\n\n    const onChangeFile = (acceptedFiles) => {\n        if (acceptedFiles.length === 0) return;\n        setOpeningFile(true);\n        setInvalidFile(false);\n        setImported(false);\n        setUploading(false);\n        const file = acceptedFiles[0];\n        const reader = new FileReader();\n        reader.onload = function (e) {\n            try {\n                const data = e.target.result;\n                const wb = read(data);\n                const ws = wb.Sheets[wb.SheetNames[0]];\n                const {rows, columns} = WorksheetToDatagrid(ws);\n                setRows(rows);\n                setColumns(columns);\n                setOpeningFile(false);\n            } catch (e) {\n                console.error(e);\n                setInvalidFile(true);\n                setOpeningFile(false);\n            }\n        };\n        reader.readAsArrayBuffer(file);\n    };\n\n    const handleSelectChange = (event) => {\n        const newValue = event.target.value;\n        const columnKey = event.target.name;\n\n        if (columnValue[columnKey]) {\n            const oldValue = columnValue[columnKey];\n            setSelectedFields((prevSelectedFields) => {\n                const newSelectedFields = {...prevSelectedFields};\n                delete newSelectedFields[oldValue];\n                return newSelectedFields;\n            });\n        }\n\n        if (newValue === \"\") {\n            setColumnValue((prevColumnValue) => {\n                const newColumnValue = {...prevColumnValue};\n                delete newColumnValue[columnKey];\n                return newColumnValue;\n            });\n            setSelection((prevSelection) => {\n                const newSelection = {...prevSelection};\n                Object.keys(newSelection).forEach((key) => {\n                    if (newSelection[key] === columnKey) {\n                        delete newSelection[key];\n                    }\n                });\n                return newSelection;\n            });\n            return;\n        }\n\n        if (selectedFields[newValue]) {\n            toastError(`O campo ${newValue} j√° foi selecionado.`);\n            return;\n        }\n\n        setSelection((selection) => ({...selection, [newValue]: columnKey}));\n        setSelectedFields((prevSelectedFields) => ({...prevSelectedFields, [newValue]: columnKey}));\n        setColumnValue((columnValue) => ({...columnValue, [columnKey]: newValue}));\n    };\n\n\n    const renderSelectbox = (column) => {\n        return (\n            <Select value={columnValue[column.key]} name={column.key} onChange={handleSelectChange}>\n                <MenuItem value=\"\">&nbsp;</MenuItem>\n                {contactFieldsAvailable.map((contactField) => (\n                    <MenuItem value={contactField.id}>{contactField.label}</MenuItem>\n                ))}\n            </Select>\n        );\n    };\n\n    const renderXls = () => {\n        return (\n            <TableContainer className={classes.tableContainer} style={{height: size.height * 0.75}}>\n                <Table stickyHeader>\n                    <TableHead key={columns.length}>\n                        <TableRow>\n                            <TableCell>\n                                <input\n                                    type=\"checkbox\"\n                                    checked={Object.keys(selectedRows).length === rows.length - 1} // Se todas as linhas, exceto a primeira, estiverem marcadas\n                                    onChange={(event) => {\n                                        const isChecked = event.target.checked;\n                                        const newSelectedRows = {};\n                                        if (isChecked) {\n                                            // Marcar todas as linhas, exceto a primeira\n                                            for (let i = 1; i < rows.length; i++) {\n                                                newSelectedRows[i] = true;\n                                            }\n                                        }\n                                        setSelectedRows(newSelectedRows);\n                                    }}\n                                />\n                            </TableCell>\n                            {columns.map((column) => (\n                                <TableCell key={column.key}>{column.name}</TableCell>\n                            ))}\n                        </TableRow>\n                        <TableRow>\n                            <TableCell></TableCell>\n                            {columns.map((column) => (\n                                <TableCell key={column.key}>{renderSelectbox(column)}</TableCell>\n                            ))}\n                        </TableRow>\n                    </TableHead>\n                    <TableBody>\n                        {rows.map((row, rowIndex) => (\n                            <TableRow key={rowIndex}>\n                                {rowIndex !== 0 && (\n                                    <TableCell>\n                                        <input\n                                            type=\"checkbox\"\n                                            checked={!!selectedRows[rowIndex]}\n                                            onChange={() => {\n                                                setSelectedRows((prevSelectedRows) => ({\n                                                    ...prevSelectedRows,\n                                                    [rowIndex]: !prevSelectedRows[rowIndex],\n                                                }));\n                                            }}\n                                        />\n                                    </TableCell>\n                                )}\n                                {rowIndex !== 0 && (\n                                    row.map((column, columnIndex) => {\n                                        // Formatar data se a coluna √© birthDate\n                                        let cellValue = column;\n                                        \n                                        // Verificar se esta coluna foi mapeada como birthDate\n                                        if (columnValue[columnIndex] === 'birthDate' && column) {\n                                            try {\n                                                // Se for n√∫mero (Excel serial), converter\n                                                if (typeof column === 'number' && column > 1 && column < 100000) {\n                                                    const convertedDate = excelSerialToDate(column);\n                                                    if (convertedDate && !isNaN(convertedDate.getTime())) {\n                                                        // Formatar como DD/MM/YYYY\n                                                        const day = String(convertedDate.getDate()).padStart(2, '0');\n                                                        const month = String(convertedDate.getMonth() + 1).padStart(2, '0');\n                                                        const year = convertedDate.getFullYear();\n                                                        cellValue = `${day}/${month}/${year}`;\n                                                    }\n                                                } \n                                                // Se for string, formatar corretamente\n                                                else if (typeof column === 'string' && column.includes('/')) {\n                                                    const parts = column.split('/');\n                                                    if (parts.length === 3) {\n                                                        let first = parseInt(parts[0]);\n                                                        let second = parseInt(parts[1]);\n                                                        let third = parts[2];\n                                                        \n                                                        // Se first > 12, definitivamente √© DD/MM\n                                                        if (first > 12) {\n                                                            // J√° est√° DD/MM/YYYY - apenas formatar\n                                                            cellValue = `${String(first).padStart(2, '0')}/${String(second).padStart(2, '0')}/${third.padStart(4, '0')}`;\n                                                        } else {\n                                                            // Ambig√ºidade: pode ser MM/DD ou DD/MM\n                                                            // Converter para DD/MM/YYYY assumindo formato americano (MM/DD)\n                                                            // e invertendo para brasileiro (DD/MM)\n                                                            const year = third.length === 2 ? '19' + third : third.padStart(4, '0');\n                                                            // Inverter: MM/DD -> DD/MM\n                                                            cellValue = `${String(second).padStart(2, '0')}/${String(first).padStart(2, '0')}/${year}`;\n                                                        }\n                                                    }\n                                                }\n                                            } catch (error) {\n                                                console.warn('Erro ao formatar data para visualiza√ß√£o:', error);\n                                            }\n                                        }\n                                        \n                                        return <TableCell key={columnIndex}>{cellValue}</TableCell>;\n                                    })\n                                )}\n                            </TableRow>\n                        ))}\n                    </TableBody>\n                </Table>\n            </TableContainer>\n        );\n    };\n\n\n    const handleCloseImport = async () => {\n        try {\n            history.push(\"/contacts\");\n        } catch (err) {\n            toastError(err);\n        }\n    };\n\n    const renderContent = () => {\n        return (\n            <div>\n                <div className={classes.importOptions}>\n                    <FormGroup row style={{width: '100%', display: 'flex', justifyContent: 'space-around'}}>\n                        <FormControlLabel\n                            control={\n                                <Switch checked={validateContact} onChange={(event) => setValidateContact(event.target.checked)} color=\"primary\"/>\n                            }\n                            label=\"Validar contatos no WhatsApp\"\n                        />\n                    </FormGroup>\n                </div>\n                {renderXls()}\n                <div className={classes.actions}>\n                    {uploading && <div>Importando... Aguarde</div>}\n                    <Button\n                        variant=\"contained\"\n                        color=\"primary\"\n                        disabled={uploading}\n                        className={classes.buttonImport}\n                        onClick={() => processImport()}\n                    >\n                        Importar contatos\n                    </Button>\n                    <Button\n                        variant=\"contained\"\n                        color=\"secondary\"\n                        disabled={uploading}\n                        onClick={() => {\n                            setRows(null);\n                            setColumns(null);\n                        }}\n                    >\n                        Cancelar\n                    </Button>\n                    {error && <div className={classes.error}>{error}</div>}\n                </div>\n            </div>\n        );\n    };\n\n    const {getRootProps, getInputProps} = useDropzone({\n        onDrop: onChangeFile,\n        maxFiles: 1,\n        accept: {\n            'application/vnd.ms-excel': ['.xls'],\n            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx'],\n            'text/csv': ['.csv'],\n            'text/plain': ['.txt'],\n        }\n    });\n\n    return (\n        <div style={{alignContent: \"center\"}}>\n            {imported && (\n                <div style={{\n                    padding: '15px',\n                    margin: '15px auto',\n                    maxWidth: '500px',\n                    border: '1px solid #ddd',\n                    borderRadius: '8px',\n                    backgroundColor: '#f9f9f9'\n                }}>\n                    <h3 style={{textAlign: 'center'}}>Resultado da importa√ß√£o</h3>\n                    <ul style={{listStyle: 'none', padding: '10px'}}>\n                        <li style={{\n                            padding: '8px',\n                            marginBottom: '5px',\n                            backgroundColor: countCreated > 0 ? '#d4edda' : '#f8f9fa',\n                            borderRadius: '4px',\n                            color: countCreated > 0 ? '#155724' : '#6c757d'\n                        }}>\n                            ‚úÖ {countCreated} contatos criados com sucesso\n                        </li>\n                        <li style={{\n                            padding: '8px',\n                            backgroundColor: countIgnored > 0 ? '#fff3cd' : '#f8f9fa',\n                            borderRadius: '4px',\n                            color: countIgnored > 0 ? '#856404' : '#6c757d'\n                        }}>\n                            ‚ö†Ô∏è {countIgnored} contatos ignorados (n√∫mero inv√°lido ou n√£o marcados para atualizar)\n                        </li>\n                    </ul>\n                    <div style={{textAlign: 'center', marginTop: '10px'}}>\n                        <Button\n                            variant=\"contained\"\n                            color=\"primary\"\n                            onClick={() => {\n                                setImported(false);\n                                setRows(null);\n                                setColumns(null);\n                                setColumnValue({});\n                                setSelectedFields({});\n                            }}\n                        >\n                            Importar mais contatos\n                        </Button>\n                    </div>\n                </div>\n            )}\n            {openingFile && (\n                <div style={{\n                    textAlign: 'center',\n                    padding: '20px',\n                    margin: '20px auto',\n                    maxWidth: '500px'\n                }}>\n                    <CircularProgress/>\n                    <p>Processando arquivo...</p>\n                </div>\n            )}\n            {invalidFile && (\n                <div style={{\n                    padding: '15px',\n                    margin: '15px auto',\n                    maxWidth: '500px',\n                    border: '1px solid #f5c6cb',\n                    borderRadius: '8px',\n                    backgroundColor: '#f8d7da',\n                    color: '#721c24',\n                    textAlign: 'center'\n                }}>\n                    <h3>Arquivo inv√°lido!</h3>\n                    <p>O arquivo que voc√™ tentou importar n√£o √© v√°lido. Por favor, tente novamente com um arquivo no formato correto.</p>\n                    <Button\n                        variant=\"contained\"\n                        color=\"primary\"\n                        onClick={() => {\n                            setInvalidFile(false);\n                            setRows(null);\n                            setColumns(null);\n                        }}\n                        style={{marginTop: '10px'}}\n                    >\n                        Tentar novamente\n                    </Button>\n                </div>\n            )}\n            {!imported && !invalidFile && rows && columns ? renderContent() : (\n                !imported && !invalidFile && !openingFile && (\n                    <>\n                        <div\n                            {...getRootProps()}\n                            className=\"uploaderDrop\"\n                            style={{\n                                borderRadius: 20,\n                                maxWidth: 500,\n                                margin: \"20px auto\",\n                                border: \"3px dotted #ddd\",\n                                padding: 20,\n                                display: \"flex\",\n                                justifyContent: \"center\",\n                                alignItems: \"center\",\n                                flexDirection: \"column\",\n                                cursor: \"pointer\",\n                                transition: \"all 0.3s ease\",\n                                backgroundColor: \"#f9f9f9\",\n                                \"&:hover\": {\n                                    backgroundColor: \"#f0f0f0\",\n                                    borderColor: \"#aaa\",\n                                }\n                            }}\n                        >\n                            <img src={upload} height={200} alt=\"Upload\"/>\n                            <h5>Clique ou arraste um arquivo Excel</h5>\n                            <p style={{color: \"#e74c3c\", fontWeight: \"bold\", textAlign: \"center\"}}>\n                                * Formatos aceitos: xls, xlsx, csv, txt\n                            </p>\n                            <p style={{textAlign: \"center\", fontSize: \"14px\", marginTop: \"10px\", color: \"#666\"}}>\n                                Para importar contatos, voc√™ deve ter pelo menos as colunas de nome e n√∫mero de telefone.\n                            </p>\n                        </div>\n\n                        <input {...getInputProps()} />\n\n                        <div className={classes.backButtonContainer}>\n                            <Button variant=\"contained\" color=\"secondary\" disabled={uploading} onClick={handleCloseImport}>\n                                Voltar\n                            </Button>\n                        </div>\n                    </>\n                )\n            )}\n        </div>\n    );\n};\n\nexport default ContactImport;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}