{"ast":null,"code":"import{useCallback}from'react';export const usePdfViewer=()=>{// Processar URL para garantir que esteja no formato correto\nconst processUrl=useCallback(url=>{if(!url)return'';try{// Se a URL j√° tem protocolo, retornar como est√°\nif(url.startsWith('http://')||url.startsWith('https://')){return url;}// Se come√ßa com /public/, usar a URL base do backend\nif(url.startsWith('/public/')){const backendUrl=process.env.REACT_APP_BACKEND_URL||'http://localhost:8080';return\"\".concat(backendUrl).concat(url);}// Se √© apenas um nome de arquivo ou caminho relativo\nif(!url.startsWith('/')){const backendUrl=process.env.REACT_APP_BACKEND_URL||'http://localhost:8080';return\"\".concat(backendUrl,\"/public/\").concat(url);}// Para outros casos, assumir que √© um caminho absoluto do servidor\nconst backendUrl=process.env.REACT_APP_BACKEND_URL||'http://localhost:8080';return\"\".concat(backendUrl).concat(url);}catch(error){console.error('‚ùå Erro ao processar URL:',error);return url;}},[]);// Verificar se uma URL √© um PDF\nconst isPdfUrl=(mediaUrl,body,mediaType)=>{// Verifica pelo mediaType primeiro\nif(mediaType===\"application/pdf\")return true;// Verifica pela extens√£o do arquivo na URL\nif(mediaUrl){const url=mediaUrl.toLowerCase();return url.endsWith('.pdf')||url.includes('.pdf?')||url.includes('/pdf/');}// Verifica no body como fallback\nif(body){return body.toLowerCase().includes('.pdf');}return false;};// Validar se a URL parece ser v√°lida\nconst validatePdfUrl=useCallback((url,filename)=>{if(!url||typeof url!=='string'){return false;}// URLs muito curtas provavelmente s√£o inv√°lidas\nif(url.length<5){return false;}// Verificar se tem caracteres suspeitos\nif(url.includes('undefined')||url.includes('null')){return false;}return true;},[]);// Fazer download do PDF\nconst downloadPdf=useCallback(function(url){let filename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'documento.pdf';console.log('üì• Fazendo download:',{url,filename});if(!url){console.error('‚ùå URL do PDF n√£o fornecida para download');alert('Erro: N√£o √© poss√≠vel fazer download, URL n√£o encontrada');return;}try{// Processar URL antes do download\nconst processedUrl=processUrl(url);const link=document.createElement('a');link.href=processedUrl;link.download=filename;link.target='_blank';link.rel='noopener noreferrer';// Adicionar ao DOM temporariamente\ndocument.body.appendChild(link);link.click();document.body.removeChild(link);console.log('‚úÖ Download iniciado com sucesso');}catch(error){console.error('‚ùå Erro ao fazer download:',error);// Fallback: abrir em nova aba\ntry{const processedUrl=processUrl(url);window.open(processedUrl,'_blank','noopener,noreferrer');}catch(fallbackError){console.error('‚ùå Erro no fallback:',fallbackError);alert('Erro ao fazer download do arquivo');}}},[processUrl]);// Extrair informa√ß√µes de um arquivo PDF de uma mensagem\nconst extractPdfInfoFromMessage=useCallback(message=>{console.log('üîç Extraindo info do PDF da mensagem:',message);const info={url:message.mediaUrl||'',filename:'documento.pdf',size:message.fileSize||null,mediaType:message.mediaType||'',isPdf:false};// Extrair filename do body da mensagem\nif(message.body&&typeof message.body==='string'){const body=message.body.trim();// Se o body √© curto e tem extens√£o, provavelmente √© um nome de arquivo\nif(body.length<100&&body.includes('.')){info.filename=body;}}// Extrair filename da URL se n√£o obtido do body\nif(info.filename==='documento.pdf'&&info.url){try{const urlParts=info.url.split('/');const urlFilename=urlParts[urlParts.length-1];// Remover par√¢metros de query se houver\nconst cleanFilename=urlFilename.split('?')[0];const decodedFilename=decodeURIComponent(cleanFilename);if(decodedFilename&&decodedFilename.includes('.')){info.filename=decodedFilename;}}catch(error){console.warn('‚ö†Ô∏è Erro ao extrair filename da URL:',error);}}// Verificar se √© PDF\ninfo.isPdf=isPdfUrl(info.url,info.filename,info.mediaType);console.log('üìÑ Info extra√≠da:',info);return info;},[isPdfUrl]);return{// A√ß√µes principais\ndownloadPdf,// Utilit√°rios\nisPdfUrl,validatePdfUrl,extractPdfInfoFromMessage,processUrl};};","map":{"version":3,"names":["useCallback","usePdfViewer","processUrl","url","startsWith","backendUrl","process","env","REACT_APP_BACKEND_URL","concat","error","console","isPdfUrl","mediaUrl","body","mediaType","toLowerCase","endsWith","includes","validatePdfUrl","filename","length","downloadPdf","arguments","undefined","log","alert","processedUrl","link","document","createElement","href","download","target","rel","appendChild","click","removeChild","window","open","fallbackError","extractPdfInfoFromMessage","message","info","size","fileSize","isPdf","trim","urlParts","split","urlFilename","cleanFilename","decodedFilename","decodeURIComponent","warn"],"sources":["/home/deploy/atendechatop/frontend/src/hooks/usePdfViewer.js"],"sourcesContent":["import { useCallback } from 'react';\n\nexport const usePdfViewer = () => {\n  \n  // Processar URL para garantir que esteja no formato correto\n  const processUrl = useCallback((url) => {\n    if (!url) return '';\n    \n    try {\n      // Se a URL j√° tem protocolo, retornar como est√°\n      if (url.startsWith('http://') || url.startsWith('https://')) {\n        return url;\n      }\n      \n      // Se come√ßa com /public/, usar a URL base do backend\n      if (url.startsWith('/public/')) {\n        const backendUrl = process.env.REACT_APP_BACKEND_URL || 'http://localhost:8080';\n        return `${backendUrl}${url}`;\n      }\n      \n      // Se √© apenas um nome de arquivo ou caminho relativo\n      if (!url.startsWith('/')) {\n        const backendUrl = process.env.REACT_APP_BACKEND_URL || 'http://localhost:8080';\n        return `${backendUrl}/public/${url}`;\n      }\n      \n      // Para outros casos, assumir que √© um caminho absoluto do servidor\n      const backendUrl = process.env.REACT_APP_BACKEND_URL || 'http://localhost:8080';\n      return `${backendUrl}${url}`;\n      \n    } catch (error) {\n      console.error('‚ùå Erro ao processar URL:', error);\n      return url;\n    }\n  }, []);\n\n  // Verificar se uma URL √© um PDF\n  const isPdfUrl = (mediaUrl, body, mediaType) => {\n    // Verifica pelo mediaType primeiro\n    if (mediaType === \"application/pdf\") return true;\n    \n    // Verifica pela extens√£o do arquivo na URL\n    if (mediaUrl) {\n      const url = mediaUrl.toLowerCase();\n      return url.endsWith('.pdf') || \n             url.includes('.pdf?') || \n             url.includes('/pdf/');\n    }\n    \n    // Verifica no body como fallback\n    if (body) {\n      return body.toLowerCase().includes('.pdf');\n    }\n    \n    return false;\n  };\n\n  // Validar se a URL parece ser v√°lida\n  const validatePdfUrl = useCallback((url, filename) => {\n    if (!url || typeof url !== 'string') {\n      return false;\n    }\n\n    // URLs muito curtas provavelmente s√£o inv√°lidas\n    if (url.length < 5) {\n      return false;\n    }\n\n    // Verificar se tem caracteres suspeitos\n    if (url.includes('undefined') || url.includes('null')) {\n      return false;\n    }\n\n    return true;\n  }, []);\n\n  // Fazer download do PDF\n  const downloadPdf = useCallback((url, filename = 'documento.pdf') => {\n    console.log('üì• Fazendo download:', { url, filename });\n    \n    if (!url) {\n      console.error('‚ùå URL do PDF n√£o fornecida para download');\n      alert('Erro: N√£o √© poss√≠vel fazer download, URL n√£o encontrada');\n      return;\n    }\n\n    try {\n      // Processar URL antes do download\n      const processedUrl = processUrl(url);\n      \n      const link = document.createElement('a');\n      link.href = processedUrl;\n      link.download = filename;\n      link.target = '_blank';\n      link.rel = 'noopener noreferrer';\n      \n      // Adicionar ao DOM temporariamente\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      \n      console.log('‚úÖ Download iniciado com sucesso');\n    } catch (error) {\n      console.error('‚ùå Erro ao fazer download:', error);\n      \n      // Fallback: abrir em nova aba\n      try {\n        const processedUrl = processUrl(url);\n        window.open(processedUrl, '_blank', 'noopener,noreferrer');\n      } catch (fallbackError) {\n        console.error('‚ùå Erro no fallback:', fallbackError);\n        alert('Erro ao fazer download do arquivo');\n      }\n    }\n  }, [processUrl]);\n\n  // Extrair informa√ß√µes de um arquivo PDF de uma mensagem\n  const extractPdfInfoFromMessage = useCallback((message) => {\n    console.log('üîç Extraindo info do PDF da mensagem:', message);\n    \n    const info = {\n      url: message.mediaUrl || '',\n      filename: 'documento.pdf',\n      size: message.fileSize || null,\n      mediaType: message.mediaType || '',\n      isPdf: false\n    };\n\n    // Extrair filename do body da mensagem\n    if (message.body && typeof message.body === 'string') {\n      const body = message.body.trim();\n      // Se o body √© curto e tem extens√£o, provavelmente √© um nome de arquivo\n      if (body.length < 100 && body.includes('.')) {\n        info.filename = body;\n      }\n    }\n\n    // Extrair filename da URL se n√£o obtido do body\n    if (info.filename === 'documento.pdf' && info.url) {\n      try {\n        const urlParts = info.url.split('/');\n        const urlFilename = urlParts[urlParts.length - 1];\n        \n        // Remover par√¢metros de query se houver\n        const cleanFilename = urlFilename.split('?')[0];\n        const decodedFilename = decodeURIComponent(cleanFilename);\n        \n        if (decodedFilename && decodedFilename.includes('.')) {\n          info.filename = decodedFilename;\n        }\n      } catch (error) {\n        console.warn('‚ö†Ô∏è Erro ao extrair filename da URL:', error);\n      }\n    }\n\n    // Verificar se √© PDF\n    info.isPdf = isPdfUrl(info.url, info.filename, info.mediaType);\n\n    console.log('üìÑ Info extra√≠da:', info);\n    return info;\n  }, [isPdfUrl]);\n\n  return {\n    // A√ß√µes principais\n    downloadPdf,\n    \n    // Utilit√°rios\n    isPdfUrl,\n    validatePdfUrl,\n    extractPdfInfoFromMessage,\n    processUrl,\n  };\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}