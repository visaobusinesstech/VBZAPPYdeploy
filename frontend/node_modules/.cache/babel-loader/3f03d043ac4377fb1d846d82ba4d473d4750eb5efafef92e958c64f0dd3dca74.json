{"ast":null,"code":"import _objectSpread from\"/home/deploy/codigologlow/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useContext}from\"react\";import{toast}from\"react-toastify\";import{makeStyles}from\"@material-ui/core/styles\";import{Paper,Typography,Switch,FormControlLabel,TextField,Button,Grid,Divider,Box,Card,CardContent,CardHeader,IconButton,Collapse,Select,MenuItem,FormControl,InputLabel}from\"@material-ui/core\";import{Cake as CakeIcon,Person as PersonIcon,Phone as PhoneIcon,Schedule as ScheduleIcon,Announcement as AnnouncementIcon,ExpandMore as ExpandMoreIcon,Save as SaveIcon,Settings as TestIcon,Info as InfoIcon}from\"@material-ui/icons\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";import{WhatsAppsContext}from\"../../context/WhatsApp/WhatsAppsContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({root:{padding:theme.spacing(3)},paper:{padding:theme.spacing(3),marginBottom:theme.spacing(2)},sectionTitle:{display:\"flex\",alignItems:\"center\",gap:theme.spacing(1),marginBottom:theme.spacing(2),color:theme.palette.primary.main,fontWeight:600},settingItem:{marginBottom:theme.spacing(2)},messageField:{marginTop:theme.spacing(1)},timeField:{maxWidth:200},saveButton:{background:\"linear-gradient(135deg, #1976d2 0%, #1565c0 100%)\",color:\"white\",fontWeight:600,textTransform:\"none\",borderRadius:8,padding:theme.spacing(1,3),\"&:hover\":{transform:\"translateY(-1px)\",boxShadow:\"0 4px 12px rgba(25, 118, 210, 0.3)\"}},testButton:{background:\"linear-gradient(135deg, #ff9800 0%, #f57c00 100%)\",color:\"white\",fontWeight:600,textTransform:\"none\",borderRadius:8,marginLeft:theme.spacing(1),\"&:hover\":{transform:\"translateY(-1px)\",boxShadow:\"0 4px 12px rgba(255, 152, 0, 0.3)\"}},expandButton:{transform:\"rotate(0deg)\",transition:theme.transitions.create(\"transform\",{duration:theme.transitions.duration.shortest})},expandButtonOpen:{transform:\"rotate(180deg)\"},helpText:{fontSize:\"0.875rem\",color:theme.palette.text.secondary,marginTop:theme.spacing(0.5)},messagePreview:{backgroundColor:theme.palette.grey[100],padding:theme.spacing(2),borderRadius:8,marginTop:theme.spacing(1),border:\"1px solid \".concat(theme.palette.grey[300])},variableChip:{backgroundColor:theme.palette.primary.main,color:\"white\",padding:\"2px 8px\",borderRadius:4,fontSize:\"0.75rem\",fontFamily:\"monospace\",margin:\"0 2px\"},infoBox:{backgroundColor:\"#e3f2fd\",border:\"1px solid #90caf9\",borderRadius:8,padding:theme.spacing(2),marginTop:theme.spacing(2),display:\"flex\",alignItems:\"flex-start\",gap:theme.spacing(1)},infoIcon:{color:\"#1976d2\",fontSize:\"1.25rem\",marginTop:2},infoContent:{flex:1}}));const BirthdaySettings=()=>{const classes=useStyles();const{whatsApps}=useContext(WhatsAppsContext);const[settings,setSettings]=useState(null);const[loading,setLoading]=useState(true);const[saving,setSaving]=useState(false);const[expandedSections,setExpandedSections]=useState({user:true,contact:true,general:true});useEffect(()=>{fetchSettings();},[]);const fetchSettings=async()=>{try{const{data}=await api.get(\"/birthdays/settings\");setSettings(data.data);}catch(error){toast.error(\"Erro ao carregar configura√ß√µes de anivers√°rio\");}finally{setLoading(false);}};const handleSettingChange=(field,value)=>{setSettings(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));};const handleSave=async()=>{setSaving(true);try{await api.put(\"/birthdays/settings\",settings);toast.success(\"Configura√ß√µes de anivers√°rio salvas com sucesso! üéâ\");}catch(error){toast.error(\"Erro ao salvar configura√ß√µes\");}finally{setSaving(false);}};const handleTestMessage=async messageType=>{// Para teste, vamos pedir um contato v√°lido\nconst contactId=prompt(\"Digite o ID de um contato para teste:\");if(!contactId)return;try{await api.post(\"/birthdays/test-message\",{contactId:parseInt(contactId),messageType});toast.success(\"Mensagem de teste enviada! üì±\");}catch(error){toast.error(\"Erro ao enviar mensagem de teste\");}};const toggleSection=section=>{setExpandedSections(prev=>_objectSpread(_objectSpread({},prev),{},{[section]:!prev[section]}));};const renderMessagePreview=(message,type)=>{if(!message)return null;let previewMessage=message;previewMessage=previewMessage.replace(/{nome}/g,\"<span class=\\\"\".concat(classes.variableChip,\"\\\">Jo\\xE3o Silva</span>\"));previewMessage=previewMessage.replace(/{idade}/g,\"<span class=\\\"\".concat(classes.variableChip,\"\\\">30</span>\"));return/*#__PURE__*/_jsxs(Box,{className:classes.messagePreview,children:[/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",children:\"Pr\\xE9-visualiza\\xE7\\xE3o:\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",dangerouslySetInnerHTML:{__html:previewMessage}})]});};if(loading){return/*#__PURE__*/_jsx(Box,{className:classes.root,children:/*#__PURE__*/_jsx(Typography,{children:\"Carregando configura\\xE7\\xF5es...\"})});}return/*#__PURE__*/_jsxs(Box,{className:classes.root,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:\"\\uD83C\\uDF82 Configura\\xE7\\xF5es de Anivers\\xE1rio\"}),/*#__PURE__*/_jsxs(Paper,{className:classes.paper,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",justifyContent:\"space-between\",children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",className:classes.sectionTitle,children:[/*#__PURE__*/_jsx(PersonIcon,{}),\"Anivers\\xE1rios de Usu\\xE1rios\"]}),/*#__PURE__*/_jsx(IconButton,{className:\"\".concat(classes.expandButton,\" \").concat(expandedSections.user?classes.expandButtonOpen:\"\"),onClick:()=>toggleSection(\"user\"),children:/*#__PURE__*/_jsx(ExpandMoreIcon,{})})]}),/*#__PURE__*/_jsx(Collapse,{in:expandedSections.user,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:(settings===null||settings===void 0?void 0:settings.userBirthdayEnabled)||false,onChange:e=>handleSettingChange(\"userBirthdayEnabled\",e.target.checked),color:\"primary\"}),label:\"Habilitar notifica\\xE7\\xF5es de anivers\\xE1rio de usu\\xE1rios\"}),/*#__PURE__*/_jsx(Typography,{className:classes.helpText,children:\"Quando habilitado, ser\\xE1 exibido modal de parab\\xE9ns e criado informativo autom\\xE1tico\"})]}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:(settings===null||settings===void 0?void 0:settings.createAnnouncementForUsers)||false,onChange:e=>handleSettingChange(\"createAnnouncementForUsers\",e.target.checked),color:\"primary\",disabled:!(settings!==null&&settings!==void 0&&settings.userBirthdayEnabled)}),label:\"Criar informativo autom\\xE1tico para anivers\\xE1rios de usu\\xE1rios\"}),/*#__PURE__*/_jsx(Typography,{className:classes.helpText,children:\"Cria um informativo autom\\xE1tico que \\xE9 exibido para todos os usu\\xE1rios da empresa\"})]}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,multiline:true,rows:3,label:\"Mensagem de anivers\\xE1rio para usu\\xE1rios\",value:(settings===null||settings===void 0?void 0:settings.userBirthdayMessage)||\"\",onChange:e=>handleSettingChange(\"userBirthdayMessage\",e.target.value),disabled:!(settings!==null&&settings!==void 0&&settings.userBirthdayEnabled),className:classes.messageField,helperText:\"Use {nome} para incluir o nome do usu\\xE1rio\"}),renderMessagePreview(settings===null||settings===void 0?void 0:settings.userBirthdayMessage,\"user\")]})]})})]}),/*#__PURE__*/_jsxs(Paper,{className:classes.paper,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",justifyContent:\"space-between\",children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",className:classes.sectionTitle,children:[/*#__PURE__*/_jsx(PhoneIcon,{}),\"Anivers\\xE1rios de Contatos\"]}),/*#__PURE__*/_jsx(IconButton,{className:\"\".concat(classes.expandButton,\" \").concat(expandedSections.contact?classes.expandButtonOpen:\"\"),onClick:()=>toggleSection(\"contact\"),children:/*#__PURE__*/_jsx(ExpandMoreIcon,{})})]}),/*#__PURE__*/_jsx(Collapse,{in:expandedSections.contact,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:(settings===null||settings===void 0?void 0:settings.contactBirthdayEnabled)||false,onChange:e=>handleSettingChange(\"contactBirthdayEnabled\",e.target.checked),color:\"primary\"}),label:\"Habilitar envio autom\\xE1tico de mensagens de anivers\\xE1rio para contatos\"}),/*#__PURE__*/_jsx(Typography,{className:classes.helpText,children:\"Envia automaticamente mensagem de parab\\xE9ns via WhatsApp para contatos aniversariantes\"})]}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,multiline:true,rows:4,label:\"Mensagem de anivers\\xE1rio para contatos\",value:(settings===null||settings===void 0?void 0:settings.contactBirthdayMessage)||\"\",onChange:e=>handleSettingChange(\"contactBirthdayMessage\",e.target.value),disabled:!(settings!==null&&settings!==void 0&&settings.contactBirthdayEnabled),className:classes.messageField,helperText:\"Use {nome} para incluir o nome do contato e {idade} para a idade\"}),renderMessagePreview(settings===null||settings===void 0?void 0:settings.contactBirthdayMessage,\"contact\"),(settings===null||settings===void 0?void 0:settings.contactBirthdayEnabled)&&/*#__PURE__*/_jsx(Button,{variant:\"contained\",className:classes.testButton,startIcon:/*#__PURE__*/_jsx(TestIcon,{}),onClick:()=>handleTestMessage(\"contact\"),size:\"small\",style:{marginTop:8},children:\"Testar Mensagem\"})]})]})})]}),/*#__PURE__*/_jsxs(Paper,{className:classes.paper,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",justifyContent:\"space-between\",children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",className:classes.sectionTitle,children:[/*#__PURE__*/_jsx(ScheduleIcon,{}),\"Configura\\xE7\\xF5es Gerais\"]}),/*#__PURE__*/_jsx(IconButton,{className:\"\".concat(classes.expandButton,\" \").concat(expandedSections.general?classes.expandButtonOpen:\"\"),onClick:()=>toggleSection(\"general\"),children:/*#__PURE__*/_jsx(ExpandMoreIcon,{})})]}),/*#__PURE__*/_jsxs(Collapse,{in:expandedSections.general,children:[/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsx(TextField,{type:\"time\",label:\"Hor\\xE1rio de envio das mensagens\",value:(settings===null||settings===void 0?void 0:settings.sendBirthdayTime)||\"09:00:00\",onChange:e=>{// Converter HH:MM para HH:MM:SS para compatibilidade com backend\nconst timeValue=e.target.value;const formattedTime=timeValue?\"\".concat(timeValue,\":00\"):\"09:00:00\";handleSettingChange(\"sendBirthdayTime\",formattedTime);},className:classes.timeField,InputLabelProps:{shrink:true},helperText:\"Hor\\xE1rio em que as mensagens autom\\xE1ticas ser\\xE3o enviadas\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Conex\\xE3o WhatsApp para Envio\"}),/*#__PURE__*/_jsxs(Select,{value:(settings===null||settings===void 0?void 0:settings.whatsappId)||\"\",onChange:e=>handleSettingChange(\"whatsappId\",e.target.value||null),label:\"Conex\\xE3o WhatsApp para Envio\",disabled:!(settings!==null&&settings!==void 0&&settings.contactBirthdayEnabled),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:/*#__PURE__*/_jsx(\"em\",{children:\"Selecione uma conex\\xE3o\"})}),(whatsApps===null||whatsApps===void 0?void 0:whatsApps.length)>0&&whatsApps.map(whatsapp=>/*#__PURE__*/_jsx(MenuItem,{value:whatsapp.id,children:/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(Box,{width:8,height:8,borderRadius:\"50%\",bgcolor:whatsapp.status===\"CONNECTED\"?\"success.main\":\"error.main\",mr:1}),whatsapp.name,\" (\",whatsapp.status,\")\"]})},whatsapp.id))]}),/*#__PURE__*/_jsx(Typography,{className:classes.helpText,children:\"Conex\\xE3o WhatsApp que ser\\xE1 usada para enviar mensagens de anivers\\xE1rio\"})]})}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:(settings===null||settings===void 0?void 0:settings.createAnnouncementForUsers)||false,onChange:e=>handleSettingChange(\"createAnnouncementForUsers\",e.target.checked),color:\"primary\"}),label:\"Criar informativo interno para anivers\\xE1rios de usu\\xE1rios\"}),/*#__PURE__*/_jsx(Typography,{className:classes.helpText,children:\"Cria um informativo interno quando um usu\\xE1rio faz anivers\\xE1rio\"})]})]}),/*#__PURE__*/_jsxs(Box,{className:classes.infoBox,children:[/*#__PURE__*/_jsx(InfoIcon,{className:classes.infoIcon}),/*#__PURE__*/_jsxs(Box,{className:classes.infoContent,children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",style:{fontWeight:600,marginBottom:8},children:\"Vari\\xE1veis dispon\\xEDveis nas mensagens:\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",component:\"div\",children:[\"\\u2022 \",/*#__PURE__*/_jsx(\"code\",{children:\"{nome}\"}),\" - Nome da pessoa\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u2022 \",/*#__PURE__*/_jsx(\"code\",{children:\"{idade}\"}),\" - Idade da pessoa (apenas para contatos)\"]})]})]})]})]}),/*#__PURE__*/_jsx(Box,{textAlign:\"center\",mt:3,children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",className:classes.saveButton,startIcon:/*#__PURE__*/_jsx(SaveIcon,{}),onClick:handleSave,disabled:saving,size:\"large\",children:saving?\"Salvando...\":\"Salvar Configura√ß√µes\"})})]});};export default BirthdaySettings;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}