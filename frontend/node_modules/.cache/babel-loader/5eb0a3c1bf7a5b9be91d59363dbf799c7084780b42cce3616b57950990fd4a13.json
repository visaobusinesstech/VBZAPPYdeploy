{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{IconButton,Tooltip,Button,Typography,Box,Fade,Paper,CircularProgress}from\"@material-ui/core\";import{Update as UpdateIcon,Refresh as RefreshIcon,Info as InfoIcon,Close as CloseIcon}from\"@material-ui/icons\";import{makeStyles}from\"@material-ui/core/styles\";import api from\"../../services/api\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const packageVersion=require(\"../../../package.json\").version;const useStyles=makeStyles(theme=>({banner:{position:\"fixed\",top:64,left:\"50%\",transform:\"translateX(-50%)\",zIndex:theme.zIndex.drawer+2,borderRadius:\"8px\",boxShadow:\"0 4px 12px rgba(0,0,0,0.2)\",backgroundColor:theme.palette.info.main,color:\"white\",padding:theme.spacing(1.5,3),display:\"flex\",alignItems:\"center\",justifyContent:\"space-between\",maxWidth:\"600px\",minWidth:\"400px\",width:\"90%\",[theme.breakpoints.down(\"sm\")]:{width:\"95%\",minWidth:\"300px\",padding:theme.spacing(1,2)}},pulseIcon:{animation:\"$pulse 2s infinite\",color:theme.palette.error.main},updateButton:{backgroundColor:theme.palette.success.main,color:\"white\",fontWeight:\"bold\",\"&:hover\":{backgroundColor:theme.palette.success.dark}},bannerButton:{backgroundColor:\"rgba(255, 255, 255, 0.2)\",color:\"white\",border:\"1px solid rgba(255, 255, 255, 0.3)\",\"&:hover\":{backgroundColor:\"rgba(255, 255, 255, 0.3)\"}},iconContainer:{display:\"flex\",alignItems:\"center\",marginRight:theme.spacing(1)},\"@keyframes pulse\":{\"0%\":{transform:\"scale(1)\",opacity:1},\"50%\":{transform:\"scale(1.1)\",opacity:0.8},\"100%\":{transform:\"scale(1)\",opacity:1}}}));const VersionControl=()=>{const classes=useStyles();const[storedVersion]=useState(window.localStorage.getItem(\"version\")||\"4.7.7\");const[showBanner,setShowBanner]=useState(false);const[isUpdating,setIsUpdating]=useState(false);const hasNewVersion=storedVersion!==packageVersion;useEffect(()=>{if(hasNewVersion){const timer=setTimeout(()=>setShowBanner(true),2000);return()=>clearTimeout(timer);}},[hasNewVersion]);const handleUpdate=async()=>{setIsUpdating(true);try{window.localStorage.setItem(\"version\",packageVersion);await api.post(\"/version\",{version:packageVersion});if('caches'in window){const cacheNames=await caches.keys();await Promise.all(cacheNames.map(name=>caches.delete(name)));}setTimeout(()=>window.location.reload(),1000);}catch(error){console.error(\"Erro na atualização:\",error);setIsUpdating(false);}};if(!hasNewVersion){return null;}return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Fade,{in:showBanner&&!isUpdating,children:/*#__PURE__*/_jsxs(Paper,{className:classes.banner,elevation:4,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",flex:1,children:[/*#__PURE__*/_jsx(\"div\",{className:classes.iconContainer,children:/*#__PURE__*/_jsx(InfoIcon,{})}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[/*#__PURE__*/_jsxs(\"strong\",{children:[\"Nova vers\\xE3o \",packageVersion,\" dispon\\xEDvel!\"]}),\" Clique em atualizar para obter as últimas melhorias.\"]})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",gap:1,alignItems:\"center\",ml:2,children:[isUpdating&&/*#__PURE__*/_jsx(CircularProgress,{size:20,style:{color:\"white\"}}),/*#__PURE__*/_jsx(Button,{size:\"small\",onClick:handleUpdate,disabled:isUpdating,startIcon:!isUpdating&&/*#__PURE__*/_jsx(RefreshIcon,{}),className:classes.updateButton,children:isUpdating?\"Atualizando...\":\"Atualizar\"}),!isUpdating&&/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>setShowBanner(false),style:{color:\"white\"},children:/*#__PURE__*/_jsx(CloseIcon,{fontSize:\"small\"})})]})]})})});};export default VersionControl;","map":{"version":3,"names":["React","useState","useEffect","IconButton","Tooltip","Button","Typography","Box","Fade","Paper","CircularProgress","Update","UpdateIcon","Refresh","RefreshIcon","Info","InfoIcon","Close","CloseIcon","makeStyles","api","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","packageVersion","require","version","useStyles","theme","banner","position","top","left","transform","zIndex","drawer","borderRadius","boxShadow","backgroundColor","palette","info","main","color","padding","spacing","display","alignItems","justifyContent","maxWidth","minWidth","width","breakpoints","down","pulseIcon","animation","error","updateButton","success","fontWeight","dark","bannerButton","border","iconContainer","marginRight","opacity","VersionControl","classes","storedVersion","window","localStorage","getItem","showBanner","setShowBanner","isUpdating","setIsUpdating","hasNewVersion","timer","setTimeout","clearTimeout","handleUpdate","setItem","post","cacheNames","caches","keys","Promise","all","map","name","delete","location","reload","console","children","in","className","elevation","flex","variant","gap","ml","size","style","onClick","disabled","startIcon","fontSize"],"sources":["/home/deploy/codigologlow/frontend/src/components/VersionControl/index.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport {\n  IconButton,\n  Tooltip,\n  Button,\n  Typography,\n  Box,\n  Fade,\n  Paper,\n  CircularProgress,\n} from \"@material-ui/core\";\nimport { \n  Update as UpdateIcon, \n  Refresh as RefreshIcon,\n  Info as InfoIcon,\n  Close as CloseIcon \n} from \"@material-ui/icons\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport api from \"../../services/api\";\n\nconst packageVersion = require(\"../../../package.json\").version;\n\nconst useStyles = makeStyles((theme) => ({\n  banner: {\n    position: \"fixed\",\n    top: 64,\n    left: \"50%\",\n    transform: \"translateX(-50%)\",\n    zIndex: theme.zIndex.drawer + 2,\n    borderRadius: \"8px\",\n    boxShadow: \"0 4px 12px rgba(0,0,0,0.2)\",\n    backgroundColor: theme.palette.info.main,\n    color: \"white\",\n    padding: theme.spacing(1.5, 3),\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    maxWidth: \"600px\",\n    minWidth: \"400px\",\n    width: \"90%\",\n    [theme.breakpoints.down(\"sm\")]: {\n      width: \"95%\",\n      minWidth: \"300px\",\n      padding: theme.spacing(1, 2),\n    },\n  },\n  pulseIcon: {\n    animation: \"$pulse 2s infinite\",\n    color: theme.palette.error.main,\n  },\n  updateButton: {\n    backgroundColor: theme.palette.success.main,\n    color: \"white\",\n    fontWeight: \"bold\",\n    \"&:hover\": {\n      backgroundColor: theme.palette.success.dark,\n    },\n  },\n  bannerButton: {\n    backgroundColor: \"rgba(255, 255, 255, 0.2)\",\n    color: \"white\",\n    border: \"1px solid rgba(255, 255, 255, 0.3)\",\n    \"&:hover\": {\n      backgroundColor: \"rgba(255, 255, 255, 0.3)\",\n    },\n  },\n  iconContainer: {\n    display: \"flex\",\n    alignItems: \"center\",\n    marginRight: theme.spacing(1),\n  },\n  \"@keyframes pulse\": {\n    \"0%\": { transform: \"scale(1)\", opacity: 1 },\n    \"50%\": { transform: \"scale(1.1)\", opacity: 0.8 },\n    \"100%\": { transform: \"scale(1)\", opacity: 1 },\n  },\n}));\n\nconst VersionControl = () => {\n  const classes = useStyles();\n  const [storedVersion] = useState(\n    window.localStorage.getItem(\"version\") || \"4.7.7\"\n  );\n  const [showBanner, setShowBanner] = useState(false);\n  const [isUpdating, setIsUpdating] = useState(false);\n\n  const hasNewVersion = storedVersion !== packageVersion;\n\n  useEffect(() => {\n    if (hasNewVersion) {\n      const timer = setTimeout(() => setShowBanner(true), 2000);\n      return () => clearTimeout(timer);\n    }\n  }, [hasNewVersion]);\n\n  const handleUpdate = async () => {\n    setIsUpdating(true);\n    \n    try {\n      window.localStorage.setItem(\"version\", packageVersion);\n      await api.post(\"/version\", { version: packageVersion });\n\n      if ('caches' in window) {\n        const cacheNames = await caches.keys();\n        await Promise.all(cacheNames.map(name => caches.delete(name)));\n      }\n\n      setTimeout(() => window.location.reload(), 1000);\n    } catch (error) {\n      console.error(\"Erro na atualização:\", error);\n      setIsUpdating(false);\n    }\n  };\n\n  if (!hasNewVersion) {\n    return null;\n  }\n\n  return (\n    <>\n      {/* Banner de Atualização Centralizado */}\n      <Fade in={showBanner && !isUpdating}>\n        <Paper className={classes.banner} elevation={4}>\n          <Box display=\"flex\" alignItems=\"center\" flex={1}>\n            <div className={classes.iconContainer}>\n              <InfoIcon />\n            </div>\n            <Typography variant=\"body2\">\n              <strong>Nova versão {packageVersion} disponível!</strong>\n              {\" Clique em atualizar para obter as últimas melhorias.\"}\n            </Typography>\n          </Box>\n          <Box display=\"flex\" gap={1} alignItems=\"center\" ml={2}>\n            {isUpdating && <CircularProgress size={20} style={{ color: \"white\" }} />}\n            <Button\n              size=\"small\"\n              onClick={handleUpdate}\n              disabled={isUpdating}\n              startIcon={!isUpdating && <RefreshIcon />}\n              className={classes.updateButton}\n            >\n              {isUpdating ? \"Atualizando...\" : \"Atualizar\"}\n            </Button>\n            {!isUpdating && (\n              <IconButton\n                size=\"small\"\n                onClick={() => setShowBanner(false)}\n                style={{ color: \"white\" }}\n              >\n                <CloseIcon fontSize=\"small\" />\n              </IconButton>\n            )}\n          </Box>\n        </Paper>\n      </Fade>\n    </>\n  );\n};\n\nexport default VersionControl;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}